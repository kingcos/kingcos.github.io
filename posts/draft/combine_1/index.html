<!DOCTYPE html>
<html lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="kingcos" />
	
	
	
	<title>Combine ï½œ kingcos</title>
	
    
    
    <meta name="description" content="ä¸‰è¨€ä¸¤è¯­ï¼Œè¯è¯´ Swiftã€‚" />
    

    
    
    <meta name="keywords" content="Hugo, theme, zozo" />
    

	
    
    <link rel="shortcut icon" href="https://kingcos.me/images/favicon.png" />

    <link rel="stylesheet" type="text/css" media="screen" href="https://kingcos.me/css/normalize.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.0/animate.min.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="https://kingcos.me/css/zozo.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://cdn.jsdelivr.net/npm/remixicon@2.5.0/fonts/remixicon.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="https://kingcos.me/css/highlight.css" />

    
    
</head>

<script data-ad-client="ca-pub-9925978992661955" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<body>
    <div class="main animate__animated animate__fadeInDown">
        <div class="nav_container animated fadeInDown">
    <div class="site_nav" id="site_nav">
        <ul>
            
            <li>
                <a href="/">Home</a>
            </li>
            
            <li>
                <a href="/posts/">Archive</a>
            </li>
            
            <li>
                <a href="/tags/">Tags</a>
            </li>
            
            <li>
                <a href="/about/">About</a>
            </li>
            
        </ul>
    </div>
    <div class="menu_icon">
        <a id="menu_icon"><i class="ri-menu-line"></i></a>
    </div>
</div>


<link rel="stylesheet" href="https://kingcos.me/scss/main.min.75b49085bfb07b1bf150a1d59b4773d857e0452a747e37243805218b528a4045.css" integrity="sha256-dbSQhb&#43;wexvxUKHVm0dz2FfgRSp0fjckOAUhi1KKQEU=" media="screen">

<style>
.nav_container {
  height: 1rem;
}
 
table {
    width: 100%;
    table-layout: fixed;
}

 
.markdown code {
    white-space: normal;
    word-wrap: break-word;
    word-break: break-word;
    line-height: 1.5em;
    font-size: 0.85em;
    font-weight: bold;
    display: inline-block;
     
}

 
.menu_icon a {
    font-size: 16px;
}

 
body {
    font-family: 'Hiragino Sans GB', 'SFMono', 'Lato', '-apple-system';
    -webkit-font-smoothing: 'antialiased';
}

 
.markdown strong, .markdown b, .markdown em {
    font-weight: bold;
}

.post .post_content p {
     

    line-height: 1.75em;
}

 
.markdown img {
    max-width: 100%;
    margin: 0 auto;
    display: block;
    border-radius: 0.25rem;
}

 
.ri-stack-line {
    vertical-align: middle;
}

 
.ri-map-pin-time-line {
    vertical-align: middle;
}

 
.chroma .lntd:nth-child(2) {
    width: 100%;
}

 

 
.markdown .book-hint::before {
    content: none;
}

.markdown .book-hint {
    margin: 1rem 0;
    padding: 0.5rem 1rem 0.5rem 0.75rem;

    border-inline-start: 0.25rem solid #e9ecef;
    border-radius: 0.25rem;

    font-style: normal;
     
}

.book-hint strong {
    background-color: transparent;
}

.markdown .book-hint.info {
    border-left-color:#6bf;
    background-color:rgba(102,187,255,.1);
}

.markdown .book-hint.warning {
    border-left-color:#fd6;
    background-color:rgba(255,221,102,.1);
}

.markdown .book-hint.danger {
    border-left-color:#f66;
    background-color:rgba(255,102,102,.1);
}

</style>

        <div class="header animated fadeInDown">
    <div class="site_title_container">
        <div class="site_title">
            
                <a href="https://kingcos.me/">
                    
                    <img class="kingcos" style="margin-top: -20px; margin-left: -10px;" src="/title.svg" width="150px">
                </a>
            
        </div>
        <div class="description">
            <p class="sub_title">ä¸“æ³¨ã€åšæŒ</p>
            <div class="my_socials">
                
                
                <a href="https://github.com/kingcos" title="github" target="_blank"><i class="ri-github-fill"></i></a>
                
                
                
                <a href="https://www.instagram.com/kingcos_v/" title="instagram" target="_blank"><i class="ri-instagram-fill"></i></a>
                
                
                
                <a href="https://twitter.com/kingcos_v" title="twitter" target="_blank"><i class="ri-twitter-fill"></i></a>
                
                
                
                <a href="https://weibo.com/u/1798410923" title="weibo" target="_blank"><i class="ri-weibo-fill"></i></a>
                
                
                
            </div>
        </div>
    </div>
</div>
        <div class="content">
            <div class="post_page">
                <div class="post animate__animated animate__fadeInDown">
                    <div class="post_title post_detail_title">
                        <h2><a href='/posts/draft/combine_1/'>Combine</a></h2>
                        <span class="date">2019.03.11</span>
                        <span>by kingcos</span>
                        
                        
                        
                        
                    </div>
                    <div class="post_content markdown"><ul>
<li>Foundation and UIKit/AppKit ä¸­çš„å¼‚æ­¥æœºåˆ¶ï¼š</li>
</ul>
<ol>
<li>NotificationCenterï¼šäº‹ä»¶å‘ç”Ÿæ—¶æ‰§è¡Œä¸€æ®µä»£ç ï¼ˆeg. è®¾å¤‡æ–¹å‘æ”¹å˜ï¼Œè½¯é”®ç›˜æ˜¾ç¤ºæˆ–éšè—ï¼‰</li>
<li>ä»£ç†ï¼ˆDelegateï¼‰æ¨¡å¼ï¼šå®šä¹‰ä»£è¡¨å¦ä¸€ä¸ªå¯¹è±¡çš„ä»£ç†å¯¹è±¡ï¼ˆeg. AppDelegate ä¸­å®šä¹‰å½“æ–°çš„è¿œç¨‹æ¨é€åˆ°è¾¾æ—¶çš„æ“ä½œï¼Œä½†å¯¹ä»£ç æ‰§è¡Œæ—¶æœºå’Œæ¬¡æ•°æœªçŸ¥ï¼‰</li>
<li>GCD &amp; NSOperationï¼šå®‰æ’åœ¨ç©¿è¡Œé˜Ÿåˆ—ä¸­é¡ºåºæ‰§è¡Œçš„ä»£ç ï¼Œæˆ–è€…åœ¨ä¸åŒä¼˜å…ˆçº§çš„ä¸åŒé˜Ÿåˆ—ä¸­åŒæ—¶è¿è¡Œå¤šä¸ªä»»åŠ¡</li>
<li>é—­åŒ…ï¼šåˆ›å»ºå¯åˆ†ç¦»çš„ä»£ç æ®µï¼Œä¾¿äºå…¶ä»–å¯¹è±¡å¯ä»¥å†³å®šæ˜¯å¦æ‰§è¡Œã€æ‰§è¡Œæ¬¡æ•°ã€ä»¥åŠæ‰§è¡Œæ—¶æœº</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">Publisher&lt;Int, Never&gt;
    â”Œâ”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”
    â”‚    â”‚   â”‚    â”‚      â”‚    â”‚   â”‚    â”‚
 â”€â”€â”€â”‚ 13 â”‚â”€â”€â–¶â”‚ 27 â”‚â”€â”€â”€â”€â”€â–¶â”‚ 35 â”‚â”€â”€â–¶â”‚ 56 â”‚â”€â”€â”‚â”€â–¶
    â”‚    â”‚   â”‚    â”‚      â”‚    â”‚   â”‚    â”‚
    â””â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”˜
time 0:01     0:05        0:15     0:19  STOP
</code></pre></div><h3 id="publisher">Publisher</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="c1">/// Declares that a type can transmit a sequence of values over time.</span>
<span class="c1">/// å£°æ˜ä¸€ç§å¯éšæ—¶é—´ä¼ é€’å€¼åºåˆ—çš„ç±»å‹ã€‚</span>
<span class="c1">///</span>
<span class="c1">/// There are four kinds of messages:</span>
<span class="c1">/// å…±æœ‰å››ç§æ¶ˆæ¯ï¼š</span>
<span class="c1">///     subscription - A connection between `Publisher` and `Subscriber`.</span>
<span class="c1">///     è®¢é˜… - å‘å¸ƒè€…ä¸è®¢é˜…è€…ä¹‹å‰çš„è¿æ¥</span>
<span class="c1">///     value - An element in the sequence.</span>
<span class="c1">///     å€¼ - åºåˆ—ä¸­çš„ä¸€ä¸ªå…ƒç´ </span>
<span class="c1">///     error - The sequence ended with an error (`.failure(e)`).</span>
<span class="c1">///     é”™è¯¯ - åºåˆ—ä»¥é”™è¯¯ç»“æŸï¼ˆ.failure(e)`ï¼‰</span>
<span class="c1">///     complete - The sequence ended successfully (`.finished`).</span>
<span class="c1">///     å®Œæˆ - åºåˆ—ä»¥æˆåŠŸç»“æŸï¼ˆ`.finished`ï¼‰</span>
<span class="c1">/// Both `.failure` and `.finished` are terminal messages.</span>
<span class="c1">/// .failure` å’Œ `.finished` å‡ä¸ºç»ˆæ­¢æ¶ˆæ¯ã€‚</span>
<span class="c1">///</span>
<span class="c1">/// You can summarize these possibilities with a regular expression:</span>
<span class="c1">/// å¯ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼å½’çº³å…¶å¯èƒ½æ€§ï¼š</span>
<span class="c1">///   value*(error|finished)?</span>
<span class="c1">///</span>
<span class="c1">/// Every `Publisher` must adhere to this contract.</span>
<span class="c1">/// æ¯ä¸ªå‘å¸ƒè€…éƒ½å¿…é¡»éµå®ˆè¯¥åè®®</span>
<span class="p">@</span><span class="n">available</span><span class="p">(</span><span class="n">OSX</span> <span class="mf">10.15</span><span class="p">,</span> <span class="n">iOS</span> <span class="mf">13.0</span><span class="p">,</span> <span class="n">tvOS</span> <span class="mf">13.0</span><span class="p">,</span> <span class="n">watchOS</span> <span class="mf">6.0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span>
<span class="kd">public</span> <span class="kd">protocol</span> <span class="nc">Publisher</span> <span class="p">{</span>

    <span class="c1">/// The kind of values published by this publisher.</span>
    <span class="c1">// è¯¥å‘å¸ƒè€…å‘å°„å€¼çš„ç±»å‹ã€‚</span>
    <span class="n">associatedtype</span> <span class="n">Output</span>

    <span class="c1">/// The kind of errors this publisher might publish.</span>
    <span class="c1">/// è¯¥å‘å¸ƒè€…å¯èƒ½å‘å°„é”™è¯¯çš„ç±»å‹ã€‚</span>
    <span class="c1">///</span>
    <span class="c1">/// Use `Never` if this `Publisher` does not publish errors.</span>
    <span class="c1">/// è‹¥è¯¥å‘å¸ƒè€…ä¸ä¼šå‘å°„å‡ºé”™è¯¯å¯ä½¿ç”¨ `Never`</span>
    <span class="n">associatedtype</span> <span class="n">Failure</span> <span class="p">:</span> <span class="n">Error</span>

    <span class="c1">/// This function is called to attach the specified `Subscriber` to this `Publisher` by `subscribe(_:)`</span>
    <span class="c1">/// è¯¥æ–¹æ³•å°†åœ¨ `subscribe(_:)` ä¸­è¢«è°ƒç”¨ï¼ŒæŠŠç‰¹å®šè®¢é˜…è€…é™„åŠ åˆ°è¯¥å‘å¸ƒè€…ä¸Šã€‚</span>
    <span class="c1">///</span>
    <span class="c1">/// - SeeAlso: `subscribe(_:)`</span>
    <span class="c1">/// - Parameters:</span>
    <span class="c1">///     - subscriber: The subscriber to attach to this `Publisher`.</span>
    <span class="c1">///                   once attached it can begin to receive values.</span>
    <span class="c1">///                   é™„åŠ åˆ°è¯¥å‘å¸ƒè€…çš„è®¢é˜…è€…ï¼Œä¸€æ—¦é™„åŠ ä¸Šå³å¼€å§‹æ¥æ”¶å€¼ã€‚</span>
    <span class="kd">func</span> <span class="nf">receive</span><span class="p">&lt;</span><span class="n">S</span><span class="p">&gt;(</span><span class="n">subscriber</span><span class="p">:</span> <span class="n">S</span><span class="p">)</span> <span class="k">where</span> <span class="n">S</span> <span class="p">:</span> <span class="n">Subscriber</span><span class="p">,</span> <span class="kc">Self</span><span class="p">.</span><span class="n">Failure</span> <span class="p">==</span> <span class="n">S</span><span class="p">.</span><span class="n">Failure</span><span class="p">,</span> <span class="kc">Self</span><span class="p">.</span><span class="n">Output</span> <span class="p">==</span> <span class="n">S</span><span class="p">.</span><span class="n">Input</span>
<span class="p">}</span>

<span class="c1">/// åè®®æ‰©å±•</span>
<span class="p">@</span><span class="n">available</span><span class="p">(</span><span class="n">OSX</span> <span class="mf">10.15</span><span class="p">,</span> <span class="n">iOS</span> <span class="mf">13.0</span><span class="p">,</span> <span class="n">tvOS</span> <span class="mf">13.0</span><span class="p">,</span> <span class="n">watchOS</span> <span class="mf">6.0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span>
<span class="kd">extension</span> <span class="nc">Publisher</span> <span class="p">{</span>

    <span class="c1">/// Attaches the specified subscriber to this publisher.</span>
    <span class="c1">/// å°†ç‰¹å®šè®¢é˜…è€…é™„åŠ åˆ°è¯¥å‘å¸ƒè€…ä¸Šã€‚</span>
    <span class="c1">///</span>
    <span class="c1">/// Always call this function instead of `receive(subscriber:)`.</span>
    <span class="c1">/// åº”æ€»æ˜¯è°ƒç”¨è¯¥æ–¹æ³•è€Œé `receive(subscriber:)`ã€‚</span>
    <span class="c1">/// Adopters of `Publisher` must implement `receive(subscriber:)`. The implementation of `subscribe(_:)` in this extension calls through to `receive(subscriber:)`.</span>
    <span class="c1">/// éµå®ˆ `Publisher` çš„ç±»å‹å¿…é¡»å®ç° `receive(subscriber:)`ã€‚è¯¥æ‰©å±•ä¸­çš„ `subscribe(_:)` å®ç°å°†è°ƒç”¨ `receive(subscriber:)`ã€‚</span>
    <span class="c1">/// - SeeAlso: `receive(subscriber:)`</span>
    <span class="c1">/// - Parameters:</span>
    <span class="c1">///     - subscriber: The subscriber to attach to this `Publisher`. After attaching, the subscriber can start to receive values.</span>
    <span class="c1">///                   è¢«é™„åŠ åˆ°å‘å¸ƒè€…çš„è®¢é˜…è€…ã€‚é™„åŠ åï¼Œè®¢é˜…è€…å¯ä»¥å¼€å§‹æ¥æ”¶å€¼ã€‚</span>
    <span class="kd">public</span> <span class="kd">func</span> <span class="nf">subscribe</span><span class="p">&lt;</span><span class="n">S</span><span class="p">&gt;(</span><span class="kc">_</span> <span class="n">subscriber</span><span class="p">:</span> <span class="n">S</span><span class="p">)</span> <span class="k">where</span> <span class="n">S</span> <span class="p">:</span> <span class="n">Subscriber</span><span class="p">,</span> <span class="kc">Self</span><span class="p">.</span><span class="n">Failure</span> <span class="p">==</span> <span class="n">S</span><span class="p">.</span><span class="n">Failure</span><span class="p">,</span> <span class="kc">Self</span><span class="p">.</span><span class="n">Output</span> <span class="p">==</span> <span class="n">S</span><span class="p">.</span><span class="n">Input</span>
<span class="p">}</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="c1">/// A protocol that declares a type that can receive input from a publisher.</span>
<span class="c1">/// å¯ä»¥æ¥æ”¶å‘å¸ƒè€…ä½œä¸ºè¾“å…¥çš„åè®®ã€‚</span>
<span class="p">@</span><span class="n">available</span><span class="p">(</span><span class="n">OSX</span> <span class="mf">10.15</span><span class="p">,</span> <span class="n">iOS</span> <span class="mf">13.0</span><span class="p">,</span> <span class="n">tvOS</span> <span class="mf">13.0</span><span class="p">,</span> <span class="n">watchOS</span> <span class="mf">6.0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span>
<span class="kd">public</span> <span class="kd">protocol</span> <span class="nc">Subscriber</span> <span class="p">:</span> <span class="n">CustomCombineIdentifierConvertible</span> <span class="p">{</span>

    <span class="c1">/// The kind of values this subscriber receives.</span>
    <span class="c1">/// è¯¥è®¢é˜…è€…æ¥æ”¶çš„å€¼çš„ç±»å‹ã€‚</span>
    <span class="n">associatedtype</span> <span class="n">Input</span>

    <span class="c1">/// The kind of errors this subscriber might receive.</span>
    <span class="c1">/// è¯¥è®¢é˜…è€…æ¥æ”¶å¯èƒ½æ¥æ”¶åˆ°é”™è¯¯çš„ç±»å‹ã€‚</span>
    <span class="c1">///</span>
    <span class="c1">/// Use `Never` if this `Subscriber` cannot receive errors.</span>
    <span class="c1">/// è‹¥è¯¥è®¢é˜…è€…ä¸ä¼šæ¥æ”¶åˆ°é”™è¯¯å¯ä½¿ç”¨ `Never`</span>
    <span class="n">associatedtype</span> <span class="n">Failure</span> <span class="p">:</span> <span class="n">Error</span>

    <span class="c1">/// Tells the subscriber that it has successfully subscribed to the publisher and may request items.</span>
    <span class="c1">/// å‘ŠçŸ¥è®¢é˜…è€…å·²æˆåŠŸè®¢é˜…å‘å¸ƒè€…ï¼Œä¸”å¯ä»¥è¯·æ±‚é¡¹ç›®ã€‚</span>
    <span class="c1">///</span>
    <span class="c1">/// Use the received `Subscription` to request items from the publisher.</span>
    <span class="c1">/// ä½¿ç”¨æ¥æ”¶åˆ°çš„ `Subscription` å‘å‘å¸ƒè€…è¯·æ±‚é¡¹ç›®ã€‚</span>
    <span class="c1">/// - Parameter subscription: A subscription that represents the connection between publisher and subscriber.</span>
    <span class="c1">///                           ä»£è¡¨å‘å¸ƒè€…ä¸è®¢é˜…è€…è”ç³»çš„è®¢é˜…ã€‚</span>
    <span class="kd">func</span> <span class="nf">receive</span><span class="p">(</span><span class="n">subscription</span><span class="p">:</span> <span class="n">Subscription</span><span class="p">)</span>

    <span class="c1">/// Tells the subscriber that the publisher has produced an element.</span>
    <span class="c1">/// å‘ŠçŸ¥è®¢é˜…è€…ï¼Œå‘å¸ƒè€…å·²ç»äº§ç”Ÿäº†ä¸€ä¸ªå…ƒç´ ã€‚</span>
    <span class="c1">///</span>
    <span class="c1">/// - Parameter input: The published element.</span>
    <span class="c1">///                    å‘å¸ƒçš„å…ƒç´ ã€‚</span>
    <span class="c1">/// - Returns: A `Demand` instance indicating how many more elements the subcriber expects to receive.</span>
    <span class="c1">///            ä¸€ä¸ª `Demand` å®ä¾‹ï¼ŒæŒ‡è®¢é˜…è€…æœŸæœ›æ¥æ”¶åˆ°çš„å…ƒç´ ä¸ªæ•°ã€‚</span>
    <span class="kd">func</span> <span class="nf">receive</span><span class="p">(</span><span class="kc">_</span> <span class="n">input</span><span class="p">:</span> <span class="kc">Self</span><span class="p">.</span><span class="n">Input</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">Subscribers</span><span class="p">.</span><span class="n">Demand</span>

    <span class="c1">/// Tells the subscriber that the publisher has completed publishing, either normally or with an error.</span>
    <span class="c1">/// å‘ŠçŸ¥è®¢é˜…è€…ï¼Œå‘å¸ƒè€…å·²ç»å®Œæˆå‘å¸ƒï¼Œæ­£å¸¸æŠ‘æˆ–å‘ç”Ÿé”™è¯¯ã€‚</span>
    <span class="c1">///</span>
    <span class="c1">/// - Parameter completion: A `Completion` case indicating whether publishing completed normally or with an error.</span>
    <span class="c1">///                         ä¸€ä¸ª `Completion` æƒ…å†µï¼ŒæŒ‡å‘å¸ƒæ­£å¸¸å®Œæˆï¼Œæˆ–è€…å‡ºé”™ã€‚</span>
    <span class="kd">func</span> <span class="nf">receive</span><span class="p">(</span><span class="n">completion</span><span class="p">:</span> <span class="n">Subscribers</span><span class="p">.</span><span class="n">Completion</span><span class="p">&lt;</span><span class="kc">Self</span><span class="p">.</span><span class="n">Failure</span><span class="p">&gt;)</span>
<span class="p">}</span>
</code></pre></div><h3 id="subscription">Subscription</h3>
<p>è®¢é˜…è€…å¯ä»¥è°ƒç”¨ <code>requestï¼ˆ_ :)</code> è¡¨ç¤ºæ„¿æ„æ¥æ”¶æ›´å¤šçš„å€¼ï¼Œæœ€å¤§ä¸ºæå€¼æˆ–æ— é™åˆ¶ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="c1">/// A protocol representing the connection of a subscriber to a publisher.</span>
<span class="c1">/// ä»£è¡¨è®¢é˜…è€…ä¸å‘å¸ƒè€…è¿æ¥çš„åè®®ã€‚</span>
<span class="c1">///</span>
<span class="c1">/// Subcriptions are class constrained because a `Subscription` has identity -</span>
<span class="c1">/// defined by the moment in time a particular subscriber attached to a publisher.</span>
<span class="c1">/// è®¢é˜…å—ç±»å‹é™åˆ¶ï¼Œå› ä¸º `Subscription` çš„æ ‡ç¤ºç”±è¿æ¥åˆ°å‘å¸ƒè€…çš„ç‰¹å®šè®¢é˜…è€…çš„æ—¶é—´å®šä¹‰ã€‚</span>
<span class="c1">/// Canceling a `Subscription` must be thread-safe.</span>
<span class="c1">/// å–æ¶ˆ `Subscription` å¿…é¡»è¦çº¿ç¨‹å®‰å…¨ã€‚</span>
<span class="c1">///</span>
<span class="c1">/// You can only cancel a `Subscription` once.</span>
<span class="c1">/// `Subscription` åªèƒ½è¢«å–æ¶ˆä¸€æ¬¡ã€‚</span>
<span class="c1">///</span>
<span class="c1">/// Canceling a subscription frees up any resources previously allocated by attaching the `Subscriber`.</span>
<span class="p">@</span><span class="n">available</span><span class="p">(</span><span class="n">OSX</span> <span class="mf">10.15</span><span class="p">,</span> <span class="n">iOS</span> <span class="mf">13.0</span><span class="p">,</span> <span class="n">tvOS</span> <span class="mf">13.0</span><span class="p">,</span> <span class="n">watchOS</span> <span class="mf">6.0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span>
<span class="kd">public</span> <span class="kd">protocol</span> <span class="nc">Subscription</span> <span class="p">:</span> <span class="n">Cancellable</span><span class="p">,</span> <span class="n">CustomCombineIdentifierConvertible</span> <span class="p">{</span>

    <span class="c1">/// Tells a publisher that it may send more values to the subscriber.</span>
    <span class="c1">/// å‘ŠçŸ¥å‘å¸ƒè€…å¯ä»¥å‘é€æ›´å¤šå€¼åˆ°è®¢é˜…è€…ã€‚</span>
    <span class="kd">func</span> <span class="nf">request</span><span class="p">(</span><span class="kc">_</span> <span class="n">demand</span><span class="p">:</span> <span class="n">Subscribers</span><span class="p">.</span><span class="n">Demand</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div><blockquote>
<p>è®¢é˜…è€…èƒ½å¤Ÿæ¥æ”¶å€¼çš„ä¸ªæ•°çš„æ¦‚å¿µä¸ºèƒŒå‹ç®¡ç†ï¼ˆBackpressure Managementï¼‰ã€‚å½“è®¢é˜…è€…ä»å‘å¸ƒè€…é‚£é‡Œè·å¾—äº†è¶…è¿‡å…¶æ‰€èƒ½å¤„ç†çš„å€¼çš„ä¸ªæ•°æ—¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´é—®é¢˜ã€‚</p>
</blockquote>
<p>åœ¨ <code>Subscription</code> ä¸­çš„ <code>request(_ demand: Subscribers.Demand)</code> é‡Œå¯ä»¥æŒ‡å®šèƒ½å¤Ÿæ¥æ”¶çš„å€¼çš„ä¸ªæ•°ï¼Œä¹Ÿå¯åœ¨ <code>Subscriber</code> ä¸­çš„ <code>receive(_ input: Self.Input) -&gt; Subscribers.Demand</code> é‡Œè°ƒæ•´ã€‚æ³¨æ„ <code>Subscriber</code> ä¸­çš„ <code>receive(_ input: Self.Input) -&gt; Subscribers.Demand</code> é‡Œè°ƒæ•´çš„å€¼æ˜¯ç´¯åŠ çš„ï¼Œä¸”å¿…é¡»ä¸ºæ­£æ•°ï¼Œå¦åˆ™å°†å‡ºé”™ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="c1">/// A publisher that eventually produces one value and then finishes or fails.</span>
<span class="p">@</span><span class="n">available</span><span class="p">(</span><span class="n">OSX</span> <span class="mf">10.15</span><span class="p">,</span> <span class="n">iOS</span> <span class="mf">13.0</span><span class="p">,</span> <span class="n">tvOS</span> <span class="mf">13.0</span><span class="p">,</span> <span class="n">watchOS</span> <span class="mf">6.0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span>
<span class="kr">final</span> <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Future</span><span class="p">&lt;</span><span class="n">Output</span><span class="p">,</span> <span class="n">Failure</span><span class="p">&gt;</span> <span class="p">:</span> <span class="n">Publisher</span> <span class="k">where</span> <span class="n">Failure</span> <span class="p">:</span> <span class="n">Error</span> <span class="p">{</span>

    <span class="kd">public</span> <span class="kd">typealias</span> <span class="n">Promise</span> <span class="p">=</span> <span class="p">(</span><span class="n">Result</span><span class="p">&lt;</span><span class="n">Output</span><span class="p">,</span> <span class="n">Failure</span><span class="p">&gt;)</span> <span class="p">-&gt;</span> <span class="nb">Void</span>

    <span class="kd">public</span> <span class="kd">init</span><span class="p">(</span><span class="kc">_</span> <span class="n">attemptToFulfill</span><span class="p">:</span> <span class="p">@</span><span class="n">escaping</span> <span class="p">(@</span><span class="n">escaping</span> <span class="n">Future</span><span class="p">&lt;</span><span class="n">Output</span><span class="p">,</span> <span class="n">Failure</span><span class="p">&gt;.</span><span class="n">Promise</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="nb">Void</span><span class="p">)</span>

    <span class="c1">/// This function is called to attach the specified `Subscriber` to this `Publisher` by `subscribe(_:)`</span>
    <span class="c1">///</span>
    <span class="c1">/// - SeeAlso: `subscribe(_:)`</span>
    <span class="c1">/// - Parameters:</span>
    <span class="c1">///     - subscriber: The subscriber to attach to this `Publisher`.</span>
    <span class="c1">///                   once attached it can begin to receive values.</span>
    <span class="kr">final</span> <span class="kd">public</span> <span class="kd">func</span> <span class="nf">receive</span><span class="p">&lt;</span><span class="n">S</span><span class="p">&gt;(</span><span class="n">subscriber</span><span class="p">:</span> <span class="n">S</span><span class="p">)</span> <span class="k">where</span> <span class="n">Output</span> <span class="p">==</span> <span class="n">S</span><span class="p">.</span><span class="n">Input</span><span class="p">,</span> <span class="n">Failure</span> <span class="p">==</span> <span class="n">S</span><span class="p">.</span><span class="n">Failure</span><span class="p">,</span> <span class="n">S</span> <span class="p">:</span> <span class="n">Subscriber</span>
<span class="p">}</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="kd">import</span> <span class="nc">Foundation</span>
<span class="kd">import</span> <span class="nc">Combine</span>

<span class="kd">public</span> <span class="kd">func</span> <span class="nf">example</span><span class="p">(</span><span class="n">of</span> <span class="n">description</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="n">action</span><span class="p">:</span> <span class="p">()</span> <span class="p">-&gt;</span> <span class="nb">Void</span><span class="p">)</span> <span class="p">{</span>
    <span class="bp">print</span><span class="p">(</span><span class="s">&#34;</span><span class="se">\n</span><span class="s">â€”â€”â€” Example of:&#34;</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="s">&#34;â€”â€”â€”&#34;</span><span class="p">)</span>
    <span class="n">action</span><span class="p">()</span>
<span class="p">}</span>


<span class="c1">//example(of: &#34;Notification&#34;) {</span>
<span class="c1">//    // åˆ›å»ºé€šçŸ¥åç§°</span>
<span class="c1">//    let myNotification = Notification.Name(&#34;myNotification&#34;)</span>
<span class="c1">//    let center = NotificationCenter.default</span>
<span class="c1">//    let observer = center.addObserver(forName: myNotification,</span>
<span class="c1">//                                      object: nil,</span>
<span class="c1">//                                      queue: nil) { notification in</span>
<span class="c1">//                                        print(&#34;æ”¶åˆ°äº†é€šçŸ¥&#34;)</span>
<span class="c1">//    }</span>
<span class="c1">//    center.post(name: myNotification, object: nil)</span>
<span class="c1">//    center.removeObserver(observer)</span>
<span class="c1">//}</span>

<span class="n">example</span><span class="p">(</span><span class="n">of</span><span class="p">:</span> <span class="s">&#34;Publisher&#34;</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// åˆ›å»ºé€šçŸ¥åç§°</span>
    <span class="kd">let</span> <span class="nv">myNotification</span> <span class="p">=</span> <span class="n">Notification</span><span class="p">.</span><span class="n">Name</span><span class="p">(</span><span class="s">&#34;myNotification&#34;</span><span class="p">)</span>
    <span class="kd">let</span> <span class="nv">center</span> <span class="p">=</span> <span class="n">NotificationCenter</span><span class="p">.</span><span class="k">default</span>

    <span class="c1">// å®šä¹‰å‘å¸ƒè€…ï¼Œé€šçŸ¥ä¸­å¿ƒ</span>
    <span class="c1">// func publisher(for name: Notification.Name, object: AnyObject? = nil) -&gt; NotificationCenter.Publisher</span>
    <span class="kd">let</span> <span class="nv">publisher</span> <span class="p">=</span> <span class="n">NotificationCenter</span>
        <span class="p">.</span><span class="k">default</span>
        <span class="p">.</span><span class="n">publisher</span><span class="p">(</span><span class="k">for</span><span class="p">:</span> <span class="n">myNotification</span><span class="p">,</span>
                   <span class="n">object</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
    <span class="c1">// å‘å¸ƒè€… -&gt; è®¢é˜…è€…</span>
    <span class="c1">// func sink(receiveValue: @escaping ((Notification) -&gt; Void)) -&gt; AnyCancellable</span>
    <span class="kd">let</span> <span class="nv">subscription</span> <span class="p">=</span> <span class="n">publisher</span><span class="p">.</span><span class="n">sink</span> <span class="p">{</span> <span class="kc">_</span> <span class="k">in</span>
        <span class="bp">print</span><span class="p">(</span><span class="s">&#34;è®¢é˜…è€…æ¥æ”¶åˆ°äº†é€šçŸ¥&#34;</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="c1">// å‘é€é€šçŸ¥</span>
    <span class="n">center</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="n">myNotification</span><span class="p">,</span> <span class="n">object</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>

    <span class="c1">// å–æ¶ˆè®¢é˜…ï¼Œé‡Šæ”¾èµ„æºï¼›è‹¥ä¸æ‰‹åŠ¨è°ƒç”¨ï¼Œå°†ç›´åˆ°å‘å¸ƒè€…å®Œæˆæˆ–å­˜å‚¨è®¢é˜…çš„å¯¹è±¡é”€æ¯æ—¶æ‰ä¼šå–æ¶ˆè®¢é˜…</span>
    <span class="c1">// _ = some_subscriptionï¼šæœªå­˜å‚¨çš„è®¢é˜…å°†åœ¨åˆ›å»ºæ—¶çš„ç¨‹åºæµé€€å‡ºæ—¶è¢«å–æ¶ˆè®¢é˜…</span>
    <span class="n">subscription</span><span class="p">.</span><span class="n">cancel</span><span class="p">()</span>

<span class="c1">//    â€”â€”â€” Example of: Publisher â€”â€”â€”</span>
<span class="c1">//    è®¢é˜…è€…æ¥æ”¶åˆ°äº†é€šçŸ¥</span>
<span class="p">}</span>

<span class="n">example</span><span class="p">(</span><span class="n">of</span><span class="p">:</span> <span class="s">&#34;Just&#34;</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// å‘å¸ƒè€…ï¼Œåªå‘å°„ä¸€ä¸ªå€¼ï¼Œç„¶åå®Œæˆ</span>
    <span class="kd">let</span> <span class="nv">just</span> <span class="p">=</span> <span class="n">Just</span><span class="p">(</span><span class="s">&#34;ä½ å¥½ï¼Œä¸–ç•Œï¼&#34;</span><span class="p">)</span>

    <span class="kc">_</span> <span class="p">=</span> <span class="n">just</span><span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveCompletion</span><span class="p">:</span> <span class="p">{</span>
        <span class="c1">// finished</span>
        <span class="bp">print</span><span class="p">(</span><span class="s">&#34;è®¢é˜…è€… 1 æ¥æ”¶åˆ°ã€Œå®Œæˆã€ï¼š&#34;</span><span class="p">,</span> <span class="nv">$0</span><span class="p">)</span>
    <span class="p">},</span> <span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span>
        <span class="bp">print</span><span class="p">(</span><span class="s">&#34;è®¢é˜…è€… 1 æ¥æ”¶åˆ°ã€Œå€¼ã€ï¼š&#34;</span><span class="p">,</span> <span class="nv">$0</span><span class="p">)</span>
    <span class="p">})</span>

    <span class="kc">_</span> <span class="p">=</span> <span class="n">just</span><span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveCompletion</span><span class="p">:</span> <span class="p">{</span>
        <span class="bp">print</span><span class="p">(</span><span class="s">&#34;è®¢é˜…è€… 2 æ¥æ”¶åˆ°ã€Œå®Œæˆã€ï¼š&#34;</span><span class="p">,</span> <span class="nv">$0</span><span class="p">)</span>
    <span class="p">},</span> <span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span>
        <span class="bp">print</span><span class="p">(</span><span class="s">&#34;è®¢é˜…è€… 2 æ¥æ”¶åˆ°ã€Œå€¼ã€ï¼š&#34;</span><span class="p">,</span> <span class="nv">$0</span><span class="p">)</span>
    <span class="p">})</span>

    <span class="c1">// å½“ Just å‘å¸ƒè€…æ¯è¢«è®¢é˜…ä¸€æ¬¡ï¼Œå°±ä¼šå‘å°„ä¸€ä¸ªå€¼ï¼Œå¹¶å®Œæˆ</span>

<span class="c1">//    è®¢é˜…è€… 1 æ¥æ”¶åˆ°ã€Œå€¼ã€ï¼š ä½ å¥½ï¼Œä¸–ç•Œï¼</span>
<span class="c1">//    è®¢é˜…è€… 1 æ¥æ”¶åˆ°ã€Œå®Œæˆã€ï¼š finished</span>
<span class="c1">//    è®¢é˜…è€… 2 æ¥æ”¶åˆ°ã€Œå€¼ã€ï¼š ä½ å¥½ï¼Œä¸–ç•Œï¼</span>
<span class="c1">//    è®¢é˜…è€… 2 æ¥æ”¶åˆ°ã€Œå®Œæˆã€ï¼š finished</span>
<span class="p">}</span>

<span class="n">example</span><span class="p">(</span><span class="n">of</span><span class="p">:</span> <span class="s">&#34;assign(toğŸ”›)&#34;</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">class</span> <span class="nc">SomeObject</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nv">value</span><span class="p">:</span> <span class="nb">String</span> <span class="p">=</span> <span class="s">&#34;&#34;</span> <span class="p">{</span>
            <span class="kr">didSet</span> <span class="p">{</span>
                <span class="c1">// è¢«è®¾ç½®æ—¶æ‰“å°</span>
                <span class="bp">print</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">let</span> <span class="nv">obj</span> <span class="p">=</span> <span class="n">SomeObject</span><span class="p">()</span>

    <span class="c1">// å‘å°„ A -&gt; å‘å°„ B</span>
    <span class="kd">let</span> <span class="nv">publisher</span> <span class="p">=</span> <span class="p">[</span><span class="s">&#34;A&#34;</span><span class="p">,</span> <span class="s">&#34;B&#34;</span><span class="p">].</span><span class="n">publisher</span>
    <span class="c1">// åˆ†é…åˆ° obj çš„ valueï¼ˆå¿…é¡»ä¸º class ç±»å‹ï¼‰</span>
    <span class="kc">_</span> <span class="p">=</span> <span class="n">publisher</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">to</span><span class="p">:</span> <span class="err">\</span><span class="p">.</span><span class="n">value</span><span class="p">,</span> <span class="n">on</span><span class="p">:</span> <span class="n">obj</span><span class="p">)</span>

<span class="c1">//    â€”â€”â€” Example of: assign(toğŸ”›) â€”â€”â€”</span>
<span class="c1">//    A</span>
<span class="c1">//    B</span>
<span class="p">}</span>

<span class="n">example</span><span class="p">(</span><span class="n">of</span><span class="p">:</span> <span class="s">&#34;Custom Subscriber&#34;</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nv">publisher</span> <span class="p">=</span> <span class="p">(</span><span class="mf">1.</span><span class="p">..</span><span class="mi">6</span><span class="p">).</span><span class="n">publisher</span>
<span class="c1">//    let publisher = [&#34;A&#34;, &#34;B&#34;, &#34;C&#34;, &#34;D&#34;, &#34;E&#34;, &#34;F&#34;].publisher // ERROR: Input ç±»å‹ä¸åŒ¹é…</span>

    <span class="c1">// è‡ªå®šä¹‰è®¢é˜…è€…</span>
    <span class="kr">final</span> <span class="kd">class</span> <span class="nc">IntSubscriber</span><span class="p">:</span> <span class="n">Subscriber</span> <span class="p">{</span>
        <span class="kd">typealias</span> <span class="n">Input</span> <span class="p">=</span> <span class="nb">Int</span>
        <span class="kd">typealias</span> <span class="n">Failure</span> <span class="p">=</span> <span class="n">Never</span>

        <span class="c1">// ç”±å‘å¸ƒè€…è°ƒç”¨</span>
        <span class="kd">func</span> <span class="nf">receive</span><span class="p">(</span><span class="n">subscription</span><span class="p">:</span> <span class="n">Subscription</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// æŒ‡å®šæœ€å¤šå¯æ¥æ”¶ 3 ä¸ªå€¼</span>
            <span class="n">subscription</span><span class="p">.</span><span class="n">request</span><span class="p">(.</span><span class="bp">max</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
        <span class="p">}</span>

        <span class="c1">// å€¼äº‹ä»¶</span>
        <span class="kd">func</span> <span class="nf">receive</span><span class="p">(</span><span class="kc">_</span> <span class="n">input</span><span class="p">:</span> <span class="nb">Int</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">Subscribers</span><span class="p">.</span><span class="n">Demand</span> <span class="p">{</span>
            <span class="bp">print</span><span class="p">(</span><span class="s">&#34;æ”¶åˆ°çš„å€¼ä¸ºï¼š&#34;</span><span class="p">,</span> <span class="n">input</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">.</span><span class="kr">none</span> <span class="c1">// ç­‰åŒäº .max(0)ï¼Œä¸å†è°ƒæ•´æ¥æ”¶æ•°é‡</span>
<span class="c1">//            return .unlimited // å‡çº§ä¸ºæ— é™åˆ¶</span>
        <span class="p">}</span>

        <span class="c1">// å®Œæˆäº‹ä»¶</span>
        <span class="kd">func</span> <span class="nf">receive</span><span class="p">(</span><span class="n">completion</span><span class="p">:</span> <span class="n">Subscribers</span><span class="p">.</span><span class="n">Completion</span><span class="p">&lt;</span><span class="n">Never</span><span class="p">&gt;)</span> <span class="p">{</span>
            <span class="bp">print</span><span class="p">(</span><span class="s">&#34;æ”¶åˆ°å®Œæˆ&#34;</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">let</span> <span class="nv">subscriber</span> <span class="p">=</span> <span class="n">IntSubscriber</span><span class="p">()</span>
    <span class="n">publisher</span><span class="p">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">subscriber</span><span class="p">)</span>

<span class="c1">//    â€”â€”â€” Example of: Custom Subscriber â€”â€”â€”</span>
<span class="c1">//    æ”¶åˆ°çš„å€¼ä¸ºï¼š 1</span>
<span class="c1">//    æ”¶åˆ°çš„å€¼ä¸ºï¼š 2</span>
<span class="c1">//    æ”¶åˆ°çš„å€¼ä¸ºï¼š 3</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nv">subscriptions</span> <span class="p">=</span> <span class="n">Set</span><span class="p">&lt;</span><span class="n">AnyCancellable</span><span class="p">&gt;()</span>

<span class="c1">//example(of: &#34;Future&#34;) {</span>
<span class="c1">//    // å‘å‡ºæ•´æ•°ï¼Œå¹¶æ°¸ä¸å¤±è´¥</span>
<span class="c1">//    func futureIncrement(</span>
<span class="c1">//        integer: Int,</span>
<span class="c1">//        afterDelay delay: TimeInterval</span>
<span class="c1">//    ) -&gt; Future&lt;Int, Never&gt; {</span>
<span class="c1">//        // public init(_ attemptToFulfill: @escaping (@escaping Future&lt;Output, Failure&gt;.Promise) -&gt; Void)</span>
<span class="c1">//        Future&lt;Int, Never&gt;.init { promise in</span>
<span class="c1">//            print(&#34;Original&#34;) // ç«‹å³æ‰“å°è¯´æ˜ï¼Œåˆ›å»ºåä¼šç«‹å³æ‰§è¡Œï¼ˆæ— éœ€è®¢é˜…è€…ï¼‰</span>
<span class="c1">//            DispatchQueue.global().asyncAfter(deadline: .now() + delay) {</span>
<span class="c1">//                promise(.success(integer + 1)) // å‘å°„å‡ºä¸€ä¸ªå€¼ï¼Œä¹‹åå®Œæˆäº‹ä»¶ï¼ˆéœ€è¦è®¢é˜…è€…ï¼‰</span>
<span class="c1">//            }</span>
<span class="c1">//        }</span>
<span class="c1">//    }</span>
<span class="c1">//</span>
<span class="c1">//    // Future æ˜¯ä¸€ä¸ªå‘å¸ƒè€…ï¼Œæœ¬è´¨ä¸Šæ˜¯åˆ¶é€ ä¸€ä¸ªå•ä¸€å€¼å¹¶ç»“æŸï¼Œæˆ–è€…å¤±è´¥ã€‚å½“å€¼æˆ–è€…é”™è¯¯å¯ç”¨æ—¶ï¼Œå°†é€šè¿‡è°ƒç”¨é—­åŒ…å®ç°ï¼Œè¯¥é—­åŒ…è¢«ç§°ä½œ Promiseã€‚</span>
<span class="c1">//</span>
<span class="c1">//    let future = futureIncrement(integer: 1, afterDelay: 3)</span>
<span class="c1">//</span>
<span class="c1">////    sleep(3);</span>
<span class="c1">//    future.sink(receiveCompletion: { print($0) }, receiveValue: { print($0) }).store(in: &amp;subscriptions)</span>
<span class="c1">//</span>
<span class="c1">//    // âš ï¸ï¼šFuture å¹¶æ²¡æœ‰é‡æ–°æ‰§è¡Œ Promiseï¼Œè€Œæ˜¯å…±äº«ï¼ˆæˆ–è€…è¯´é‡æ’­ï¼‰äº†å…¶è¾“å‡º</span>
<span class="c1">//    future.sink(receiveCompletion: { print(&#34;Second&#34;, $0) }, receiveValue: { print(&#34;Second&#34;, $0) }) .store(in: &amp;subscriptions)</span>
<span class="c1">//</span>
<span class="c1">////    â€”â€”â€” Example of: Future â€”â€”â€”</span>
<span class="c1">////    Original</span>
<span class="c1">////    2</span>
<span class="c1">////    finished</span>
<span class="c1">////    Second 2</span>
<span class="c1">////    Second finished</span>
<span class="c1">//}</span>

<span class="n">example</span><span class="p">(</span><span class="n">of</span><span class="p">:</span> <span class="s">&#34;PassthoughSubject&#34;</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">enum</span> <span class="nc">MyError</span><span class="p">:</span> <span class="n">Error</span> <span class="p">{</span>
        <span class="k">case</span> <span class="n">test</span>
    <span class="p">}</span>

    <span class="kr">final</span> <span class="kd">class</span> <span class="nc">StringSubscriber</span><span class="p">:</span> <span class="n">Subscriber</span> <span class="p">{</span>
        <span class="kd">typealias</span> <span class="n">Input</span> <span class="p">=</span> <span class="nb">String</span>
        <span class="kd">typealias</span> <span class="n">Failure</span> <span class="p">=</span> <span class="n">MyError</span>

        <span class="kd">func</span> <span class="nf">receive</span><span class="p">(</span><span class="n">subscription</span><span class="p">:</span> <span class="n">Subscription</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">subscription</span><span class="p">.</span><span class="n">request</span><span class="p">(.</span><span class="bp">max</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
        <span class="p">}</span>

        <span class="kd">func</span> <span class="nf">receive</span><span class="p">(</span><span class="kc">_</span> <span class="n">input</span><span class="p">:</span> <span class="nb">String</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">Subscribers</span><span class="p">.</span><span class="n">Demand</span> <span class="p">{</span>
            <span class="bp">print</span><span class="p">(</span><span class="s">&#34;æ¥æ”¶åˆ°å€¼&#34;</span><span class="p">,</span> <span class="n">input</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">input</span> <span class="p">==</span> <span class="s">&#34;World&#34;</span> <span class="p">?</span> <span class="p">.</span><span class="bp">max</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">:</span> <span class="p">.</span><span class="kr">none</span>
        <span class="p">}</span>

        <span class="kd">func</span> <span class="nf">receive</span><span class="p">(</span><span class="n">completion</span><span class="p">:</span> <span class="n">Subscribers</span><span class="p">.</span><span class="n">Completion</span><span class="p">&lt;</span><span class="n">MyError</span><span class="p">&gt;)</span> <span class="p">{</span>
            <span class="bp">print</span><span class="p">(</span><span class="s">&#34;æ¥æ”¶åˆ°å®Œæˆ&#34;</span><span class="p">,</span> <span class="n">completion</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">let</span> <span class="nv">subscriber</span> <span class="p">=</span> <span class="n">StringSubscriber</span><span class="p">()</span>

    <span class="c1">// PassthroughSubjectï¼šå¯ä»¥æŒ‰éœ€è¦å‘å¸ƒæ–°å€¼ï¼ˆå…¶ä¹äºä¼ é€’å€¼å’Œå®Œæˆäº‹ä»¶ï¼‰ï¼Œä½†ä»éœ€å£°æ˜å…¶å‘å‡ºå€¼å’Œé”™è¯¯çš„ç±»å‹ï¼Œä¸”è®¢é˜…è€…éœ€è¦ä¸å…¶åŒ¹é…</span>
    <span class="kd">let</span> <span class="nv">subject</span> <span class="p">=</span> <span class="n">PassthroughSubject</span><span class="p">&lt;</span><span class="nb">String</span><span class="p">,</span> <span class="n">MyError</span><span class="p">&gt;()</span>
    <span class="c1">// è®¢é˜…è€…è®¢é˜… subject</span>
    <span class="n">subject</span><span class="p">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">subscriber</span><span class="p">)</span>

    <span class="c1">// åˆ›å»ºå¦å¤–çš„è®¢é˜…</span>
    <span class="kd">let</span> <span class="nv">subscription</span> <span class="p">=</span> <span class="n">subject</span><span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="n">completion</span> <span class="k">in</span>
        <span class="bp">print</span><span class="p">(</span><span class="s">&#34;Received completion (sink)&#34;</span><span class="p">,</span> <span class="n">completion</span><span class="p">)</span>
    <span class="p">})</span> <span class="p">{</span> <span class="n">value</span> <span class="k">in</span>
        <span class="bp">print</span><span class="p">(</span><span class="s">&#34;Received value (sink)&#34;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="n">subject</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s">&#34;Hello&#34;</span><span class="p">)</span>
    <span class="n">subject</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s">&#34;World&#34;</span><span class="p">)</span>

    <span class="n">subscription</span><span class="p">.</span><span class="n">cancel</span><span class="p">()</span> <span class="c1">// å–æ¶ˆè®¢é˜…</span>

    <span class="n">subject</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s">&#34;Test&#34;</span><span class="p">)</span>

<span class="c1">//    subject.send(completion: .failure(MyError.test))</span>
    <span class="n">subject</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">completion</span><span class="p">:</span> <span class="p">.</span><span class="n">finished</span><span class="p">)</span> <span class="c1">// subscriber çš„è®¢é˜…å–æ¶ˆ</span>
    <span class="n">subject</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s">&#34;Test again&#34;</span><span class="p">)</span>

<span class="c1">//     é€šè¿‡ PassthroughSubject ä¼ é€’å€¼æ˜¯å°†å‘½ä»¤å¼ä»£ç æ¡¥æ¥åˆ° Combine çš„å£°æ˜æ€§ä¸–ç•Œçš„ä¸€ç§æ–¹æ³•ã€‚</span>
<span class="p">}</span>

<span class="n">example</span><span class="p">(</span><span class="n">of</span><span class="p">:</span> <span class="s">&#34;CurrentValueSubject&#34;</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// å‘å°„ Int å€¼ï¼Œä¸ä¼šå‡ºç°é”™è¯¯</span>
    <span class="kd">let</span> <span class="nv">subject</span> <span class="p">=</span> <span class="n">CurrentValueSubject</span><span class="p">&lt;</span><span class="nb">Int</span><span class="p">,</span> <span class="n">Never</span><span class="p">&gt;(</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">subject</span>
        <span class="p">.</span><span class="bp">print</span><span class="p">()</span> <span class="c1">// æ‰“å° log ä¿¡æ¯</span>
        <span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">})</span> <span class="c1">// è®¢é˜…ï¼Œå¹¶å¤„ç†</span>
        <span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subscriptions</span><span class="p">)</span> <span class="c1">// inoutï¼šæ›´æ–°åŒä¸€é›†åˆ</span>

    <span class="n">subject</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1">// è®¿é—®å…¶å½“å‰å€¼</span>
    <span class="bp">print</span><span class="p">(</span><span class="s">&#34;print&#34;</span><span class="p">,</span> <span class="n">subject</span><span class="p">.</span><span class="n">value</span><span class="p">)</span>
    <span class="n">subject</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="bp">print</span><span class="p">(</span><span class="s">&#34;print&#34;</span><span class="p">,</span> <span class="n">subject</span><span class="p">.</span><span class="n">value</span><span class="p">)</span>

    <span class="n">subject</span><span class="p">.</span><span class="n">value</span> <span class="p">=</span> <span class="mi">100</span>
    <span class="bp">print</span><span class="p">(</span><span class="s">&#34;print&#34;</span><span class="p">,</span> <span class="n">subject</span><span class="p">.</span><span class="n">value</span><span class="p">)</span>

    <span class="n">subject</span>
         <span class="p">.</span><span class="bp">print</span><span class="p">()</span>
        <span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="s">&#34;222:&#34;</span><span class="p">,</span> <span class="nv">$0</span><span class="p">)</span> <span class="p">})</span> <span class="c1">// é¦–ä¸ªä¸ºå½“å‰å€¼</span>
        <span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subscriptions</span><span class="p">)</span>

    <span class="c1">// CurrentValueSubject çš„å€¼åªèƒ½ä¸ºå€¼ï¼Œä¸èƒ½ä¸ºå®Œæˆäº‹ä»¶</span>
    <span class="c1">// ERROR: Type &#39;Int&#39; has no member &#39;finished&#39;</span>
    <span class="c1">// subject.value = .finished</span>

    <span class="c1">// æ‰‹åŠ¨å–æ¶ˆ</span>
<span class="c1">//    subscriptions.forEach {</span>
<span class="c1">//        $0.cancel()</span>
<span class="c1">//    }</span>
    <span class="c1">// å‘å°„å®Œæˆäº‹ä»¶(æ— éœ€ cancelï¼‰</span>
    <span class="n">subject</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">completion</span><span class="p">:</span> <span class="p">.</span><span class="n">finished</span><span class="p">)</span>

    <span class="c1">// å¯ä»¥å°†é¢„è®¢å­˜å‚¨åœ¨AnyCancellableçš„å®ä¾‹æˆ–é›†åˆä¸­ï¼Œä»¥åœ¨å–æ¶ˆåˆå§‹åŒ–æ—¶æ¥æ”¶è‡ªåŠ¨å–æ¶ˆã€‚</span>

<span class="p">}</span>

<span class="n">example</span><span class="p">(</span><span class="n">of</span><span class="p">:</span> <span class="s">&#34;åŠ¨æ€è°ƒæ•´ Demand&#34;</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">final</span> <span class="kd">class</span> <span class="nc">IntSubscriber</span><span class="p">:</span> <span class="n">Subscriber</span> <span class="p">{</span>
        <span class="kd">typealias</span> <span class="n">Input</span> <span class="p">=</span> <span class="nb">Int</span>
        <span class="kd">typealias</span> <span class="n">Failure</span> <span class="p">=</span> <span class="n">Never</span>
        <span class="kd">func</span> <span class="nf">receive</span><span class="p">(</span><span class="n">subscription</span><span class="p">:</span> <span class="n">Subscription</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">subscription</span><span class="p">.</span><span class="n">request</span><span class="p">(.</span><span class="bp">max</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
        <span class="p">}</span>

        <span class="kd">func</span> <span class="nf">receive</span><span class="p">(</span><span class="kc">_</span> <span class="n">input</span><span class="p">:</span> <span class="nb">Int</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">Subscribers</span><span class="p">.</span><span class="n">Demand</span> <span class="p">{</span>
            <span class="bp">print</span><span class="p">(</span><span class="s">&#34;Received value&#34;</span><span class="p">,</span> <span class="n">input</span><span class="p">)</span>

            <span class="k">switch</span> <span class="n">input</span> <span class="p">{</span>
            <span class="k">case</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">.</span><span class="bp">max</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c1">// 1</span>
            <span class="k">case</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">.</span><span class="bp">max</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1">// 2</span>
            <span class="k">default</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">.</span><span class="kr">none</span> <span class="c1">// 3</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="kd">func</span> <span class="nf">receive</span><span class="p">(</span><span class="n">completion</span><span class="p">:</span> <span class="n">Subscribers</span><span class="p">.</span><span class="n">Completion</span><span class="p">&lt;</span><span class="n">Never</span><span class="p">&gt;)</span> <span class="p">{</span>
          <span class="bp">print</span><span class="p">(</span><span class="s">&#34;Received completion&#34;</span><span class="p">,</span> <span class="n">completion</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">let</span> <span class="nv">subscriber</span> <span class="p">=</span> <span class="n">IntSubscriber</span><span class="p">()</span>  <span class="c1">// 2</span>
    <span class="kd">let</span> <span class="nv">subject</span> <span class="p">=</span> <span class="n">PassthroughSubject</span><span class="p">&lt;</span><span class="nb">Int</span><span class="p">,</span> <span class="n">Never</span><span class="p">&gt;()</span>
    <span class="n">subject</span><span class="p">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">subscriber</span><span class="p">)</span>
    <span class="n">subject</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1">// 4</span>
    <span class="n">subject</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c1">// 5</span>
    <span class="n">subject</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">subject</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">subject</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">subject</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">example</span><span class="p">(</span><span class="n">of</span><span class="p">:</span> <span class="s">&#34;ç±»å‹æ“¦é™¤ Type erasure&#34;</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// å¸Œæœ›è®©è®¢é˜…è€…è®¢é˜…ä»¥æ¥æ”¶æ¥è‡ªå‘å¸ƒè€…çš„äº‹ä»¶ï¼Œè€Œåˆæ— æ³•è®¿é—®æœ‰å…³è¯¥å‘å¸ƒè€…çš„å…¶ä»–è¯¦ç»†ä¿¡æ¯ã€‚</span>
    <span class="kd">let</span> <span class="nv">subject</span> <span class="p">=</span> <span class="n">PassthroughSubject</span><span class="p">&lt;</span><span class="nb">Int</span><span class="p">,</span> <span class="n">Never</span><span class="p">&gt;()</span>

    <span class="c1">// ç±»å‹æ“¦é™¤çš„å‘å¸ƒè€…ï¼šå¯¹è®¢é˜…è€…éšè—å‘å¸ƒè€…çš„è¯¦ç»†ä¿¡æ¯</span>
    <span class="c1">// AnyPublisher&lt;Int, Never&gt;</span>
    <span class="kd">let</span> <span class="nv">publisher</span> <span class="p">=</span> <span class="n">subject</span><span class="p">.</span><span class="n">eraseToAnyPublisher</span><span class="p">()</span>

    <span class="n">publisher</span><span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">})</span>
    <span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subscriptions</span><span class="p">)</span>

    <span class="n">subject</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>


    <span class="c1">// AnyCancellable æ˜¯éµå®ˆ Cancellable çš„ç±»å‹æ“¦é™¤çš„ç±»ï¼Œè°ƒç”¨è€…å¯ä»¥å–æ¶ˆè®¢é˜…ï¼Œä½†ä¸èƒ½è®¿é—®è®¢é˜…å†…éƒ¨çš„ä¿¡æ¯</span>


    <span class="c1">// å¦å¤–ä¸€ç§æƒ…å†µæ˜¯ï¼Œå½“æˆ‘ä»¬æƒ³ä½¿ç”¨ä¸€å¯¹å…¬å¼€å’Œç§æœ‰çš„å±æ€§ï¼Œæ¥å…è®¸è¿™äº›å±æ€§çš„æ‹¥æœ‰è€…åœ¨ç§æœ‰çš„å‘å¸ƒè€…ä¸Šå‘é€å€¼ï¼Œå¹¶è®©å¤–ç•Œè°ƒç”¨è€…è®¿é—®å…¬å¼€çš„å‘å¸ƒå€¼æ¥è®¢é˜…ï¼Œä½†ä¸èƒ½å‘é€å€¼</span>

    <span class="c1">// AnyPublisher æ²¡æœ‰ send(_:) æ“ä½œè€…ï¼Œæ‰€ä»¥æ–°å€¼ä¸èƒ½è¢«å†åŠ åˆ°å‘å¸ƒè€…ä¸Š</span>
    <span class="c1">// publisher.send(1)</span>

    <span class="c1">// eraseToAnyPublisher() å°†æä¾›çš„å‘å¸ƒè€…ä½œä¸º AnyPublisher çš„å®ä¾‹ï¼ˆä¸èƒ½æŒ‡å®šä¸º Publish æ˜¯å› ä¸º Publish æ˜¯åè®®ï¼Œæ— æ³•ä½œä¸ºå®ä¾‹çš„ç±»å‹å»çº¦æŸï¼‰ï¼Œéšè—å…¶æ˜¯ PassthroughSubject çš„äº‹å®</span>


<span class="p">}</span>
</code></pre></div><h2 id="3">3</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="kd">import</span> <span class="nc">Foundation</span>
<span class="kd">import</span> <span class="nc">Combine</span>


<span class="kd">public</span> <span class="kd">func</span> <span class="nf">example</span><span class="p">(</span><span class="n">of</span> <span class="n">description</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="n">action</span><span class="p">:</span> <span class="p">()</span> <span class="p">-&gt;</span> <span class="nb">Void</span><span class="p">)</span> <span class="p">{</span>
    <span class="bp">print</span><span class="p">(</span><span class="s">&#34;</span><span class="se">\n</span><span class="s">â€”â€”â€” Example of:&#34;</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="s">&#34;â€”â€”â€”&#34;</span><span class="p">)</span>
    <span class="n">action</span><span class="p">()</span>
<span class="p">}</span>


<span class="kd">var</span> <span class="nv">subscriptions</span> <span class="p">=</span> <span class="p">[</span><span class="n">AnyCancellable</span><span class="p">]()</span>

<span class="c1">// æ“ä½œè€…æ˜¯å‘å¸ƒè€…</span>
<span class="c1">// å¤„ç†æ¥è‡ªå‘å¸ƒè€…çš„å€¼çš„æ–¹æ³•è¢«ç§°ä½œæ“ä½œè€…ï¼Œ</span>
<span class="n">example</span><span class="p">(</span><span class="n">of</span><span class="p">:</span> <span class="s">&#34;æ”¶é›†&#34;</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">[</span><span class="s">&#34;A&#34;</span><span class="p">,</span> <span class="s">&#34;B&#34;</span><span class="p">,</span> <span class="s">&#34;C&#34;</span><span class="p">,</span> <span class="s">&#34;D&#34;</span><span class="p">,</span> <span class="s">&#34;E&#34;</span><span class="p">].</span><span class="n">publisher</span>
    <span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">},</span>
          <span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">})</span>
    <span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subscriptions</span><span class="p">)</span>

    <span class="c1">// æ³¨æ„ï¼š</span>
    <span class="c1">// ä½¿ç”¨ collect å’Œå…¶å®ƒä¸é™å®šæ•°é‡æˆ–é™åˆ¶çš„ç¼“å†²æ“ä½œç¬¦æ—¶è¦å°å¿ƒï¼Œå…¶å°†ä½¿ç”¨æ— é™åˆ¶çš„å†…å­˜æ¥å­˜å‚¨æ”¶åˆ°çš„å€¼</span>
    <span class="p">[</span><span class="s">&#34;A&#34;</span><span class="p">,</span> <span class="s">&#34;B&#34;</span><span class="p">,</span> <span class="s">&#34;C&#34;</span><span class="p">,</span> <span class="s">&#34;D&#34;</span><span class="p">,</span> <span class="s">&#34;E&#34;</span><span class="p">].</span><span class="n">publisher</span>
<span class="c1">//    .collect() // [&#34;A&#34;, &#34;B&#34;, &#34;C&#34;, &#34;D&#34;, &#34;E&#34;]</span>
    <span class="p">.</span><span class="n">collect</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c1">// [&#34;A&#34;, &#34;B&#34;], [&#34;C&#34;, &#34;D&#34;], [&#34;E&#34;] // é™å®šä¸º 2</span>
    <span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">},</span>
          <span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">})</span>
    <span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subscriptions</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">example</span><span class="p">(</span><span class="n">of</span><span class="p">:</span> <span class="s">&#34;map&#34;</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nv">formatter</span> <span class="p">=</span> <span class="n">NumberFormatter</span><span class="p">()</span>
    <span class="n">formatter</span><span class="p">.</span><span class="n">numberStyle</span> <span class="p">=</span> <span class="p">.</span><span class="n">spellOut</span>
    <span class="c1">// map æ˜¯ Swift é‡Œçš„é«˜é˜¶å‡½æ•°</span>
    <span class="p">[</span><span class="mi">123</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">56</span><span class="p">].</span><span class="n">publisher</span><span class="p">.</span><span class="bp">map</span> <span class="p">{</span>
        <span class="n">formatter</span><span class="p">.</span><span class="n">string</span><span class="p">(</span><span class="n">from</span><span class="p">:</span> <span class="n">NSNumber</span><span class="p">(</span><span class="n">integerLiteral</span><span class="p">:</span> <span class="nv">$0</span><span class="p">))</span> <span class="p">??</span> <span class="s">&#34;&#34;</span>
    <span class="p">}</span>
    <span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">})</span>
    <span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subscriptions</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="nc">Coordinate</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nv">x</span><span class="p">:</span> <span class="nb">Int</span>
    <span class="kd">var</span> <span class="nv">y</span><span class="p">:</span> <span class="nb">Int</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">quadrantOf</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">Int</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">Int</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="nb">String</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s">&#34;</span><span class="si">\(</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="si">)</span><span class="s">&#34;</span>
<span class="p">}</span>

<span class="n">example</span><span class="p">(</span><span class="n">of</span><span class="p">:</span> <span class="s">&#34;map key path&#34;</span><span class="p">)</span> <span class="p">{</span>
<span class="c1">//    â€¢ map&lt;T&gt;(_:)</span>
<span class="c1">//    â€¢ map&lt;T0, T1&gt;(_:_:)</span>
<span class="c1">//    â€¢ map&lt;T0, T1, T2&gt;(_:_:_:)</span>
    <span class="c1">// T ä»£è¡¨ç»™å®šé”®è·¯å¾„ä¸­æ‰¾åˆ°çš„å€¼çš„ç±»å‹</span>
    <span class="c1">// è±¡é™ï¼ˆQuadrantsï¼‰æ˜¯åæ ‡å‡ ä½•ï¼ˆcoordinate geometryï¼‰çš„ä¸€éƒ¨åˆ†ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·è®¿é—® mathworld.wolfram.com/Quadrant.htmlã€‚</span>

    <span class="kd">let</span> <span class="nv">publisher</span> <span class="p">=</span> <span class="n">PassthroughSubject</span><span class="p">&lt;</span><span class="n">Coordinate</span><span class="p">,</span> <span class="n">Never</span><span class="p">&gt;()</span>

    <span class="n">publisher</span>
        <span class="p">.</span><span class="bp">map</span><span class="p">(</span><span class="err">\</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="err">\</span><span class="p">.</span><span class="n">y</span><span class="p">)</span> <span class="c1">// å°† Coordinate keyPath map å‡ºæ¥(æ°¸è¿œä¸ä¼šå‡ºé”™ï¼‰</span>
        <span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="k">in</span>
            <span class="bp">print</span><span class="p">(</span><span class="s">&#34;</span><span class="si">\(</span><span class="n">x</span><span class="si">)</span><span class="s"> + </span><span class="si">\(</span><span class="n">y</span><span class="si">)</span><span class="s"> =&#34;</span><span class="p">,</span> <span class="n">quadrantOf</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">y</span><span class="p">))</span>
        <span class="p">})</span>
    <span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subscriptions</span><span class="p">)</span>

    <span class="n">publisher</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">Coordinate</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="o">-</span><span class="mi">8</span><span class="p">))</span>
    <span class="n">publisher</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">Coordinate</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="mi">5</span><span class="p">))</span>
<span class="p">}</span>

<span class="n">example</span><span class="p">(</span><span class="n">of</span><span class="p">:</span> <span class="s">&#34;tryMap(_:)&#34;</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// å°è¯• mapï¼Œå‡ºé”™æ—¶ä¸º failure completion</span>
    <span class="n">Just</span><span class="p">(</span><span class="s">&#34;Directory name that does not exist&#34;</span><span class="p">)</span>
        <span class="p">.</span><span class="n">tryMap</span> <span class="p">{</span> <span class="k">try</span> <span class="n">FileManager</span><span class="p">.</span><span class="k">default</span><span class="p">.</span><span class="n">contentsOfDirectory</span><span class="p">(</span><span class="n">atPath</span><span class="p">:</span> <span class="nv">$0</span><span class="p">)</span> <span class="p">}</span>
        <span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">},</span>
              <span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">})</span>
        <span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subscriptions</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">public</span> <span class="kd">struct</span> <span class="nc">Chatter</span> <span class="p">{</span>
  <span class="kd">public</span> <span class="kd">let</span> <span class="nv">name</span><span class="p">:</span> <span class="nb">String</span>
  <span class="kd">public</span> <span class="kd">let</span> <span class="nv">message</span><span class="p">:</span> <span class="n">CurrentValueSubject</span><span class="p">&lt;</span><span class="nb">String</span><span class="p">,</span> <span class="n">Never</span><span class="p">&gt;</span>

    <span class="kd">public</span> <span class="kd">init</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">String</span><span class="p">)</span> <span class="p">{</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">name</span> <span class="p">=</span> <span class="n">name</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">message</span> <span class="p">=</span> <span class="n">CurrentValueSubject</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">example</span><span class="p">(</span><span class="n">of</span><span class="p">:</span> <span class="s">&#34;flattern&#34;</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// flattern å¯ç”¨äºå°†å¤šä¸ªä¸Šæ¸¸å‘å¸ƒè€…æ‘Šå¹³ä¸ºä¸€ä¸ªä¸‹æ¸¸å‘å¸ƒè€…ï¼Œæˆ–è€…ç‰¹åˆ«çš„ï¼Œå°†è¿™äº›å‘å¸ƒè€…çš„å‘å°„ç‰©æ‘Šå¹³</span>

    <span class="c1">// ä¸Šæ¸¸å‘å¸ƒè€…æ¥æ”¶åˆ°çš„ç±»å‹ä¸ flatMap è¿”å›çš„å‘å¸ƒè€…é€šå¸¸ä¼šä¸ä¸€è‡´</span>
    <span class="c1">// å¸¸ç”¨æƒ…å†µï¼šå½“æˆ‘ä»¬æƒ³è®¢é˜…å‘å¸ƒè€…å‘å°„çš„å€¼ï¼Œä½†è¿™äº›å€¼æœ¬èº«åˆæ˜¯ä»–ä»¬è‡ªå·±çš„å‘å¸ƒè€…</span>

    <span class="kd">let</span> <span class="nv">charlotte</span> <span class="p">=</span> <span class="n">Chatter</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="s">&#34;Charlotte&#34;</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="s">&#34;Hi I am Charlotte&#34;</span><span class="p">)</span>
    <span class="kd">let</span> <span class="nv">james</span> <span class="p">=</span> <span class="n">Chatter</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="s">&#34;James&#34;</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="s">&#34;Hi I am James&#34;</span><span class="p">)</span>

    <span class="kd">let</span> <span class="nv">chat</span> <span class="p">=</span> <span class="n">CurrentValueSubject</span><span class="p">&lt;</span><span class="n">Chatter</span><span class="p">,</span> <span class="n">Never</span><span class="p">&gt;(</span><span class="n">charlotte</span><span class="p">)</span> <span class="c1">// æœ€åˆä¸º charlotte</span>

<span class="c1">//    chat</span>
<span class="c1">//        .sink(receiveValue: { print($0.message.value) })</span>
<span class="c1">//        .store(in: &amp;subscriptions)</span>

    <span class="n">chat</span>
        <span class="p">.</span><span class="n">flatMap</span> <span class="p">{</span> <span class="nv">$0</span><span class="p">.</span><span class="n">message</span> <span class="p">}</span> <span class="c1">// è½¬æ¢ä¸º message çš„ å‘å¸ƒè€…</span>
        <span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">})</span>
        <span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subscriptions</span><span class="p">)</span>

    <span class="c1">// messgae å˜æ›´ä¹Ÿå¯è§¦å‘ï¼ˆä¸åš flatMap çš„æ—¶å€™æ˜¯ä¸å¯ä»¥çš„ï¼‰</span>
    <span class="n">charlotte</span><span class="p">.</span><span class="n">message</span><span class="p">.</span><span class="n">value</span> <span class="p">=</span> <span class="s">&#34;Charlotte: How&#39;s it going?&#34;</span>

    <span class="c1">// å‡å¯è§¦å‘</span>
    <span class="n">chat</span><span class="p">.</span><span class="n">value</span> <span class="p">=</span> <span class="n">james</span>
<span class="p">}</span>

<span class="n">example</span><span class="p">(</span><span class="n">of</span><span class="p">:</span> <span class="s">&#34;flatMap(maxPublishers&#34;</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// flatMap å°†æ‰€æœ‰æ¥æ”¶åˆ°çš„å‘å¸ƒè€…çš„è¾“å‡ºå‹ç¼©ä¸ºä¸€ä¸ªå‘å¸ƒè€…ã€‚</span>
    <span class="c1">// è¿™å¸¦æ¥äº†å†…å­˜é—®é¢˜ï¼Œå› ä¸ºå®ƒå°†ç¼“å­˜ä¸æ‚¨å‘é€çš„å‘å¸ƒè€…ä¸€æ ·å¤šçš„å‘å¸ƒè€…ï¼Œä»¥æ›´æ–°å®ƒåœ¨ä¸‹æ¸¸å‘å‡ºçš„å•ä¸ªå‘å¸ƒè€…ã€‚</span>

    <span class="kd">let</span> <span class="nv">charlotte</span> <span class="p">=</span> <span class="n">Chatter</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="s">&#34;Charlotte&#34;</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="s">&#34;Hi I am Charlotte&#34;</span><span class="p">)</span>
    <span class="kd">let</span> <span class="nv">james</span> <span class="p">=</span> <span class="n">Chatter</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="s">&#34;James&#34;</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="s">&#34;Hi I am James&#34;</span><span class="p">)</span>

    <span class="kd">let</span> <span class="nv">chat</span> <span class="p">=</span> <span class="n">CurrentValueSubject</span><span class="p">&lt;</span><span class="n">Chatter</span><span class="p">,</span> <span class="n">Never</span><span class="p">&gt;(</span><span class="n">charlotte</span><span class="p">)</span> <span class="c1">// æœ€åˆå‘å¸ƒè€…ä¸º charlotte</span>

    <span class="n">chat</span>
        <span class="p">.</span><span class="n">flatMap</span><span class="p">(</span><span class="n">maxPublishers</span><span class="p">:</span> <span class="p">.</span><span class="bp">max</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="p">{</span> <span class="nv">$0</span><span class="p">.</span><span class="n">message</span> <span class="p">}</span> <span class="c1">// æœ€å¤šæ¥æ”¶ä¸Šæ¸¸ n ä¸ªå‘å¸ƒè€…ï¼Œå…¶ä»–å°†å¿½ç•¥ï¼Œé»˜è®¤ä¸ºæ— é™</span>
        <span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">})</span>
        <span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subscriptions</span><span class="p">)</span>

    <span class="c1">// æ›´æ–°ç¬¬ä¸€ä¸ªå‘å¸ƒè€…</span>
    <span class="n">charlotte</span><span class="p">.</span><span class="n">message</span><span class="p">.</span><span class="n">value</span> <span class="p">=</span> <span class="s">&#34;Charlotte: How&#39;s it going?&#34;</span>

    <span class="c1">// ç¬¬äºŒä¸ªå‘å¸ƒè€…ä¸º james</span>
    <span class="n">chat</span><span class="p">.</span><span class="n">value</span> <span class="p">=</span> <span class="n">james</span>

    <span class="c1">// ç¬¬ä¸‰ä¸ªå‘å¸ƒè€…ï¼Œä½†è¢«å¿½ç•¥äº†</span>
    <span class="kd">let</span> <span class="nv">morgan</span> <span class="p">=</span> <span class="n">Chatter</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="s">&#34;Morgan&#34;</span><span class="p">,</span>
                         <span class="n">message</span><span class="p">:</span> <span class="s">&#34;Hey guys, what are you up to?&#34;</span><span class="p">)</span>
    <span class="n">chat</span><span class="p">.</span><span class="n">value</span> <span class="p">=</span> <span class="n">morgan</span>

    <span class="c1">// ç”¨çš„æ˜¯ charlotte</span>
    <span class="n">charlotte</span><span class="p">.</span><span class="n">message</span><span class="p">.</span><span class="n">value</span> <span class="p">=</span> <span class="s">&#34;Did you hear something?&#34;</span>

<span class="c1">//Hi I am Charlotte</span>
<span class="c1">//Charlotte: How&#39;s it going?</span>
<span class="c1">//Hi I am James</span>
<span class="c1">//Did you hear something?</span>

<span class="p">}</span>

<span class="n">example</span><span class="p">(</span><span class="n">of</span><span class="p">:</span> <span class="s">&#34;replaceNil&#34;</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">[</span><span class="s">&#34;A&#34;</span><span class="p">,</span> <span class="kc">nil</span><span class="p">,</span> <span class="s">&#34;B&#34;</span><span class="p">]</span>
        <span class="p">.</span><span class="n">publisher</span>
        <span class="p">.</span><span class="n">replaceNil</span><span class="p">(</span><span class="n">with</span><span class="p">:</span> <span class="s">&#34;-&#34;</span><span class="p">)</span> <span class="c1">// åªåšæ›¿æ¢ï¼Œå¹¶ä¸æ”¹å˜ç±»å‹</span>
        <span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">})</span>
        <span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subscriptions</span><span class="p">)</span>

<span class="c1">//    Optional(&#34;A&#34;)</span>
<span class="c1">//    Optional(&#34;-&#34;)</span>
<span class="c1">//    Optional(&#34;B&#34;)</span>


    <span class="p">[</span><span class="s">&#34;A&#34;</span><span class="p">,</span> <span class="kc">nil</span><span class="p">,</span> <span class="s">&#34;B&#34;</span><span class="p">]</span>
        <span class="p">.</span><span class="n">publisher</span>
        <span class="p">.</span><span class="n">replaceNil</span><span class="p">(</span><span class="n">with</span><span class="p">:</span> <span class="s">&#34;-&#34;</span><span class="p">)</span>
        <span class="p">.</span><span class="bp">map</span> <span class="p">{</span> <span class="nv">$0</span><span class="p">!</span> <span class="p">}</span> <span class="c1">// ä½¿ç”¨ map è½¬æ¢ç±»å‹ï¼ˆå¼ºåˆ¶è§£åŒ…ï¼‰</span>
        <span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">})</span>
        <span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subscriptions</span><span class="p">)</span>

<span class="c1">//    A</span>
<span class="c1">//    -</span>
<span class="c1">//    B</span>

    <span class="kd">let</span> <span class="nv">formatter</span> <span class="p">=</span> <span class="n">NumberFormatter</span><span class="p">()</span>
    <span class="n">formatter</span><span class="p">.</span><span class="n">numberStyle</span> <span class="p">=</span> <span class="p">.</span><span class="n">spellOut</span>

    <span class="p">[</span><span class="mi">123</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">56</span><span class="p">].</span><span class="n">publisher</span><span class="p">.</span><span class="bp">map</span> <span class="p">{</span>
        <span class="n">formatter</span><span class="p">.</span><span class="n">string</span><span class="p">(</span><span class="n">from</span><span class="p">:</span> <span class="n">NSNumber</span><span class="p">(</span><span class="n">integerLiteral</span><span class="p">:</span> <span class="nv">$0</span><span class="p">))</span> <span class="p">??</span> <span class="s">&#34;&#34;</span> <span class="c1">// ?? å¯ä»¥è¿”å›å¦å¤–ä¸€ä¸ªå¯é€‰ç±»å‹ï¼Œä½† replaceNil ä¸å¯</span>
    <span class="p">}</span>
    <span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">})</span>
    <span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subscriptions</span><span class="p">)</span>

<span class="c1">//    [&#34;A&#34;, nil, &#34;B&#34;]</span>
<span class="c1">//    .publisher</span>
<span class="c1">//    .replaceNil(with: &#34;-&#34; as? String?)</span>
<span class="c1">//    .map { $0! } // ä½¿ç”¨ map è½¬æ¢ç±»å‹ï¼ˆå¼ºåˆ¶è§£åŒ…ï¼‰</span>
<span class="c1">//    .sink(receiveValue: { print($0) })</span>
<span class="c1">//    .store(in: &amp;subscriptions)</span>
<span class="p">}</span>

<span class="n">example</span><span class="p">(</span><span class="n">of</span><span class="p">:</span> <span class="s">&#34;replaceEmpty(with:)&#34;</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ç©ºå‘å¸ƒè€…ï¼Œç«‹å³å‘å‡ºå®Œæˆäº‹ä»¶ï¼›ä¹Ÿå¯é€šè¿‡ä¼ é€’ false åˆ° completeImmediately ä¸­ï¼Œä»è€Œä¸å‘å°„ä»»ä½•ä¸œè¥¿ï¼Œé»˜è®¤ä¸º true</span>
    <span class="c1">// å¯ç”¨äºæµ‹è¯•æˆ–æ¼”ç¤ºåªæœ‰å®Œæˆäº‹ä»¶æ—¶</span>
<span class="c1">//    let empty = Empty&lt;Int, Never&gt;.init(completeImmediately: false)</span>
    <span class="kd">let</span> <span class="nv">empty</span> <span class="p">=</span> <span class="n">Empty</span><span class="p">&lt;</span><span class="nb">Int</span><span class="p">,</span> <span class="n">Never</span><span class="p">&gt;()</span>
    <span class="n">empty</span>
        <span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">},</span>
              <span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">})</span>
        <span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subscriptions</span><span class="p">)</span>

<span class="c1">//    finished</span>


    <span class="n">empty</span>
        <span class="p">.</span><span class="n">replaceEmpty</span><span class="p">(</span><span class="n">with</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span> <span class="c1">// æ›¿æ¢ç©ºä¸ºå‘å°„ 1</span>
        <span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">},</span>
              <span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">})</span>
        <span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subscriptions</span><span class="p">)</span>

<span class="c1">//    1</span>
<span class="c1">//    finished</span>
<span class="p">}</span>

<span class="n">example</span><span class="p">(</span><span class="n">of</span><span class="p">:</span> <span class="s">&#34;scan&#34;</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// è®¡ç®—å±æ€§ï¼Œéšæœºæ•°</span>
    <span class="kd">var</span> <span class="nv">dailyGainLoss</span><span class="p">:</span> <span class="nb">Int</span> <span class="p">{</span>
        <span class="p">.</span><span class="n">random</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="o">-</span><span class="mf">10.</span><span class="p">..</span><span class="mi">10</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="kd">let</span> <span class="nv">august2019</span> <span class="p">=</span> <span class="p">(</span><span class="mf">0.</span><span class="p">.&lt;</span><span class="mi">22</span><span class="p">)</span>
        <span class="p">.</span><span class="bp">map</span> <span class="p">{</span> <span class="kc">_</span> <span class="k">in</span> <span class="n">dailyGainLoss</span> <span class="p">}</span> <span class="c1">// æ•°ç»„</span>
        <span class="p">.</span><span class="n">publisher</span>

    <span class="n">august2019</span>
        <span class="c1">// èµ·å§‹ 50</span>
        <span class="p">.</span><span class="n">scan</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="p">{</span> <span class="n">latest</span><span class="p">,</span> <span class="n">current</span> <span class="k">in</span>
            <span class="bp">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">latest</span> <span class="o">+</span> <span class="n">current</span><span class="p">)</span> <span class="c1">// â¡ï¸ å¯é¢„è§ˆ</span>
        <span class="p">}</span>
    <span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="kc">_</span> <span class="k">in</span> <span class="p">})</span> <span class="c1">// ä¸åšæ“ä½œ</span>
<span class="c1">//    .sink(receiveCompletion: { print($0) },</span>
<span class="c1">//          receiveValue: { print($0) })</span>
    <span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subscriptions</span><span class="p">)</span>


<span class="c1">//    â€¢å¯¹å‘å¸ƒè€…çš„è¾“å‡ºæ‰§è¡Œæ“ä½œçš„æ–¹æ³•ç§°ä¸ºè¿ç®—ç¬¦ã€‚</span>
<span class="c1">//    â€¢æ“ä½œè€…ä¹Ÿæ˜¯å‘å¸ƒè€…ã€‚</span>
<span class="c1">//ä½¿ç”¨ä»»ä½•ç¼“å†²å€¼ï¼ˆä¾‹å¦‚collectæˆ–flatMapï¼‰çš„è¿ç®—ç¬¦æ—¶ï¼Œè¯·é¿å…å†…å­˜é—®é¢˜ã€‚</span>
<span class="c1">//    åº”ç”¨æ¥è‡ªSwiftæ ‡å‡†åº“çš„ç°æœ‰åŠŸèƒ½çŸ¥è¯†æ—¶è¦è°¨è®°ã€‚ ä¸€äº›åç§°ç›¸ä¼¼çš„Combineè¿ç®—ç¬¦çš„å·¥ä½œåŸç†ç›¸åŒï¼Œè€Œå¦ä¸€äº›åˆ™å®Œå…¨ä¸åŒã€‚</span>
    <span class="c1">// æ“ä½œç¬¦å¯ä»¥ç»„åˆç”¨äºä¸€ä¸ªè®¢é˜…</span>
<span class="p">}</span>

</code></pre></div><h2 id="4">4</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="kd">import</span> <span class="nc">Foundation</span>
<span class="kd">import</span> <span class="nc">Combine</span>

<span class="kd">var</span> <span class="nv">subscriptions</span> <span class="p">=</span> <span class="p">[</span><span class="n">AnyCancellable</span><span class="p">]()</span>

<span class="c1">// å¸¦ try çš„æ“ä½œç¬¦ï¼Œå°†æä¾› throw çš„é—­åŒ…ï¼Œæ‚¨åœ¨é—­åŒ…å†…å¼•å‘çš„ä»»ä½•é”™è¯¯éƒ½å°†ä»¥å¼•å‘çš„é”™è¯¯ç»ˆæ­¢å‘å¸ƒè€…ã€‚</span>

<span class="kd">enum</span> <span class="nc">MyError</span><span class="p">:</span> <span class="n">Error</span> <span class="p">{</span>
    <span class="k">case</span> <span class="n">foo</span>
<span class="p">}</span>

<span class="n">example</span><span class="p">(</span><span class="n">of</span><span class="p">:</span> <span class="s">&#34;filter&#34;</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nv">numbers</span> <span class="p">=</span> <span class="p">(</span><span class="mf">1.</span><span class="p">..</span><span class="mi">10</span><span class="p">).</span><span class="n">publisher</span>
        <span class="n">numbers</span><span class="p">.</span><span class="bp">filter</span> <span class="p">{</span>
            <span class="nv">$0</span><span class="p">.</span><span class="n">isMultiple</span><span class="p">(</span><span class="n">of</span><span class="p">:</span> <span class="mi">3</span><span class="p">)</span> <span class="c1">// 3 çš„å€æ•°</span>
        <span class="p">}</span>
        <span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span>
            <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span>
        <span class="p">})</span>
        <span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subscriptions</span><span class="p">)</span>

        <span class="c1">// ---</span>

        <span class="kd">func</span> <span class="nf">throwFunc</span><span class="p">(</span><span class="n">val</span><span class="p">:</span> <span class="nb">Int</span><span class="p">)</span> <span class="kr">throws</span> <span class="p">-&gt;</span> <span class="nb">Bool</span> <span class="p">{</span>
            <span class="k">if</span> <span class="n">val</span> <span class="o">%</span> <span class="mi">3</span> <span class="p">==</span> <span class="mi">0</span> <span class="p">{</span>
                <span class="k">return</span> <span class="kc">true</span>
            <span class="p">}</span>
            <span class="k">throw</span> <span class="n">MyError</span><span class="p">.</span><span class="n">foo</span>
        <span class="p">}</span>

        <span class="n">numbers</span>
            <span class="p">.</span><span class="n">tryFilter</span> <span class="p">{</span>
                <span class="k">try</span> <span class="n">throwFunc</span><span class="p">(</span><span class="n">val</span><span class="p">:</span> <span class="nv">$0</span><span class="p">)</span> <span class="c1">// å¤±è´¥åï¼Œå³ç»“æŸ</span>
        <span class="p">}</span>
            <span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveCompletion</span><span class="p">:</span> <span class="p">{</span>
                <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="c1">// failure(__lldb_expr_10.(unknown context at $1136214cc).(unknown context at $1136214d4).(unknown context at $1136214dc).MyError.foo)</span>
            <span class="p">},</span> <span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span>
                <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span>
            <span class="p">})</span>
            <span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subscriptions</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">example</span><span class="p">(</span><span class="n">of</span><span class="p">:</span> <span class="s">&#34;removeDuplicates&#34;</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nv">words</span> <span class="p">=</span> <span class="s">&#34;a a a a b b b b&#34;</span> <span class="p">.</span><span class="n">components</span><span class="p">(</span><span class="n">separatedBy</span><span class="p">:</span> <span class="s">&#34; &#34;</span><span class="p">)</span>
        <span class="p">.</span><span class="n">publisher</span>

    <span class="n">words</span>
        <span class="p">.</span><span class="n">removeDuplicates</span><span class="p">()</span> <span class="c1">// æ— éœ€å‚æ•°ï¼ˆéµå®ˆ Equable åè®®ï¼‰</span>
        <span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">})</span>
        <span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subscriptions</span><span class="p">)</span>

<span class="c1">//    a</span>
<span class="c1">//    b</span>

        <span class="n">words</span>
            <span class="p">.</span><span class="n">tryRemoveDuplicates</span><span class="p">(</span><span class="n">by</span><span class="p">:</span> <span class="p">{</span> <span class="bp">first</span><span class="p">,</span> <span class="n">second</span> <span class="p">-&gt;</span> <span class="nb">Bool</span> <span class="k">in</span>
                <span class="bp">print</span><span class="p">(</span><span class="bp">first</span><span class="p">,</span> <span class="n">second</span><span class="p">)</span>
<span class="c1">//                throw Error</span>
                <span class="k">return</span> <span class="kc">true</span>
            <span class="p">})</span>
            <span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveCompletion</span><span class="p">:</span> <span class="p">{</span>
                <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span>
            <span class="p">},</span> <span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span>
                <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span>
            <span class="p">})</span>
            <span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subscriptions</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">example</span><span class="p">(</span><span class="n">of</span><span class="p">:</span> <span class="s">&#34;compactMap&#34;</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nv">strings</span> <span class="p">=</span> <span class="p">[</span><span class="s">&#34;a&#34;</span><span class="p">,</span> <span class="s">&#34;1.24&#34;</span><span class="p">,</span> <span class="s">&#34;3&#34;</span><span class="p">,</span> <span class="s">&#34;def&#34;</span><span class="p">,</span> <span class="s">&#34;45&#34;</span><span class="p">,</span> <span class="s">&#34;0.23&#34;</span><span class="p">].</span><span class="n">publisher</span>

    <span class="n">strings</span>
        <span class="p">.</span><span class="n">compactMap</span> <span class="p">{</span>
            <span class="nb">Float</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="c1">// æ— æ³•è½¬æ¢ä¼šè¿”å› nil</span>
        <span class="p">}</span>
        <span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span>
            <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span>
        <span class="p">})</span>
        <span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subscriptions</span><span class="p">)</span>
<span class="c1">//    1.24</span>
<span class="c1">//    3.0</span>
<span class="c1">//    45.0</span>
<span class="c1">//    0.23</span>

    <span class="kd">func</span> <span class="nf">throwFunc</span><span class="p">(</span><span class="n">val</span><span class="p">:</span> <span class="nb">String</span><span class="p">)</span> <span class="kr">throws</span> <span class="p">-&gt;</span> <span class="nb">Float</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">if</span> <span class="kd">let</span> <span class="nv">fV</span> <span class="p">=</span> <span class="nb">Float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">fV</span>
        <span class="p">}</span>

        <span class="k">throw</span> <span class="n">MyError</span><span class="p">.</span><span class="n">foo</span>
    <span class="p">}</span>

    <span class="n">strings</span>
        <span class="p">.</span><span class="n">tryCompactMap</span> <span class="p">{</span>
            <span class="k">try</span> <span class="n">throwFunc</span><span class="p">(</span><span class="n">val</span><span class="p">:</span> <span class="nv">$0</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveCompletion</span><span class="p">:</span> <span class="p">{</span>
            <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span>
        <span class="p">},</span> <span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span>
            <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span>
        <span class="p">})</span>
        <span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subscriptions</span><span class="p">)</span>

    <span class="c1">// failure(__lldb_expr_1.MyError.foo)</span>
<span class="p">}</span>

<span class="n">example</span><span class="p">(</span><span class="n">of</span><span class="p">:</span> <span class="s">&#34;ignoreOutput&#34;</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nv">numbers</span> <span class="p">=</span> <span class="p">(</span><span class="mf">1.</span><span class="p">..</span><span class="mi">10_000</span><span class="p">).</span><span class="n">publisher</span>

    <span class="n">numbers</span>
        <span class="p">.</span><span class="n">ignoreOutput</span><span class="p">()</span> <span class="c1">// å¿½ç•¥å€¼è¾“å‡º</span>
        <span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">},</span>
              <span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">})</span>
        <span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subscriptions</span><span class="p">)</span>
<span class="c1">//    finished</span>
<span class="p">}</span>

<span class="n">example</span><span class="p">(</span><span class="n">of</span><span class="p">:</span> <span class="s">&#34;first(where:)&#34;</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nv">numbers</span> <span class="p">=</span> <span class="p">(</span><span class="mf">1.</span><span class="p">..</span><span class="mi">9</span><span class="p">).</span><span class="n">publisher</span>

    <span class="n">numbers</span>
        <span class="p">.</span><span class="bp">print</span><span class="p">(</span><span class="s">&#34;numbers&#34;</span><span class="p">)</span>
        <span class="p">.</span><span class="bp">first</span><span class="p">(</span><span class="k">where</span><span class="p">:</span> <span class="p">{</span> <span class="nv">$0</span> <span class="o">%</span> <span class="mi">2</span> <span class="p">==</span> <span class="mi">0</span> <span class="p">})</span> <span class="c1">// æ‰¾åˆ°ç¬¬ä¸€ä¸ªå³å–æ¶ˆè®¢é˜…å¹¶å®Œæˆ</span>
        <span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">},</span>
              <span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">})</span>
        <span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subscriptions</span><span class="p">)</span>

<span class="c1">//    numbers: receive subscription: (1...9)</span>
<span class="c1">//    numbers: request unlimited</span>
<span class="c1">//    numbers: receive value: (1)</span>
<span class="c1">//    numbers: receive value: (2)</span>
<span class="c1">//    numbers: receive cancel</span>
<span class="c1">//    2</span>
<span class="p">}</span>


<span class="n">example</span><span class="p">(</span><span class="n">of</span><span class="p">:</span> <span class="s">&#34;last(where:)&#34;</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nv">numbers</span> <span class="p">=</span> <span class="p">(</span><span class="mf">1.</span><span class="p">..</span><span class="mi">9</span><span class="p">).</span><span class="n">publisher</span>

    <span class="n">numbers</span>
        <span class="p">.</span><span class="bp">print</span><span class="p">(</span><span class="s">&#34;numbers&#34;</span><span class="p">)</span>
        <span class="p">.</span><span class="bp">last</span><span class="p">(</span><span class="k">where</span><span class="p">:</span> <span class="p">{</span> <span class="nv">$0</span> <span class="o">%</span> <span class="mi">2</span> <span class="p">==</span> <span class="mi">0</span> <span class="p">})</span> <span class="c1">// éœ€ç­‰å¾…æ‰€æœ‰å€¼å‘å‡ºå®Œæˆåå†æ‰§è¡Œ</span>
        <span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">},</span>
              <span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">})</span>
        <span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subscriptions</span><span class="p">)</span>

<span class="c1">//numbers: receive subscription: (1...9)</span>
<span class="c1">//numbers: request unlimited</span>
<span class="c1">//numbers: receive value: (1)</span>
<span class="c1">//numbers: receive value: (2)</span>
<span class="c1">//numbers: receive value: (3)</span>
<span class="c1">//numbers: receive value: (4)</span>
<span class="c1">//numbers: receive value: (5)</span>
<span class="c1">//numbers: receive value: (6)</span>
<span class="c1">//numbers: receive value: (7)</span>
<span class="c1">//numbers: receive value: (8)</span>
<span class="c1">//numbers: receive value: (9)</span>
<span class="c1">//numbers: receive finished</span>
<span class="c1">//8</span>
<span class="p">}</span>

<span class="n">example</span><span class="p">(</span><span class="n">of</span><span class="p">:</span> <span class="s">&#34;last(where:)&#34;</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nv">numbers</span> <span class="p">=</span> <span class="n">PassthroughSubject</span><span class="p">&lt;</span><span class="nb">Int</span><span class="p">,</span> <span class="n">Never</span><span class="p">&gt;()</span>
    <span class="n">numbers</span>
        <span class="p">.</span><span class="bp">last</span><span class="p">(</span><span class="k">where</span><span class="p">:</span> <span class="p">{</span> <span class="nv">$0</span> <span class="o">%</span> <span class="mi">2</span> <span class="p">==</span> <span class="mi">0</span> <span class="p">})</span>
        <span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">},</span>
              <span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">})</span>
        <span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subscriptions</span><span class="p">)</span>
    <span class="n">numbers</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">numbers</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">numbers</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">numbers</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">numbers</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="c1">// æ²¡æœ‰å®Œæˆå°±ä¸ä¼šæ‰§è¡Œ</span>
<span class="c1">//    numbers.send(completion: .finished)</span>
<span class="p">}</span>


<span class="n">example</span><span class="p">(</span><span class="n">of</span><span class="p">:</span> <span class="s">&#34;drop&#34;</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nv">numbers</span> <span class="p">=</span> <span class="p">(</span><span class="mf">1.</span><span class="p">..</span><span class="mi">5</span><span class="p">).</span><span class="n">publisher</span>

    <span class="n">numbers</span>
        <span class="p">.</span><span class="bp">dropFirst</span><span class="p">()</span> <span class="c1">// æŠ›å¼ƒç¬¬ä¸€ä¸ªå€¼</span>
        <span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">},</span>
              <span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">})</span>
        <span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subscriptions</span><span class="p">)</span>

<span class="c1">//    â€”â€”â€” Example of: dropFirst â€”â€”â€”</span>
<span class="c1">//    2</span>
<span class="c1">//    3</span>
<span class="c1">//    4</span>
<span class="c1">//    5</span>
<span class="c1">//    finished</span>
<span class="p">}</span>

<span class="n">example</span><span class="p">(</span><span class="n">of</span><span class="p">:</span> <span class="s">&#34;drop(while:)&#34;</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nv">numbers</span> <span class="p">=</span> <span class="p">(</span><span class="mf">1.</span><span class="p">..</span><span class="mi">10</span><span class="p">).</span><span class="n">publisher</span>

    <span class="n">numbers</span>
    <span class="p">.</span><span class="n">drop</span><span class="p">(</span><span class="k">while</span><span class="p">:</span> <span class="p">{</span>
        <span class="bp">print</span><span class="p">(</span><span class="s">&#34;dropping&#34;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nv">$0</span> <span class="o">%</span> <span class="mi">5</span> <span class="o">!=</span> <span class="mi">0</span>
    <span class="p">})</span> <span class="c1">// æ¡ä»¶æˆç«‹æ—¶ï¼Œä¸¢å¼ƒï¼Œç¬¬ä¸€ä¸ªä¸æˆç«‹æ¡ä»¶è¾¾æˆæ—¶ï¼Œè¾“å‡ºå®ƒä»¥åŠåç»­çš„æ‰€æœ‰å€¼ï¼ˆä¹‹åä¸å†è¿›å…¥ï¼‰</span>
        <span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">})</span>
        <span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subscriptions</span><span class="p">)</span>
<span class="c1">//    dropping</span>
<span class="c1">//    dropping</span>
<span class="c1">//    dropping</span>
<span class="c1">//    dropping</span>
<span class="c1">//    dropping</span>
<span class="c1">//    5</span>
<span class="c1">//    6</span>
<span class="c1">//    7</span>
<span class="c1">//    8</span>
<span class="c1">//    9</span>
<span class="c1">//    10</span>

    <span class="n">numbers</span>
        <span class="p">.</span><span class="bp">filter</span> <span class="p">{</span> <span class="nv">$0</span> <span class="o">%</span> <span class="mi">5</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">}</span>
        <span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">})</span>
        <span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subscriptions</span><span class="p">)</span>
<span class="c1">//    1</span>
<span class="c1">//    2</span>
<span class="c1">//    3</span>
<span class="c1">//    4</span>
<span class="c1">//    6</span>
<span class="c1">//    7</span>
<span class="c1">//    8</span>
<span class="c1">//    9</span>

    <span class="c1">// ä¸ filter çš„åŒºåˆ«ï¼š</span>
    <span class="c1">// 1. é—­åŒ…å†…è¿”å› true æ—¶ï¼Œwhile ä¼šè·³è¿‡è¿™äº›å€¼ï¼Œfilter åˆ™æ˜¯å…è®¸é€šè¿‡</span>
    <span class="c1">// 2. filter ä¼šåœ¨åç»­æ‰§è¡Œç›¸åŒçš„è¿‡æ»¤ç­–ç•¥ï¼Œè€Œ while åˆ™ç¬¬ä¸€æ¬¡æ»¡è¶³åï¼ˆè¿”å› falseï¼‰å°±ä¸å†è¿‡æ»¤</span>
<span class="p">}</span>

<span class="n">example</span><span class="p">(</span><span class="n">of</span><span class="p">:</span> <span class="s">&#34;drop(untilOutputFrom:)&#34;</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// å¦‚æœæˆ‘ä»¬æƒ³å½“ä¸€ä¸ªå‘å¸ƒè€…å‡†å¤‡å¥½çš„æ—¶å€™ï¼Œå†å»æ¥å—å¦å¤–ä¸€ä¸ªå‘å¸ƒè€…çš„å€¼ï¼Œå°±å¯ä»¥ä½¿ç”¨è¯¥æ“ä½œè€…</span>
    <span class="kd">let</span> <span class="nv">isReady</span> <span class="p">=</span> <span class="n">PassthroughSubject</span><span class="p">&lt;</span><span class="nb">Void</span><span class="p">,</span> <span class="n">Never</span><span class="p">&gt;()</span>
    <span class="kd">let</span> <span class="nv">taps</span> <span class="p">=</span> <span class="n">PassthroughSubject</span><span class="p">&lt;</span><span class="nb">Int</span><span class="p">,</span> <span class="n">Never</span><span class="p">&gt;()</span>

    <span class="n">taps</span>
        <span class="p">.</span><span class="n">drop</span><span class="p">(</span><span class="n">untilOutputFrom</span><span class="p">:</span> <span class="n">isReady</span><span class="p">)</span> <span class="c1">// isReady å‘å°„æ‰å¼€å§‹æ¥æ”¶</span>
        <span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">})</span>
        <span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subscriptions</span><span class="p">)</span>

    <span class="p">(</span><span class="mf">1.</span><span class="p">..</span><span class="mi">5</span><span class="p">).</span><span class="n">forEach</span> <span class="p">{</span> <span class="n">n</span> <span class="k">in</span>
        <span class="n">taps</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">n</span> <span class="p">==</span> <span class="mi">3</span> <span class="p">{</span>
<span class="c1">//            isReady.send(completion: .finished) å‘å°„å®Œæˆäº‹ä»¶æ˜¯ä¸è¡Œçš„</span>
            <span class="n">isReady</span><span class="p">.</span><span class="n">send</span><span class="p">()</span> <span class="c1">// å‘å°„</span>
        <span class="p">}</span>
    <span class="p">}</span>

<span class="c1">//    4</span>
<span class="c1">//    5</span>
<span class="p">}</span>

<span class="n">example</span><span class="p">(</span><span class="n">of</span><span class="p">:</span> <span class="s">&#34;prefix&#34;</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nv">numbers</span> <span class="p">=</span> <span class="p">(</span><span class="mf">1.</span><span class="p">..</span><span class="mi">10</span><span class="p">).</span><span class="n">publisher</span>

    <span class="c1">// ç±»ä¼¼ first æƒ°æ€§ï¼Œä»…å ç”¨æ‰€éœ€æ•°é‡çš„å€¼ï¼Œå³ç»ˆæ­¢</span>
    <span class="n">numbers</span>
        <span class="p">.</span><span class="kr">prefix</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c1">// åªæ¥å—å‰ä¸¤ä¸ª</span>
        <span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">},</span>
              <span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">})</span>
        <span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subscriptions</span><span class="p">)</span>

<span class="c1">//    1</span>
<span class="c1">//    2</span>
<span class="c1">//    finished</span>

    <span class="n">numbers</span><span class="p">.</span><span class="kr">prefix</span><span class="p">(</span><span class="k">while</span><span class="p">:</span> <span class="p">{</span> <span class="nv">$0</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="p">})</span> <span class="c1">// åªæ¥å—å°äº 3 çš„å‰ç¼€ï¼Œå½“èµ·å§‹ä¸æ»¡è¶³ï¼Œåˆ™ç›´æ¥ finished</span>
    <span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">},</span>
          <span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">})</span>
    <span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subscriptions</span><span class="p">)</span>

<span class="c1">//    1</span>
<span class="c1">//    2</span>
<span class="c1">//    finished</span>
<span class="p">}</span>

<span class="n">example</span><span class="p">(</span><span class="n">of</span><span class="p">:</span> <span class="s">&#34;prefix(untilOutputFrom:)&#34;</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nv">isReady</span> <span class="p">=</span> <span class="n">PassthroughSubject</span><span class="p">&lt;</span><span class="nb">Void</span><span class="p">,</span> <span class="n">Never</span><span class="p">&gt;()</span>
    <span class="kd">let</span> <span class="nv">taps</span> <span class="p">=</span> <span class="n">PassthroughSubject</span><span class="p">&lt;</span><span class="nb">Int</span><span class="p">,</span> <span class="n">Never</span><span class="p">&gt;()</span>

    <span class="n">taps</span>
        <span class="p">.</span><span class="kr">prefix</span><span class="p">(</span><span class="n">untilOutputFrom</span><span class="p">:</span> <span class="n">isReady</span><span class="p">)</span> <span class="c1">// å½“ isReady å‘å‡ºåä¸å†å¯ä»¥å‘é€</span>
        <span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">},</span>
              <span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">})</span>
        <span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subscriptions</span><span class="p">)</span>

    <span class="p">(</span><span class="mf">1.</span><span class="p">..</span><span class="mi">5</span><span class="p">).</span><span class="n">forEach</span> <span class="p">{</span> <span class="n">n</span> <span class="k">in</span> <span class="n">taps</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">n</span> <span class="p">==</span> <span class="mi">2</span> <span class="p">{</span>
            <span class="n">isReady</span><span class="p">.</span><span class="n">send</span><span class="p">()</span> <span class="c1">// å‘å°„</span>
        <span class="p">}</span>
    <span class="p">}</span>

<span class="c1">//    1</span>
<span class="c1">//    2</span>
<span class="c1">//    finished</span>


<span class="p">}</span>

<span class="n">example</span><span class="p">(</span><span class="n">of</span><span class="p">:</span> <span class="s">&#34;Challenge&#34;</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nv">p</span> <span class="p">=</span> <span class="p">(</span><span class="mf">1.</span><span class="p">..</span><span class="mi">100</span><span class="p">).</span><span class="n">publisher</span>

    <span class="n">p</span>
        <span class="p">.</span><span class="n">drop</span><span class="p">(</span><span class="k">while</span><span class="p">:</span> <span class="p">{</span> <span class="nv">$0</span> <span class="o">&lt;</span> <span class="mi">50</span> <span class="p">})</span>
        <span class="p">.</span><span class="kr">prefix</span> <span class="p">{</span> <span class="nv">$0</span> <span class="o">&lt;=</span> <span class="mi">70</span> <span class="p">}</span>
        <span class="p">.</span><span class="bp">filter</span> <span class="p">{</span> <span class="nv">$0</span><span class="p">.</span><span class="n">isMultiple</span><span class="p">(</span><span class="n">of</span><span class="p">:</span> <span class="mi">2</span><span class="p">)</span> <span class="p">}</span>
        <span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">},</span>
              <span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">})</span>
        <span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subscriptions</span><span class="p">)</span>

    <span class="c1">// æƒ°æ€§ï¼šæ¥æ”¶æ‰€éœ€æ•°é‡çš„å€¼ï¼Œç„¶åå®Œæˆ</span>
    <span class="c1">// è´ªå©ªï¼šç¡®å®šå€¼çš„èŒƒå›´ï¼Œå†æ¥æ”¶æ»¡è¶³æ¡ä»¶çš„å€¼</span>
<span class="p">}</span>

</code></pre></div><h2 id="5">5</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="kd">import</span> <span class="nc">UIKit</span>
<span class="kd">import</span> <span class="nc">Combine</span>

<span class="kd">var</span> <span class="nv">subscriptions</span> <span class="p">=</span> <span class="p">[</span><span class="n">AnyCancellable</span><span class="p">]()</span>

<span class="kd">enum</span> <span class="nc">MyError</span><span class="p">:</span> <span class="n">Error</span> <span class="p">{</span>
    <span class="k">case</span> <span class="n">foo</span>
<span class="p">}</span>


<span class="n">example</span><span class="p">(</span><span class="n">of</span><span class="p">:</span> <span class="s">&#34;prepend(Output...)&#34;</span><span class="p">)</span> <span class="p">{</span>

    <span class="kd">let</span> <span class="nv">publisher</span> <span class="p">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">].</span><span class="n">publisher</span>

    <span class="n">publisher</span>
        <span class="p">.</span><span class="n">prepend</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="c1">// å¯å˜å‚æ•°ï¼Œæ’å…¥å‰ç½®çš„å€¼</span>
        <span class="p">.</span><span class="n">prepend</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="c1">// æ’å…¥ä¸Šæµçš„æœ€å‰é¢</span>
        <span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">})</span>
        <span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subscriptions</span><span class="p">)</span>
<span class="c1">//-1</span>
<span class="c1">//0</span>
<span class="c1">//1</span>
<span class="c1">//2</span>
<span class="c1">//3</span>
<span class="c1">//4</span>
<span class="p">}</span>

<span class="n">example</span><span class="p">(</span><span class="n">of</span><span class="p">:</span> <span class="s">&#34;prepend(Sequence)&#34;</span><span class="p">)</span> <span class="p">{</span>

    <span class="kd">let</span> <span class="nv">publisher</span> <span class="p">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">].</span><span class="n">publisher</span>

    <span class="n">publisher</span>
        <span class="p">.</span><span class="n">prepend</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
        <span class="p">.</span><span class="n">prepend</span><span class="p">(</span><span class="n">Set</span><span class="p">(</span><span class="mf">1.</span><span class="p">..</span><span class="mi">2</span><span class="p">))</span> <span class="c1">// é›†åˆæ— åºï¼Œå¯èƒ½ 1ï¼Œ2 æˆ– 2ï¼Œ1</span>
        <span class="p">.</span><span class="n">prepend</span><span class="p">(</span><span class="bp">stride</span><span class="p">(</span><span class="n">from</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="n">to</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span> <span class="n">by</span><span class="p">:</span> <span class="mi">2</span><span class="p">))</span>
        <span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">})</span>
        <span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subscriptions</span><span class="p">)</span>

<span class="p">}</span>

<span class="n">example</span><span class="p">(</span><span class="n">of</span><span class="p">:</span> <span class="s">&#34;prepend(Publisher)&#34;</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nv">publisher1</span> <span class="p">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">].</span><span class="n">publisher</span>
    <span class="kd">let</span> <span class="nv">publisher2</span> <span class="p">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">].</span><span class="n">publisher</span>
<span class="c1">// ç±»å‹éœ€ç›¸åŒ</span>
    <span class="n">publisher1</span>
        <span class="p">.</span><span class="n">prepend</span><span class="p">(</span><span class="n">publisher2</span><span class="p">)</span> <span class="c1">// æ’å…¥å‘å¸ƒè€…ï¼Œå½“æ’å…¥çš„å‘å¸ƒè€…å®Œæˆåæ‰å‘å‡ºç¬¬äºŒä¸ª</span>
        <span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">},</span>
              <span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">})</span>
        <span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subscriptions</span><span class="p">)</span>

    <span class="kd">let</span> <span class="nv">publisher3</span> <span class="p">=</span> <span class="n">PassthroughSubject</span><span class="p">&lt;</span><span class="nb">Int</span><span class="p">,</span> <span class="n">MyError</span><span class="p">&gt;()</span>
    <span class="kd">let</span> <span class="nv">publisher4</span> <span class="p">=</span> <span class="n">PassthroughSubject</span><span class="p">&lt;</span><span class="nb">Int</span><span class="p">,</span> <span class="n">MyError</span><span class="p">&gt;()</span>

    <span class="n">publisher4</span>
    <span class="p">.</span><span class="n">prepend</span><span class="p">(</span><span class="n">publisher3</span><span class="p">)</span> <span class="c1">// publisher3 ä¸ç»“æŸï¼Œåˆ™ publisher4 ä¸ç»§ç»­</span>
    <span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">},</span>
          <span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">})</span>
        <span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subscriptions</span><span class="p">)</span>

    <span class="n">publisher4</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>
    <span class="n">publisher4</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">22</span><span class="p">)</span>

    <span class="n">publisher3</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">publisher3</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">publisher3</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">completion</span><span class="p">:</span> <span class="p">.</span><span class="n">finished</span><span class="p">)</span> <span class="c1">// å®Œæˆåï¼Œ4 å¼€å§‹</span>

    <span class="n">publisher4</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">33</span><span class="p">)</span>
    <span class="n">publisher4</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">44</span><span class="p">)</span>
<span class="c1">//    publisher3.send(completion: .failure(.foo)) // Error åˆ™ä¹Ÿåœæ­¢</span>

<span class="c1">//    1</span>
<span class="c1">//    2</span>
<span class="c1">//    33</span>
<span class="c1">//    44</span>
<span class="p">}</span>

<span class="n">example</span><span class="p">(</span><span class="n">of</span><span class="p">:</span> <span class="s">&#34;append(Output...)&#34;</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nv">publisher</span> <span class="p">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">publisher</span>

    <span class="n">publisher</span>
        <span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
        <span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">})</span>
        <span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subscriptions</span><span class="p">)</span>

<span class="c1">//    1</span>
<span class="c1">//    2</span>
<span class="c1">//    3</span>
<span class="c1">//    4</span>
<span class="p">}</span>

<span class="n">example</span><span class="p">(</span><span class="n">of</span><span class="p">:</span> <span class="s">&#34;append(Output...) #2&#34;</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// 1</span>
    <span class="kd">let</span> <span class="nv">publisher</span> <span class="p">=</span> <span class="n">PassthroughSubject</span><span class="p">&lt;</span><span class="nb">Int</span><span class="p">,</span> <span class="n">Never</span><span class="p">&gt;()</span>
    <span class="n">publisher</span>
        <span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">})</span>
        <span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subscriptions</span><span class="p">)</span>

    <span class="n">publisher</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">publisher</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="c1">// åªæœ‰ publisher å®Œæˆï¼Œappend æ‰ä¼šé™„åŠ </span>
    <span class="n">publisher</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">completion</span><span class="p">:</span> <span class="p">.</span><span class="n">finished</span><span class="p">)</span>

<span class="c1">//    1</span>
<span class="c1">//    2</span>
<span class="c1">//    3</span>
<span class="c1">//    4</span>
<span class="c1">//    5</span>
<span class="p">}</span>

<span class="n">example</span><span class="p">(</span><span class="n">of</span><span class="p">:</span> <span class="s">&#34;append(Sequence)&#34;</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nv">publisher</span> <span class="p">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">].</span><span class="n">publisher</span>
    <span class="n">publisher</span>
        <span class="p">.</span><span class="n">append</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
        <span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">Set</span><span class="p">([</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">]))</span> <span class="c1">// æ³¨æ„é›†åˆæ— åº</span>
        <span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="bp">stride</span><span class="p">(</span><span class="n">from</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="n">to</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span> <span class="n">by</span><span class="p">:</span> <span class="mi">2</span><span class="p">))</span>
        <span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">})</span>
        <span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subscriptions</span><span class="p">)</span>

<span class="c1">//    1</span>
<span class="c1">//    2</span>
<span class="c1">//    3</span>
<span class="c1">//    4</span>
<span class="c1">//    5</span>
<span class="c1">//    7</span>
<span class="c1">//    6</span>
<span class="c1">//    8</span>
<span class="c1">//    10</span>
<span class="p">}</span>

<span class="n">example</span><span class="p">(</span><span class="n">of</span><span class="p">:</span> <span class="s">&#34;append(Publisher)&#34;</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nv">publisher1</span> <span class="p">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">].</span><span class="n">publisher</span>
    <span class="kd">let</span> <span class="nv">publisher2</span> <span class="p">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">].</span><span class="n">publisher</span>

    <span class="n">publisher1</span>
        <span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">publisher2</span><span class="p">)</span>
        <span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">})</span>
        <span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subscriptions</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">example</span><span class="p">(</span><span class="n">of</span><span class="p">:</span> <span class="s">&#34;switchToLatest&#34;</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nv">publisher1</span> <span class="p">=</span> <span class="n">PassthroughSubject</span><span class="p">&lt;</span><span class="nb">Int</span><span class="p">,</span> <span class="n">Never</span><span class="p">&gt;()</span>
    <span class="kd">let</span> <span class="nv">publisher2</span> <span class="p">=</span> <span class="n">PassthroughSubject</span><span class="p">&lt;</span><span class="nb">Int</span><span class="p">,</span> <span class="n">Never</span><span class="p">&gt;()</span>
    <span class="kd">let</span> <span class="nv">publisher3</span> <span class="p">=</span> <span class="n">PassthroughSubject</span><span class="p">&lt;</span><span class="nb">Int</span><span class="p">,</span> <span class="n">Never</span><span class="p">&gt;()</span>

    <span class="kd">let</span> <span class="nv">publishers</span> <span class="p">=</span> <span class="n">PassthroughSubject</span><span class="p">&lt;</span><span class="n">PassthroughSubject</span><span class="p">&lt;</span><span class="nb">Int</span><span class="p">,</span> <span class="n">Never</span><span class="p">&gt;,</span> <span class="n">Never</span><span class="p">&gt;()</span>

    <span class="n">publishers</span>
        <span class="p">.</span><span class="n">switchToLatest</span><span class="p">()</span> <span class="c1">// åªèƒ½ç”¨äºå‘å¸ƒå‘å¸ƒè€…çš„å‘å¸ƒè€…ä¸Š</span>
        <span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="kc">_</span> <span class="k">in</span> <span class="bp">print</span><span class="p">(</span><span class="s">&#34;Completed!&#34;</span><span class="p">)</span> <span class="p">},</span>
              <span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">})</span>
        <span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subscriptions</span><span class="p">)</span>

    <span class="n">publishers</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">publisher1</span><span class="p">)</span>
    <span class="n">publisher1</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">publisher1</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">publishers</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">publisher2</span><span class="p">)</span>
    <span class="n">publisher1</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="c1">// å·²ç»åˆ‡æ¢åˆ° publisher2ï¼Œå¿½ç•¥ publisher1</span>
    <span class="n">publisher2</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">publisher2</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="n">publishers</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">publisher3</span><span class="p">)</span>
    <span class="n">publisher2</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>  <span class="c1">// å·²ç»åˆ‡æ¢åˆ° publisher3ï¼Œå¿½ç•¥ publisher2</span>
    <span class="n">publisher3</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
    <span class="n">publisher3</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
    <span class="n">publisher3</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>

    <span class="n">publisher3</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">completion</span><span class="p">:</span> <span class="p">.</span><span class="n">finished</span><span class="p">)</span>
    <span class="n">publishers</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">completion</span><span class="p">:</span> <span class="p">.</span><span class="n">finished</span><span class="p">)</span>

    <span class="c1">// ç”¨é€”ï¼Œç”¨æˆ·ç‚¹å‡»æŒ‰é’®å°±ä¼šå‘é€è¯·æ±‚ï¼Œå†æ¬¡ç‚¹å‡»è§¦å‘æ–°çš„è¯·æ±‚ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç”¨ switchToLatest åˆ‡æ¢åˆ°åªå¤„ç†æœ€æ–°çš„è¯·æ±‚</span>
<span class="p">}</span>

<span class="c1">//example(of: &#34;switchToLatest - Network Request&#34;) {</span>
<span class="c1">//    let url = URL(string: &#34;https://source.unsplash.com/random&#34;)!</span>
<span class="c1">//</span>
<span class="c1">//    func getImage() -&gt; AnyPublisher&lt;UIImage?, Never&gt; {</span>
<span class="c1">//        return URLSession.shared</span>
<span class="c1">//            .dataTaskPublisher(for: url) // URLSession çš„ Combine æ‰©å±•</span>
<span class="c1">//            .map { data, _ in UIImage(data: data) }</span>
<span class="c1">//            .print(&#34;image&#34;)</span>
<span class="c1">//            .replaceError(with: nil) // æ›¿ä»£ error</span>
<span class="c1">//            .eraseToAnyPublisher() // ç±»å‹æ“¦é™¤</span>
<span class="c1">//    }</span>
<span class="c1">//</span>
<span class="c1">//    let taps = PassthroughSubject&lt;Void, Never&gt;()</span>
<span class="c1">//    taps</span>
<span class="c1">//        .map { _ in getImage() }</span>
<span class="c1">//        .switchToLatest()</span>
<span class="c1">//        .sink(receiveValue: { _ in })</span>
<span class="c1">//        .store(in: &amp;subscriptions)</span>
<span class="c1">//    taps.send()</span>
<span class="c1">//</span>
<span class="c1">//    DispatchQueue.main.asyncAfter(deadline: .now() + 3) {</span>
<span class="c1">//        taps.send()</span>
<span class="c1">//    }</span>
<span class="c1">//</span>
<span class="c1">//    DispatchQueue.main.asyncAfter(deadline: .now() + 3.1) {</span>
<span class="c1">//        taps.send()</span>
<span class="c1">//    }</span>
<span class="c1">//</span>
<span class="c1">////    â€”â€”â€” Example of: switchToLatest - Network Request â€”â€”â€”</span>
<span class="c1">////    image: receive subscription: (DataTaskPublisher)</span>
<span class="c1">////    image: request unlimited</span>
<span class="c1">////    image: receive cancel // è¢«å–æ¶ˆ</span>
<span class="c1">////    image: receive subscription: (DataTaskPublisher)</span>
<span class="c1">////    image: request unlimited</span>
<span class="c1">////    image: receive cancel // è¢«å–æ¶ˆ</span>
<span class="c1">////    image: receive subscription: (DataTaskPublisher)</span>
<span class="c1">////    image: request unlimited</span>
<span class="c1">////    image: receive value: (Optional(&lt;UIImage:0x600001beca20 anonymous {1080, 1350}&gt;))</span>
<span class="c1">////    image: receive finished</span>
<span class="c1">//}</span>

<span class="n">example</span><span class="p">(</span><span class="n">of</span><span class="p">:</span> <span class="s">&#34;merge&#34;</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nv">pub1</span> <span class="p">=</span> <span class="n">PassthroughSubject</span><span class="p">&lt;</span><span class="nb">Int</span><span class="p">,</span> <span class="n">Never</span><span class="p">&gt;()</span>
    <span class="kd">let</span> <span class="nv">pub2</span> <span class="p">=</span> <span class="n">PassthroughSubject</span><span class="p">&lt;</span><span class="nb">Int</span><span class="p">,</span> <span class="n">Never</span><span class="p">&gt;()</span>

    <span class="c1">// æœ€å¤šåˆå¹¶ 8 ä¸ª</span>
<span class="c1">//    pub2.merge(with: &lt;#T##Publisher#&gt;, &lt;#T##c: Publisher##Publisher#&gt;, &lt;#T##d: Publisher##Publisher#&gt;, &lt;#T##e: Publisher##Publisher#&gt;, &lt;#T##f: Publisher##Publisher#&gt;, &lt;#T##g: Publisher##Publisher#&gt;, &lt;#T##h: Publisher##Publisher#&gt;)</span>
    <span class="n">pub2</span><span class="p">.</span><span class="n">merge</span><span class="p">(</span><span class="n">with</span><span class="p">:</span> <span class="n">pub1</span><span class="p">)</span>
        <span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="kc">_</span> <span class="k">in</span>
        <span class="bp">print</span><span class="p">(</span><span class="s">&#34;completion&#34;</span><span class="p">)</span>
    <span class="p">},</span> <span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">})</span>
        <span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subscriptions</span><span class="p">)</span>

    <span class="n">pub1</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>
    <span class="n">pub2</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">22</span><span class="p">)</span>
    <span class="n">pub1</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">13</span><span class="p">)</span>
    <span class="n">pub2</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span>

    <span class="n">pub1</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">completion</span><span class="p">:</span> <span class="p">.</span><span class="n">finished</span><span class="p">)</span>

    <span class="n">pub2</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span>

    <span class="n">pub2</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">completion</span><span class="p">:</span> <span class="p">.</span><span class="n">finished</span><span class="p">)</span> <span class="c1">// ä»¥æœ€åä¸€ä¸ªç»“æŸä¸ºæ•´ä¸ªç»“æŸ</span>

<span class="c1">//11</span>
<span class="c1">//22</span>
<span class="c1">//13</span>
<span class="c1">//24</span>
<span class="c1">//25</span>
<span class="c1">//completion</span>
<span class="p">}</span>

<span class="n">example</span><span class="p">(</span><span class="n">of</span><span class="p">:</span> <span class="s">&#34;combineLatest&#34;</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// combineLatest å¯ç»„åˆå¤šä¸ªå‘å¸ƒè€…ï¼Œå½“å…¶ä¸­ä»»ä½•ä¸€ä¸ªå‘å‡ºå€¼æ—¶ï¼Œéƒ½ä¼šå‘å¸ƒä¸€ä¸ªå…·æœ‰æ‰€æœ‰å‘å¸ƒè€…æœ€æ–°å€¼çš„å…ƒç»„</span>

    <span class="kd">let</span> <span class="nv">pub1</span> <span class="p">=</span> <span class="n">PassthroughSubject</span><span class="p">&lt;</span><span class="nb">Int</span><span class="p">,</span> <span class="n">Never</span><span class="p">&gt;()</span>
    <span class="kd">let</span> <span class="nv">pub2</span> <span class="p">=</span> <span class="n">PassthroughSubject</span><span class="p">&lt;</span><span class="nb">String</span><span class="p">,</span> <span class="n">Never</span><span class="p">&gt;()</span>

    <span class="n">pub1</span><span class="p">.</span><span class="n">combineLatest</span><span class="p">(</span><span class="n">pub2</span><span class="p">)</span>
        <span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="s">&#34;completion&#34;</span><span class="p">,</span> <span class="nv">$0</span><span class="p">)</span> <span class="p">},</span>
              <span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">})</span>
        <span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subscriptions</span><span class="p">)</span>

    <span class="n">pub1</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="c1">// combineLatest é¦–æ¬¡éœ€ç­‰å¾…å¦ä¸€ä¸ªå‘å¸ƒè€…å‘å¸ƒæ‰ä¼šä¸€åŒå‘å¸ƒ</span>
    <span class="n">pub1</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">pub2</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s">&#34;23&#34;</span><span class="p">)</span>
    <span class="n">pub1</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">pub2</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s">&#34;25&#34;</span><span class="p">)</span>

    <span class="n">pub1</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">completion</span><span class="p">:</span> <span class="p">.</span><span class="n">finished</span><span class="p">)</span>

    <span class="n">pub2</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s">&#34;26&#34;</span><span class="p">)</span>

    <span class="n">pub2</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">completion</span><span class="p">:</span> <span class="p">.</span><span class="n">finished</span><span class="p">)</span> <span class="c1">// ä»¥æœ€åä¸€ä¸ªç»“æŸä¸ºæ•´ä¸ªç»“æŸ</span>

<span class="c1">//    (12, &#34;23&#34;)</span>
<span class="c1">//    (14, &#34;23&#34;)</span>
<span class="c1">//    (14, &#34;25&#34;)</span>
<span class="c1">//    (14, &#34;26&#34;)</span>
<span class="c1">//    completion finished</span>
<span class="p">}</span>

<span class="n">example</span><span class="p">(</span><span class="n">of</span><span class="p">:</span> <span class="s">&#34;zip&#34;</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nv">pub1</span> <span class="p">=</span> <span class="n">PassthroughSubject</span><span class="p">&lt;</span><span class="nb">Int</span><span class="p">,</span> <span class="n">Never</span><span class="p">&gt;()</span>
    <span class="kd">let</span> <span class="nv">pub2</span> <span class="p">=</span> <span class="n">PassthroughSubject</span><span class="p">&lt;</span><span class="nb">String</span><span class="p">,</span> <span class="n">Never</span><span class="p">&gt;()</span>

    <span class="n">pub1</span><span class="p">.</span><span class="n">zip</span><span class="p">(</span><span class="n">pub2</span><span class="p">)</span>
    <span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="s">&#34;completion&#34;</span><span class="p">,</span> <span class="nv">$0</span><span class="p">)</span> <span class="p">},</span>
          <span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">})</span>
    <span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subscriptions</span><span class="p">)</span>

    <span class="n">pub1</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>
    <span class="n">pub1</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">pub2</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s">&#34;23&#34;</span><span class="p">)</span> <span class="c1">// å–å’Œä»–åŒä¸ºç¬¬ä¸€ä¸ªçš„ 11</span>
    <span class="n">pub1</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">pub2</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s">&#34;25&#34;</span><span class="p">)</span> <span class="c1">// å–å’Œä»–åŒä¸ºç¬¬äºŒä¸ªçš„ 12</span>

    <span class="n">pub1</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">completion</span><span class="p">:</span> <span class="p">.</span><span class="n">finished</span><span class="p">)</span>

    <span class="n">pub2</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s">&#34;26&#34;</span><span class="p">)</span> <span class="c1">// å–å’Œä»–åŒä¸ºç¬¬ä¸‰ä¸ªçš„ 14</span>
    <span class="n">pub2</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s">&#34;27&#34;</span><span class="p">)</span> <span class="c1">// æ²¡æœ‰å’Œä»–åŒä¸€ä¸ªçš„ pub1 äº†ï¼Œå°±ä¸è¾“å‡º</span>

    <span class="n">pub2</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">completion</span><span class="p">:</span> <span class="p">.</span><span class="n">finished</span><span class="p">)</span> <span class="c1">// ä»¥æœ€åä¸€ä¸ªç»“æŸä¸ºæ•´ä¸ªç»“æŸ</span>

<span class="c1">//    â€”â€”â€” Example of: zip â€”â€”â€”</span>
<span class="c1">//    (11, &#34;23&#34;)</span>
<span class="c1">//    (12, &#34;25&#34;)</span>
<span class="c1">//    (14, &#34;26&#34;)</span>
<span class="c1">//    completion finished</span>

<span class="c1">//    mergeï¼ˆwith :)ä½¿æ‚¨å¯ä»¥äº¤é”™å¤šä¸ªå‘å¸ƒè€…çš„å€¼ã€‚</span>

<span class="p">}</span>

</code></pre></div><h2 id="6">6</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="kd">import</span> <span class="nc">UIKit</span>
<span class="kd">import</span> <span class="nc">SwiftUI</span>
<span class="kd">import</span> <span class="nc">Combine</span>
<span class="kd">import</span> <span class="nc">PlaygroundSupport</span>

<span class="c1">// ObservableObject åªèƒ½ç”± class å®ç°ï¼Œå¯¹åº”äº† assign åªæ¥å—åˆ†é…åˆ° class ç±»å‹</span>
<span class="kd">public</span> <span class="kr">final</span> <span class="kd">class</span> <span class="nc">DisplayTimer</span><span class="p">:</span> <span class="n">ObservableObject</span> <span class="p">{</span>
    <span class="p">@</span><span class="n">Published</span> <span class="kd">var</span> <span class="nv">current</span><span class="p">:</span> <span class="n">CGFloat</span> <span class="p">=</span> <span class="mi">0</span>
    <span class="kd">var</span> <span class="nv">cancellable</span><span class="p">:</span> <span class="n">Cancellable</span><span class="p">?</span> <span class="p">=</span> <span class="kc">nil</span>

    <span class="kd">init</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">DispatchQueue</span><span class="p">.</span><span class="n">main</span><span class="p">.</span><span class="n">async</span> <span class="p">{</span>
            <span class="kc">self</span><span class="p">.</span><span class="n">cancellable</span> <span class="p">=</span> <span class="kc">self</span><span class="p">.</span><span class="n">start</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">start</span><span class="p">()</span> <span class="p">-&gt;</span> <span class="n">Cancellable</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">Timer</span><span class="p">.</span><span class="n">publish</span><span class="p">(</span><span class="n">every</span><span class="p">:</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="mi">30</span><span class="p">,</span>
                             <span class="n">on</span><span class="p">:</span> <span class="p">.</span><span class="n">main</span><span class="p">,</span>
                             <span class="k">in</span><span class="p">:</span> <span class="p">.</span><span class="n">common</span><span class="p">)</span>
            <span class="p">.</span><span class="n">autoconnect</span><span class="p">()</span>
            <span class="p">.</span><span class="n">scan</span><span class="p">(</span><span class="n">CGFloat</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="p">{</span> <span class="n">counter</span><span class="p">,</span> <span class="kc">_</span> <span class="k">in</span> <span class="n">counter</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">}</span> <span class="c1">// æ‰«ææ¯ä¸ªå€¼ï¼Œåšè‡ªå¢ + 1</span>
            <span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="n">counter</span> <span class="k">in</span> <span class="kc">self</span><span class="p">.</span><span class="n">current</span> <span class="p">=</span> <span class="n">counter</span> <span class="p">})</span> <span class="c1">// å°† Timer å‘å°„ä¸€æ¬¡å°±æ›´æ–°åˆ° current ä¸Š</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">stop</span><span class="p">(</span><span class="n">after</span><span class="p">:</span> <span class="n">TimeInterval</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">DispatchQueue</span><span class="p">.</span><span class="n">main</span><span class="p">.</span><span class="n">asyncAfter</span><span class="p">(</span><span class="n">deadline</span><span class="p">:</span> <span class="p">.</span><span class="n">now</span><span class="p">()</span> <span class="o">+</span> <span class="n">after</span><span class="p">)</span> <span class="p">{</span>
            <span class="kc">self</span><span class="p">.</span><span class="n">cancellable</span><span class="p">?.</span><span class="n">cancel</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// äº‹ä»¶æšä¸¾ï¼Œå€¼ã€å®Œæˆã€å¤±è´¥</span>
<span class="kd">public</span> <span class="kd">enum</span> <span class="nc">Event</span><span class="p">:</span> <span class="nb">Equatable</span> <span class="p">{</span>
    <span class="k">case</span> <span class="n">value</span>
    <span class="k">case</span> <span class="n">completion</span>
    <span class="k">case</span> <span class="n">failure</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="nc">CombineEvent</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nv">index</span><span class="p">:</span> <span class="nb">Int</span>
    <span class="kd">let</span> <span class="nv">time</span><span class="p">:</span> <span class="n">TimeInterval</span>
    <span class="kd">let</span> <span class="nv">event</span><span class="p">:</span> <span class="n">Event</span>

    <span class="kd">var</span> <span class="nv">groupTime</span><span class="p">:</span> <span class="nb">Int</span> <span class="p">{</span> <span class="nb">Int</span><span class="p">(</span><span class="n">floor</span><span class="p">(</span><span class="n">time</span> <span class="o">*</span> <span class="mf">10.0</span><span class="p">))</span> <span class="p">}</span>
    <span class="kd">var</span> <span class="nv">isValue</span><span class="p">:</span> <span class="nb">Bool</span> <span class="p">{</span> <span class="kc">self</span><span class="p">.</span><span class="n">event</span> <span class="p">==</span> <span class="p">.</span><span class="n">value</span> <span class="p">}</span>
    <span class="kd">var</span> <span class="nv">isCompletion</span><span class="p">:</span> <span class="nb">Bool</span> <span class="p">{</span> <span class="kc">self</span><span class="p">.</span><span class="n">event</span> <span class="p">==</span> <span class="p">.</span><span class="n">completion</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="nc">CombineEvents</span><span class="p">:</span> <span class="n">Identifiable</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nv">events</span><span class="p">:</span> <span class="p">[</span><span class="n">CombineEvent</span><span class="p">]</span>

    <span class="kd">var</span> <span class="nv">time</span><span class="p">:</span> <span class="n">TimeInterval</span> <span class="p">{</span> <span class="n">events</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">time</span> <span class="p">}</span>
    <span class="kd">var</span> <span class="nv">id</span><span class="p">:</span> <span class="nb">Int</span> <span class="p">{</span> <span class="p">(</span><span class="n">events</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">groupTime</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">|</span> <span class="n">events</span><span class="p">.</span><span class="bp">count</span> <span class="p">}</span> <span class="c1">// idï¼Œä¸ºæ¯ä¸ªäº‹ä»¶åˆ›é€ ä¸€ä¸ª id</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">EventsHolder</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nv">events</span><span class="p">:</span> <span class="p">[</span><span class="n">CombineEvent</span><span class="p">]</span>
    <span class="kd">var</span> <span class="nv">startDate</span> <span class="p">=</span> <span class="n">Date</span><span class="p">()</span>
    <span class="kd">var</span> <span class="nv">nextIndex</span> <span class="p">=</span> <span class="mi">1</span>

    <span class="kd">init</span><span class="p">(</span><span class="n">events</span><span class="p">:</span> <span class="p">[</span><span class="n">CombineEvent</span><span class="p">]</span> <span class="p">=</span> <span class="p">[])</span> <span class="p">{</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">events</span> <span class="p">=</span> <span class="n">events</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">capture</span><span class="p">(</span><span class="kc">_</span> <span class="n">event</span><span class="p">:</span> <span class="n">Event</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nv">time</span> <span class="p">=</span> <span class="n">Date</span><span class="p">().</span><span class="n">timeIntervalSince</span><span class="p">(</span><span class="n">startDate</span><span class="p">)</span>
        <span class="c1">// if case æ¨¡å¼åŒ¹é…</span>
        <span class="k">if</span> <span class="k">case</span> <span class="p">.</span><span class="n">completion</span> <span class="p">=</span> <span class="n">event</span><span class="p">,</span> <span class="c1">// æ ¡éªŒ event æ˜¯å¦ç¬¦åˆ .completion åŒ¹é…</span>
            <span class="kd">let</span> <span class="nv">lastEvent</span> <span class="p">=</span> <span class="n">events</span><span class="p">.</span><span class="bp">last</span><span class="p">,</span>
            <span class="p">(</span><span class="n">time</span> <span class="o">-</span> <span class="n">lastEvent</span><span class="p">.</span><span class="n">time</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1.0</span> <span class="p">{</span>
            <span class="n">events</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">CombineEvent</span><span class="p">(</span><span class="n">index</span><span class="p">:</span> <span class="n">nextIndex</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="n">lastEvent</span><span class="p">.</span><span class="n">time</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">event</span><span class="p">))</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">events</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">CombineEvent</span><span class="p">(</span><span class="n">index</span><span class="p">:</span> <span class="n">nextIndex</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="n">time</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">event</span><span class="p">))</span>
        <span class="p">}</span>
        <span class="n">nextIndex</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1">// è¶…è¿‡ 15 ç§’ï¼Œåˆ™ç§»é™¤äº‹ä»¶</span>
        <span class="k">while</span> <span class="kd">let</span> <span class="nv">e</span> <span class="p">=</span> <span class="n">events</span><span class="p">.</span><span class="bp">first</span> <span class="p">{</span>
            <span class="k">guard</span> <span class="p">(</span><span class="n">time</span> <span class="o">-</span> <span class="n">e</span><span class="p">.</span><span class="n">time</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">15.0</span> <span class="k">else</span> <span class="p">{</span> <span class="k">break</span> <span class="p">}</span>
            <span class="n">events</span><span class="p">.</span><span class="n">removeFirst</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// äº‹ä»¶å€¼çš„è§†å›¾</span>
<span class="kd">struct</span> <span class="nc">EventValueView</span><span class="p">:</span> <span class="n">View</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nv">index</span><span class="p">:</span> <span class="nb">Int</span>

    <span class="kd">var</span> <span class="nv">body</span><span class="p">:</span> <span class="n">some</span> <span class="n">View</span> <span class="p">{</span>
        <span class="n">Text</span><span class="p">(</span><span class="s">&#34;</span><span class="si">\(</span><span class="kc">self</span><span class="p">.</span><span class="n">index</span><span class="si">)</span><span class="s">&#34;</span><span class="p">)</span>
        <span class="p">.</span><span class="n">padding</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">width</span><span class="p">:</span> <span class="mi">28</span><span class="p">,</span> <span class="n">height</span><span class="p">:</span> <span class="mi">28</span><span class="p">)</span>
        <span class="c1">// Sets whether text can compress the space between characters when necessary to fit text in a line.</span>
        <span class="c1">// å…è®¸ä¸€è¡Œä¸­æŒ¤å‹æ–‡å­—é—´ç©ºéš™</span>
<span class="c1">// .allowsTightening(true)</span>
        <span class="p">.</span><span class="n">minimumScaleFactor</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="p">.</span><span class="n">foregroundColor</span><span class="p">(.</span><span class="n">white</span><span class="p">)</span>
        <span class="p">.</span><span class="n">background</span><span class="p">(</span><span class="n">Circle</span><span class="p">().</span><span class="n">fill</span><span class="p">(</span><span class="n">Color</span><span class="p">.</span><span class="n">blue</span><span class="p">))</span>
        <span class="p">.</span><span class="n">fixedSize</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="nc">EventCompletedView</span><span class="p">:</span> <span class="n">View</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nv">body</span><span class="p">:</span> <span class="n">some</span> <span class="n">View</span> <span class="p">{</span>
        <span class="n">Rectangle</span><span class="p">()</span>
            <span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">width</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="n">height</span><span class="p">:</span> <span class="mi">38</span><span class="p">)</span>
            <span class="p">.</span><span class="n">offset</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">)</span>
            <span class="p">.</span><span class="n">foregroundColor</span><span class="p">(.</span><span class="n">gray</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="nc">EventFailureView</span><span class="p">:</span> <span class="n">View</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nv">body</span><span class="p">:</span> <span class="n">some</span> <span class="n">View</span> <span class="p">{</span>
        <span class="n">Text</span><span class="p">(</span><span class="s">&#34;X&#34;</span><span class="p">)</span>
            <span class="p">.</span><span class="n">padding</span><span class="p">(</span><span class="mf">3.0</span><span class="p">)</span>
            <span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">width</span><span class="p">:</span> <span class="mi">28</span><span class="p">,</span> <span class="n">height</span><span class="p">:</span> <span class="mi">28</span><span class="p">)</span>
            <span class="p">.</span><span class="n">foregroundColor</span><span class="p">(.</span><span class="n">white</span><span class="p">)</span>
            <span class="p">.</span><span class="n">background</span><span class="p">(</span><span class="n">Circle</span><span class="p">().</span><span class="n">fill</span><span class="p">(</span><span class="n">Color</span><span class="p">.</span><span class="n">red</span><span class="p">))</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="nc">EventView</span><span class="p">:</span> <span class="n">View</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nv">event</span><span class="p">:</span> <span class="n">CombineEvent</span>
    <span class="c1">// An AnyView allows changing the type of view used in a given view hierarchy. Whenever the type of view used with an AnyView changes, the old hierarchy is destroyed and a new hierarchy is created for the new type.</span>
    <span class="kd">var</span> <span class="nv">body</span><span class="p">:</span> <span class="n">some</span> <span class="n">View</span> <span class="p">{</span>
        <span class="k">switch</span> <span class="kc">self</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="n">event</span> <span class="p">{</span>
        <span class="k">case</span> <span class="p">.</span><span class="n">value</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">AnyView</span><span class="p">(</span><span class="n">EventValueView</span><span class="p">(</span><span class="n">index</span><span class="p">:</span> <span class="kc">self</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="n">index</span><span class="p">))</span>
        <span class="k">case</span> <span class="p">.</span><span class="n">completion</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">AnyView</span><span class="p">(</span><span class="n">EventCompletedView</span><span class="p">())</span>
        <span class="k">case</span> <span class="p">.</span><span class="n">failure</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">AnyView</span><span class="p">(</span><span class="n">EventFailureView</span><span class="p">())</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="nc">SimultaneousEventsView</span><span class="p">:</span> <span class="n">View</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nv">events</span><span class="p">:</span> <span class="p">[</span><span class="n">CombineEvent</span><span class="p">]</span>

    <span class="kd">var</span> <span class="nv">body</span><span class="p">:</span> <span class="n">some</span> <span class="n">View</span> <span class="p">{</span>
        <span class="n">VStack</span><span class="p">(</span><span class="n">alignment</span><span class="p">:</span> <span class="p">.</span><span class="n">center</span><span class="p">,</span> <span class="n">spacing</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">ForEach</span><span class="p">(</span><span class="mf">0.</span><span class="p">.&lt;</span><span class="kc">self</span><span class="p">.</span><span class="n">events</span><span class="p">.</span><span class="bp">count</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">EventView</span><span class="p">(</span><span class="n">event</span><span class="p">:</span> <span class="kc">self</span><span class="p">.</span><span class="n">events</span><span class="p">[</span><span class="nv">$0</span><span class="p">])</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="nc">SimultaneousEventsView</span><span class="p">:</span> <span class="n">Identifiable</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nv">id</span><span class="p">:</span> <span class="nb">Int</span> <span class="p">{</span> <span class="k">return</span> <span class="n">events</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">groupTime</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="nc">ContentView</span><span class="p">:</span> <span class="n">View</span> <span class="p">{</span>
    <span class="p">@</span><span class="n">ObservedObject</span> <span class="kd">var</span> <span class="nv">time</span> <span class="p">=</span> <span class="n">DisplayTimer</span><span class="p">()</span>
    <span class="kd">let</span> <span class="nv">holder</span><span class="p">:</span> <span class="n">EventsHolder</span>
    <span class="kd">let</span> <span class="nv">title</span><span class="p">:</span> <span class="nb">String</span>
    <span class="kd">var</span> <span class="nv">groupEvents</span><span class="p">:</span> <span class="p">[</span><span class="n">CombineEvents</span><span class="p">]</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nv">d</span> <span class="p">=</span> <span class="nb">Dictionary</span><span class="p">&lt;</span><span class="nb">Int</span><span class="p">,</span> <span class="p">[</span><span class="n">CombineEvent</span><span class="p">]</span><span class="o">&gt;</span><span class="p">.</span><span class="kd">init</span><span class="p">(</span><span class="n">grouping</span><span class="p">:</span> <span class="kc">self</span><span class="p">.</span><span class="n">holder</span><span class="p">.</span><span class="n">events</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$0</span><span class="p">.</span><span class="n">groupTime</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">d</span><span class="p">.</span><span class="n">keys</span><span class="p">.</span><span class="bp">sorted</span><span class="p">().</span><span class="bp">map</span> <span class="p">{</span>
            <span class="n">CombineEvents</span><span class="p">(</span><span class="n">events</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="nv">$0</span><span class="p">]</span><span class="o">!</span><span class="p">.</span><span class="bp">sorted</span> <span class="p">{</span> <span class="nv">$0</span><span class="p">.</span><span class="n">index</span> <span class="o">&lt;</span> <span class="nv">$1</span><span class="p">.</span><span class="n">index</span> <span class="p">})</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">init</span><span class="p">(</span><span class="n">title</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="n">holder</span><span class="p">:</span> <span class="n">EventsHolder</span> <span class="p">=</span> <span class="n">EventsHolder</span><span class="p">())</span> <span class="p">{</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">title</span> <span class="p">=</span> <span class="n">title</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">holder</span> <span class="p">=</span> <span class="n">holder</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nv">body</span><span class="p">:</span> <span class="n">some</span> <span class="n">View</span> <span class="p">{</span>
        <span class="n">VStack</span><span class="p">(</span><span class="n">alignment</span><span class="p">:</span> <span class="p">.</span><span class="n">leading</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">Text</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
                <span class="p">.</span><span class="n">fixedSize</span><span class="p">(</span><span class="n">horizontal</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="n">vertical</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span>
                <span class="p">.</span><span class="n">padding</span><span class="p">(.</span><span class="n">bottom</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
            <span class="n">ZStack</span> <span class="p">{</span>
                <span class="n">Rectangle</span><span class="p">()</span>
                    <span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">height</span><span class="p">:</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="p">.</span><span class="n">foregroundColor</span><span class="p">(.</span><span class="n">gray</span><span class="p">)</span>
                    <span class="p">.</span><span class="n">offset</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="mi">14</span><span class="p">)</span>
                <span class="n">ForEach</span><span class="p">(</span><span class="n">groupEvents</span><span class="p">)</span> <span class="p">{</span> <span class="n">group</span> <span class="k">in</span>
                    <span class="n">SimultaneousEventsView</span><span class="p">(</span><span class="n">events</span><span class="p">:</span> <span class="n">group</span><span class="p">.</span><span class="n">events</span><span class="p">)</span>
                        <span class="p">.</span><span class="n">offset</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">CGFloat</span><span class="p">(</span><span class="n">group</span><span class="p">.</span><span class="n">time</span><span class="p">)</span> <span class="o">*</span> <span class="mf">30.0</span> <span class="o">-</span> <span class="kc">self</span><span class="p">.</span><span class="n">time</span><span class="p">.</span><span class="n">current</span> <span class="o">-</span> <span class="mi">32</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="mi">0</span><span class="p">)</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">minHeight</span><span class="p">:</span> <span class="mi">32</span><span class="p">)</span>
            <span class="p">.</span><span class="n">onReceive</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="n">objectWillChange</span><span class="p">)</span> <span class="p">{</span> <span class="kc">_</span> <span class="k">in</span>
                <span class="k">if</span> <span class="kc">self</span><span class="p">.</span><span class="n">holder</span><span class="p">.</span><span class="n">events</span><span class="p">.</span><span class="bp">contains</span><span class="p">(</span><span class="k">where</span><span class="p">:</span> <span class="p">{</span> <span class="nv">$0</span><span class="p">.</span><span class="n">event</span> <span class="o">!=</span> <span class="p">.</span><span class="n">value</span> <span class="p">})</span> <span class="p">{</span>
                    <span class="kc">self</span><span class="p">.</span><span class="n">time</span><span class="p">.</span><span class="n">stop</span><span class="p">(</span><span class="n">after</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">)</span>
                <span class="p">}</span>
            <span class="p">}</span>

        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">capture</span><span class="p">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">F</span><span class="p">&gt;(</span><span class="n">publisher</span><span class="p">:</span> <span class="n">AnyPublisher</span><span class="p">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">F</span><span class="p">&gt;)</span> <span class="p">{</span>
        <span class="c1">// ä¼ å…¥çš„ publisher ä¸å…¶è®¢é˜…è€…ç»‘å®šï¼Œè§¦å‘äº‹ä»¶æ›´æ–°</span>
        <span class="c1">// ç±»å‹æ“¦é™¤çš„ è®¢é˜…è€…</span>
        <span class="kd">let</span> <span class="nv">observer</span> <span class="p">=</span> <span class="n">AnySubscriber</span><span class="p">(</span><span class="n">receiveSubscription</span><span class="p">:</span> <span class="p">{</span> <span class="n">subscription</span> <span class="k">in</span>
            <span class="n">subscription</span><span class="p">.</span><span class="n">request</span><span class="p">(.</span><span class="n">unlimited</span><span class="p">)</span>
        <span class="p">},</span> <span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="n">T</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">Subscribers</span><span class="p">.</span><span class="n">Demand</span> <span class="k">in</span>
            <span class="kc">self</span><span class="p">.</span><span class="n">holder</span><span class="p">.</span><span class="n">capture</span><span class="p">(.</span><span class="n">value</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">.</span><span class="n">unlimited</span>
        <span class="p">},</span> <span class="n">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="p">(</span><span class="n">completion</span><span class="p">:</span> <span class="n">Subscribers</span><span class="p">.</span><span class="n">Completion</span><span class="p">&lt;</span><span class="n">F</span><span class="p">&gt;)</span> <span class="k">in</span>
            <span class="k">switch</span> <span class="n">completion</span> <span class="p">{</span>
            <span class="k">case</span> <span class="p">.</span><span class="n">finished</span><span class="p">:</span> <span class="kc">self</span><span class="p">.</span><span class="n">holder</span><span class="p">.</span><span class="n">capture</span><span class="p">(.</span><span class="n">completion</span><span class="p">)</span>
            <span class="k">case</span> <span class="p">.</span><span class="n">failure</span><span class="p">:</span> <span class="kc">self</span><span class="p">.</span><span class="n">holder</span><span class="p">.</span><span class="n">capture</span><span class="p">(.</span><span class="n">failure</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">})</span>

        <span class="n">publisher</span><span class="p">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">on</span><span class="p">:</span> <span class="n">DispatchQueue</span><span class="p">.</span><span class="n">main</span><span class="p">)</span>
        <span class="p">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">observer</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="nc">Publisher</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">displayEvents</span><span class="p">(</span><span class="k">in</span> <span class="n">view</span><span class="p">:</span> <span class="n">ContentView</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">view</span><span class="p">.</span><span class="n">capture</span><span class="p">(</span><span class="n">publisher</span><span class="p">:</span> <span class="kc">self</span><span class="p">.</span><span class="n">eraseToAnyPublisher</span><span class="p">())</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nv">subscriptions</span> <span class="p">=</span> <span class="p">[</span><span class="n">AnyCancellable</span><span class="p">]()</span>

<span class="kd">enum</span> <span class="nc">MyError</span><span class="p">:</span> <span class="n">Error</span> <span class="p">{</span>
    <span class="k">case</span> <span class="n">foo</span>
<span class="p">}</span>

<span class="kd">let</span> <span class="nv">valuesPerSecond</span> <span class="p">=</span> <span class="mf">1.0</span>
<span class="kd">let</span> <span class="nv">delayInSeconds</span> <span class="p">=</span> <span class="mf">1.5</span>



<span class="c1">// å»¶è¿Ÿ</span>
<span class="kd">let</span> <span class="nv">pub</span> <span class="p">=</span> <span class="n">PassthroughSubject</span><span class="p">&lt;</span><span class="n">Date</span><span class="p">,</span> <span class="n">Never</span><span class="p">&gt;()</span> <span class="c1">// å‘å°„ Date å€¼çš„å‘å¸ƒè€…</span>
<span class="kd">let</span> <span class="nv">delayedPub</span> <span class="p">=</span> <span class="n">pub</span><span class="p">.</span><span class="n">delay</span><span class="p">(</span><span class="k">for</span><span class="p">:</span> <span class="p">.</span><span class="n">seconds</span><span class="p">(</span><span class="n">delayInSeconds</span><span class="p">),</span>
                           <span class="n">scheduler</span><span class="p">:</span> <span class="n">DispatchQueue</span><span class="p">.</span><span class="n">main</span><span class="p">)</span> <span class="c1">// å»¶è¿Ÿå‘å¸ƒè€…</span>

<span class="kd">let</span> <span class="nv">sub</span> <span class="p">=</span> <span class="n">Timer</span>
    <span class="p">.</span><span class="n">publish</span><span class="p">(</span><span class="n">every</span><span class="p">:</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">valuesPerSecond</span><span class="p">,</span> <span class="n">on</span><span class="p">:</span> <span class="p">.</span><span class="n">main</span><span class="p">,</span> <span class="k">in</span><span class="p">:</span> <span class="p">.</span><span class="n">common</span><span class="p">)</span>
    <span class="p">.</span><span class="n">autoconnect</span><span class="p">()</span> <span class="c1">// autoconnectï¼Œå®ƒå°†åœ¨ç¬¬ä¸€ä¸ªè®¢é˜…æ—¶ç«‹å³è¿æ¥ã€‚</span>
    <span class="p">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">pub</span><span class="p">)</span> <span class="c1">// pub.send</span>

<span class="kd">let</span> <span class="nv">sourceTimeline</span> <span class="p">=</span> <span class="n">ContentView</span><span class="p">(</span><span class="n">title</span><span class="p">:</span> <span class="s">&#34;Emitted values (</span><span class="si">\(</span><span class="n">valuesPerSecond</span><span class="si">)</span><span class="s"> per sec.):&#34;</span><span class="p">)</span>
<span class="kd">let</span> <span class="nv">delayedTimeline</span> <span class="p">=</span> <span class="n">ContentView</span><span class="p">(</span><span class="n">title</span><span class="p">:</span> <span class="s">&#34;Delayed values (with a </span><span class="si">\(</span><span class="n">delayInSeconds</span><span class="si">)</span><span class="s">s delay):&#34;</span><span class="p">)</span>
<span class="kd">let</span> <span class="nv">view</span> <span class="p">=</span> <span class="n">VStack</span><span class="p">(</span><span class="n">spacing</span><span class="p">:</span> <span class="mi">50</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">sourceTimeline</span>
  <span class="n">delayedTimeline</span>
<span class="p">}</span>

<span class="n">PlaygroundPage</span><span class="p">.</span><span class="n">current</span><span class="p">.</span><span class="n">liveView</span> <span class="p">=</span> <span class="n">UIHostingController</span><span class="p">(</span><span class="n">rootView</span><span class="p">:</span> <span class="n">view</span><span class="p">)</span>

<span class="n">pub</span><span class="p">.</span><span class="n">displayEvents</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="n">sourceTimeline</span><span class="p">)</span>
<span class="n">delayedPub</span><span class="p">.</span><span class="n">displayEvents</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="n">delayedTimeline</span><span class="p">)</span>


<span class="c1">//pub.sink(receiveValue: { print($0) }).store(in: &amp;subscriptions)</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="kd">import</span> <span class="nc">UIKit</span>
<span class="kd">import</span> <span class="nc">SwiftUI</span>
<span class="kd">import</span> <span class="nc">Combine</span>

<span class="kd">var</span> <span class="nv">subs</span> <span class="p">=</span> <span class="p">[</span><span class="n">AnyCancellable</span><span class="p">]()</span>

<span class="kd">let</span> <span class="nv">pub1</span> <span class="p">=</span> <span class="n">PassthroughSubject</span><span class="p">&lt;</span><span class="n">Date</span><span class="p">,</span> <span class="n">Never</span><span class="p">&gt;()</span> <span class="c1">// æº</span>
<span class="c1">// collect çš„å¦ä¸€ç§é‡è½½</span>
<span class="kd">let</span> <span class="nv">pub2</span> <span class="p">=</span> <span class="n">pub1</span>
    <span class="p">.</span><span class="n">collect</span><span class="p">(.</span><span class="n">byTime</span><span class="p">(</span><span class="n">DispatchQueue</span><span class="p">.</span><span class="n">main</span><span class="p">,</span> <span class="p">.</span><span class="n">seconds</span><span class="p">(</span><span class="mi">4</span><span class="p">)))</span> <span class="c1">// æŒ‰æ—¶é—´æ¯å››ç§’æ”¶é›†ä¸€æ¬¡</span>
<span class="c1">//    .flatMap { $0.publisher } // åˆ†è§£ä¸ºåŒæ—¶å•ä¸ªè¾“å‡ºçš„å››ä¸ªå€¼</span>

<span class="kd">let</span> <span class="nv">sub</span> <span class="p">=</span> <span class="n">Timer</span><span class="p">.</span><span class="n">publish</span><span class="p">(</span><span class="n">every</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">on</span><span class="p">:</span> <span class="p">.</span><span class="n">main</span><span class="p">,</span> <span class="k">in</span><span class="p">:</span> <span class="p">.</span><span class="n">common</span><span class="p">)</span>
<span class="p">.</span><span class="n">autoconnect</span><span class="p">()</span>
<span class="p">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">pub1</span><span class="p">)</span>

<span class="n">pub1</span><span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="s">&#34;1 - &#34;</span><span class="p">,</span> <span class="nv">$0</span><span class="p">)</span> <span class="p">})</span>
    <span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subs</span><span class="p">)</span>
<span class="n">pub2</span><span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="s">&#34;2 - &#34;</span><span class="p">,</span> <span class="nv">$0</span><span class="p">)</span> <span class="p">})</span>
    <span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subs</span><span class="p">)</span>

<span class="c1">//1 -  2020-03-15 10:38:02 +0000</span>
<span class="c1">//1 -  2020-03-15 10:38:03 +0000</span>
<span class="c1">//1 -  2020-03-15 10:38:04 +0000</span>
<span class="c1">//1 -  2020-03-15 10:38:05 +0000</span>
<span class="c1">//2 -  [2020-03-15 10:38:02 +0000, 2020-03-15 10:38:03 +0000, 2020-03-15 10:38:04 +0000, 2020-03-15 10:38:05 +0000]</span>
<span class="c1">//1 -  2020-03-15 10:38:06 +0000</span>
<span class="c1">//1 -  2020-03-15 10:38:07 +0000</span>
<span class="c1">//1 -  2020-03-15 10:38:08 +0000</span>
<span class="c1">//1 -  2020-03-15 10:38:09 +0000</span>
<span class="c1">//2 -  [2020-03-15 10:38:06 +0000, 2020-03-15 10:38:07 +0000, 2020-03-15 10:38:08 +0000, 2020-03-15 10:38:09 +0000]</span>
<span class="c1">//1 -  2020-03-15 10:38:10 +0000</span>
<span class="c1">//...</span>

<span class="c1">//1 -  2020-03-15 10:44:55 +0000</span>
<span class="c1">//1 -  2020-03-15 10:44:56 +0000</span>
<span class="c1">//1 -  2020-03-15 10:44:57 +0000</span>
<span class="c1">//1 -  2020-03-15 10:44:58 +0000</span>
<span class="c1">//2 -  2020-03-15 10:44:55 +0000</span>
<span class="c1">//2 -  2020-03-15 10:44:56 +0000</span>
<span class="c1">//2 -  2020-03-15 10:44:57 +0000</span>
<span class="c1">//2 -  2020-03-15 10:44:58 +0000</span>
<span class="c1">//1 -  2020-03-15 10:44:59 +0000</span>
<span class="c1">//1 -  2020-03-15 10:45:00 +0000</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="kd">import</span> <span class="nc">UIKit</span>
<span class="kd">import</span> <span class="nc">SwiftUI</span>
<span class="kd">import</span> <span class="nc">Combine</span>

<span class="kd">var</span> <span class="nv">subs</span> <span class="p">=</span> <span class="p">[</span><span class="n">AnyCancellable</span><span class="p">]()</span>

<span class="kd">let</span> <span class="nv">pub1</span> <span class="p">=</span> <span class="n">PassthroughSubject</span><span class="p">&lt;</span><span class="n">Date</span><span class="p">,</span> <span class="n">Never</span><span class="p">&gt;()</span> <span class="c1">// æº</span>
<span class="c1">// collect çš„å¦ä¸€ç§é‡è½½</span>
<span class="kd">let</span> <span class="nv">pub2</span> <span class="p">=</span> <span class="n">pub1</span>
    <span class="p">.</span><span class="n">collect</span><span class="p">(.</span><span class="n">byTimeOrCount</span><span class="p">(</span><span class="n">DispatchQueue</span><span class="p">.</span><span class="n">main</span><span class="p">,</span> <span class="p">.</span><span class="n">seconds</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="mi">2</span><span class="p">))</span> <span class="c1">// æŒ‰æ—¶é—´æ¯å››ç§’ï¼Œä½†æœ€å¤šæ”¶é›†ä¸¤ä¸ª</span>
    <span class="p">.</span><span class="n">flatMap</span> <span class="p">{</span> <span class="nv">$0</span><span class="p">.</span><span class="n">publisher</span> <span class="p">}</span> <span class="c1">// åˆ†è§£ä¸ºåŒæ—¶å•ä¸ªè¾“å‡ºçš„å››ä¸ªå€¼</span>

<span class="kd">let</span> <span class="nv">sub</span> <span class="p">=</span> <span class="n">Timer</span><span class="p">.</span><span class="n">publish</span><span class="p">(</span><span class="n">every</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">on</span><span class="p">:</span> <span class="p">.</span><span class="n">main</span><span class="p">,</span> <span class="k">in</span><span class="p">:</span> <span class="p">.</span><span class="n">common</span><span class="p">)</span>
<span class="p">.</span><span class="n">autoconnect</span><span class="p">()</span>
<span class="p">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">pub1</span><span class="p">)</span>

<span class="n">pub1</span><span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="s">&#34;1 - &#34;</span><span class="p">,</span> <span class="nv">$0</span><span class="p">)</span> <span class="p">})</span>
    <span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subs</span><span class="p">)</span>
<span class="n">pub2</span><span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="s">&#34;2 - &#34;</span><span class="p">,</span> <span class="nv">$0</span><span class="p">)</span> <span class="p">})</span>
    <span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subs</span><span class="p">)</span>

<span class="c1">// ä¸å¸¦ flatMap</span>
<span class="c1">//1 -  2020-03-15 10:55:00 +0000</span>
<span class="c1">//1 -  2020-03-15 10:55:01 +0000</span>
<span class="c1">//2 -  [2020-03-15 10:55:00 +0000, 2020-03-15 10:55:01 +0000]</span>
<span class="c1">//1 -  2020-03-15 10:55:02 +0000</span>
<span class="c1">//1 -  2020-03-15 10:55:03 +0000</span>
<span class="c1">//2 -  [2020-03-15 10:55:02 +0000, 2020-03-15 10:55:03 +0000]</span>
<span class="c1">//1 -  2020-03-15 10:55:04 +0000</span>

<span class="c1">// å¸¦ flatMap</span>
<span class="c1">//1 -  2020-03-15 10:55:34 +0000</span>
<span class="c1">//1 -  2020-03-15 10:55:35 +0000</span>
<span class="c1">//2 -  2020-03-15 10:55:34 +0000</span>
<span class="c1">//2 -  2020-03-15 10:55:35 +0000</span>
<span class="c1">//1 -  2020-03-15 10:55:36 +0000</span>
<span class="c1">//1 -  2020-03-15 10:55:37 +0000</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="kd">import</span> <span class="nc">UIKit</span>
<span class="kd">import</span> <span class="nc">SwiftUI</span>
<span class="kd">import</span> <span class="nc">Combine</span>

<span class="c1">// å»æŠ–</span>
<span class="kd">var</span> <span class="nv">subs</span> <span class="p">=</span> <span class="p">[</span><span class="n">AnyCancellable</span><span class="p">]()</span>

<span class="kd">public</span> <span class="kd">let</span> <span class="nv">typingHelloWorld</span><span class="p">:</span> <span class="p">[(</span><span class="n">TimeInterval</span><span class="p">,</span> <span class="nb">String</span><span class="p">)]</span> <span class="p">=</span> <span class="p">[</span>
  <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="s">&#34;H&#34;</span><span class="p">),</span>
  <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="s">&#34;He&#34;</span><span class="p">),</span>
  <span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="s">&#34;Hel&#34;</span><span class="p">),</span>
  <span class="p">(</span><span class="mf">0.3</span><span class="p">,</span> <span class="s">&#34;Hell&#34;</span><span class="p">),</span>
  <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="s">&#34;Hello&#34;</span><span class="p">),</span>
  <span class="p">(</span><span class="mf">0.6</span><span class="p">,</span> <span class="s">&#34;Hello &#34;</span><span class="p">),</span>
  <span class="p">(</span><span class="mf">2.0</span><span class="p">,</span> <span class="s">&#34;Hello W&#34;</span><span class="p">),</span>
  <span class="p">(</span><span class="mf">2.1</span><span class="p">,</span> <span class="s">&#34;Hello Wo&#34;</span><span class="p">),</span>
  <span class="p">(</span><span class="mf">2.2</span><span class="p">,</span> <span class="s">&#34;Hello Wor&#34;</span><span class="p">),</span>
  <span class="p">(</span><span class="mf">2.4</span><span class="p">,</span> <span class="s">&#34;Hello Worl&#34;</span><span class="p">),</span>
  <span class="p">(</span><span class="mf">2.5</span><span class="p">,</span> <span class="s">&#34;Hello World&#34;</span><span class="p">)</span>
<span class="p">]</span>

<span class="kd">let</span> <span class="nv">subject</span> <span class="p">=</span> <span class="n">PassthroughSubject</span><span class="p">&lt;</span><span class="nb">String</span><span class="p">,</span> <span class="n">Never</span><span class="p">&gt;()</span>
<span class="kd">let</span> <span class="nv">debounced</span> <span class="p">=</span> <span class="n">subject</span>
    <span class="p">.</span><span class="n">debounce</span><span class="p">(</span><span class="k">for</span><span class="p">:</span> <span class="p">.</span><span class="n">seconds</span><span class="p">(</span><span class="mf">1.0</span><span class="p">),</span> <span class="n">scheduler</span><span class="p">:</span> <span class="n">DispatchQueue</span><span class="p">.</span><span class="n">main</span><span class="p">)</span>
    <span class="p">.</span><span class="n">share</span><span class="p">()</span> <span class="c1">// å½“ä¸€ä¸ªå‘å¸ƒè€…çš„å•ä¸ªè®¢é˜…éœ€è¦å‘å¤šä¸ªè®¢é˜…è€…äº¤ä»˜ç›¸åŒçš„ç»“æœæ—¶</span>

<span class="n">subject</span><span class="p">.</span><span class="n">feed</span><span class="p">(</span><span class="n">with</span><span class="p">:</span> <span class="n">typingHelloWorld</span><span class="p">)</span> <span class="c1">// A function that can feed delayed values to a subject for testing and simulation purposes</span>
<span class="n">DispatchQueue</span><span class="p">.</span><span class="n">main</span><span class="p">.</span><span class="n">asyncAfter</span><span class="p">(</span><span class="n">deadline</span><span class="p">:</span> <span class="p">.</span><span class="n">now</span><span class="p">()</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">subject</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s">&#34;kingcos.me&#34;</span><span class="p">)</span>
    <span class="n">subject</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">completion</span><span class="p">:</span> <span class="p">.</span><span class="n">finished</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">subject</span><span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">},</span> <span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="s">&#34;s&#34;</span><span class="p">,</span> <span class="nv">$0</span><span class="p">)</span> <span class="p">}).</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subs</span><span class="p">)</span>
<span class="n">debounced</span><span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="s">&#34;d&#34;</span><span class="p">,</span> <span class="nv">$0</span><span class="p">)</span> <span class="p">}).</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subs</span><span class="p">)</span>
<span class="c1">//s H</span>
<span class="c1">//s He</span>
<span class="c1">//s Hel</span>
<span class="c1">//s Hell</span>
<span class="c1">//s Hello</span>
<span class="c1">//s Hello</span>
<span class="c1">//d Hello // ä¸Šä¸€ä¸ªå€¼å‘å‡º 1 ç§’åï¼Œæ— æ–°å€¼æ‰å‘å°„</span>
<span class="c1">//s Hello W</span>
<span class="c1">//s Hello Wo</span>
<span class="c1">//s Hello Wor</span>
<span class="c1">//s Hello Worl</span>
<span class="c1">//s Hello World</span>
<span class="c1">//d Hello World</span>
<span class="c1">//finished // å®Œæˆåï¼Œæœ€åä¸€ä¸ªæœªé—´éš”åˆ° 1s ä¸ä¼šå†å‘å‡º</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="kd">import</span> <span class="nc">UIKit</span>
<span class="kd">import</span> <span class="nc">SwiftUI</span>
<span class="kd">import</span> <span class="nc">Combine</span>

<span class="kd">var</span> <span class="nv">subs</span> <span class="p">=</span> <span class="p">[</span><span class="n">AnyCancellable</span><span class="p">]()</span>

<span class="kd">public</span> <span class="kd">let</span> <span class="nv">typingHelloWorld</span><span class="p">:</span> <span class="p">[(</span><span class="n">TimeInterval</span><span class="p">,</span> <span class="nb">String</span><span class="p">)]</span> <span class="p">=</span> <span class="p">[</span>
  <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="s">&#34;H&#34;</span><span class="p">),</span>
  <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="s">&#34;He&#34;</span><span class="p">),</span>
  <span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="s">&#34;Hel&#34;</span><span class="p">),</span>
  <span class="p">(</span><span class="mf">0.3</span><span class="p">,</span> <span class="s">&#34;Hell&#34;</span><span class="p">),</span>
  <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="s">&#34;Hello&#34;</span><span class="p">),</span>
  <span class="p">(</span><span class="mf">0.6</span><span class="p">,</span> <span class="s">&#34;Hello &#34;</span><span class="p">),</span>
  <span class="p">(</span><span class="mf">2.0</span><span class="p">,</span> <span class="s">&#34;Hello W&#34;</span><span class="p">),</span>
  <span class="p">(</span><span class="mf">2.1</span><span class="p">,</span> <span class="s">&#34;Hello Wo&#34;</span><span class="p">),</span>
  <span class="p">(</span><span class="mf">2.2</span><span class="p">,</span> <span class="s">&#34;Hello Wor&#34;</span><span class="p">),</span>
  <span class="p">(</span><span class="mf">2.4</span><span class="p">,</span> <span class="s">&#34;Hello Worl&#34;</span><span class="p">),</span>
  <span class="p">(</span><span class="mf">2.5</span><span class="p">,</span> <span class="s">&#34;Hello World&#34;</span><span class="p">)</span>
<span class="p">]</span>

<span class="c1">// èŠ‚æµ</span>
<span class="c1">// A Boolean value that indicates whether to publish the most recent element. If false, the publisher emits the first element received during the interval.</span>
<span class="c1">// bool æ§åˆ¶æ˜¯å¦å‘å¸ƒæœ€è¿‘çš„å…ƒç´ ï¼Œfalse æ—¶å‘å°„ä¸€æ®µæ—¶é—´å†…æœ€åˆçš„å…ƒç´ </span>
<span class="kd">let</span> <span class="nv">subject</span> <span class="p">=</span> <span class="n">PassthroughSubject</span><span class="p">&lt;</span><span class="nb">String</span><span class="p">,</span> <span class="n">Never</span><span class="p">&gt;()</span>
<span class="kd">let</span> <span class="nv">throttled</span> <span class="p">=</span> <span class="n">subject</span>
    <span class="p">.</span><span class="n">throttle</span><span class="p">(</span><span class="k">for</span><span class="p">:</span> <span class="p">.</span><span class="n">seconds</span><span class="p">(</span><span class="mf">1.0</span><span class="p">),</span> <span class="n">scheduler</span><span class="p">:</span> <span class="n">DispatchQueue</span><span class="p">.</span><span class="n">main</span><span class="p">,</span> <span class="n">latest</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span>
    <span class="p">.</span><span class="n">share</span><span class="p">()</span>

<span class="n">subject</span><span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">},</span> <span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="s">&#34;s&#34;</span><span class="p">,</span> <span class="nv">$0</span><span class="p">)</span> <span class="p">}).</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subs</span><span class="p">)</span>
<span class="n">throttled</span><span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="s">&#34;t&#34;</span><span class="p">,</span> <span class="nv">$0</span><span class="p">)</span> <span class="p">}).</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subs</span><span class="p">)</span>

<span class="n">subject</span><span class="p">.</span><span class="n">feed</span><span class="p">(</span><span class="n">with</span><span class="p">:</span> <span class="n">typingHelloWorld</span><span class="p">)</span>

<span class="c1">//åŒºåˆ«:</span>
<span class="c1">//å»æŠ–åœ¨å°äºç­‰å¾…çš„æ—¶é—´å†…æš‚åœæ¥æ”¶ï¼ˆå»é™¤æŠ–åŠ¨æ—¶çš„æ“ä½œï¼‰</span>
<span class="c1">//èŠ‚æµæŒ‰æ—¶å‘è½¦ï¼Œå–è¯¥æ—¶é—´æ®µå†…é¦–ä¸ªæˆ–æœ€åä¸€ä¸ªå€¼</span>

<span class="c1">// latest: false</span>
<span class="c1">//s H</span>
<span class="c1">//t H // 0-1s å†…çš„ç¬¬ä¸€ä¸ªå…ƒç´ </span>
<span class="c1">//s He</span>
<span class="c1">//s Hel</span>
<span class="c1">//s Hell</span>
<span class="c1">//s Hello</span>
<span class="c1">//s Hello</span>
<span class="c1">//t He // 1-2s å†…çš„ç¬¬ä¸€ä¸ªå…ƒç´ </span>
<span class="c1">//s Hello W</span>
<span class="c1">//s Hello Wo</span>
<span class="c1">//t Hello W // 2-3s å†…çš„ç¬¬ä¸€ä¸ªå…ƒç´ </span>
<span class="c1">//s Hello Wor</span>
<span class="c1">//s Hello Worl</span>
<span class="c1">//s Hello World</span>
<span class="c1">//t Hello Wor // 3-4s å†…çš„ç¬¬ä¸€ä¸ªå…ƒç´ </span>
<span class="c1">//finished</span>

<span class="c1">//s H</span>
<span class="c1">//t H // 0-1s å†…çš„æœ€åä¸€ä¸ªå…ƒç´ </span>
<span class="c1">//s He</span>
<span class="c1">//s Hel</span>
<span class="c1">//s Hell</span>
<span class="c1">//s Hello</span>
<span class="c1">//s Hello</span>
<span class="c1">//t Hello // 1-2s å†…çš„æœ€åä¸€ä¸ªå…ƒç´ </span>
<span class="c1">//s Hello W</span>
<span class="c1">//s Hello Wo</span>
<span class="c1">//s Hello Wor</span>
<span class="c1">//s Hello Worl</span>
<span class="c1">//s Hello World</span>
<span class="c1">//t Hello World // 2-3s å†…çš„æœ€åä¸€ä¸ªå…ƒç´ </span>
<span class="c1">//finished</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="kd">import</span> <span class="nc">UIKit</span>
<span class="kd">import</span> <span class="nc">SwiftUI</span>
<span class="kd">import</span> <span class="nc">Combine</span>

<span class="kd">var</span> <span class="nv">subs</span> <span class="p">=</span> <span class="p">[</span><span class="n">AnyCancellable</span><span class="p">]()</span>

<span class="kd">enum</span> <span class="nc">TimeoutError</span><span class="p">:</span> <span class="n">Error</span> <span class="p">{</span>
  <span class="k">case</span> <span class="n">timedOut</span>
<span class="p">}</span>

<span class="kd">let</span> <span class="nv">sub</span> <span class="p">=</span> <span class="n">PassthroughSubject</span><span class="p">&lt;</span><span class="nb">Void</span><span class="p">,</span> <span class="n">Never</span><span class="p">&gt;()</span>
<span class="c1">//let sub = PassthroughSubject&lt;Void, TimeoutError&gt;()</span>
<span class="kd">let</span> <span class="nv">timedOutSubject</span> <span class="p">=</span> <span class="n">sub</span><span class="p">.</span><span class="n">timeout</span><span class="p">(.</span><span class="n">seconds</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
                                  <span class="n">scheduler</span><span class="p">:</span> <span class="n">DispatchQueue</span><span class="p">.</span><span class="n">main</span> <span class="cm">/*,
</span><span class="cm">                                  customError: { .timedOut }*/</span><span class="p">)</span>

<span class="n">DispatchQueue</span><span class="p">.</span><span class="n">main</span><span class="p">.</span><span class="n">asyncAfter</span><span class="p">(</span><span class="n">deadline</span><span class="p">:</span> <span class="p">.</span><span class="n">now</span><span class="p">()</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">sub</span><span class="p">.</span><span class="n">send</span><span class="p">()</span>
<span class="p">}</span>

<span class="n">sub</span><span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">},</span> <span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="s">&#34;sub&#34;</span><span class="p">,</span> <span class="nv">$0</span><span class="p">)</span> <span class="p">}).</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subs</span><span class="p">)</span>
<span class="n">timedOutSubject</span><span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">},</span> <span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="s">&#34;timeout&#34;</span><span class="p">,</span> <span class="nv">$0</span><span class="p">)</span> <span class="p">}).</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subs</span><span class="p">)</span>

<span class="c1">//finished // è¶…æ—¶å³å®Œæˆ</span>
<span class="c1">//sub ()</span>

<span class="c1">// å®šä¹‰ customError</span>
<span class="c1">//failure(__lldb_expr_19.TimeoutError.timedOut)</span>
<span class="c1">//sub ()</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="kd">import</span> <span class="nc">UIKit</span>
<span class="kd">import</span> <span class="nc">SwiftUI</span>
<span class="kd">import</span> <span class="nc">Combine</span>

<span class="kd">var</span> <span class="nv">subs</span> <span class="p">=</span> <span class="p">[</span><span class="n">AnyCancellable</span><span class="p">]()</span>

<span class="kd">public</span> <span class="kd">let</span> <span class="nv">typingHelloWorld</span><span class="p">:</span> <span class="p">[(</span><span class="n">TimeInterval</span><span class="p">,</span> <span class="nb">String</span><span class="p">)]</span> <span class="p">=</span> <span class="p">[</span>
  <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="s">&#34;H&#34;</span><span class="p">),</span>
  <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="s">&#34;He&#34;</span><span class="p">),</span>
  <span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="s">&#34;Hel&#34;</span><span class="p">),</span>
  <span class="p">(</span><span class="mf">0.3</span><span class="p">,</span> <span class="s">&#34;Hell&#34;</span><span class="p">),</span>
  <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="s">&#34;Hello&#34;</span><span class="p">),</span>
  <span class="p">(</span><span class="mf">0.6</span><span class="p">,</span> <span class="s">&#34;Hello &#34;</span><span class="p">),</span>
  <span class="p">(</span><span class="mf">2.0</span><span class="p">,</span> <span class="s">&#34;Hello W&#34;</span><span class="p">),</span>
  <span class="p">(</span><span class="mf">2.1</span><span class="p">,</span> <span class="s">&#34;Hello Wo&#34;</span><span class="p">),</span>
  <span class="p">(</span><span class="mf">2.2</span><span class="p">,</span> <span class="s">&#34;Hello Wor&#34;</span><span class="p">),</span>
  <span class="p">(</span><span class="mf">2.4</span><span class="p">,</span> <span class="s">&#34;Hello Worl&#34;</span><span class="p">),</span>
  <span class="p">(</span><span class="mf">2.5</span><span class="p">,</span> <span class="s">&#34;Hello World&#34;</span><span class="p">)</span>
<span class="p">]</span>

<span class="kd">let</span> <span class="nv">sub</span> <span class="p">=</span> <span class="n">PassthroughSubject</span><span class="p">&lt;</span><span class="nb">String</span><span class="p">,</span> <span class="n">Never</span><span class="p">&gt;()</span>
<span class="kd">let</span> <span class="nv">measure</span> <span class="p">=</span> <span class="n">sub</span><span class="p">.</span><span class="n">measureInterval</span><span class="p">(</span><span class="n">using</span><span class="p">:</span> <span class="n">DispatchQueue</span><span class="p">.</span><span class="n">main</span><span class="p">)</span>

<span class="n">sub</span><span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">},</span> <span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="s">&#34;sub&#34;</span><span class="p">,</span> <span class="nv">$0</span><span class="p">)</span> <span class="p">}).</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subs</span><span class="p">)</span>
<span class="c1">//measure.sink(receiveCompletion: { print($0) }, receiveValue: { print(&#34;measure \(Double($0.magnitude) / 1_000_000_000.0)&#34;) }).store(in: &amp;subs)</span>

<span class="c1">// é»˜è®¤å•ä½çº³ç§’ï¼Œè½¬æ¢ä¸ºç§’ï¼š</span>
<span class="c1">//sub H</span>
<span class="c1">//measure 0.010279283</span>
<span class="c1">//sub He</span>
<span class="c1">//measure 0.097314792</span>
<span class="c1">//sub Hel</span>
<span class="c1">//measure 0.106212119</span>
<span class="c1">//sub Hell</span>
<span class="c1">//measure 0.113224792</span>
<span class="c1">//sub Hello</span>
<span class="c1">//measure 0.197550122</span>
<span class="c1">//sub Hello</span>
<span class="c1">//measure 0.129873388</span>
<span class="c1">//sub Hello W</span>
<span class="c1">//measure 1.346181832</span>
<span class="c1">//sub Hello Wo</span>
<span class="c1">//measure 0.103605421</span>
<span class="c1">//sub Hello Wor</span>
<span class="c1">//measure 0.096385811</span>
<span class="c1">//sub Hello Worl</span>
<span class="c1">//measure 0.19998862</span>
<span class="c1">//sub Hello World</span>
<span class="c1">//measure 0.10001298</span>
<span class="c1">//finished</span>
<span class="c1">//finished</span>

<span class="c1">// RunLoop</span>
<span class="c1">// é€šå¸¸ï¼Œå¯¹æ‰€æœ‰å†…å®¹éƒ½åšæŒä½¿ç”¨DispatchQueueæ˜¯ä¸€ä¸ªå¥½ä¸»æ„</span>
<span class="kd">let</span> <span class="nv">measureSubject2</span> <span class="p">=</span> <span class="n">sub</span><span class="p">.</span><span class="n">measureInterval</span><span class="p">(</span><span class="n">using</span><span class="p">:</span> <span class="n">RunLoop</span><span class="p">.</span><span class="n">main</span><span class="p">)</span>
<span class="n">measureSubject2</span><span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">},</span> <span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="s">&#34;measure </span><span class="si">\(</span><span class="nv">$0</span><span class="si">)</span><span class="s">&#34;</span><span class="p">)</span> <span class="p">}).</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subs</span><span class="p">)</span>

<span class="n">sub</span><span class="p">.</span><span class="n">feed</span><span class="p">(</span><span class="n">with</span><span class="p">:</span> <span class="n">typingHelloWorld</span><span class="p">)</span>
<span class="c1">//sub H</span>
<span class="c1">//measure Stride(magnitude: 0.008931994438171387)</span>
<span class="c1">//sub He</span>
<span class="c1">//measure Stride(magnitude: 0.10000407695770264)</span>
<span class="c1">//sub Hel</span>
<span class="c1">//measure Stride(magnitude: 0.1105649471282959)</span>
<span class="c1">//sub Hell</span>
<span class="c1">//measure Stride(magnitude: 0.10970902442932129)</span>
<span class="c1">//sub Hello</span>
<span class="c1">//measure Stride(magnitude: 0.21341097354888916)</span>
<span class="c1">//sub Hello</span>
<span class="c1">//measure Stride(magnitude: 0.11738002300262451)</span>
<span class="c1">//sub Hello W</span>
<span class="c1">//measure Stride(magnitude: 1.3406749963760376)</span>
<span class="c1">//sub Hello Wo</span>
<span class="c1">//measure Stride(magnitude: 0.10406196117401123)</span>
<span class="c1">//sub Hello Wor</span>
<span class="c1">//measure Stride(magnitude: 0.09577000141143799)</span>
<span class="c1">//sub Hello Worl</span>
<span class="c1">//measure Stride(magnitude: 0.20008206367492676)</span>
<span class="c1">//sub Hello World</span>
<span class="c1">//measure Stride(magnitude: 0.10001897811889648)</span>
<span class="c1">//finished</span>
<span class="c1">//finished</span>
</code></pre></div><h2 id="7">7</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="kd">import</span> <span class="nc">UIKit</span>
<span class="kd">import</span> <span class="nc">SwiftUI</span>
<span class="kd">import</span> <span class="nc">Combine</span>

<span class="kd">var</span> <span class="nv">subs</span> <span class="p">=</span> <span class="p">[</span><span class="n">AnyCancellable</span><span class="p">]()</span>

<span class="n">example</span><span class="p">(</span><span class="n">of</span><span class="p">:</span> <span class="s">&#34;min &amp; max&#34;</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nv">pub1</span> <span class="p">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">50</span><span class="p">,</span> <span class="mi">246</span><span class="p">,</span> <span class="mi">0</span><span class="p">].</span><span class="n">publisher</span>

    <span class="n">pub1</span>
        <span class="p">.</span><span class="bp">print</span><span class="p">(</span><span class="s">&#34;pub1&#34;</span><span class="p">)</span>
        <span class="p">.</span><span class="bp">min</span><span class="p">()</span> <span class="c1">// Int éµå®ˆ Comparableï¼Œæ‰¾åˆ°åºåˆ—ä¸­çš„æœ€å°å€¼ï¼Œmin æ˜¯è´ªå©ªçš„ï¼Œéœ€åºåˆ—å‘å°„å®Œæ¯•æ‰ä¼š</span>
        <span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">},</span>
              <span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">})</span>
        <span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subs</span><span class="p">)</span>

    <span class="bp">print</span><span class="p">(</span><span class="s">&#34;---&#34;</span><span class="p">)</span>

    <span class="kd">let</span> <span class="nv">pub2</span> <span class="p">=</span> <span class="p">[</span><span class="s">&#34;12345&#34;</span><span class="p">,</span> <span class="s">&#34;ab&#34;</span><span class="p">,</span> <span class="s">&#34;hello world&#34;</span><span class="p">]</span>
        <span class="p">.</span><span class="n">compactMap</span> <span class="p">{</span> <span class="nv">$0</span><span class="p">.</span><span class="n">data</span><span class="p">(</span><span class="n">using</span><span class="p">:</span> <span class="p">.</span><span class="n">utf8</span><span class="p">)</span> <span class="p">}</span>
        <span class="p">.</span><span class="n">publisher</span>
    <span class="n">pub2</span>
        <span class="p">.</span><span class="bp">print</span><span class="p">(</span><span class="s">&#34;pub2&#34;</span><span class="p">)</span>
        <span class="p">.</span><span class="bp">min</span><span class="p">(</span><span class="n">by</span><span class="p">:</span> <span class="p">{</span> <span class="nv">$0</span><span class="p">.</span><span class="bp">count</span> <span class="o">&lt;</span> <span class="nv">$1</span><span class="p">.</span><span class="bp">count</span> <span class="p">})</span> <span class="c1">// æœªéµå®ˆ Comparable å¯è‡ªå·±å®ç°ï¼Œä»¥æ‰¾åˆ°åºåˆ—ä¸­çš„æœ€å°å€¼</span>
        <span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">},</span>
              <span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">})</span>
        <span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subs</span><span class="p">)</span>

    <span class="bp">print</span><span class="p">(</span><span class="s">&#34;---&#34;</span><span class="p">)</span>

    <span class="kd">let</span> <span class="nv">pub3</span> <span class="p">=</span> <span class="p">[</span><span class="s">&#34;A&#34;</span><span class="p">,</span> <span class="s">&#34;F&#34;</span><span class="p">,</span> <span class="s">&#34;Z&#34;</span><span class="p">,</span> <span class="s">&#34;E&#34;</span><span class="p">].</span><span class="n">publisher</span>
    <span class="n">pub3</span>
        <span class="p">.</span><span class="bp">print</span><span class="p">(</span><span class="s">&#34;pub3&#34;</span><span class="p">)</span>
        <span class="p">.</span><span class="bp">max</span><span class="p">()</span>
        <span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">},</span>
              <span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">})</span>
        <span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subs</span><span class="p">)</span>

    <span class="c1">// max(by:) åŒç†</span>

<span class="p">}</span>

<span class="c1">//â€”â€”â€” Example of: min â€”â€”â€”</span>
<span class="c1">//pub: receive subscription: ([1, -50, 246, 0])</span>
<span class="c1">//pub: request unlimited</span>
<span class="c1">//pub: receive value: (1)</span>
<span class="c1">//pub: receive value: (-50)</span>
<span class="c1">//pub: receive value: (246)</span>
<span class="c1">//pub: receive value: (0)</span>
<span class="c1">//pub: receive finished</span>
<span class="c1">//-50</span>
<span class="c1">//finished</span>
<span class="c1">//---</span>
<span class="c1">//pub2: receive subscription: ([5 bytes, 2 bytes, 11 bytes])</span>
<span class="c1">//pub2: request unlimited</span>
<span class="c1">//pub2: receive value: (5 bytes)</span>
<span class="c1">//pub2: receive value: (2 bytes)</span>
<span class="c1">//pub2: receive value: (11 bytes)</span>
<span class="c1">//pub2: receive finished</span>
<span class="c1">//2 bytes</span>
<span class="c1">//finished</span>
<span class="c1">//---</span>
<span class="c1">//pub3: receive subscription: ([&#34;A&#34;, &#34;F&#34;, &#34;Z&#34;, &#34;E&#34;])</span>
<span class="c1">//pub3: request unlimited</span>
<span class="c1">//pub3: receive value: (A)</span>
<span class="c1">//pub3: receive value: (F)</span>
<span class="c1">//pub3: receive value: (Z)</span>
<span class="c1">//pub3: receive value: (E)</span>
<span class="c1">//pub3: receive finished</span>
<span class="c1">//Z</span>
<span class="c1">//finished</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="kd">import</span> <span class="nc">UIKit</span>
<span class="kd">import</span> <span class="nc">SwiftUI</span>
<span class="kd">import</span> <span class="nc">Combine</span>

<span class="kd">var</span> <span class="nv">subs</span> <span class="p">=</span> <span class="p">[</span><span class="n">AnyCancellable</span><span class="p">]()</span>

<span class="n">example</span><span class="p">(</span><span class="n">of</span><span class="p">:</span> <span class="s">&#34;first &amp; last&#34;</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nv">pub1</span> <span class="p">=</span> <span class="p">[</span><span class="s">&#34;A&#34;</span><span class="p">,</span> <span class="s">&#34;B&#34;</span><span class="p">,</span> <span class="s">&#34;C&#34;</span><span class="p">].</span><span class="n">publisher</span>

    <span class="n">pub1</span>
        <span class="p">.</span><span class="bp">print</span><span class="p">(</span><span class="s">&#34;pub1&#34;</span><span class="p">)</span>
        <span class="p">.</span><span class="bp">first</span><span class="p">()</span> <span class="c1">// æ”¶åˆ°ç¬¬ä¸€ä¸ªå‘å°„çš„å€¼å³å–æ¶ˆè®¢é˜…</span>
        <span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">},</span>
              <span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">})</span>
        <span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subs</span><span class="p">)</span>

    <span class="bp">print</span><span class="p">(</span><span class="s">&#34;---&#34;</span><span class="p">)</span>

    <span class="kd">let</span> <span class="nv">pub2</span> <span class="p">=</span> <span class="p">[</span><span class="s">&#34;A&#34;</span><span class="p">,</span> <span class="s">&#34;B&#34;</span><span class="p">,</span> <span class="s">&#34;C&#34;</span><span class="p">,</span> <span class="s">&#34;B&#34;</span><span class="p">].</span><span class="n">publisher</span>

    <span class="n">pub2</span>
        <span class="p">.</span><span class="bp">print</span><span class="p">(</span><span class="s">&#34;pub2&#34;</span><span class="p">)</span>
        <span class="p">.</span><span class="bp">first</span><span class="p">(</span><span class="k">where</span><span class="p">:</span> <span class="p">{</span> <span class="nv">$0</span> <span class="p">==</span> <span class="s">&#34;B&#34;</span> <span class="p">})</span> <span class="c1">// æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³æ¡ä»¶</span>
        <span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">},</span>
              <span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">})</span>
        <span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subs</span><span class="p">)</span>

    <span class="bp">print</span><span class="p">(</span><span class="s">&#34;---&#34;</span><span class="p">)</span>

    <span class="kd">let</span> <span class="nv">pub3</span> <span class="p">=</span> <span class="p">[</span><span class="s">&#34;A&#34;</span><span class="p">,</span> <span class="s">&#34;B&#34;</span><span class="p">,</span> <span class="s">&#34;C&#34;</span><span class="p">].</span><span class="n">publisher</span>

    <span class="n">pub3</span>
        <span class="p">.</span><span class="bp">print</span><span class="p">(</span><span class="s">&#34;pub3&#34;</span><span class="p">)</span>
        <span class="p">.</span><span class="bp">last</span><span class="p">()</span> <span class="c1">// è´ªå©ªï¼Œéœ€ç­‰å¾…å‘å°„å®Œæˆ</span>
        <span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">},</span>
              <span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">})</span>
        <span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subs</span><span class="p">)</span>

    <span class="c1">// last(where:) åŒç†</span>
<span class="p">}</span>
<span class="c1">//â€”â€”â€” Example of: first â€”â€”â€”</span>
<span class="c1">//pub1: receive subscription: ([&#34;A&#34;, &#34;B&#34;, &#34;C&#34;])</span>
<span class="c1">//pub1: request unlimited</span>
<span class="c1">//pub1: receive value: (A)</span>
<span class="c1">//pub1: receive cancel</span>
<span class="c1">//A</span>
<span class="c1">//finished</span>
<span class="c1">//---</span>
<span class="c1">//pub2: receive subscription: ([&#34;A&#34;, &#34;B&#34;, &#34;C&#34;])</span>
<span class="c1">//pub2: request unlimited</span>
<span class="c1">//pub2: receive value: (A)</span>
<span class="c1">//pub2: receive value: (B)</span>
<span class="c1">//pub2: receive cancel</span>
<span class="c1">//B</span>
<span class="c1">//finished</span>
<span class="c1">//---</span>
<span class="c1">//pub3: receive subscription: ([&#34;A&#34;, &#34;B&#34;, &#34;C&#34;])</span>
<span class="c1">//pub3: request unlimited</span>
<span class="c1">//pub3: receive value: (A)</span>
<span class="c1">//pub3: receive value: (B)</span>
<span class="c1">//pub3: receive value: (C)</span>
<span class="c1">//pub3: receive finished</span>
<span class="c1">//C</span>
<span class="c1">//finished</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="kd">import</span> <span class="nc">UIKit</span>
<span class="kd">import</span> <span class="nc">SwiftUI</span>
<span class="kd">import</span> <span class="nc">Combine</span>

<span class="kd">var</span> <span class="nv">subs</span> <span class="p">=</span> <span class="p">[</span><span class="n">AnyCancellable</span><span class="p">]()</span>

<span class="n">example</span><span class="p">(</span><span class="n">of</span><span class="p">:</span> <span class="s">&#34;output&#34;</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nv">pub1</span> <span class="p">=</span> <span class="p">[</span><span class="s">&#34;A&#34;</span><span class="p">,</span> <span class="s">&#34;B&#34;</span><span class="p">,</span> <span class="s">&#34;C&#34;</span><span class="p">].</span><span class="n">publisher</span>

    <span class="n">pub1</span>
        <span class="p">.</span><span class="bp">print</span><span class="p">(</span><span class="s">&#34;pub1&#34;</span><span class="p">)</span>
        <span class="p">.</span><span class="n">output</span><span class="p">(</span><span class="n">at</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span> <span class="c1">// ç´¢å¼•ä¸º 1 çš„å€¼ï¼Œä¼ å…¥è¶…è¿‡çš„ç´¢å¼•å€¼åˆ™ä¸å‘å°„</span>
        <span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">},</span>
              <span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">})</span>
        <span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subs</span><span class="p">)</span>

    <span class="bp">print</span><span class="p">(</span><span class="s">&#34;---&#34;</span><span class="p">)</span>

    <span class="kd">let</span> <span class="nv">pub2</span> <span class="p">=</span> <span class="p">[</span><span class="s">&#34;A&#34;</span><span class="p">,</span> <span class="s">&#34;B&#34;</span><span class="p">,</span> <span class="s">&#34;C&#34;</span><span class="p">].</span><span class="n">publisher</span>

    <span class="n">pub2</span>
        <span class="p">.</span><span class="bp">print</span><span class="p">(</span><span class="s">&#34;pub2&#34;</span><span class="p">)</span>
        <span class="p">.</span><span class="n">output</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="mf">1.</span><span class="p">..</span><span class="mi">2</span><span class="p">)</span> <span class="c1">// Range</span>
        <span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">},</span>
              <span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">})</span>
        <span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subs</span><span class="p">)</span>

    <span class="bp">print</span><span class="p">(</span><span class="s">&#34;---&#34;</span><span class="p">)</span>



<span class="p">}</span>
<span class="c1">//pub1: receive subscription: ([&#34;A&#34;, &#34;B&#34;, &#34;C&#34;])</span>
<span class="c1">//pub1: request unlimited</span>
<span class="c1">//pub1: receive value: (A)</span>
<span class="c1">//pub1: request max: (1) (synchronous) // æ³¨æ„è¿™é‡Œï¼Œæ¯å‘å°„ä¸€ä¸ªå€¼åï¼Œdemands ä¼šè‡ªå¢ï¼Œå› ä¸ºå…¶çŸ¥é“æ˜¯åœ¨ç‰¹å®šç´¢å¼•ä¸‹æŸ¥æ‰¾</span>
<span class="c1">//pub1: receive value: (B)</span>
<span class="c1">//B // ç´¢å¼•ä¸º 1 çš„å€¼ï¼Œä¼ å…¥è¶…è¿‡çš„ç´¢å¼•å€¼åˆ™ä¸å‘å°„</span>
<span class="c1">//pub1: receive cancel</span>
<span class="c1">//finished</span>
<span class="c1">//---</span>
<span class="c1">//pub2: receive subscription: ([&#34;A&#34;, &#34;B&#34;, &#34;C&#34;])</span>
<span class="c1">//pub2: request unlimited</span>
<span class="c1">//pub2: receive value: (A)</span>
<span class="c1">//pub2: request max: (1) (synchronous)</span>
<span class="c1">//pub2: receive value: (B)</span>
<span class="c1">//B // æ³¨æ„ï¼šå‘å°„çš„æ˜¯èŒƒå›´å†…çš„å•ä¸ªå€¼</span>
<span class="c1">//pub2: receive value: (C)</span>
<span class="c1">//C</span>
<span class="c1">//pub2: receive cancel // è¶³å¤Ÿåç«‹å³å–æ¶ˆè®¢é˜…</span>
<span class="c1">//finished</span>
<span class="c1">//pub2: receive finished</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="kd">import</span> <span class="nc">UIKit</span>
<span class="kd">import</span> <span class="nc">SwiftUI</span>
<span class="kd">import</span> <span class="nc">Combine</span>

<span class="kd">var</span> <span class="nv">subs</span> <span class="p">=</span> <span class="p">[</span><span class="n">AnyCancellable</span><span class="p">]()</span>

<span class="n">example</span><span class="p">(</span><span class="n">of</span><span class="p">:</span> <span class="s">&#34;query&#34;</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nv">pub1</span> <span class="p">=</span> <span class="p">[</span><span class="s">&#34;A&#34;</span><span class="p">,</span> <span class="s">&#34;B&#34;</span><span class="p">,</span> <span class="s">&#34;C&#34;</span><span class="p">].</span><span class="n">publisher</span>

    <span class="n">pub1</span>
        <span class="p">.</span><span class="bp">print</span><span class="p">(</span><span class="s">&#34;pub1&#34;</span><span class="p">)</span>
        <span class="p">.</span><span class="bp">count</span><span class="p">()</span> <span class="c1">// è®¡æ•°ï¼Œè´ªå©ªï¼Œéœ€å®Œæˆæ‰å‘å‡º</span>
        <span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">},</span>
              <span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">})</span>
        <span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subs</span><span class="p">)</span>

    <span class="bp">print</span><span class="p">(</span><span class="s">&#34;---&#34;</span><span class="p">)</span>

    <span class="kd">let</span> <span class="nv">pub2</span> <span class="p">=</span> <span class="p">[</span><span class="s">&#34;A&#34;</span><span class="p">,</span> <span class="s">&#34;B&#34;</span><span class="p">,</span> <span class="s">&#34;C&#34;</span><span class="p">].</span><span class="n">publisher</span>

    <span class="n">pub2</span>
        <span class="p">.</span><span class="bp">print</span><span class="p">(</span><span class="s">&#34;pub2 - 1&#34;</span><span class="p">)</span>
        <span class="p">.</span><span class="bp">contains</span><span class="p">(</span><span class="s">&#34;B&#34;</span><span class="p">)</span> <span class="c1">// æƒ°æ€§ï¼ŒåŒ…å«åˆ™å‘å°„ trueï¼Œå¹¶å–æ¶ˆè®¢é˜…</span>
        <span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">},</span>
              <span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">})</span>
        <span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subs</span><span class="p">)</span>

    <span class="bp">print</span><span class="p">(</span><span class="s">&#34;---&#34;</span><span class="p">)</span>

    <span class="n">pub2</span>
        <span class="p">.</span><span class="bp">print</span><span class="p">(</span><span class="s">&#34;pub2 - 2&#34;</span><span class="p">)</span>
        <span class="p">.</span><span class="bp">contains</span><span class="p">(</span><span class="s">&#34;D&#34;</span><span class="p">)</span> <span class="c1">// ç­‰åˆ°å®Œæˆéƒ½æ‰¾ä¸åˆ°åˆ™å‘å°„ fakse</span>
        <span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">},</span>
              <span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">})</span>
        <span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subs</span><span class="p">)</span>

<span class="c1">//    containsï¼ˆwhere :) åŒç†</span>

    <span class="bp">print</span><span class="p">(</span><span class="s">&#34;---&#34;</span><span class="p">)</span>

    <span class="n">pub2</span>
        <span class="p">.</span><span class="bp">print</span><span class="p">(</span><span class="s">&#34;pub2 - 3&#34;</span><span class="p">)</span>
        <span class="p">.</span><span class="bp">contains</span><span class="p">(</span><span class="k">where</span><span class="p">:</span> <span class="p">{</span> <span class="nv">$0</span> <span class="p">==</span> <span class="s">&#34;B&#34;</span> <span class="p">})</span> <span class="c1">// åŒ…å«æ¡ä»¶</span>
        <span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">},</span>
              <span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">})</span>
        <span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subs</span><span class="p">)</span>

    <span class="bp">print</span><span class="p">(</span><span class="s">&#34;---&#34;</span><span class="p">)</span>

    <span class="kd">let</span> <span class="nv">pub3</span> <span class="p">=</span> <span class="bp">stride</span><span class="p">(</span><span class="n">from</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">to</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="n">by</span><span class="p">:</span> <span class="mi">2</span><span class="p">).</span><span class="n">publisher</span>

    <span class="n">pub3</span>
        <span class="p">.</span><span class="bp">print</span><span class="p">(</span><span class="s">&#34;pub3&#34;</span><span class="p">)</span>
        <span class="p">.</span><span class="n">allSatisfy</span> <span class="p">{</span> <span class="nv">$0</span> <span class="o">%</span> <span class="mi">2</span> <span class="p">==</span> <span class="mi">0</span> <span class="p">}</span> <span class="c1">// æ˜¯å¦æ‰€æœ‰éƒ½æ»¡è¶³ xxx æ¡ä»¶ï¼ˆä¸€ä¸ªä¸ªåŒ¹é…ï¼‰ï¼Ÿæ˜¯åˆ™å‘å°„ trueï¼Œå¦åˆ™åªè¦ä¸€ä¸ªä¸æ»¡è¶³å°±å–æ¶ˆè®¢é˜…å¹¶å‘å°„ false</span>
        <span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">},</span>
              <span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">})</span>
        <span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subs</span><span class="p">)</span>
<span class="p">}</span>
<span class="c1">//pub1: receive subscription: ([&#34;A&#34;, &#34;B&#34;, &#34;C&#34;])</span>
<span class="c1">//pub1: request unlimited</span>
<span class="c1">//pub1: receive value: (A)</span>
<span class="c1">//pub1: receive value: (B)</span>
<span class="c1">//pub1: receive value: (C)</span>
<span class="c1">//pub1: receive finished</span>
<span class="c1">//3</span>
<span class="c1">//finished</span>
<span class="c1">//---</span>
<span class="c1">//pub2 - 1: receive subscription: ([&#34;A&#34;, &#34;B&#34;, &#34;C&#34;])</span>
<span class="c1">//pub2 - 1: request unlimited</span>
<span class="c1">//pub2 - 1: receive value: (A)</span>
<span class="c1">//pub2 - 1: receive value: (B)</span>
<span class="c1">//pub2 - 1: receive cancel</span>
<span class="c1">//true</span>
<span class="c1">//finished</span>
<span class="c1">//---</span>
<span class="c1">//pub2 - 2: receive subscription: ([&#34;A&#34;, &#34;B&#34;, &#34;C&#34;])</span>
<span class="c1">//pub2 - 2: request unlimited</span>
<span class="c1">//pub2 - 2: receive value: (A)</span>
<span class="c1">//pub2 - 2: receive value: (B)</span>
<span class="c1">//pub2 - 2: receive value: (C)</span>
<span class="c1">//pub2 - 2: receive finished</span>
<span class="c1">//false</span>
<span class="c1">//finished</span>
<span class="c1">//---</span>
<span class="c1">//pub2 - 3: receive subscription: ([&#34;A&#34;, &#34;B&#34;, &#34;C&#34;])</span>
<span class="c1">//pub2 - 3: request unlimited</span>
<span class="c1">//pub2 - 3: receive value: (A)</span>
<span class="c1">//pub2 - 3: receive value: (B)</span>
<span class="c1">//pub2 - 3: receive cancel</span>
<span class="c1">//true</span>
<span class="c1">//finished</span>
<span class="c1">//---</span>
<span class="c1">//pub3: receive subscription: (Sequence)</span>
<span class="c1">//pub3: request unlimited</span>
<span class="c1">//pub3: receive value: (0)</span>
<span class="c1">//pub3: receive value: (2)</span>
<span class="c1">//pub3: receive value: (4)</span>
<span class="c1">//pub3: receive finished</span>
<span class="c1">//true</span>
<span class="c1">//finished</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="kd">import</span> <span class="nc">UIKit</span>
<span class="kd">import</span> <span class="nc">SwiftUI</span>
<span class="kd">import</span> <span class="nc">Combine</span>

<span class="kd">var</span> <span class="nv">subs</span> <span class="p">=</span> <span class="p">[</span><span class="n">AnyCancellable</span><span class="p">]()</span>

<span class="n">example</span><span class="p">(</span><span class="n">of</span><span class="p">:</span> <span class="s">&#34;reduce&#34;</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nv">pub1</span> <span class="p">=</span> <span class="p">[</span><span class="s">&#34;A&#34;</span><span class="p">,</span> <span class="s">&#34;B&#34;</span><span class="p">,</span> <span class="s">&#34;C&#34;</span><span class="p">].</span><span class="n">publisher</span>

    <span class="n">pub1</span>
        <span class="p">.</span><span class="bp">print</span><span class="p">(</span><span class="s">&#34;pub1&#34;</span><span class="p">)</span>
        <span class="p">.</span><span class="bp">reduce</span><span class="p">(</span><span class="s">&#34;&#34;</span><span class="p">,</span> <span class="o">+</span><span class="p">)</span> <span class="c1">// ç´¯åŠ ï¼Œç±»ä¼¼æ ‡å‡†åº“ reduceï¼Œå½“ finish å‘å°„å®Œæ•´ç»“æœ</span>
<span class="c1">//        .reduce(&#34;&#34;) { accumulator, value in // å®Œæ•´ç‰ˆ</span>
<span class="c1">//          return accumulator + value</span>
<span class="c1">//        }</span>
        <span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">},</span>
              <span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">})</span>
        <span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subs</span><span class="p">)</span>

    <span class="bp">print</span><span class="p">(</span><span class="s">&#34;---&#34;</span><span class="p">)</span>
<span class="p">}</span>
<span class="c1">//pub1: receive subscription: ([&#34;A&#34;, &#34;B&#34;, &#34;C&#34;])</span>
<span class="c1">//pub1: request unlimited</span>
<span class="c1">//pub1: receive value: (A)</span>
<span class="c1">//pub1: receive value: (B)</span>
<span class="c1">//pub1: receive value: (C)</span>
<span class="c1">//pub1: receive finished</span>
<span class="c1">//ABC</span>
<span class="c1">//finished</span>
</code></pre></div><hr>
<ul>
<li>Encoding and Decoding in Swift at raywenderlich.com:</li>
<li>https:// <a href="http://www.raywenderlich.com/3418439-encoding-and-decoding-in-swift">www.raywenderlich.com/3418439-encoding-and-decoding-in-swift</a></li>
<li>Encoding and Decoding Custom Types on Appleâ€˜s official documentation:</li>
<li>https:// developer.apple.com/documentation/foundation/archives_and_serialization/ encoding_and_decoding_custom_types</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="kd">import</span> <span class="nc">UIKit</span>
<span class="kd">import</span> <span class="nc">Combine</span>

<span class="c1">//let subscription = (1...3).publisher</span>
<span class="c1">//    .print(&#34;publisher&#34;)</span>
<span class="c1">//    .sink { _ in }</span>

<span class="c1">//publisher: receive subscription: (1...3)</span>
<span class="c1">//publisher: request unlimited</span>
<span class="c1">//publisher: receive value: (1)</span>
<span class="c1">//publisher: receive value: (2)</span>
<span class="c1">//publisher: receive value: (3)</span>
<span class="c1">//publisher: receive finished</span>

<span class="kd">class</span> <span class="nc">TimeLogger</span><span class="p">:</span> <span class="n">TextOutputStream</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="kd">var</span> <span class="nv">previous</span> <span class="p">=</span> <span class="n">Date</span><span class="p">()</span>
    <span class="kd">private</span> <span class="kd">let</span> <span class="nv">formatter</span> <span class="p">=</span> <span class="n">NumberFormatter</span><span class="p">()</span>

    <span class="kd">init</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">formatter</span><span class="p">.</span><span class="n">maximumFractionDigits</span> <span class="p">=</span> <span class="mi">5</span>
        <span class="n">formatter</span><span class="p">.</span><span class="n">minimumFractionDigits</span> <span class="p">=</span> <span class="mi">5</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">write</span><span class="p">(</span><span class="kc">_</span> <span class="n">string</span><span class="p">:</span> <span class="nb">String</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nv">trimmed</span> <span class="p">=</span> <span class="n">string</span><span class="p">.</span><span class="n">trimmingCharacters</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">.</span><span class="n">whitespacesAndNewlines</span><span class="p">)</span>
        <span class="k">guard</span> <span class="o">!</span><span class="n">trimmed</span><span class="p">.</span><span class="bp">isEmpty</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="p">}</span>
        <span class="kd">let</span> <span class="nv">now</span> <span class="p">=</span> <span class="n">Date</span><span class="p">()</span>
        <span class="bp">print</span><span class="p">(</span><span class="s">&#34;+</span><span class="si">\(</span><span class="n">formatter</span><span class="p">.</span><span class="n">string</span><span class="si">(</span><span class="k">for</span><span class="p">:</span> <span class="n">now</span><span class="p">.</span><span class="n">timeIntervalSince</span><span class="si">(</span><span class="n">previous</span><span class="si">))</span><span class="o">!</span><span class="si">)</span><span class="s">s: </span><span class="si">\(</span><span class="n">string</span><span class="si">)</span><span class="s">&#34;</span><span class="p">)</span>
        <span class="n">previous</span> <span class="p">=</span> <span class="n">now</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">let</span> <span class="nv">subscription</span> <span class="p">=</span> <span class="p">(</span><span class="mf">1.</span><span class="p">..</span><span class="mi">3</span><span class="p">).</span><span class="n">publisher</span>
    <span class="p">.</span><span class="bp">print</span><span class="p">(</span><span class="s">&#34;publisher&#34;</span><span class="p">,</span> <span class="n">to</span><span class="p">:</span> <span class="n">TimeLogger</span><span class="p">())</span>
    <span class="p">.</span><span class="n">sink</span> <span class="p">{</span> <span class="kc">_</span> <span class="k">in</span> <span class="p">}</span>

<span class="c1">//+0.00589s: publisher: receive subscription: (1...3)</span>
<span class="c1">//+0.03223s: publisher: request unlimited</span>
<span class="c1">//+0.00031s: publisher: receive value: (1)</span>
<span class="c1">//+0.00025s: publisher: receive value: (2)</span>
<span class="c1">//+0.00024s: publisher: receive value: (3)</span>
<span class="c1">//+0.00023s: publisher: receive finished</span>
</code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="c1">// iOS Project</span>
<span class="kd">import</span> <span class="nc">UIKit</span>
<span class="kd">import</span> <span class="nc">Combine</span>

<span class="kd">class</span> <span class="nc">MyType</span><span class="p">:</span> <span class="n">Codable</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nv">id</span><span class="p">:</span> <span class="nb">Int</span>
    <span class="kd">var</span> <span class="nv">title</span><span class="p">:</span> <span class="nb">String</span>
<span class="p">}</span>

<span class="cm">/*
</span><span class="cm"> [
</span><span class="cm">   {
</span><span class="cm">     &#34;id&#34;: 1,
</span><span class="cm">     &#34;title&#34;: &#34;Post 1&#34;
</span><span class="cm">   },
</span><span class="cm">   {
</span><span class="cm">     &#34;id&#34;: 2,
</span><span class="cm">     &#34;title&#34;: &#34;Post 2&#34;
</span><span class="cm">   },
</span><span class="cm">   {
</span><span class="cm">     &#34;id&#34;: 3,
</span><span class="cm">     &#34;title&#34;: &#34;Post 3&#34;
</span><span class="cm">   }
</span><span class="cm"> ]
</span><span class="cm"> */</span>

<span class="kd">class</span> <span class="nc">ViewController</span><span class="p">:</span> <span class="n">UIViewController</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nv">subs</span> <span class="p">=</span> <span class="n">Set</span><span class="p">&lt;</span><span class="n">AnyCancellable</span><span class="p">&gt;()</span>

    <span class="kr">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
        <span class="kc">super</span><span class="p">.</span><span class="n">viewDidLoad</span><span class="p">()</span>

<span class="c1">//        guard let url = URL(string: &#34;https://my-json-server.typicode.com/typicode/demo/posts&#34;) else { return }</span>

<span class="c1">//        let sub = URLSession.shared</span>
<span class="c1">//            .dataTaskPublisher(for: url)</span>
<span class="c1">//            .tryMap { data, _ in</span>
<span class="c1">//                try JSONDecoder().decode([MyType].self, from: data)</span>
<span class="c1">//            }</span>
<span class="c1">//            .sink(receiveCompletion: { completion in</span>
<span class="c1">//                if case .failure(let err) = completion {</span>
<span class="c1">//                    print(err)</span>
<span class="c1">//                }</span>
<span class="c1">//            }, receiveValue: { data in</span>
<span class="c1">//                for m in data {</span>
<span class="c1">//                    print(m.id, m.title)</span>
<span class="c1">//                }</span>
<span class="c1">//            })</span>

<span class="c1">//        let sub = URLSession.shared</span>
<span class="c1">//            .dataTaskPublisher(for: url)</span>
<span class="c1">//            .map(\.data)</span>
<span class="c1">//            .decode(type: [MyType].self, decoder: JSONDecoder())</span>
<span class="c1">//            .sink(receiveCompletion: { completion in</span>
<span class="c1">//                if case .failure(let err) = completion {</span>
<span class="c1">//                    print(err)</span>
<span class="c1">//                }</span>
<span class="c1">//            }, receiveValue: { data in</span>
<span class="c1">//                for m in data {</span>
<span class="c1">//                    print(m.id, m.title)</span>
<span class="c1">//                }</span>
<span class="c1">//            })</span>
<span class="c1">//</span>
<span class="c1">//        sub.store(in: &amp;subs)</span>

<span class="c1">//        let pub = URLSession</span>
<span class="c1">//            .shared</span>
<span class="c1">//            .dataTaskPublisher(for: url)</span>
<span class="c1">//            .map(\.data) // æ˜ å°„åˆ° data</span>
<span class="c1">//            .multicast {</span>
<span class="c1">//                // å¤šæ’­ï¼Œé—­åŒ…ä¸­å¿…é¡»è¿”å›é€‚å½“ç±»å‹çš„ publisher</span>
<span class="c1">//                PassthroughSubject&lt;Data, URLError&gt;()</span>
<span class="c1">//        }</span>
<span class="c1">//</span>
<span class="c1">//        // é¦–æ¬¡è®¢é˜…ï¼ŒConnectablePublisherï¼Œä½†ä¸ä¼šç«‹å³å¼€å§‹å·¥ä½œ</span>
<span class="c1">//        let sub1 = pub</span>
<span class="c1">//            .decode(type: [MyType].self, decoder: JSONDecoder())</span>
<span class="c1">//            .sink(receiveCompletion: { completion in</span>
<span class="c1">//                if case .failure(let err) = completion {</span>
<span class="c1">//                    print(err)</span>
<span class="c1">//                }</span>
<span class="c1">//            }, receiveValue: { data in</span>
<span class="c1">//                for m in data {</span>
<span class="c1">//                    print(m.id, m.title)</span>
<span class="c1">//                }</span>
<span class="c1">//            })</span>
<span class="c1">//</span>
<span class="c1">//        sub1.store(in: &amp;subs)</span>
<span class="c1">//</span>
<span class="c1">//        let sub2 = pub</span>
<span class="c1">//            .decode(type: [MyType].self, decoder: JSONDecoder())</span>
<span class="c1">//            .sink(receiveCompletion: { completion in</span>
<span class="c1">//                if case .failure(let err) = completion {</span>
<span class="c1">//                    print(err)</span>
<span class="c1">//                }</span>
<span class="c1">//            }, receiveValue: { data in</span>
<span class="c1">//                for m in data {</span>
<span class="c1">//                    print(m.id, m.title)</span>
<span class="c1">//                }</span>
<span class="c1">//            })</span>
<span class="c1">//</span>
<span class="c1">//        sub2.store(in: &amp;subs)</span>
<span class="c1">//</span>
<span class="c1">//        // å‡†å¤‡å°±ç»ªï¼Œå¼€å§‹å·¥ä½œ</span>
<span class="c1">//        let subscription = pub.connect()</span>
<span class="c1">//</span>
<span class="c1">//        subscription.store(in: &amp;subs)</span>

        <span class="c1">// ---</span>

        <span class="kd">let</span> <span class="nv">request</span> <span class="p">=</span> <span class="n">URLSession</span><span class="p">.</span><span class="n">shared</span>
            <span class="p">.</span><span class="n">dataTaskPublisher</span><span class="p">(</span><span class="k">for</span><span class="p">:</span> <span class="n">URL</span><span class="p">(</span><span class="n">string</span><span class="p">:</span> <span class="s">&#34;https://my-json-server.typicode.com/typicode/demo/posts&#34;</span><span class="p">)</span><span class="o">!</span><span class="p">)</span>

<span class="c1">//        request.sink(receiveCompletion: { completion in</span>
<span class="c1">//            print(&#34;Sink received completion: \(completion)&#34;)</span>
<span class="c1">//        }) { (data, _) in</span>
<span class="c1">//            print(&#34;Sink received data: \(data)&#34;)</span>
<span class="c1">//        }.store(in: &amp;subs)</span>

<span class="c1">//        Sink received data: 134 bytes</span>
<span class="c1">//        Sink received completion: finished</span>

<span class="c1">//        request</span>
<span class="c1">//            .handleEvents(receiveSubscription: { _ in</span>
<span class="c1">//                print(&#34;Network request will start&#34;)</span>
<span class="c1">//            }, receiveOutput: { _ in</span>
<span class="c1">//                print(&#34;Network request data received&#34;)</span>
<span class="c1">//            }, receiveCancel: {</span>
<span class="c1">//                print(&#34;Network request cancelled&#34;)</span>
<span class="c1">//            })</span>
<span class="c1">//            .sink(receiveCompletion: { completion in</span>
<span class="c1">//                print(&#34;Sink received completion: \(completion)&#34;)</span>
<span class="c1">//            }) { (data, _) in</span>
<span class="c1">//                print(&#34;Sink received data: \(data)&#34;)</span>
<span class="c1">//            }</span>
<span class="c1">//            .store(in: &amp;subs)</span>

        <span class="c1">// æ³¨é‡Š .store(in: &amp;subs) ä¸€è¡Œ</span>
<span class="c1">//        Network request will start</span>
<span class="c1">//        Network request cancelled</span>

<span class="c1">//        Network request will start</span>
<span class="c1">//        Network request data received</span>
<span class="c1">//        Sink received data: 134 bytes</span>
<span class="c1">//        Sink received completion: finished</span>

        <span class="c1">// ---</span>

       <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
           <span class="p">.</span><span class="n">publisher</span>
           <span class="p">.</span><span class="n">breakpoint</span><span class="p">(</span><span class="n">receiveOutput</span><span class="p">:</span> <span class="p">{</span> <span class="n">value</span> <span class="k">in</span>
            <span class="c1">// åœ¨æŸä¸ªæ—¶æœºæ‰“æ–­ç‚¹ï¼Œä¸­æ–­æŸä¸ªäº‹ä»¶ï¼ˆä½†ä¸å¯åœ¨å–æ¶ˆè®¢é˜…æ—¶æ–­ç‚¹ï¼‰</span>
               <span class="k">return</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="o">&amp;&amp;</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">5</span>
           <span class="p">})</span>
           <span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span>
               <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span>
           <span class="p">})</span>
           <span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subs</span><span class="p">)</span>

<span class="c1">//        0</span>
<span class="c1">//        1</span>
<span class="c1">//        2</span>
<span class="c1">//        (lldb) // æ–­ç‚¹ï¼Œå¯ä»¥ç»§ç»­</span>
<span class="c1">//        3</span>
<span class="c1">//        4</span>
<span class="c1">//        5</span>

    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><hr>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="c1">// Swift-Project</span>

<span class="kd">import</span> <span class="nc">UIKit</span>
<span class="kd">import</span> <span class="nc">Combine</span>

<span class="kd">class</span> <span class="nc">ViewController</span><span class="p">:</span> <span class="n">UIViewController</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nv">subs</span> <span class="p">=</span> <span class="n">Set</span><span class="p">&lt;</span><span class="n">AnyCancellable</span><span class="p">&gt;()</span>

    <span class="kr">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
        <span class="kc">super</span><span class="p">.</span><span class="n">viewDidLoad</span><span class="p">()</span>

        <span class="c1">// RunLoop éçº¿ç¨‹å®‰å…¨</span>

<span class="c1">//        let rl = RunLoop.main</span>
<span class="c1">//        // ä¸ä¼šåˆ›å»ºå‘å¸ƒè€…</span>
<span class="c1">//        // Cancellable</span>
<span class="c1">//        let sub = rl.schedule(after: rl.now,</span>
<span class="c1">//                              // é—´éš”</span>
<span class="c1">//                              interval: .seconds(1),</span>
<span class="c1">//                              // å¯å…è®¸çš„è¯¯å·®ï¼ˆå¦‚æœä½¿ç”¨å°äº minimumTolerance çš„å€¼å¯èƒ½å¹¶ä¸ä¼šå¦‚ä½ æ‰€æ„¿ï¼‰</span>
<span class="c1">//                              tolerance: .milliseconds(100)) {</span>
<span class="c1">//            print(&#34;å®šæ—¶å™¨1&#34;)</span>
<span class="c1">//        }</span>
<span class="c1">//</span>
<span class="c1">//        rl.schedule(after: .init(Date(timeIntervalSinceNow: 3.0))) {</span>
<span class="c1">//            sub.cancel()</span>
<span class="c1">//        }</span>

<span class="c1">//        å®šæ—¶å™¨1</span>
<span class="c1">//        å®šæ—¶å™¨1</span>
<span class="c1">//        å®šæ—¶å™¨1</span>
<span class="c1">//        å®šæ—¶å™¨1</span>

        <span class="kd">let</span> <span class="nv">pub</span> <span class="p">=</span> <span class="n">Timer</span><span class="p">.</span><span class="n">publish</span><span class="p">(</span><span class="n">every</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
                                <span class="n">on</span><span class="p">:</span> <span class="p">.</span><span class="n">main</span><span class="p">,</span> <span class="c1">// é™„åŠ çš„ RunLoop</span>
                                <span class="k">in</span><span class="p">:</span> <span class="p">.</span><span class="n">common</span><span class="p">)</span> <span class="c1">// RunLoop è¿è¡Œæ¨¡å¼</span>


        <span class="c1">// æ³¨æ„åœ¨éä¸»é˜Ÿåˆ—ä½¿ç”¨å¯èƒ½ä¼šå¯¼è‡´ä¸å¯é¢„æœŸçš„ç»“æœï¼›Dispatch åº“æ²¡æœ‰ä½¿ç”¨ RunLoop æ¥ç®¡ç†çº¿ç¨‹</span>
        <span class="c1">// ç”±äº RunLoop éœ€è¦è°ƒç”¨ run æ–¹æ³•æ¥å¤„ç†äº‹ä»¶ï¼Œå…¶å®ƒ RunLoop å°†ä¸ä¼šè§¦å‘å®šæ—¶å™¨ï¼Œå®‰å…¨èµ·è§ä½¿ç”¨ .main</span>
<span class="c1">//        let pub = Timer.publish(every: 1.0,</span>
<span class="c1">//                                on: .current, // è‡ªå·±å¼€è¾Ÿçº¿ç¨‹çš„ RunLoop é€šè¿‡ current è·å¾—</span>
<span class="c1">//                                in: .common)</span>

        <span class="c1">// Timer è¿”å›çš„å‘å¸ƒè€…ä¸º ConnectablePublisher ç±»å‹ï¼Œæ˜ç¡®è°ƒç”¨ connect() æ‰ä¼šåœ¨è®¢é˜…æ—¶è§¦å‘ï¼Œæˆ–è€… autoconnect()</span>
<span class="c1">//        let pub1 = Timer.publish(every: 1.0,</span>
<span class="c1">//                                 on: .main,</span>
<span class="c1">//                                 in: .common)</span>
<span class="c1">//                        .autoconnect()</span>
<span class="c1">//                        .scan(0) { counter, _ in</span>
<span class="c1">//                            counter + 1</span>
<span class="c1">//                        }.sink(receiveValue: { print($0) })</span>
<span class="c1">//        pub1.store(in: &amp;subs)</span>
<span class="c1">//        1</span>
<span class="c1">//        2</span>
<span class="c1">//        3</span>
<span class="c1">//        4</span>
<span class="c1">//        ... // æ— é™</span>



        <span class="c1">// --- Dispatch Queue</span>
        <span class="kd">let</span> <span class="nv">queue</span> <span class="p">=</span> <span class="n">DispatchQueue</span><span class="p">.</span><span class="n">main</span>
        <span class="kd">let</span> <span class="nv">source</span> <span class="p">=</span> <span class="n">PassthroughSubject</span><span class="p">&lt;</span><span class="nb">Int</span><span class="p">,</span> <span class="n">Never</span><span class="p">&gt;()</span>
        <span class="kd">var</span> <span class="nv">counter</span> <span class="p">=</span> <span class="mi">0</span>

        <span class="kd">let</span> <span class="nv">cancellable</span> <span class="p">=</span> <span class="n">queue</span><span class="p">.</span><span class="n">schedule</span><span class="p">(</span><span class="n">after</span><span class="p">:</span> <span class="n">queue</span><span class="p">.</span><span class="n">now</span><span class="p">,</span>
                                         <span class="n">interval</span><span class="p">:</span> <span class="p">.</span><span class="n">seconds</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">source</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">counter</span><span class="p">)</span>
            <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="p">}</span>

        <span class="kd">let</span> <span class="nv">sub</span> <span class="p">=</span> <span class="n">source</span><span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">})</span>
        <span class="n">sub</span><span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subs</span><span class="p">)</span>

        <span class="n">cancellable</span><span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="k">in</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">subs</span><span class="p">)</span>

<span class="c1">//        0</span>
<span class="c1">//        1</span>
<span class="c1">//        2</span>
<span class="c1">//        3</span>
<span class="c1">//        ... // æ— é™</span>

        <span class="c1">// 1. å¦‚æœæœ‰ Obj-C æ€€æ—§ä¹‹æƒ…ï¼Œç”¨ RunLoop å®ç°å®šæ—¶å™¨</span>
        <span class="c1">// 2. ç°ä»£è®¡æ—¶å™¨ç”¨ DispatchQueue.schedule</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><hr>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift">
<span class="kd">import</span> <span class="nc">UIKit</span>
<span class="kd">import</span> <span class="nc">Combine</span>

<span class="kd">class</span> <span class="nc">TestObject</span><span class="p">:</span> <span class="n">NSObject</span> <span class="p">{</span>
    <span class="kr">@objc</span> <span class="kr">dynamic</span> <span class="kd">var</span> <span class="nv">intProp</span><span class="p">:</span> <span class="nb">Int</span> <span class="p">=</span> <span class="mi">0</span>
    <span class="kr">@objc</span> <span class="kr">dynamic</span> <span class="kd">var</span> <span class="nv">strProp</span><span class="p">:</span> <span class="nb">String</span> <span class="p">=</span> <span class="s">&#34;&#34;</span>
    <span class="kr">@objc</span> <span class="kr">dynamic</span> <span class="kd">var</span> <span class="nv">arrProp</span><span class="p">:</span> <span class="p">[</span><span class="nb">Float</span><span class="p">]</span> <span class="p">=</span> <span class="p">[]</span>

    <span class="c1">// KVO ä¸æ”¯æŒ</span>
    <span class="c1">// ERROR: Property cannot be marked @objc because its type cannot be represented in Objective-C</span>
<span class="c1">//    @objc dynamic var structProperty: PureSwift = .init(a: (0,false))</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="nc">PureSwift</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nv">a</span><span class="p">:</span> <span class="p">(</span><span class="nb">Int</span><span class="p">,</span> <span class="nb">Bool</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">MonitorObject</span><span class="p">:</span> <span class="n">ObservableObject</span> <span class="p">{</span>
    <span class="p">@</span><span class="n">Published</span> <span class="kd">var</span> <span class="nv">someProp1</span> <span class="p">=</span> <span class="kc">false</span>
    <span class="p">@</span><span class="n">Published</span> <span class="kd">var</span> <span class="nv">someProp2</span> <span class="p">=</span> <span class="s">&#34;&#34;</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">ViewController</span><span class="p">:</span> <span class="n">UIViewController</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nv">subs</span> <span class="p">=</span> <span class="n">Set</span><span class="p">&lt;</span><span class="n">AnyCancellable</span><span class="p">&gt;()</span>

    <span class="kr">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
        <span class="kc">super</span><span class="p">.</span><span class="n">viewDidLoad</span><span class="p">()</span>

        <span class="c1">// KVO ç»§æ‰¿è‡ª NSObject çš„ç±»ï¼›æ ‡è®°ä¸º @objc dynamicï¼›å…¼å®¹ Obj-C çš„æ•°ç»„å’Œå­—å…¸</span>

<span class="c1">//        let queue = OperationQueue()</span>
<span class="c1">//        let sub = queue.publisher(for: \.operationCount) // ç›‘å¬æ¬¡æ•°</span>
<span class="c1">//            .sink { print($0) }</span>
<span class="c1">//</span>
<span class="c1">//        sub.store(in: &amp;subs)</span>
<span class="c1">//</span>
<span class="c1">//        queue.addOperation(Operation())</span>

<span class="c1">//        0</span>
<span class="c1">//        1</span>
<span class="c1">//        0</span>

<span class="c1">//        let obj = TestObject()</span>
<span class="c1">//        let sub = obj</span>
<span class="c1">//            .publisher(for: \.intProp)</span>
<span class="c1">//            .sink { print($0) }</span>
<span class="c1">//        sub.store(in: &amp;subs)</span>
<span class="c1">//</span>
<span class="c1">//        obj.intProp = 100</span>
<span class="c1">//        obj.intProp = 200</span>
<span class="c1">//        obj.intProp = 200</span>

<span class="c1">//        0   // åˆå§‹å€¼</span>
<span class="c1">//        100</span>
<span class="c1">//        200</span>
<span class="c1">//        200</span>

<span class="c1">//        let sub2 = obj</span>
<span class="c1">//            .publisher(for: \.strProp)</span>
<span class="c1">//            .sink { print($0) }</span>
<span class="c1">//</span>
<span class="c1">//        let sub3 = obj</span>
<span class="c1">//            .publisher(for: \.arrProp)</span>
<span class="c1">//            .sink { print($0) }</span>
<span class="c1">//</span>
<span class="c1">//        obj.strProp = &#34;A&#34;</span>
<span class="c1">//        obj.arrProp.append(1)</span>
<span class="c1">//        obj.strProp = &#34;B&#34;</span>
<span class="c1">//        obj.arrProp.append(2)</span>

<span class="c1">//           // ç©ºå­—ç¬¦ä¸²</span>
<span class="c1">//        []</span>
<span class="c1">//        A</span>
<span class="c1">//        [1.0]</span>
<span class="c1">//        B</span>
<span class="c1">//        [1.0, 2.0]</span>


<span class="c1">//        let obj = TestObject()</span>
<span class="c1">//        let sub = obj</span>
<span class="c1">//        .publisher(for: \.intProp, options: [.initial])</span>
<span class="c1">////        .publisher(for: \.intProp, options: [.prior])</span>
<span class="c1">////        .publisher(for: \.intProp, options: [.new])</span>
<span class="c1">//            .sink { print($0) }</span>
<span class="c1">//        sub.store(in: &amp;subs)</span>
<span class="c1">//</span>
<span class="c1">//        obj.intProp = 100</span>
<span class="c1">//        obj.intProp = 200</span>
<span class="c1">//        obj.intProp = 200</span>

        <span class="c1">// options é»˜è®¤ .initial</span>
<span class="c1">//        0</span>
<span class="c1">//        100</span>
<span class="c1">//        200</span>
<span class="c1">//        200</span>

        <span class="c1">// options []</span>
<span class="c1">//        100</span>
<span class="c1">//        200</span>
<span class="c1">//        200</span>

        <span class="c1">// options [.prior] æ¯æ¬¡åŒæ—¶å‘å‡ºå‰ä¸€ä¸ªä¸æ–°å€¼</span>
<span class="c1">//        0</span>
<span class="c1">//        100</span>
<span class="c1">//        100</span>
<span class="c1">//        200</span>
<span class="c1">//        200</span>
<span class="c1">//        200</span>

        <span class="c1">// new old åœ¨è¯¥å‘å¸ƒè€…å¤„æ²¡æœ‰ä½œç”¨ï¼Œä»…ä»…è®©æ–°å€¼é€šè¿‡ï¼ˆnew oldï¼‰</span>
<span class="c1">//        100</span>
<span class="c1">//        200</span>
<span class="c1">//        200</span>

        <span class="c1">// --- ObservableObject</span>

        <span class="kd">let</span> <span class="nv">object</span> <span class="p">=</span> <span class="n">MonitorObject</span><span class="p">()</span>
        <span class="kd">let</span> <span class="nv">sub</span> <span class="p">=</span> <span class="n">object</span><span class="p">.</span><span class="n">objectWillChange</span><span class="p">.</span><span class="n">sink</span> <span class="p">{</span>
            <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="n">object</span><span class="p">.</span><span class="n">someProp1</span> <span class="p">=</span> <span class="kc">true</span>
        <span class="n">object</span><span class="p">.</span><span class="n">someProp2</span> <span class="p">=</span> <span class="s">&#34;Hello&#34;</span>

        <span class="c1">// æˆ‘ä»¬åªçŸ¥é“æ”¹å˜ï¼Œä½†ä¸çŸ¥é“å…·ä½“æ”¹å˜äº†å“ªä¸ªã€æ”¹å˜äº†ä»€ä¹ˆï¼Œå¸¸ç”¨äº SwiftUI å’Œ @Published ç»“åˆ</span>
<span class="c1">//        ()</span>
<span class="c1">//        ()</span>

    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><hr>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift">

<span class="kd">import</span> <span class="nc">UIKit</span>
<span class="kd">import</span> <span class="nc">Combine</span>

<span class="kd">class</span> <span class="nc">ViewController</span><span class="p">:</span> <span class="n">UIViewController</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nv">subs</span> <span class="p">=</span> <span class="n">Set</span><span class="p">&lt;</span><span class="n">AnyCancellable</span><span class="p">&gt;()</span>

    <span class="kr">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
        <span class="kc">super</span><span class="p">.</span><span class="n">viewDidLoad</span><span class="p">()</span>

        <span class="c1">// å¤šä¸ªè®¢é˜…è€…å…±äº«å‘å¸ƒè€…çš„å†…å®¹</span>
        <span class="c1">// share &amp; multicast</span>
        <span class="c1">// share è¿”å› Publish.Share ç±»å‹ï¼Œæ–°çš„å‘å¸ƒè€…å…±äº«ä¸Šæµçš„å‘å¸ƒè€…ï¼ˆåªä¼šè®¢é˜…ä¸Šæµå‘å¸ƒè€…ä¸€æ¬¡ï¼Œå¹¶å…±äº«ç»™æ‰€æœ‰åç»­è®¢é˜…è¯¥å‘å¸ƒè€…çš„è®¢é˜…è€…ï¼‰</span>
        <span class="c1">// æ–°è®¢é˜…è€…åªèƒ½æ”¶åˆ°ä¸Šæ¸¸å‘å¸ƒè€…è®¢é˜…åå‡ºçš„å€¼ï¼Œæ˜¯æ²¡æœ‰ç¼“å†²å’Œé‡æ’­çš„ï¼Œå¦‚æœä¸Šæ¸¸å·²ç»å®Œæˆï¼Œé‚£ä¹ˆè®¢é˜…è€…åªèƒ½æ”¶åˆ°å®Œæˆ</span>

<span class="c1">//        let shared = URLSession.shared</span>
<span class="c1">//            .dataTaskPublisher(for: URL(string: &#34;https://my-json-server.typicode.com/typicode/demo/posts&#34;)!)</span>
<span class="c1">//            .map(\.data)</span>
<span class="c1">//            .print(&#34;shared&#34;)</span>
<span class="c1">//            .share()</span>
<span class="c1">//</span>
<span class="c1">//        print(&#34;sub 1&#34;)</span>
<span class="c1">//</span>
<span class="c1">//        let sub1 = shared.sink(receiveCompletion: { _ in</span>
<span class="c1">//            print(&#34;Completion&#34;)</span>
<span class="c1">//        }, receiveValue: { print(&#34;sub1&#34;, $0) })</span>
<span class="c1">//        sub1.store(in: &amp;subs)</span>
<span class="c1">//</span>
<span class="c1">//        print(&#34;sub 2&#34;)</span>
<span class="c1">//</span>
<span class="c1">//        let sub2 = shared.sink(receiveCompletion: { _ in</span>
<span class="c1">//            print(&#34;Completion&#34;)</span>
<span class="c1">//        }, receiveValue: { print(&#34;sub2&#34;, $0) })</span>
<span class="c1">//        sub2.store(in: &amp;subs)</span>

<span class="c1">//        sub 1</span>
<span class="c1">//        shared: receive subscription: (DataTaskPublisher) // ç¬¬ä¸€ä¸ªè®¢é˜…è§¦å‘å¯¹ DataTaskPublisher è®¢é˜…</span>
<span class="c1">//        shared: request unlimited</span>
<span class="c1">//        sub 2</span>
<span class="c1">//        shared: receive value: (134 bytes)</span>
<span class="c1">//        sub1 134 bytes</span>
<span class="c1">//        sub2 134 bytes</span>
<span class="c1">//        shared: receive finished</span>
<span class="c1">//        Completion</span>
<span class="c1">//        Completion</span>

        <span class="c1">// å»æ‰ share</span>
<span class="c1">//        sub 1</span>
<span class="c1">//        shared: receive subscription: (DataTaskPublisher)</span>
<span class="c1">//        shared: request unlimited</span>
<span class="c1">//        sub 2</span>
<span class="c1">//        shared: receive subscription: (DataTaskPublisher) // ä¸¤æ¬¡è®¢é˜…</span>
<span class="c1">//        shared: request unlimited</span>
<span class="c1">//        shared: receive value: (134 bytes)</span>
<span class="c1">//        sub2 134 bytes</span>
<span class="c1">//        shared: receive finished</span>
<span class="c1">//        Completion</span>
<span class="c1">//        shared: receive value: (134 bytes)</span>
<span class="c1">//        sub1 134 bytes</span>
<span class="c1">//        shared: receive finished</span>
<span class="c1">//        Completion</span>

<span class="c1">//        var sub3: AnyCancellable? = nil</span>
<span class="c1">//</span>
<span class="c1">//        DispatchQueue.main.asyncAfter(deadline: .now() + 5) {</span>
<span class="c1">//            print(&#34;sub3&#34;)</span>
<span class="c1">//</span>
<span class="c1">//            sub3 = shared.sink(receiveCompletion: {</span>
<span class="c1">//                print(&#34;sub3&#34;, $0)</span>
<span class="c1">//            }, receiveValue: {</span>
<span class="c1">//                print(&#34;sub3&#34;, $0)</span>
<span class="c1">//            })</span>
<span class="c1">//        }</span>

        <span class="c1">// sub3 è®¢é˜…çš„æ—¶å€™ï¼Œè¯·æ±‚å·²ç»å›æ¥è¿‡äº†ï¼Œå› æ­¤æ²¡æœ‰æ¥æ”¶åˆ°ä»»ä½•å€¼</span>
<span class="c1">//        sub 1</span>
<span class="c1">//        shared: receive subscription: (DataTaskPublisher)</span>
<span class="c1">//        shared: request unlimited</span>
<span class="c1">//        sub 2</span>
<span class="c1">//        shared: receive value: (134 bytes)</span>
<span class="c1">//        sub1 134 bytes</span>
<span class="c1">//        sub2 134 bytes</span>
<span class="c1">//        shared: receive finished</span>
<span class="c1">//        Completion</span>
<span class="c1">//        Completion</span>
<span class="c1">//        sub3</span>
<span class="c1">//        sub3 finished</span>

        <span class="c1">// ---</span>
        <span class="c1">// multicast çš„å‘å¸ƒè€…ä¸º ConnectablePublisherï¼Œåªæœ‰è°ƒç”¨ connect æ‰ä¼šçœŸæ­£è®¢é˜…</span>

<span class="c1">//        let sub = PassthroughSubject&lt;Data, URLError&gt;()</span>
<span class="c1">//        let multi = URLSession.shared.dataTaskPublisher(for: URL(string: &#34;https://my-json-server.typicode.com/typicode/demo/posts&#34;)!)</span>
<span class="c1">//            .map(\.data)</span>
<span class="c1">//            .print(&#34;shared&#34;)</span>
<span class="c1">//            .multicast(subject: sub)</span>
<span class="c1">////            .autoconnect()</span>
<span class="c1">//</span>
<span class="c1">//        let sub1 = multi.sink(receiveCompletion: { print(&#34;sub1&#34;, $0) },</span>
<span class="c1">//                              receiveValue: { print(&#34;sub1&#34;, $0) })</span>
<span class="c1">//</span>
<span class="c1">//        let sub2 = multi.sink(receiveCompletion: { print(&#34;sub2&#34;, $0) },</span>
<span class="c1">//                              receiveValue: { print(&#34;sub2&#34;, $0) })</span>
<span class="c1">//</span>
<span class="c1">//        multi.connect()</span>
<span class="c1">//        // autoconnect ä¹Ÿæ”¯æŒï¼Œä½¿ç”¨æ—¶é¦–æ¬¡è®¢é˜…åï¼Œè¿æ¥åˆ°ä¸Šæ¸¸å‘å¸ƒè€…å¹¶ç«‹å³å¼€å§‹å·¥ä½œ</span>
<span class="c1">//        // ç”¨äºä¸Šæ¸¸å‘å¸ƒè€…å‘å°„å•ä¸€å€¼ï¼Œå¹¶ä½¿ç”¨ CurrentValueSubject å…±äº«è®¢é˜…è€…</span>
<span class="c1">//        sub.send(Data())</span>

        <span class="c1">// connect åï¼Œå‘é€æ•°æ®ï¼Œä¸¤ä¸ªå‡å¯æ”¶åˆ°</span>
<span class="c1">//        shared: receive subscription: (DataTaskPublisher)</span>
<span class="c1">//        shared: request unlimited</span>
<span class="c1">//        shared: receive cancel</span>
<span class="c1">//        sub1 0 bytes</span>
<span class="c1">//        sub2 0 bytes</span>

        <span class="c1">// autoconnect</span>
<span class="c1">//        shared: receive subscription: (DataTaskPublisher)</span>
<span class="c1">//        shared: request unlimited</span>
<span class="c1">//        sub1 0 bytes</span>
<span class="c1">//        sub2 0 bytes</span>
<span class="c1">//        shared: receive cancel</span>

        <span class="c1">// Future</span>

        <span class="kd">let</span> <span class="nv">future</span> <span class="p">=</span> <span class="n">Future</span><span class="p">&lt;</span><span class="nb">Int</span><span class="p">,</span> <span class="n">Error</span><span class="p">&gt;</span> <span class="p">{</span> <span class="n">fulfill</span> <span class="k">in</span>
            <span class="k">do</span> <span class="p">{</span>
                <span class="c1">// åˆ›å»ºåç«‹å³æ‰§è¡Œï¼ˆæ— å…³æ˜¯å¦è®¢é˜…ï¼‰</span>
                <span class="kd">let</span> <span class="nv">result</span> <span class="p">=</span> <span class="k">try</span> <span class="kc">self</span><span class="p">.</span><span class="n">performSomeWork</span><span class="p">()</span>
                <span class="c1">// å°†ç»“æœä¿å­˜åœ¨ fulfillï¼Œå¹¶åˆ†å‘ç»™ Future çš„è®¢é˜…è€…</span>
                <span class="n">fulfill</span><span class="p">(.</span><span class="n">success</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
            <span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
                <span class="n">fulfill</span><span class="p">(.</span><span class="n">failure</span><span class="p">(</span><span class="n">error</span><span class="p">))</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="c1">// ä»…æ‰§è¡Œä¸€æ¬¡ä½†å¯ä»¥åˆ†å‘ç»“æœåˆ°å¤šä¸ªè®¢é˜…è€…</span>
        <span class="c1">// ä¸èƒ½ä¾é  Deferred æ¨è¿Ÿé—­åŒ…æ‰§è¡Œç›´åˆ°è®¢é˜…è€…è®¢é˜…ï¼Œå› ä¸º Deferred æ˜¯ä¸ªç»“æ„ä½“ï¼Œæ¯æ¬¡éƒ½ä¼šå¯¼è‡´æ–°çš„ Future åˆ›å»º</span>

<span class="c1">//        åœ¨å¤„ç†ç½‘ç»œç­‰èµ„æºå¯†é›†å‹æµç¨‹æ—¶ï¼Œå…±äº«è®¢é˜…å·¥ä½œè‡³å…³é‡è¦ã€‚</span>
<span class="c1">//        å½“æ‚¨åªéœ€è¦ä¸å¤šä¸ªè®¢é˜…è€…å…±äº«ä¸€ä¸ªå‘å¸ƒè€…æ—¶ï¼Œè¯·ä½¿ç”¨shareï¼ˆï¼‰ã€‚</span>
<span class="c1">//        å½“æ‚¨éœ€è¦ç²¾ç»†æ§åˆ¶ä¸Šæ¸¸å‘å¸ƒè€…ä½•æ—¶å¼€å§‹å·¥ä½œä»¥åŠå€¼å¦‚ä½•ä¼ æ’­åˆ°è®¢é˜…è€…æ—¶ï¼Œè¯·ä½¿ç”¨multicastï¼ˆ_ :)ã€‚</span>
<span class="c1">//        ä½¿ç”¨Futureå°†è®¡ç®—çš„å•ä¸ªç»“æœå…±äº«ç»™å¤šä¸ªè®¢æˆ·ã€‚</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">performSomeWork</span><span class="p">()</span> <span class="kr">throws</span> <span class="p">-&gt;</span> <span class="nb">Int</span> <span class="p">{</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><hr>
<p>@ObservedObject åŒ…è£…å™¨æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š 1.ä»è§†å›¾ä¸­åˆ é™¤å±æ€§å­˜å‚¨ï¼Œå¹¶ä½¿ç”¨å¯¹åŸå§‹å±æ€§çš„ç»‘å®š
æ¨¡å‹ã€‚ æ¢å¥è¯è¯´ï¼Œå®ƒä¸ä¼šé‡å¤æ•°æ®ã€‚ 2.å°†å±æ€§æ ‡è®°ä¸ºå¤–éƒ¨å­˜å‚¨ã€‚ æ¢å¥è¯è¯´ï¼Œå®ƒè¡¨ç¤ºä¸€å—
çš„æ•°æ®ä¸å±äºè§†å›¾ã€‚ 3.ä¸@Published å’Œ@State ä¸€æ ·ï¼Œå®ƒä¼šå°†å‘å¸ƒè€…æ·»åŠ åˆ°å±æ€§ä¸­ï¼Œå› æ­¤æ‚¨å¯ä»¥
è®¢é˜…å®ƒå’Œ/æˆ–åœ¨è§†å›¾å±‚æ¬¡ç»“æ„ä¸­è¿›ä¸€æ­¥ç»‘å®šåˆ°å®ƒã€‚</p>
</div>
                    <div class="post_footer">
                        
                        <div class="meta">
                            <div class="info">
                                <span class="field tags">
                                    <i class="ri-stack-line"></i>
                                    
                                    <a href="https://kingcos.me/tags/swift/">Swift</a>
                                    
                                </span>
                            </div>
                        </div>
                        
                    </div>
                </div>
                <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<table style="border: 0;">
  <tr>
  <td style="border: 0; width: 30%;">
    <img width='100%' src='/img/about/1.jpg'>
  </td>
  <td style="border: 0; width: 50%;">
    <center>â† å†™å¾—å¦‚ä½•ï¼Ÿè€ƒè™‘<strong>èµèµ</strong>ä¸€ä¸‹ï¼ŸğŸŒš</center>
    
  </td>
  </tr>
</table>

<hr>

<script>
    (adsbygoogle = window.adsbygoogle || []).push({});
</script>
                
                
                







    
    
    
    <div>
        <div id="github-comment">
        </div>

        <script type="text/javascript">
        function getUtterances(isDark) {
            var utterances = document.createElement('script');
            utterances.type = 'text/javascript';
            utterances.async = true;
            utterances.setAttribute('issue-term', "pathname")
            utterances.setAttribute('repo', "kingcos\/kingcos.github.io")
            utterances.setAttribute('label', "comments")
            isDark ? utterances.setAttribute('theme', "github-dark") : utterances.setAttribute('theme', "github-light")
            utterances.crossorigin = 'anonymous';
            utterances.src = 'https://utteranc.es/client.js';

            return utterances
        }
        document.getElementById('github-comment').appendChild(getUtterances(false))
        </script>
    </div>
    




                
            </div>
        </div>
    </div>
    <a id="back_to_top" href="#" class="back_to_top"><i class="ri-arrow-up-s-line"></i></a>
    <footer class="footer">
    <div class="powered_by">
        <a href="https://kingcos.me">Powered by kingcos with love.</a>
    </div>

    <div class="footer_slogan">
        <span>â¤ï¸</span>
    </div>
</footer>
    <script src="https://kingcos.me/js/jquery-3.5.1.min.js"></script>
<link href="https://kingcos.me/css/fancybox.min.css" rel="stylesheet">
<script src="https://kingcos.me/js/fancybox.min.js"></script>
<script src="https://kingcos.me/js/zozo.js"></script>


<script type="text/javascript" async
    src="https://cdn.bootcss.com/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
        MathJax.Hub.Config({
            tex2jax: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\[\[', '\]\]']],
                processEscapes: true,
                processEnvironments: true,
                skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
                TeX: {
                    equationNumbers: { autoNumber: "AMS" },
                    extensions: ["AMSmath.js", "AMSsymbols.js"]
                }
            }
        });

        MathJax.Hub.Queue(function () {
            
            
            
            var all = MathJax.Hub.getAllJax(), i;
            for (i = 0; i < all.length; i += 1) {
                all[i].SourceElement().parentNode.className += ' has-jax';
            }
        });
    </script>

<style>
    code.has-jax {
        font: inherit;
        font-size: 100%;
        background: inherit;
        border: inherit;
        color: #515151;
    }
</style>



<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-138311951-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</body>

</html>