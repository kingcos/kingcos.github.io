<!DOCTYPE html>
<html lang="en">
  <head>
    
      <title>Swift 拾遗 - 汇编 :: iBlog</title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content="Date Notes     2020-08-10 首次提交    Preface 《Swift 拾遗》是一个关于 Swift 的新文章专辑，这个系列的文章将不会涉及基本语法的层面，而是尝试从底层「拾」起之前所忽视的内容。本文涉及了各个部分关于汇编的内容。
struct &amp;amp; class struct 栈区 // main.swift struct Foo { var a: Int var b: Int } func bar() { var foo1 = Foo(a: 10, b: 11) // BREAKPOINT 🔴 var foo2 = foo1 foo2.a = 20 foo2.b = 22 } bar() 我们定义一个结构体 Foo，并在函数 bar 中声明和构造后赋值于 foo1，之后将 foo1 赋值给新变量 foo2；此时改变 foo2 中的值，由于结构体是值类型，因此对于 foo2 的改变将不会影响 foo1，我们尝试从汇编底层看一下这个过程："/>
<meta name="keywords" content="kingcos.me,maimieng.comios,swift,objective-c,obj-c,objc,oc,geek,python,ruby,golang,go,apple,mac"/>
<meta name="robots" content="noodp"/>
<link rel="canonical" href="/posts/2020/swift_with_asm/" />





<link rel="stylesheet" href="/assets/style.css">


<link rel="stylesheet" href="/style.css">


<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/img/apple-touch-icon-144-precomposed.png">
<link rel="shortcut icon" href="/img/favicon.png">


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Swift 拾遗 - 汇编"/>
<meta name="twitter:description" content="《Swift 拾遗》是一个关于 Swift 的新文章专辑，这个系列的文章将不会涉及基本语法的层面，而是尝试从底层「拾」起之前所忽视的内容。本文涉及了各个部分关于汇编的内容。"/>



<meta property="og:title" content="Swift 拾遗 - 汇编" />
<meta property="og:description" content="《Swift 拾遗》是一个关于 Swift 的新文章专辑，这个系列的文章将不会涉及基本语法的层面，而是尝试从底层「拾」起之前所忽视的内容。本文涉及了各个部分关于汇编的内容。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/2020/swift_with_asm/" />
<meta property="article:published_time" content="2020-08-10T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-08-10T00:00:00+00:00" /><meta property="og:site_name" content="iBlog" />




<script data-ad-client="ca-pub-9925978992661955" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

  </head>
  <body class="">
    <div class="container">
      <header class="header">
  <span class="header__inner">
    <a href="/" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367"/>
</svg>
</span>
    <span class="logo__text">kingcos.me</span>
    <span class="logo__cursor"></span>
  
</a>

    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/about">About</a></li>
        
      
        
          <li><a href="/links">Links</a></li>
        
      
        
          <li><a href="/perspective">Perspective</a></li>
        
      
        
          <li><a href="/words">Words</a></li>
        
      
      
    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/about">About</a></li>
      
    
      
        <li><a href="/links">Links</a></li>
      
    
      
        <li><a href="/perspective">Perspective</a></li>
      
    
      
        <li><a href="/words">Words</a></li>
      
    
  </ul>
</nav>

        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none"/>
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
          </svg>
        </span>
      
      <span class="theme-toggle">
        <svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>

      </span>
    </span>
  </span>
</header>


      <div class="content">
        
  <div class="post">
    <h2 class="post-title"><a href="/posts/2020/swift_with_asm/">Swift 拾遗 - 汇编</a></h2>
    <div class="post-meta">
      
        <span class="post-date">
            2020-08-10
        </span>
      
      
      
        <span class="post-read-time">— 15 min read</span>
      
    </div>

    
      <span class="post-tags">
        
          #<a href="/tags/swift/">Swift</a>&nbsp;
        
          #<a href="/tags/swift-%E6%8B%BE%E9%81%97/">Swift 拾遗</a>&nbsp;
        
      </span>
    

    

    <div class="post-content">
      <table>
<thead>
<tr>
<th align="center">Date</th>
<th align="center">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">2020-08-10</td>
<td align="center">首次提交</td>
</tr>
</tbody>
</table>
<h2 id="preface">Preface</h2>
<p>《Swift 拾遗》是一个关于 Swift 的新文章专辑，这个系列的文章将不会涉及基本语法的层面，而是尝试从底层「拾」起之前所忽视的内容。本文涉及了各个部分关于汇编的内容。</p>
<!-- - 16 个常用寄存器：
  - `rax`、`rbx`、`rcx`、`rdx`、`rsi`、`rdi`、`rbp`、`rsp`
  - `r8`、`r9`、`r10`、`r11`、`r12`、`r13`、`r14`、`r15`
  - `r` 开头的寄存器均为 64 位(8 字节）寄存器，`e` 开头为 32 位，`ax`、`bx`、`cx` 为 16 位，`ah`、`al` 为 8 位。

  - 结构体和对象等均存储在内存（非寄存器） -->
<h2 id="struct--class">struct &amp; class</h2>
<h3 id="struct">struct</h3>
<h4 id="栈区">栈区</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-swift" data-lang="swift"><span style="color:#75715e">// main.swift</span>

<span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Foo</span> {
    <span style="color:#66d9ef">var</span> a: Int
    <span style="color:#66d9ef">var</span> b: Int
}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">bar</span>() {
    <span style="color:#66d9ef">var</span> foo1 = Foo(a: <span style="color:#ae81ff">10</span>, b: <span style="color:#ae81ff">11</span>) <span style="color:#75715e">// BREAKPOINT 🔴</span>
    <span style="color:#66d9ef">var</span> foo2 = foo1

    foo2.a = <span style="color:#ae81ff">20</span>
    foo2.b = <span style="color:#ae81ff">22</span>
}

bar()
</code></pre></div><p>我们定义一个结构体 <code>Foo</code>，并在函数 <code>bar</code> 中声明和构造后赋值于 <code>foo1</code>，之后将 <code>foo1</code> 赋值给新变量 <code>foo2</code>；此时改变 <code>foo2</code> 中的值，由于结构体是值类型，因此对于 <code>foo2</code> 的改变将不会影响 <code>foo1</code>，我们尝试从汇编底层看一下这个过程：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-asm" data-lang="asm"><span style="color:#a6e22e">demo</span><span style="color:#960050;background-color:#1e0010">`</span><span style="color:#66d9ef">bar</span>():
    <span style="color:#75715e">; ...
</span><span style="color:#75715e"></span>    <span style="color:#75715e">; 函数调用前要先传递参数：
</span><span style="color:#75715e"></span>    <span style="color:#75715e">; 将立即数 10 移动到 edi 寄存器（即 rdi 寄存器低 32 位）
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000b73</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">19</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">movl</span>   <span style="color:#66d9ef">$0xa</span>, %edi
    <span style="color:#75715e">; 将立即数 11 移动到 esi 寄存器（即 rsi 寄存器低 32 位）
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000b78</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">24</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">movl</span>   <span style="color:#66d9ef">$0xb</span>, %esi
    <span style="color:#75715e">; 构造函数调用：
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">-&gt;</span>  <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000b7d</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">29</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">callq</span>  <span style="color:#ae81ff">0x100000b50</span>               <span style="color:#75715e">; demo.Foo.init(a: Swift.Int, b: Swift.Int) -&gt; demo.Foo at main.swift:1
</span><span style="color:#75715e"></span>    <span style="color:#75715e">; 经构造函数调用后，此时 10 位于 rax，11 位于 rdx（详见下方 init 内汇编）
</span><span style="color:#75715e"></span>    <span style="color:#75715e">; (lldb) register read rax =&gt; rax = 0x000000000000000a
</span><span style="color:#75715e"></span>    <span style="color:#75715e">; (lldb) register read rdx =&gt; rdx = 0x000000000000000b
</span><span style="color:#75715e"></span>    <span style="color:#75715e">; ---
</span><span style="color:#75715e"></span>    <span style="color:#75715e">; (lldb) register read rbp =&gt; rbp = 0x00007ffeefbff4a0
</span><span style="color:#75715e"></span>    <span style="color:#75715e">; (lldb) po withUnsafePointer(to: &amp;foo1) { print(&#34;\($0)&#34;) } =&gt; 0x00007ffeefbff490
</span><span style="color:#75715e"></span>    <span style="color:#75715e">; 将 rax 寄存器内容（10）移动到 rbp - 0x10 地址（0x7FFEEFBFF490，即 foo1 的内存地址）
</span><span style="color:#75715e"></span>    <span style="color:#ae81ff">0x100000b82</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">34</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">movq</span>   %rax, -<span style="color:#ae81ff">0x10</span>(%rbp)
    <span style="color:#75715e">; 将 rdx 寄存器内容（11）移动到 rbp - 0x8 地址（0x7FFEEFBFF498）
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000b86</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">38</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">movq</span>   %rdx, -<span style="color:#ae81ff">0x8</span>(%rbp)
    <span style="color:#75715e">; (lldb) po withUnsafePointer(to: &amp;foo2) { print(&#34;\($0)&#34;) } =&gt; 0x00007ffeefbff480
</span><span style="color:#75715e"></span>    <span style="color:#75715e">; 将 rax 寄存器内容（10）移动到 rbp - 0x20 地址（0x7FFEEFBFF480，即 foo2 的内存地址）
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000b8a</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">42</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">movq</span>   %rax, -<span style="color:#ae81ff">0x20</span>(%rbp)
    <span style="color:#75715e">; 将 rdx 寄存器内容（11）移动到 rbp - 0x18 地址（0x7FFEEFBFF488）
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000b8e</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">46</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">movq</span>   %rdx, -<span style="color:#ae81ff">0x18</span>(%rbp)
    <span style="color:#75715e">; 将立即数 20 移动到 rbp - 0x20 寄存器（foo2.a）
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000b92</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">50</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">movq</span>   <span style="color:#66d9ef">$0x14</span>, -<span style="color:#ae81ff">0x20</span>(%rbp)
    <span style="color:#75715e">; 将立即数 22 移动到 rbp - 0x18 寄存器（foo2.b）
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000b9a</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">58</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">movq</span>   <span style="color:#66d9ef">$0x16</span>, -<span style="color:#ae81ff">0x18</span>(%rbp)
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000ba2</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">66</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">addq</span>   <span style="color:#66d9ef">$0x20</span>, %rsp
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000ba6</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">70</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">popq</span>   %rbp
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000ba7</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">71</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">retq</span>

<span style="color:#75715e">; 断点处执行 LLDB 命令 si：
</span><span style="color:#75715e"></span><span style="color:#a6e22e">demo</span><span style="color:#960050;background-color:#1e0010">`</span><span style="color:#66d9ef">Foo.init</span>(<span style="color:#66d9ef">a</span>:<span style="color:#66d9ef">b</span>:):
<span style="color:#960050;background-color:#1e0010">-&gt;</span>  <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000b50</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">0</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">pushq</span>  %rbp
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000b51</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">1</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movq</span>   %rsp, %rbp
    <span style="color:#75715e">; 将参数放在函数内部的栈空间：
</span><span style="color:#75715e"></span>    <span style="color:#75715e">; 将 rdi 寄存器内容（10）移动到 rax 寄存器
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000b54</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">4</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movq</span>   %rdi, %rax
    <span style="color:#75715e">; 将 rsi 寄存器内容（11）移动到 rdx 寄存器
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000b57</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">7</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movq</span>   %rsi, %rdx
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000b5a</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">10</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">popq</span>   %rbp
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000b5b</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">11</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">retq</span>
</code></pre></div><p>综上，变量的内存地址格式为：<code>-0x10(%rbp)</code> 一般是栈空间的局部变量。这是因为 <code>rbp</code> 会根据每次函数调用而有不一样的值，局部变量的内存地址也在每次调用时会重新分配。</p>
<h4 id="全局区">全局区</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-swift" data-lang="swift"><span style="color:#75715e">// main.swift</span>

<span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Foo</span> {
    <span style="color:#66d9ef">var</span> a: Int
    <span style="color:#66d9ef">var</span> b: Int
}

<span style="color:#66d9ef">var</span> foo1 = Foo(a: <span style="color:#ae81ff">10</span>, b: <span style="color:#ae81ff">11</span>) <span style="color:#75715e">// BREAKPOINT 🔴</span>
<span style="color:#66d9ef">var</span> foo2 = foo1

foo2.a = <span style="color:#ae81ff">20</span>
foo2.b = <span style="color:#ae81ff">22</span>
</code></pre></div><p>当 <code>foo1</code> 和 <code>foo2</code> 在全局区时则又有些不一样：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-asm" data-lang="asm"><span style="color:#a6e22e">demo</span><span style="color:#960050;background-color:#1e0010">`</span><span style="color:#66d9ef">main</span>:
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000a80</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">0</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:   <span style="color:#66d9ef">pushq</span>  %rbp
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000a81</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">1</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:   <span style="color:#66d9ef">movq</span>   %rsp, %rbp
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000a84</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">4</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:   <span style="color:#66d9ef">subq</span>   <span style="color:#66d9ef">$0x60</span>, %rsp
    <span style="color:#75715e">; 函数调用前要先传递参数：
</span><span style="color:#75715e"></span>    <span style="color:#75715e">; 将立即数 10 移动到 eax 寄存器（即 rax 寄存器低 32 位）
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">-&gt;</span>  <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000a88</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">8</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:   <span style="color:#66d9ef">movl</span>   <span style="color:#66d9ef">$0xa</span>, %eax
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000a8d</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">13</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movl</span>   %edi, -<span style="color:#ae81ff">0x4c</span>(%rbp)
    <span style="color:#75715e">; 将 rax 寄存器内容（10）移动到 rdi 寄存器
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000a90</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">16</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movq</span>   %rax, %rdi
    <span style="color:#75715e">; 将立即数 11 移动到 eax 寄存器（即 rax 寄存器低 32 位）
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000a93</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">19</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movl</span>   <span style="color:#66d9ef">$0xb</span>, %eax
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000a98</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">24</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movq</span>   %rsi, -<span style="color:#ae81ff">0x58</span>(%rbp)
    <span style="color:#75715e">; 将 rax 寄存器内容（11）移动到 rsi 寄存器
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000a9c</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">28</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movq</span>   %rax, %rsi
    <span style="color:#75715e">; 构造函数调用：
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000a9f</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">31</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">callq</span>  <span style="color:#ae81ff">0x100000c00</span>               <span style="color:#75715e">; demo.Foo.init(a: Swift.Int, b: Swift.Int) -&gt; demo.Foo at main.swift:3
</span><span style="color:#75715e"></span>    <span style="color:#75715e">; 经构造函数调用后，此时 10 位于 rax，11 位于 rdx（详见下方 init 内汇编）
</span><span style="color:#75715e"></span>    <span style="color:#75715e">; (lldb) register read rax =&gt; rax = 0x000000000000000a
</span><span style="color:#75715e"></span>    <span style="color:#75715e">; (lldb) register read rdx =&gt; rdx = 0x000000000000000b
</span><span style="color:#75715e"></span>    <span style="color:#ae81ff">0x100000aa4</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">36</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">leaq</span>   <span style="color:#ae81ff">0x156d</span>(%rip), %rcx        <span style="color:#75715e">; demo.foo1 : demo.Foo
</span><span style="color:#75715e"></span>    <span style="color:#ae81ff">0x100000aab</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">43</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">xorl</span>   %r8d, %r8d
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000aae</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">46</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movl</span>   %r8d, %esi
    <span style="color:#75715e">; (lldb) po withUnsafePointer(to: &amp;foo1) { print(&#34;\($0)&#34;) } =&gt; 0x0000000100002018
</span><span style="color:#75715e"></span>    <span style="color:#75715e">; 将 rax 寄存器内容（10）移动到 rip + 0x1560 地址（0x100002018，即 foo1 的内存地址）
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000ab1</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">49</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movq</span>   %rax, <span style="color:#ae81ff">0x1560</span>(%rip)        <span style="color:#75715e">; demo.foo1 : demo.Foo
</span><span style="color:#75715e"></span>    <span style="color:#75715e">; 将 rdx 寄存器内容（11）移动到 rip + 0x1561 地址（0x100002020）
</span><span style="color:#75715e"></span>    <span style="color:#ae81ff">0x100000ab8</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">56</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movq</span>   %rdx, <span style="color:#ae81ff">0x1561</span>(%rip)        <span style="color:#75715e">; demo.foo1 : demo.Foo + 8
</span><span style="color:#75715e"></span>    <span style="color:#ae81ff">0x100000abf</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">63</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movq</span>   %rcx, %rdi
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000ac2</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">66</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">leaq</span>   -<span style="color:#ae81ff">0x18</span>(%rbp), %rax
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000ac6</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">70</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movq</span>   %rsi, -<span style="color:#ae81ff">0x60</span>(%rbp)
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000aca</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">74</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movq</span>   %rax, %rsi
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000acd</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">77</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movl</span>   <span style="color:#66d9ef">$0x20</span>, %edx
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000ad2</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">82</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movq</span>   -<span style="color:#ae81ff">0x60</span>(%rbp), %rcx
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000ad6</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">86</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">callq</span>  <span style="color:#ae81ff">0x100000e42</span>               <span style="color:#75715e">; symbol stub for: swift_beginAccess
</span><span style="color:#75715e"></span>    <span style="color:#75715e">; (lldb) po withUnsafePointer(to: &amp;foo2) { print(&#34;\($0)&#34;) } =&gt; 0x0000000100002028
</span><span style="color:#75715e"></span>    <span style="color:#75715e">; 将 rip + 0x1536 地址（0x100002018，即 foo1）内容（10）移动到 rax
</span><span style="color:#75715e"></span>    <span style="color:#ae81ff">0x100000adb</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">91</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movq</span>   <span style="color:#ae81ff">0x1536</span>(%rip), %rax        <span style="color:#75715e">; demo.foo1 : demo.Foo
</span><span style="color:#75715e"></span>    <span style="color:#75715e">; 将 rax 寄存器内容（10）移动到 rip + 0x153f 地址（00x100002028，即 foo2 的内存地址）
</span><span style="color:#75715e"></span>    <span style="color:#ae81ff">0x100000ae2</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">98</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movq</span>   %rax, <span style="color:#ae81ff">0x153f</span>(%rip)        <span style="color:#75715e">; demo.foo2 : demo.Foo
</span><span style="color:#75715e"></span>    <span style="color:#75715e">; 将 rip + 0x1530 地址（0x100002020）内容（11）移动到 rax
</span><span style="color:#75715e"></span>    <span style="color:#ae81ff">0x100000ae9</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">105</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">movq</span>   <span style="color:#ae81ff">0x1530</span>(%rip), %rax        <span style="color:#75715e">; demo.foo1 : demo.Foo + 8
</span><span style="color:#75715e"></span>    <span style="color:#75715e">; 将 rax 寄存器内容（11）移动到 rip + 0x1539 地址（0x100002030）
</span><span style="color:#75715e"></span>    <span style="color:#ae81ff">0x100000af0</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">112</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">movq</span>   %rax, <span style="color:#ae81ff">0x1539</span>(%rip)        <span style="color:#75715e">; demo.foo2 : demo.Foo + 8
</span><span style="color:#75715e"></span>    <span style="color:#ae81ff">0x100000af7</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">119</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">leaq</span>   -<span style="color:#ae81ff">0x18</span>(%rbp), %rdi
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000afb</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">123</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">callq</span>  <span style="color:#ae81ff">0x100000e48</span>               <span style="color:#75715e">; symbol stub for: swift_endAccess
</span><span style="color:#75715e"></span>    <span style="color:#ae81ff">0x100000b00</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">128</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">leaq</span>   <span style="color:#ae81ff">0x1521</span>(%rip), %rax        <span style="color:#75715e">; demo.foo2 : demo.Foo
</span><span style="color:#75715e"></span>    <span style="color:#ae81ff">0x100000b07</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">135</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">xorl</span>   %r8d, %r8d
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000b0a</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">138</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">movl</span>   %r8d, %ecx
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000b0d</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">141</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">movq</span>   %rax, %rdi
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000b10</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">144</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">leaq</span>   -<span style="color:#ae81ff">0x30</span>(%rbp), %rsi
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000b14</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">148</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">movl</span>   <span style="color:#66d9ef">$0x21</span>, %edx
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000b19</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">153</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">callq</span>  <span style="color:#ae81ff">0x100000e42</span>               <span style="color:#75715e">; symbol stub for: swift_beginAccess
</span><span style="color:#75715e"></span>    <span style="color:#75715e">; 将立即数 20 移动到 rip + 0x14ff 寄存器（0x100002028，foo2.a）
</span><span style="color:#75715e"></span>    <span style="color:#ae81ff">0x100000b1e</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">158</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">movq</span>   <span style="color:#66d9ef">$0x14</span>, <span style="color:#ae81ff">0x14ff</span>(%rip)       <span style="color:#75715e">; demo.foo1 : demo.Foo + 12
</span><span style="color:#75715e"></span>    <span style="color:#ae81ff">0x100000b29</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">169</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">leaq</span>   -<span style="color:#ae81ff">0x30</span>(%rbp), %rdi
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000b2d</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">173</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">callq</span>  <span style="color:#ae81ff">0x100000e48</span>               <span style="color:#75715e">; symbol stub for: swift_endAccess
</span><span style="color:#75715e"></span>    <span style="color:#ae81ff">0x100000b32</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">178</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">leaq</span>   <span style="color:#ae81ff">0x14ef</span>(%rip), %rax        <span style="color:#75715e">; demo.foo2 : demo.Foo
</span><span style="color:#75715e"></span>    <span style="color:#ae81ff">0x100000b39</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">185</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">xorl</span>   %r8d, %r8d
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000b3c</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">188</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">movl</span>   %r8d, %ecx
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000b3f</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">191</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">movq</span>   %rax, %rdi
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000b42</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">194</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">leaq</span>   -<span style="color:#ae81ff">0x48</span>(%rbp), %rsi
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000b46</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">198</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">movl</span>   <span style="color:#66d9ef">$0x21</span>, %edx
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000b4b</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">203</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">callq</span>  <span style="color:#ae81ff">0x100000e42</span>               <span style="color:#75715e">; symbol stub for: swift_beginAccess
</span><span style="color:#75715e"></span>     <span style="color:#75715e">; 将立即数 22 移动到 rip + 0x14d5 寄存器（0x100002030，foo2.b）
</span><span style="color:#75715e"></span>    <span style="color:#ae81ff">0x100000b50</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">208</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">movq</span>   <span style="color:#66d9ef">$0x16</span>, <span style="color:#ae81ff">0x14d5</span>(%rip)       <span style="color:#75715e">; demo.foo2 : demo.Foo + 4
</span><span style="color:#75715e"></span>    <span style="color:#ae81ff">0x100000b5b</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">219</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">leaq</span>   -<span style="color:#ae81ff">0x48</span>(%rbp), %rdi
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000b5f</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">223</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">callq</span>  <span style="color:#ae81ff">0x100000e48</span>               <span style="color:#75715e">; symbol stub for: swift_endAccess
</span><span style="color:#75715e"></span>    <span style="color:#ae81ff">0x100000b64</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">228</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">xorl</span>   %eax, %eax
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000b66</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">230</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">addq</span>   <span style="color:#66d9ef">$0x60</span>, %rsp
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000b6a</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">234</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">popq</span>   %rbp
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000b6b</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">235</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">retq</span>

<span style="color:#75715e">; 将断点加在 `0x100000a9f &lt;+31&gt;: callq 0x100000c00` 一行，并执行 `si`，进入函数内部；
</span><span style="color:#75715e">; 因为 `init` 函数是结构体本身的函数，与结构体变量所在的内存区域无关，因此这部分的汇编与之前完全相同。
</span><span style="color:#75715e"></span><span style="color:#a6e22e">demo</span><span style="color:#960050;background-color:#1e0010">`</span><span style="color:#66d9ef">Foo.init</span>(<span style="color:#66d9ef">a</span>:<span style="color:#66d9ef">b</span>:):
<span style="color:#960050;background-color:#1e0010">-&gt;</span>  <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000c00</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">0</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">pushq</span>  %rbp
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000c01</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">1</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movq</span>   %rsp, %rbp
    <span style="color:#75715e">; 将参数放在函数内部的栈空间：
</span><span style="color:#75715e"></span>    <span style="color:#75715e">; 将 rdi 寄存器内容（10）移动到 rax 寄存器
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000c04</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">4</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movq</span>   %rdi, %rax
    <span style="color:#75715e">; 将 rsi 寄存器内容（11）移动到 rdx 寄存器
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000c07</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">7</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movq</span>   %rsi, %rdx
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000c0a</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">10</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">popq</span>   %rbp
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000c0b</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">11</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">retq</span>
</code></pre></div><p>与刚才在函数体内的栈区不同的是，全局区（数据段）大量使用了 <code>rip</code> 寄存器。<code>rip</code> 作为指令指针寄存器，存储着 CPU 下一条要执行的指令的地址，一旦 CPU 读取一条指令，<code>rip</code> 会自动指向下一条指令。而代码一旦装载，每条指令的地址就会得以确认，因此通常使用 <code>rip</code> 加偏移的地址来存放全局变量。</p>
<h3 id="class">class</h3>
<h4 id="栈区-1">栈区</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-swift" data-lang="swift"><span style="color:#75715e">// main.swift</span>

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Foo</span> {
    <span style="color:#66d9ef">var</span> a: Int
    <span style="color:#66d9ef">var</span> b: Int

    <span style="color:#66d9ef">init</span>(a: Int, b: Int) {
        <span style="color:#66d9ef">self</span>.a = a
        <span style="color:#66d9ef">self</span>.b = b
    }
}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">bar</span>() {
    <span style="color:#66d9ef">var</span> foo1 = Foo(a: <span style="color:#ae81ff">10</span>, b: <span style="color:#ae81ff">11</span>)
    <span style="color:#66d9ef">var</span> foo2 = foo1 <span style="color:#75715e">// BREAKPOINT 🔴</span>

    foo2.a = <span style="color:#ae81ff">20</span>
    foo2.b = <span style="color:#ae81ff">22</span>
}

bar()
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-asm" data-lang="asm"><span style="color:#a6e22e">demo</span><span style="color:#960050;background-color:#1e0010">`</span><span style="color:#66d9ef">bar</span>():
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001cc0</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">0</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:   <span style="color:#66d9ef">pushq</span>  %rbp
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001cc1</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">1</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:   <span style="color:#66d9ef">movq</span>   %rsp, %rbp
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001cc4</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">4</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:   <span style="color:#66d9ef">pushq</span>  %r13
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001cc6</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">6</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:   <span style="color:#66d9ef">subq</span>   <span style="color:#66d9ef">$0x38</span>, %rsp
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001cca</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">10</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movq</span>   <span style="color:#66d9ef">$0x0</span>, -<span style="color:#ae81ff">0x10</span>(%rbp)
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001cd2</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">18</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movq</span>   <span style="color:#66d9ef">$0x0</span>, -<span style="color:#ae81ff">0x18</span>(%rbp)
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001cda</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">26</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">xorl</span>   %eax, %eax
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001cdc</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">28</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movl</span>   %eax, %edi
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001cde</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">30</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">callq</span>  <span style="color:#ae81ff">0x100001d90</span>               <span style="color:#75715e">; type metadata accessor for demo.Foo at &lt;compiler-generated&gt;
</span><span style="color:#75715e"></span>    <span style="color:#75715e">; 函数调用前要先传递参数：
</span><span style="color:#75715e"></span>    <span style="color:#75715e">; 将立即数 10 移动到 edi 寄存器（即 rdi 寄存器低 32 位）
</span><span style="color:#75715e"></span>    <span style="color:#ae81ff">0x100001ce3</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">35</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movl</span>   <span style="color:#66d9ef">$0xa</span>, %edi
    <span style="color:#75715e">; 将立即数 11 移动到 esi 寄存器（即 rsi 寄存器低 32 位）
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001ce8</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">40</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movl</span>   <span style="color:#66d9ef">$0xb</span>, %esi
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001ced</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">45</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movq</span>   %rax, %r13
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001cf0</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">48</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movq</span>   %rdx, -<span style="color:#ae81ff">0x20</span>(%rbp)
    <span style="color:#75715e">; 构造函数调用：
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001cf4</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">52</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">callq</span>  <span style="color:#ae81ff">0x100001b50</span>               <span style="color:#75715e">; demo.Foo.__allocating_init(a: Swift.Int, b: Swift.Int) -&gt; demo.Foo at main.swift:7
</span><span style="color:#75715e"></span>    <span style="color:#75715e">; rax 寄存器通常放置函数返回值（详见下文），这里即 foo1 指针所指向的堆空间内存地址
</span><span style="color:#75715e"></span>    <span style="color:#75715e">; (lldb) register read rax =&gt; rax = 0x000000010046d080
</span><span style="color:#75715e"></span>    <span style="color:#75715e">; (lldb) x --size 8 --format x --count 4 0x000000010046d080
</span><span style="color:#75715e"></span>    <span style="color:#75715e">; 0x10046d080: 0x0000000100003150 0x0000000000000002
</span><span style="color:#75715e"></span>    <span style="color:#75715e">; 0x10046d090: 0x000000000000000a 0x000000000000000b
</span><span style="color:#75715e"></span>    <span style="color:#75715e">; 此时可以尝试读取 foo1 的内存地址（指针本身的内存地址，位于栈空间）
</span><span style="color:#75715e"></span>    <span style="color:#75715e">; (lldb) po withUnsafeMutablePointer(to: &amp;foo1) { print(&#34;\($0)&#34;) } =&gt; 0x00007ffeefbff510
</span><span style="color:#75715e"></span>    <span style="color:#75715e">; (lldb) po withUnsafeMutablePointer(to: &amp;foo2) { print(&#34;\($0)&#34;) } =&gt; 0x00007ffeefbff508
</span><span style="color:#75715e"></span>    <span style="color:#ae81ff">0x100001cf9</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">57</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movq</span>   %rax, %rdi
    <span style="color:#75715e">; 将 rax 寄存器内容（0x000000010046d080）移动到 rbp - 0x28 地址
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001cfc</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">60</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movq</span>   %rax, -<span style="color:#ae81ff">0x28</span>(%rbp)
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001d00</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">64</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">callq</span>  <span style="color:#ae81ff">0x100001df6</span>               <span style="color:#75715e">; symbol stub for: swift_retain
</span><span style="color:#75715e"></span>    <span style="color:#75715e">; 将 rbp - 0x28 地址内容（0x000000010046d080）移动到 rcx 寄存器
</span><span style="color:#75715e"></span>    <span style="color:#ae81ff">0x100001d05</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">69</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movq</span>   -<span style="color:#ae81ff">0x28</span>(%rbp), %rcx
    <span style="color:#75715e">; (lldb) register read rbp =&gt; rbp = 0x00007ffeefbff520
</span><span style="color:#75715e"></span>    <span style="color:#75715e">; 将 rcx 寄存器内容（0x000000010046d080）移动到 rbp - 0x10 地址（0x7FFEEFBFF510，即 foo1）
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001d09</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">73</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movq</span>   %rcx, -<span style="color:#ae81ff">0x10</span>(%rbp)
    <span style="color:#75715e">; (lldb) x --size 8 --format x --count 4 0x7FFEEFBFF510
</span><span style="color:#75715e"></span>    <span style="color:#75715e">; 0x7ffeefbff510: 0x000000010046d080 0x0000000000000000
</span><span style="color:#75715e"></span>    <span style="color:#75715e">; 0x7ffeefbff520: 0x00007ffeefbff540 0x00000001000017a4
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">-&gt;</span>  <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001d0d</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">77</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movq</span>   %rcx, %rdi
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001d10</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">80</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movq</span>   %rax, -<span style="color:#ae81ff">0x30</span>(%rbp)
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001d14</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">84</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">callq</span>  <span style="color:#ae81ff">0x100001df6</span>               <span style="color:#75715e">; symbol stub for: swift_retain
</span><span style="color:#75715e"></span>    <span style="color:#ae81ff">0x100001d19</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">89</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movq</span>   -<span style="color:#ae81ff">0x28</span>(%rbp), %rdi
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001d1d</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">93</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movq</span>   %rax, -<span style="color:#ae81ff">0x38</span>(%rbp)
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001d21</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">97</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">callq</span>  <span style="color:#ae81ff">0x100001df6</span>               <span style="color:#75715e">; symbol stub for: swift_retain
</span><span style="color:#75715e"></span>    <span style="color:#75715e">; 将 rbp - 0x28 地址内容（0x000000010046d080）移动到 rcx 寄存器
</span><span style="color:#75715e"></span>    <span style="color:#ae81ff">0x100001d26</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">102</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">movq</span>   -<span style="color:#ae81ff">0x28</span>(%rbp), %rcx
    <span style="color:#75715e">; 将 rcx 寄存器内容（0x000000010046d080）移动到 rbp - 0x18 地址（0x7FFEEFBFF508，即 foo2）
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001d2a</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">106</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">movq</span>   %rcx, -<span style="color:#ae81ff">0x18</span>(%rbp)
    <span style="color:#75715e">; (lldb) x --size 8 --format x --count 4 0x7FFEEFBFF508
</span><span style="color:#75715e"></span>    <span style="color:#75715e">; 0x7ffeefbff508: 0x000000010046d080 0x000000010046d080
</span><span style="color:#75715e"></span>    <span style="color:#75715e">; 0x7ffeefbff518: 0x0000000000000000 0x00007ffeefbff540
</span><span style="color:#75715e"></span>    <span style="color:#75715e">; 因此此时，foo1 和 foo2 中存储了相同的内存地址
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001d2e</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">110</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">movq</span>   (%rcx), %rdx
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001d31</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">113</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">movq</span>   <span style="color:#ae81ff">0x68</span>(%rdx), %rdx
    <span style="color:#75715e">; 将立即数 20 移动到 edi 寄存器
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001d35</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">117</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">movl</span>   <span style="color:#66d9ef">$0x14</span>, %edi
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001d3a</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">122</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">movq</span>   %rcx, %r13
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001d3d</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">125</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">movq</span>   %rax, -<span style="color:#ae81ff">0x40</span>(%rbp)
    <span style="color:#75715e">; 见下文
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001d41</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">129</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">callq</span>  *%rdx
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001d43</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">131</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">movq</span>   -<span style="color:#ae81ff">0x28</span>(%rbp), %rdi
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001d47</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">135</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">callq</span>  <span style="color:#ae81ff">0x100001df0</span>               <span style="color:#75715e">; symbol stub for: swift_release
</span><span style="color:#75715e"></span>    <span style="color:#ae81ff">0x100001d4c</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">140</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">movq</span>   -<span style="color:#ae81ff">0x28</span>(%rbp), %rax
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001d50</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">144</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">movq</span>   (%rax), %rcx
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001d53</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">147</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">movq</span>   <span style="color:#ae81ff">0x80</span>(%rcx), %rcx
    <span style="color:#75715e">; 将立即数 22 移动到 edi 寄存器（同理）
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001d5a</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">154</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">movl</span>   <span style="color:#66d9ef">$0x16</span>, %edi
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001d5f</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">159</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">movq</span>   %rax, %r13
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001d62</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">162</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">callq</span>  *%rcx
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001d64</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">164</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">movq</span>   -<span style="color:#ae81ff">0x28</span>(%rbp), %rdi
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001d68</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">168</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">callq</span>  <span style="color:#ae81ff">0x100001df0</span>               <span style="color:#75715e">; symbol stub for: swift_release
</span><span style="color:#75715e"></span>    <span style="color:#ae81ff">0x100001d6d</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">173</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">movq</span>   -<span style="color:#ae81ff">0x18</span>(%rbp), %rdi
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001d71</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">177</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">callq</span>  <span style="color:#ae81ff">0x100001df0</span>               <span style="color:#75715e">; symbol stub for: swift_release
</span><span style="color:#75715e"></span>    <span style="color:#ae81ff">0x100001d76</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">182</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">movq</span>   -<span style="color:#ae81ff">0x10</span>(%rbp), %rdi
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001d7a</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">186</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">callq</span>  <span style="color:#ae81ff">0x100001df0</span>               <span style="color:#75715e">; symbol stub for: swift_release
</span><span style="color:#75715e"></span>    <span style="color:#ae81ff">0x100001d7f</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">191</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">addq</span>   <span style="color:#66d9ef">$0x38</span>, %rsp
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001d83</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">195</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">popq</span>   %r13
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001d85</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">197</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">popq</span>   %rbp
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001d86</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">198</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">retq</span>

<span style="color:#75715e">; 将断点加在 `0x100000a9f &lt;+31&gt;: callq 0x100000c00` 一行，并执行 `si`，进入函数内部：
</span><span style="color:#75715e"></span><span style="color:#a6e22e">demo</span><span style="color:#960050;background-color:#1e0010">`</span><span style="color:#66d9ef">Foo.__allocating_init</span>(<span style="color:#66d9ef">a</span>:<span style="color:#66d9ef">b</span>:):
<span style="color:#960050;background-color:#1e0010">-&gt;</span>  <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001b50</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">0</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">pushq</span>  %rbp
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001b51</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">1</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movq</span>   %rsp, %rbp
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001b54</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">4</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">pushq</span>  %r13
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001b56</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">6</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">subq</span>   <span style="color:#66d9ef">$0x18</span>, %rsp
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001b5a</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">10</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">movl</span>   <span style="color:#66d9ef">$0x20</span>, %eax
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001b5f</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">15</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">movl</span>   <span style="color:#66d9ef">$0x7</span>, %edx
    <span style="color:#75715e">; (lldb) register read rdi =&gt; rdi = 0x000000000000000a
</span><span style="color:#75715e"></span>    <span style="color:#75715e">; (lldb) register read rsi =&gt; rsi = 0x000000000000000b
</span><span style="color:#75715e"></span>    <span style="color:#75715e">; (lldb) register read rbp =&gt; rbp = 0x00007ffeefbff4d0
</span><span style="color:#75715e"></span>    <span style="color:#75715e">; 将 rdi 寄存器内容（10）移动到 rbp - 0x10 地址（0x7FFEEFBFF4C0）
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001b64</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">20</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">movq</span>   %rdi, -<span style="color:#ae81ff">0x10</span>(%rbp)
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001b68</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">24</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">movq</span>   %r13, %rdi
    <span style="color:#75715e">; 将 rsi 寄存器内容（11）移动到 rbp - 0x18 地址（0x7FFEEFBFF4B8）
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001b6b</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">27</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">movq</span>   %rsi, -<span style="color:#ae81ff">0x18</span>(%rbp)
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001b6f</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">31</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">movq</span>   %rax, %rsi
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001b72</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">34</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">callq</span>  <span style="color:#ae81ff">0x100001dd2</span>               <span style="color:#75715e">; symbol stub for: swift_allocObject
</span><span style="color:#75715e"></span>    <span style="color:#75715e">; 将 rbp - 0x10 地址内容（10）移动到 rdi
</span><span style="color:#75715e"></span>    <span style="color:#ae81ff">0x100001b77</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">39</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">movq</span>   -<span style="color:#ae81ff">0x10</span>(%rbp), %rdi
    <span style="color:#75715e">; 将 rbp - 0x18 地址内容（11）移动到 rsi
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001b7b</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">43</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">movq</span>   -<span style="color:#ae81ff">0x18</span>(%rbp), %rsi
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001b7f</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">47</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">movq</span>   %rax, %r13
    <span style="color:#75715e">; 构造函数调用：
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001b82</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">50</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">callq</span>  <span style="color:#ae81ff">0x100001b90</span>               <span style="color:#75715e">; demo.Foo.init(a: Swift.Int, b: Swift.Int) -&gt; demo.Foo at main.swift:7
</span><span style="color:#75715e"></span>    <span style="color:#ae81ff">0x100001b87</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">55</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">addq</span>   <span style="color:#66d9ef">$0x18</span>, %rsp
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001b8b</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">59</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">popq</span>   %r13
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001b8d</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">61</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">popq</span>   %rbp
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001b8e</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">62</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">retq</span>

<span style="color:#75715e">; 将断点加在 `0x100001b82 &lt;+50&gt;: callq  0x100001b90` 一行，并执行 `si`，进入函数内部：
</span><span style="color:#75715e"></span><span style="color:#a6e22e">demo</span><span style="color:#960050;background-color:#1e0010">`</span><span style="color:#66d9ef">Foo.init</span>(<span style="color:#66d9ef">a</span>:<span style="color:#66d9ef">b</span>:):
<span style="color:#960050;background-color:#1e0010">-&gt;</span>  <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001b90</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">0</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:   <span style="color:#66d9ef">pushq</span>  %rbp
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001b91</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">1</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:   <span style="color:#66d9ef">movq</span>   %rsp, %rbp
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001b94</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">4</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:   <span style="color:#66d9ef">subq</span>   <span style="color:#66d9ef">$0x80</span>, %rsp
    <span style="color:#75715e">; 清零：
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001b9b</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">11</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movq</span>   <span style="color:#66d9ef">$0x0</span>, -<span style="color:#ae81ff">0x8</span>(%rbp)
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001ba3</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">19</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movq</span>   <span style="color:#66d9ef">$0x0</span>, -<span style="color:#ae81ff">0x10</span>(%rbp)
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001bab</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">27</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movq</span>   <span style="color:#66d9ef">$0x0</span>, -<span style="color:#ae81ff">0x18</span>(%rbp)
    <span style="color:#75715e">; 参数局部变量化：
</span><span style="color:#75715e"></span>    <span style="color:#75715e">; 第一个参数 10 从 rdi 转移到 rbp - 0x8 地址
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001bb3</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">35</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movq</span>   %rdi, -<span style="color:#ae81ff">0x8</span>(%rbp)
    <span style="color:#75715e">; 第二个参数 11 从 rsi 转移到 rbp - 0x10 地址
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001bb7</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">39</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movq</span>   %rsi, -<span style="color:#ae81ff">0x10</span>(%rbp)
    <span style="color:#75715e">; ...
</span><span style="color:#75715e"></span>
<span style="color:#75715e">; 将断点加在 `0x100001d41 &lt;+129&gt;: callq  *%rdx` 一行，并执行 `si`，进入函数内部：
</span><span style="color:#75715e"></span><span style="color:#a6e22e">demo</span><span style="color:#960050;background-color:#1e0010">`</span><span style="color:#66d9ef">Foo.a.setter</span>:
<span style="color:#960050;background-color:#1e0010">-&gt;</span>  <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x1000018d0</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">0</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">pushq</span>  %rbp
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x1000018d1</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">1</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movq</span>   %rsp, %rbp
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x1000018d4</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">4</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">subq</span>   <span style="color:#66d9ef">$0x40</span>, %rsp
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x1000018d8</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">8</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movq</span>   %r13, %rax
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x1000018db</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">11</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">addq</span>   <span style="color:#66d9ef">$0x10</span>, %rax
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x1000018df</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">15</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">xorl</span>   %ecx, %ecx
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x1000018e1</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">17</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">leaq</span>   -<span style="color:#ae81ff">0x18</span>(%rbp), %rdx
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x1000018e5</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">21</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">movl</span>   <span style="color:#66d9ef">$0x21</span>, %esi
    <span style="color:#75715e">; (lldb) register read rdi =&gt; rdi = 0x0000000000000014
</span><span style="color:#75715e"></span>    <span style="color:#75715e">; (lldb) register read rbp =&gt; rbp = 0x00007ffeefbff4d0
</span><span style="color:#75715e"></span>    <span style="color:#75715e">; 将 rdi 寄存器内容（14）移动到 rbp - 0x20 地址
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x1000018ea</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">26</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">movq</span>   %rdi, -<span style="color:#ae81ff">0x20</span>(%rbp)
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x1000018ee</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">30</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">movq</span>   %rax, %rdi
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x1000018f1</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">33</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">movq</span>   %rsi, -<span style="color:#ae81ff">0x28</span>(%rbp)
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x1000018f5</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">37</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">movq</span>   %rdx, %rsi
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x1000018f8</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">40</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">movq</span>   -<span style="color:#ae81ff">0x28</span>(%rbp), %rax
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x1000018fc</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">44</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">movq</span>   %rdx, -<span style="color:#ae81ff">0x30</span>(%rbp)
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001900</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">48</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">movq</span>   %rax, %rdx
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001903</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">51</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">movq</span>   %r13, -<span style="color:#ae81ff">0x38</span>(%rbp)
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001907</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">55</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">callq</span>  <span style="color:#ae81ff">0x100001dd8</span>               <span style="color:#75715e">; symbol stub for: swift_beginAccess
</span><span style="color:#75715e"></span>    <span style="color:#75715e">; 将 rbp - 0x38 地址（0x7FFEEFBFF498）内容（0x000000010046d080，foo1 和 foo2 指向的内存空间地址）移动到 rax 寄存器
</span><span style="color:#75715e"></span>    <span style="color:#ae81ff">0x10000190c</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">60</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">movq</span>   -<span style="color:#ae81ff">0x38</span>(%rbp), %rax
    <span style="color:#75715e">; 将 rbp - 0x20 地址内容（14）移动到 rcx 寄存器
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001910</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">64</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">movq</span>   -<span style="color:#ae81ff">0x20</span>(%rbp), %rcx
    <span style="color:#75715e">; 将 rcx 寄存器内容（14）移动到 rax + 0x10（0x10046D090）
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001914</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">68</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">movq</span>   %rcx, <span style="color:#ae81ff">0x10</span>(%rax)
    <span style="color:#75715e">; (lldb) x --size 8 --format x --count 4 0x000000010046d080
</span><span style="color:#75715e"></span>    <span style="color:#75715e">; 0x10046d080: 0x0000000100003150 0x0000000600000002
</span><span style="color:#75715e"></span>    <span style="color:#75715e">; 0x10046d090: 0x0000000000000014 0x000000000000000b
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001918</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">72</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">movq</span>   -<span style="color:#ae81ff">0x30</span>(%rbp), %rdi
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x10000191c</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">76</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">callq</span>  <span style="color:#ae81ff">0x100001de4</span>               <span style="color:#75715e">; symbol stub for: swift_endAccess
</span><span style="color:#75715e"></span>    <span style="color:#ae81ff">0x100001921</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">81</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">addq</span>   <span style="color:#66d9ef">$0x40</span>, %rsp
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001925</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">85</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">popq</span>   %rbp
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100001926</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">86</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">retq</span>
</code></pre></div><p>当对象初始化后将通过 <code>rax</code> 返回给指针变量，再通过 <code>rax</code> 偏移去改变堆空间中的值，因此内存地址格式为：<code>0x10(%rax)</code> 的变量一般是堆空间。</p>
<h2 id="函数">函数</h2>
<h3 id="函数参数">函数参数</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-swift" data-lang="swift"><span style="color:#75715e">// main.swift</span>

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">baz</span>(<span style="color:#66d9ef">_</span> a: Int, <span style="color:#66d9ef">_</span> b: Int, <span style="color:#66d9ef">_</span> c: Int, <span style="color:#66d9ef">_</span> d: Int, <span style="color:#66d9ef">_</span> e: Int,
         <span style="color:#66d9ef">_</span> f: Int, <span style="color:#66d9ef">_</span> g: Int, <span style="color:#66d9ef">_</span> h: Int, <span style="color:#66d9ef">_</span> i: Int, <span style="color:#66d9ef">_</span> j: Int) {

}

baz(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">9</span>, <span style="color:#ae81ff">10</span>) <span style="color:#75715e">// BREAKPOINT 🔴</span>
</code></pre></div><p>定义一个需要 10 个参数的函数，我们尝试从汇编底层看一下这个过程：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-asm" data-lang="asm"><span style="color:#a6e22e">demo</span><span style="color:#960050;background-color:#1e0010">`</span><span style="color:#66d9ef">main</span>:
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000ea0</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">0</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:   <span style="color:#66d9ef">pushq</span>  %rbp
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000ea1</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">1</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:   <span style="color:#66d9ef">movq</span>   %rsp, %rbp
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000ea4</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">4</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:   <span style="color:#66d9ef">subq</span>   <span style="color:#66d9ef">$0x30</span>, %rsp
    <span style="color:#75715e">; 第一个参数先放在 eax（rax 的低 32 位）
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">-&gt;</span>  <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000ea8</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">8</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:   <span style="color:#66d9ef">movl</span>   <span style="color:#66d9ef">$0x1</span>, %eax
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000ead</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">13</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movl</span>   %edi, -<span style="color:#ae81ff">0x4</span>(%rbp)
    <span style="color:#75715e">; 第一个参数从 rax 转移到 rdi
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000eb0</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">16</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movq</span>   %rax, %rdi
    <span style="color:#75715e">; 第二个参数先放在 eax（rax 的低 32 位）
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000eb3</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">19</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movl</span>   <span style="color:#66d9ef">$0x2</span>, %eax
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000eb8</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">24</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movq</span>   %rsi, -<span style="color:#ae81ff">0x10</span>(%rbp)
    <span style="color:#75715e">; 第二个参数从 rax 转移到 rsi
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000ebc</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">28</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movq</span>   %rax, %rsi
    <span style="color:#75715e">; 第三个参数放在 edx（rdx 的低 32 位）
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000ebf</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">31</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movl</span>   <span style="color:#66d9ef">$0x3</span>, %edx
    <span style="color:#75715e">; 第四个参数放在 ecx（rcx 的低 32 位）
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000ec4</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">36</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movl</span>   <span style="color:#66d9ef">$0x4</span>, %ecx
    <span style="color:#75715e">; 第五个参数放在 r8d（r8 的低 32 位）
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000ec9</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">41</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movl</span>   <span style="color:#66d9ef">$0x5</span>, %r8d
    <span style="color:#75715e">; 第六个参数放在 r9d（r9 的低 32 位）
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000ecf</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">47</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movl</span>   <span style="color:#66d9ef">$0x6</span>, %r9d
    <span style="color:#75715e">; 第七个参数放在 rsp（(lldb) register read rsp =&gt; rsp = 0x00007ffeefbff510）
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000ed5</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">53</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movq</span>   <span style="color:#66d9ef">$0x7</span>, (%rsp)
    <span style="color:#75715e">; 第八个参数放在 rsp + 0x8 地址（0x7FFEEFBFF518）
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000edd</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">61</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movq</span>   <span style="color:#66d9ef">$0x8</span>, <span style="color:#ae81ff">0x8</span>(%rsp)
    <span style="color:#75715e">; 第九个参数放在 rsp + 0x10 地址（0x7FFEEFBFF520）
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000ee6</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">70</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movq</span>   <span style="color:#66d9ef">$0x9</span>, <span style="color:#ae81ff">0x10</span>(%rsp)
    <span style="color:#75715e">; 第十个参数放在 rsp + 0x18 地址（0x7FFEEFBFF528）
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000eef</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">79</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movq</span>   <span style="color:#66d9ef">$0xa</span>, <span style="color:#ae81ff">0x18</span>(%rsp)
    <span style="color:#75715e">; 函数调用
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000ef8</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">88</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">callq</span>  <span style="color:#ae81ff">0x100000f10</span>               <span style="color:#75715e">; demo.baz(Swift.Int, Swift.Int, Swift.Int, Swift.Int, Swift.Int, Swift.Int, Swift.Int, Swift.Int, Swift.Int, Swift.Int) -&gt; () at main.swift:1
</span><span style="color:#75715e"></span>    <span style="color:#ae81ff">0x100000efd</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">93</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">xorl</span>   %eax, %eax
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000eff</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">95</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">addq</span>   <span style="color:#66d9ef">$0x30</span>, %rsp
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000f03</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">99</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">popq</span>   %rbp
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000f04</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">100</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">retq</span>
</code></pre></div><p>由上我们可以得出：<code>rdi</code>（<code>edi</code>）、<code>rsi</code>（<code>esi</code>）、<code>rdx</code>（<code>edx</code>）、<code>rcx</code>（<code>ecx</code>）、<code>r8</code>（<code>r8d</code>）、<code>r9</code>（<code>r9d</code>）寄存器将依次存放函数参数，当以上寄存器个数仍不满足函数参数个数时，将从 <code>rsp</code> 开始放置函数参（其实 <code>rsp</code> 是函数栈空间的栈底，详见下文）。将断点加在 <code>0x100000ef8 &lt;+88&gt;: callq 0x100000f10</code> 一行，并执行 <code>si</code>，进入函数内部：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-asm" data-lang="asm"><span style="color:#a6e22e">demo</span><span style="color:#960050;background-color:#1e0010">`</span><span style="color:#66d9ef">baz</span>(<span style="color:#66d9ef">_</span>:<span style="color:#66d9ef">_</span>:<span style="color:#66d9ef">_</span>:<span style="color:#66d9ef">_</span>:<span style="color:#66d9ef">_</span>:<span style="color:#66d9ef">_</span>:<span style="color:#66d9ef">_</span>:<span style="color:#66d9ef">_</span>:<span style="color:#66d9ef">_</span>:<span style="color:#66d9ef">_</span>:):
    <span style="color:#75715e">; 调用帧入栈
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">-&gt;</span>  <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000f10</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">0</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:   <span style="color:#66d9ef">pushq</span>  %rbp
    <span style="color:#75715e">; 切换栈帧到当前栈帧
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000f11</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">1</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:   <span style="color:#66d9ef">movq</span>   %rsp, %rbp
    <span style="color:#75715e">; (lldb) register read rbp =&gt; rbp = 0x00007ffeefbff500
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000f14</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">4</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:   <span style="color:#66d9ef">pushq</span>  %rbx
    <span style="color:#75715e">; (lldb) register read rsp =&gt; rsp = 0x00007ffeefbff4f8
</span><span style="color:#75715e"></span>    <span style="color:#75715e">; rbp + 0x28（0x7FFEEFBFF528，即第十个参数 10）转移到 rax
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000f15</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">5</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:   <span style="color:#66d9ef">movq</span>   <span style="color:#ae81ff">0x28</span>(%rbp), %rax
    <span style="color:#75715e">; rbp + 0x20（0x7FFEEFBFF520，即第九个参数 9）转移到 r10
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000f19</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">9</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:   <span style="color:#66d9ef">movq</span>   <span style="color:#ae81ff">0x20</span>(%rbp), %r10
    <span style="color:#75715e">; rbp + 0x18（0x7FFEEFBFF518，即第八个参数 8）转移到 r11
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000f1d</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">13</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movq</span>   <span style="color:#ae81ff">0x18</span>(%rbp), %r11
    <span style="color:#75715e">; rbp + 0x10（0x7FFEEFBFF510，即第七个参数 7）转移到 rbx
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000f21</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">17</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movq</span>   <span style="color:#ae81ff">0x10</span>(%rbp), %rbx
    <span style="color:#75715e">; 清零：
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000f25</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">21</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movq</span>   <span style="color:#66d9ef">$0x0</span>, -<span style="color:#ae81ff">0x10</span>(%rbp)
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000f2d</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">29</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movq</span>   <span style="color:#66d9ef">$0x0</span>, -<span style="color:#ae81ff">0x18</span>(%rbp)
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000f35</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">37</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movq</span>   <span style="color:#66d9ef">$0x0</span>, -<span style="color:#ae81ff">0x20</span>(%rbp)
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000f3d</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">45</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movq</span>   <span style="color:#66d9ef">$0x0</span>, -<span style="color:#ae81ff">0x28</span>(%rbp)
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000f45</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">53</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movq</span>   <span style="color:#66d9ef">$0x0</span>, -<span style="color:#ae81ff">0x30</span>(%rbp)
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000f4d</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">61</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movq</span>   <span style="color:#66d9ef">$0x0</span>, -<span style="color:#ae81ff">0x38</span>(%rbp)
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000f55</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">69</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movq</span>   <span style="color:#66d9ef">$0x0</span>, -<span style="color:#ae81ff">0x40</span>(%rbp)
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000f5d</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">77</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movq</span>   <span style="color:#66d9ef">$0x0</span>, -<span style="color:#ae81ff">0x48</span>(%rbp)
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000f65</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">85</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movq</span>   <span style="color:#66d9ef">$0x0</span>, -<span style="color:#ae81ff">0x50</span>(%rbp)
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000f6d</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">93</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movq</span>   <span style="color:#66d9ef">$0x0</span>, -<span style="color:#ae81ff">0x58</span>(%rbp)
    <span style="color:#75715e">; 参数局部变量化：
</span><span style="color:#75715e"></span>    <span style="color:#75715e">; 第一个参数从 rdi 转移到 rbp - 0x10 地址（0x7FFEEFBFF4F0，高地址）
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000f75</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">101</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">movq</span>   %rdi, -<span style="color:#ae81ff">0x10</span>(%rbp)
    <span style="color:#75715e">; 第二个参数从 rsi 转移到 rbp - 0x18 地址（0x7FFEEFBFF4E8）
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000f79</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">105</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">movq</span>   %rsi, -<span style="color:#ae81ff">0x18</span>(%rbp)
    <span style="color:#75715e">; 第三个参数从 rdx 转移到 rbp - 0x20 地址（0x7FFEEFBFF4E0）
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000f7d</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">109</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">movq</span>   %rdx, -<span style="color:#ae81ff">0x20</span>(%rbp)
    <span style="color:#75715e">; 第四个参数从 rcx 转移到 rbp - 0x28 地址（0x7FFEEFBFF4D8）
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000f81</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">113</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">movq</span>   %rcx, -<span style="color:#ae81ff">0x28</span>(%rbp)
    <span style="color:#75715e">; 第五个参数从 r8 转移到 rbp - 0x30 地址（0x7FFEEFBFF4D0）
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000f85</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">117</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">movq</span>   %r8, -<span style="color:#ae81ff">0x30</span>(%rbp)
    <span style="color:#75715e">; 第六个参数从 r9 转移到 rbp - 0x38 地址（0x7FFEEFBFF4C8）
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000f89</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">121</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">movq</span>   %r9, -<span style="color:#ae81ff">0x38</span>(%rbp)
    <span style="color:#75715e">; 第七个参数从 rbx 转移到 rbp - 0x40 地址（0x7FFEEFBFF4C0）
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000f8d</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">125</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">movq</span>   %rbx, -<span style="color:#ae81ff">0x40</span>(%rbp)
    <span style="color:#75715e">; 第八个参数从 r11 转移到 rbp - 0x48 地址（0x7FFEEFBFF4B8）
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000f91</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">129</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">movq</span>   %r11, -<span style="color:#ae81ff">0x48</span>(%rbp)
    <span style="color:#75715e">; 第九个参数从 r10 转移到 rbp - 0x50 地址（0x7FFEEFBFF4B0）
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000f95</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">133</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">movq</span>   %r10, -<span style="color:#ae81ff">0x50</span>(%rbp)
    <span style="color:#75715e">; 第十个参数从 rax 转移到 rbp - 0x58 地址（0x7FFEEFBFF4A8，低地址）
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000f99</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">137</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">movq</span>   %rax, -<span style="color:#ae81ff">0x58</span>(%rbp)
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000f9d</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">141</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">popq</span>   %rbx
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000f9e</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">142</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">popq</span>   %rbp
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000f9f</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">143</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">retq</span>
</code></pre></div><p><code>rbp</code>（<code>(lldb) register read rbp =&gt; rbp = 0x00007ffeefbff500</code>，高地址，栈底）与 <code>rsp</code>（<code>(lldb) register read rsp =&gt; rsp = 0x00007ffeefbff4f8</code>，低地址，栈顶）寄存器之间为函数的栈空间，即栈帧。函数参数局部变量化时，将依次从高地址排列至低地址，即入栈。</p>
<h3 id="函数返回值">函数返回值</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-swift" data-lang="swift"><span style="color:#75715e">// main.swift</span>

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">baz</span>() -&gt; Int {
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">10</span>
}

<span style="color:#66d9ef">_</span> = baz()
</code></pre></div><p>定义一个需要返回值的函数，我们尝试从汇编底层看一下这个过程：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-asm" data-lang="asm"><span style="color:#a6e22e">demo</span><span style="color:#960050;background-color:#1e0010">`</span><span style="color:#66d9ef">baz</span>():
<span style="color:#960050;background-color:#1e0010">-&gt;</span>  <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000fa0</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">0</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">pushq</span>  %rbp
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000fa1</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">1</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movq</span>   %rsp, %rbp
    <span style="color:#75715e">; 将立即数 10 移动到 eax 寄存器（即 rax 寄存器低 32 位）
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000fa4</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">4</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movl</span>   <span style="color:#66d9ef">$0xa</span>, %eax
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000fa9</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">9</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">popq</span>   %rbp
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000faa</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">10</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">retq</span>
</code></pre></div><p>此时返回值将移动到 <code>rax</code> 寄存器供函数外部使用。通常来说，一个函数只有一个返回值，但 Swift 中支持元组类型，可以将多个元素同时返回，那么此时返回值存在哪里呢？</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-swift" data-lang="swift"><span style="color:#75715e">// main.swift</span>

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">baz</span>() -&gt; (Int, Int, Int, Int, Int) {
    <span style="color:#66d9ef">return</span> (<span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">11</span>, <span style="color:#ae81ff">12</span>, <span style="color:#ae81ff">13</span>, <span style="color:#ae81ff">14</span>)
}

<span style="color:#66d9ef">var</span> t = baz()
<span style="color:#66d9ef">var</span> a = t.<span style="color:#ae81ff">0</span>
<span style="color:#66d9ef">var</span> b = t.<span style="color:#ae81ff">1</span>
<span style="color:#66d9ef">var</span> c = t.<span style="color:#ae81ff">2</span>
<span style="color:#66d9ef">var</span> d = t.<span style="color:#ae81ff">3</span>
<span style="color:#66d9ef">var</span> e = t.<span style="color:#ae81ff">4</span>
</code></pre></div><p>转换为汇编代码：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-asm" data-lang="asm"><span style="color:#a6e22e">demo</span><span style="color:#960050;background-color:#1e0010">`</span><span style="color:#66d9ef">baz</span>():
<span style="color:#960050;background-color:#1e0010">-&gt;</span>  <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000f50</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">0</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">pushq</span>  %rbp
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000f51</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">1</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movq</span>   %rsp, %rbp
    <span style="color:#75715e">; 返回值元组第一个元素放在 rax
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000f54</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">4</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movq</span>   <span style="color:#66d9ef">$0xa</span>, (%rax)
    <span style="color:#75715e">; 返回值元组第二个元素放在 rax + 0x8
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000f5b</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">11</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">movq</span>   <span style="color:#66d9ef">$0xb</span>, <span style="color:#ae81ff">0x8</span>(%rax)
    <span style="color:#75715e">; 返回值元组第三个元素放在 rax + 0x10
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000f63</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">19</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">movq</span>   <span style="color:#66d9ef">$0xc</span>, <span style="color:#ae81ff">0x10</span>(%rax)
    <span style="color:#75715e">; 返回值元组第四个元素放在 rax + 0x18
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000f6b</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">27</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">movq</span>   <span style="color:#66d9ef">$0xd</span>, <span style="color:#ae81ff">0x18</span>(%rax)
    <span style="color:#75715e">; 返回值元组第五个元素放在 rax + 0x20
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000f73</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">35</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">movq</span>   <span style="color:#66d9ef">$0xe</span>, <span style="color:#ae81ff">0x20</span>(%rax)
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000f7b</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">43</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">popq</span>   %rbp
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000f7c</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">44</span><span style="color:#960050;background-color:#1e0010">&gt;</span>: <span style="color:#66d9ef">retq</span>

<span style="color:#a6e22e">demo</span><span style="color:#960050;background-color:#1e0010">`</span><span style="color:#66d9ef">main</span>:
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000dd0</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">0</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:   <span style="color:#66d9ef">pushq</span>  %rbp
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000dd1</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">1</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:   <span style="color:#66d9ef">movq</span>   %rsp, %rbp
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000dd4</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">4</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:   <span style="color:#66d9ef">subq</span>   <span style="color:#66d9ef">$0xb0</span>, %rsp
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000ddb</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">11</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">leaq</span>   -<span style="color:#ae81ff">0x28</span>(%rbp), %rax
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000ddf</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">15</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movl</span>   %edi, -<span style="color:#ae81ff">0xa4</span>(%rbp)
    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000de5</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">21</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movq</span>   %rsi, -<span style="color:#ae81ff">0xb0</span>(%rbp)
<span style="color:#960050;background-color:#1e0010">-&gt;</span>  <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000dec</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">28</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">callq</span>  <span style="color:#ae81ff">0x100000f50</span>               <span style="color:#75715e">; demo.baz() -&gt; (Swift.Int, Swift.Int, Swift.Int, Swift.Int, Swift.Int) at main.swift:3
</span><span style="color:#75715e"></span>    <span style="color:#75715e">; (lldb) register read rax =&gt; rax = 0x00007ffeefbff518
</span><span style="color:#75715e"></span>    <span style="color:#75715e">; (lldb) x --size 8 --format x --count 6 0x00007ffeefbff518
</span><span style="color:#75715e"></span>    <span style="color:#75715e">; 0x7ffeefbff518: 0x000000000000000a 0x000000000000000b
</span><span style="color:#75715e"></span>    <span style="color:#75715e">; 0x7ffeefbff528: 0x000000000000000c 0x000000000000000d
</span><span style="color:#75715e"></span>    <span style="color:#75715e">; 0x7ffeefbff538: 0x000000000000000e 0x00007ffeefbff550
</span><span style="color:#75715e"></span>    <span style="color:#ae81ff">0x100000df1</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">33</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">leaq</span>   <span style="color:#ae81ff">0x1220</span>(%rip), %rax        <span style="color:#75715e">; demo.t : (Swift.Int, Swift.Int, Swift.Int, Swift.Int, Swift.Int)
</span><span style="color:#75715e"></span>    <span style="color:#ae81ff">0x100000df8</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">40</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">xorl</span>   %ecx, %ecx
    <span style="color:#75715e">; (lldb) register read rbp =&gt; rbp = 0x00007ffeefbff540
</span><span style="color:#75715e"></span>    <span style="color:#75715e">; 将 rbp - 0x28 地址（0x7FFEEFBFF518）内容（10）移动到 rdx
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000dfa</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">42</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movq</span>   -<span style="color:#ae81ff">0x28</span>(%rbp), %rdx
    <span style="color:#75715e">; 将 rbp - 0x20 地址（0x7FFEEFBFF518）内容（11）移动到 rsi
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000dfe</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">46</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movq</span>   -<span style="color:#ae81ff">0x20</span>(%rbp), %rsi
    <span style="color:#75715e">; 将 rbp - 0x18 地址（0x7FFEEFBFF518）内容（12）移动到 r8
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000e02</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">50</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movq</span>   -<span style="color:#ae81ff">0x18</span>(%rbp), %r8
    <span style="color:#75715e">; 将 rbp - 0x10 地址（0x7FFEEFBFF518）内容（13）移动到 r9
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000e06</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">54</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movq</span>   -<span style="color:#ae81ff">0x10</span>(%rbp), %r9
    <span style="color:#75715e">; 将 rbp - 0x8 地址（0x7FFEEFBFF518）内容（14）移动到 r10
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x100000e0a</span> <span style="color:#960050;background-color:#1e0010">&lt;+</span><span style="color:#ae81ff">58</span><span style="color:#960050;background-color:#1e0010">&gt;</span>:  <span style="color:#66d9ef">movq</span>   -<span style="color:#ae81ff">0x8</span>(%rbp), %r10
    <span style="color:#75715e">; ...
</span></code></pre></div><p>我们可以看出，当元组作为返回值时，将从 <code>rax</code> 开始偏移依次存放。</p>
<!--

- 寄存器：
  - 16 个常用寄存器：
    - `rax`、`rbx`、`rcx`、`rdx`、`rsi`、`rdi`、`rbp`、`rsp`
    - `r8`、`r9`、`r10`、`r11`、`r12`、`r13`、`r14`、`r15`
    - `r` 开头的寄存器均为 64 位(8 字节）寄存器，`e` 开头为 32 位，`ax`、`bx`、`cx` 为 16 位，`ah`、`al` 为 8 位。
  - 用途
    - `rax`、`rdx` 常作为函数返回值使用
  - 结构体和对象等均存储在内存（非寄存器）



## 汇编语言

- 汇编语言分类：
  - 8086 汇编（16 位（Bit），即每个寄存器的大小为 16 位，2 字节）
  - x86 汇编（32 位）
  - x64 汇编（64 位）
  - ARM 汇编等
- AT&T 汇编用于 iOS 模拟器，ARM 汇编用于 iOS 真机

|    项目     |                                AT&T                                 |                           Intel                           |                                                                                                                   说明                                                                                                                   |
| :---------: | :-----------------------------------------------------------------: | :-------------------------------------------------------: | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------: |
| 寄存器命名  |                               `%rax`                                |                           `rax`                           |                                                                                                                    -                                                                                                                     |
| 操作数顺序  |                          `movq %rax, %rdx`                          |                      `mov rdx, rax`                       |                                                                                                        将 `rax` 的值赋值给 `rdx`                                                                                                         |
| 常数/立即数 |                `movq $3, %rax`<br>`movq $0x10, %rax`                |              `mov rax, 3`<br>`mov rax, 0x10`              |                                                                                                将 `3` 赋值给 `rax` 将 `0x10` 赋值给 `rax`                                                                                                |
|  内存赋值   |                      `movq $0xa, 0x1ff7(%rip)`                      |             `mov qword ptr [rip+0x1ff7], 0xa`             |                                                                                            将 `0xa` 赋值给地址为 `rip` + `0x1ff7` 的内存空间                                                                                             |
| 取内存地址  |                      `leaq -0x18(%rbp), %rax`                       |                  `lea rax, [rbp – 0x18]`                  |                                                                                                  将 `rbp – 0x18` 这个地址值赋值给 `rax`                                                                                                  |
| `jmp` 指令  | `jmp *%rdx`<br>`jmp 0x4001002`<br>`jmp *(%rax)`（`*` 代表间接跳转） |        `jmp rdx`<br>`jmp 0x4001002`<br>`jmp [rax]`        |                                                                                  `call` 和 `jmp` 写法类似（`call` 后通常为函数地址，可配合 `ret` 使用）                                                                                  |
| 操作数长度  |   `movl %eax, %edx`<br>`movb $0x10, %al`<br>`leaw 0x10(%dx), %ax`   | `mov edx, eax`<br>`mov al, 0x10`<br>`lea ax, [dx + 0x10]` | **b** = byte (8-bit)<br>**s** = short (16-bit integer or 32-bit floating point)<br>**w** = word (16-bit)<br>**l** = long (32-bit integer or 64-bit floating point)<br>**q** = quad (64 bit)<br>**t** = ten bytes (80-bit floating point) |

- `movq -0x18(%rbp), %rax` & `leaq -0x18(%rbp), %rax` 的区别：
  - 前者为将 `%rbp - 0x18` 得到的地址对应存储空间的数据，存储到 `rax` 寄存器；
  - 后者为将 `%rbp - 0x18` 得到的地址，存储到 `rax` 寄存器。
- `call 0x10`：跳转至 `0x10` 函数地址处；
- `call *%rax`：跳转至 `rax` 寄存器存储的函数地址处。

## LLDB

|            操作            |                                            指令                                             |
| :------------------------: | :-----------------------------------------------------------------------------------------: |
|       列出所有寄存器       |                                       `register read`                                       |
|       读取寄存器的值       |                  `register read/格式 寄存器名称`<br>`register read/x rax`                   |
|       修改寄存器的值       |                 `register write 寄存器名称 数值`<br>`register write rax 0`                  |
|       读取内存中的值       |                    `x/数量-格式-字节大小 内存地址`<br>`x/3xw 0x0000010`                     |
|       修改内存中的值       |                 `memory write 内存地址 数值`<br>`memory write 0x0000010 10`                 |
|            格式            |                          `x` 是十六进制，`f` 是浮点，`d` 是十进制                           |
|          字节大小          | `b` – byte 1 字节<br>`h` – half word 2 字节<br>`w` – word 4 字节<br>`g` – giant word 8 字节 |
|     expression 表达式      |           可以简写为：`expr 表达式`<br>`expression $rax`<br>`expression $rax = 1`           |
| `po` 表达式 `print` 表达式 |                                `po/x $rax`<br>`po (int)$rax`                                |

```swift
func foo() {
    let a = 10
    let b = a + 1

    print(b) // BREAKPOINT ⚠️
}

foo()

// LLDB:
//    (lldb) register read // 读取所有寄存器
//    General Purpose Registers:
//           rax = 0x000000010313e1d0
//           rbx = 0x000000010313e1d0
//           rcx = 0x0000000000000000
//           rdx = 0x0000000000000004
//           rdi = 0x00000000000003e3
//           rsi = 0x000000010045d080
//           rbp = 0x00007ffeefbff4c0
//           rsp = 0x00007ffeefbff4b0
//            r8 = 0x0000000010313e1e
//            r9 = 0x0000000010313e21
//           r10 = 0x00000000fffffffe
//           r11 = 0x0000000000000000
//           r12 = 0x0000000000000000
//           r13 = 0x0000000000000000
//           r14 = 0x0000000000000000
//           r15 = 0x0000000000000000
//           rip = 0x0000000100000a59  demo`main + 41 [inlined] demo.foo() -> () + 37 at main.swift:8
//      demo`main + 4 at main.swift:8
//        rflags = 0x0000000000000202
//            cs = 0x000000000000002b
//            fs = 0x0000000000000000
//            gs = 0x0000000000000000
//
//    (lldb) register read rax // 读取 rax 寄存器
//         rax = 0x000000010313e1d0
//    (lldb) register read/x rax // 以十六进制读取 rax 寄存器
//         rax = 0x000000010313e1d0
//    (lldb) register write rax 10 // 写入 rax 寄存器 10
//    (lldb) register read/d rax // 以十进制读取 rax 寄存器
//         rax = 10
//    (lldb) x 0x000000010313e1d0 // 读取内存的值
//    0x10313e1d0: 60 52 a3 93 ff 7f 00 00 02 00 00 00 00 00 00 00  `R..............
//    0x10313e1e0: 01 00 00 00 00 00 00 00 02 00 00 00 00 00 00 00  ................
//    (lldb) x/3xw 0x000000010313e1d0 // 以一个字（4 字节）读取，读取三段，十六进制表示
//    0x10313e1d0: 0x93a35260 0x00007fff 0x00000002
//    (lldb) x/4xg 0x000000010313e1d0  // 以 8 字节读取，读取四段，十六进制表示
//    0x10313e1d0: 0x00007fff93a35260 0x0000000000000002
//    0x10313e1e0: 0x0000000000000001 0x0000000000000002
```

|                  指令                  |                               解释                               |
| :------------------------------------: | :--------------------------------------------------------------: |
|    `thread step-over`、`next`、`n`     |          单步运⾏，把子函数当做整体⼀步执行（源码级别）          |
|     `thread step-in`、`step`、`s`      |           单步运行，遇到子函数会进⼊子函数（源码级别）           |
| `thread step-inst-over`、`nexti`、`ni` |          单步运行，把子函数当做整体⼀步执⾏（汇编级别）          |
|   `thread step-inst`、`stepi`、`si`    |           单步运行，遇到子函数会进入子函数（汇编级别）           |
|      `thread step-out`、`finish`       | 直接执行完当前函数的所有代码，返回到上一个函数（遇到断点会卡住） |



## enum & switch-case

 -->
<h2 id="reference">Reference</h2>
<ul>
<li><a href="https://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/x64-architecture?view=drivers-server-ver15">x64 Architecture - Microsoft</a></li>
</ul>

    </div>
    
      <div class="pagination">
        <div class="pagination__title">
          <span class="pagination__title-h">Read other posts</span>
          <hr />
        </div>
        <div class="pagination__buttons">
          
          
            <span class="button next">
              <a href="/posts/2020/swift_struct_and_class/">
                <span class="button__text">Swift 拾遗 - struct &amp; class</span>
                <span class="button__icon">→</span>
              </a>
            </span>
          
        </div>
      </div>
    

    

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<table style="border: 0;">
  <tr>
  <td style="border: 0; width: 30%;">
    <img src='/img/about/1.jpg'>
  </td>
  <td style="border: 0;">
    <ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-9925978992661955"
     data-ad-slot="3213735320"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
  </td>
  </tr>
</table>



<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>


    
    
    <div>
      <div id="github-comment">
      </div>

      <script type="text/javascript">
        function getUtterances(isDark) {
          var utterances = document.createElement('script');
          utterances.type = 'text/javascript';
          utterances.async = true;
          utterances.setAttribute('issue-term', "pathname")
          utterances.setAttribute('repo', "kingcos\/kingcos.github.io")
          utterances.setAttribute('label', "comments")
          isDark ? utterances.setAttribute('theme', "github-dark") : utterances.setAttribute('theme', "github-light")
          utterances.crossorigin = 'anonymous';
          utterances.src = 'https://utteranc.es/client.js';

          return utterances
        }

        var themeToggle = document.querySelector(".theme-toggle")
        themeToggle.addEventListener("click", function () {
          var getTheme = window.localStorage && window.localStorage.getItem("theme")
          var divNode = document.getElementById('github-comment')
          while(divNode.hasChildNodes()) {
            divNode.removeChild(divNode.firstChild);
          }
          
          
          

          
          
          
          
          
          
          document.getElementById('github-comment').appendChild(getUtterances(getTheme !== "dark"))
        })

        var getTheme = window.localStorage && window.localStorage.getItem("theme")
        document.getElementById('github-comment').appendChild(getUtterances(getTheme === "dark"))
      </script>
    </div>
    

    </div>

      </div>

      
        <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright copyright--user">All rights reserved by kingcos.me</div>
    
  </div>
</footer>

<script src="/assets/main.js"></script>
<script src="/assets/prism.js"></script>



      
    </div>

    
      
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-138311951-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

    
  </body>
</html>
