<!DOCTYPE html>
<html lang="en">
  <head>
    
      <title>Obj-C 中的 Boolean :: iBlog</title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content="Date Notes     2020-06-02 首次提交   2020-06-16 增加「逻辑表达式」一节    Preface Boolean，即布尔值，通常用来表明逻辑中的真或假。但在 Obj-C 中，我们似乎既可以使用 BOOL 又可以使用 bool，既可以使用 YES/NO 又可以使用 true/false，那么它们到底有何不同呢？
 ⚠️ 注意：
为了避免读者（和笔者）记混，这里简单说明下 #define 与 typedef 的异同：#define A B 意为将已存在的 B 定义为 A，A 与 B 等价；typedef C D 意为将已存在的 C 定义为 D，C 与 D 等价；后者通常用于类型定义。
 _Bool 与 bool // iOS - stdbool.h  /*===---- stdbool.h - Standard header for booleans -------------------------=== * * Part of the LLVM Project, under the Apache License v2."/>
<meta name="keywords" content="kingcos.me,maimieng.comios,swift,objective-c,obj-c,objc,oc,geek,python,ruby,golang,go,apple,mac"/>
<meta name="robots" content="noodp"/>
<link rel="canonical" href="/posts/2020/booleans_in_objc/" />





<link rel="stylesheet" href="/assets/style.css">


<link rel="stylesheet" href="/style.css">


<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/img/apple-touch-icon-144-precomposed.png">
<link rel="shortcut icon" href="/img/favicon.png">


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Obj-C 中的 Boolean"/>
<meta name="twitter:description" content="Boolean，即布尔值，通常用来表明逻辑中的真或假。但在 Obj-C 中，我们似乎既可以使用 `BOOL` 又可以使用 `bool`，既可以使用 `YES`/`NO` 又可以使用 `true`/`false`，那么它们到底有何不同呢？"/>



<meta property="og:title" content="Obj-C 中的 Boolean" />
<meta property="og:description" content="Boolean，即布尔值，通常用来表明逻辑中的真或假。但在 Obj-C 中，我们似乎既可以使用 `BOOL` 又可以使用 `bool`，既可以使用 `YES`/`NO` 又可以使用 `true`/`false`，那么它们到底有何不同呢？" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/2020/booleans_in_objc/" />
<meta property="article:published_time" content="2020-06-02T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-06-02T00:00:00+00:00" /><meta property="og:site_name" content="iBlog" />




<script data-ad-client="ca-pub-9925978992661955" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

  </head>
  <body class="">
    <div class="container">
      <header class="header">
  <span class="header__inner">
    <a href="/" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367"/>
</svg>
</span>
    <span class="logo__text">kingcos.me</span>
    <span class="logo__cursor"></span>
  
</a>

    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/about">About</a></li>
        
      
        
          <li><a href="/links">Links</a></li>
        
      
        
          <li><a href="/perspective">Perspective</a></li>
        
      
        
          <li><a href="/words">Words</a></li>
        
      
      
    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/about">About</a></li>
      
    
      
        <li><a href="/links">Links</a></li>
      
    
      
        <li><a href="/perspective">Perspective</a></li>
      
    
      
        <li><a href="/words">Words</a></li>
      
    
  </ul>
</nav>

        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none"/>
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
          </svg>
        </span>
      
      <span class="theme-toggle">
        <svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>

      </span>
    </span>
  </span>
</header>


      <div class="content">
        
  <div class="post">
    <h2 class="post-title"><a href="/posts/2020/booleans_in_objc/">Obj-C 中的 Boolean</a></h2>
    <div class="post-meta">
      
        <span class="post-date">
            2020-06-02
        </span>
      
      
      
        <span class="post-read-time">— 7 min read</span>
      
    </div>

    
      <span class="post-tags">
        
          #<a href="/tags/focus/">Focus</a>&nbsp;
        
          #<a href="/tags/ios/">iOS</a>&nbsp;
        
          #<a href="/tags/obj-c/">Obj-C</a>&nbsp;
        
      </span>
    

    

    <div class="post-content">
      <table>
<thead>
<tr>
<th align="center">Date</th>
<th align="center">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">2020-06-02</td>
<td align="center">首次提交</td>
</tr>
<tr>
<td align="center">2020-06-16</td>
<td align="center">增加「逻辑表达式」一节</td>
</tr>
</tbody>
</table>
<p><img src="/img/2020/booleans_in_objc/0.png" alt="0"></p>
<h2 id="preface">Preface</h2>
<p>Boolean，即布尔值，通常用来表明逻辑中的真或假。但在 Obj-C 中，我们似乎既可以使用 <code>BOOL</code> 又可以使用 <code>bool</code>，既可以使用 <code>YES</code>/<code>NO</code> 又可以使用 <code>true</code>/<code>false</code>，那么它们到底有何不同呢？</p>
<blockquote>
<p>⚠️ 注意：</p>
<p>为了避免读者（和笔者）记混，这里简单说明下 <code>#define</code> 与 <code>typedef</code> 的异同：<code>#define A B</code> 意为将已存在的 <code>B</code> 定义为 <code>A</code>，<code>A</code> 与 <code>B</code> 等价；<code>typedef C D</code> 意为将已存在的 <code>C</code> 定义为 <code>D</code>，<code>C</code> 与 <code>D</code> 等价；后者通常用于类型定义。</p>
</blockquote>
<h2 id="_bool-与-bool">_Bool 与 bool</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">// iOS - stdbool.h
</span><span style="color:#75715e"></span>
<span style="color:#75715e">/*===---- stdbool.h - Standard header for booleans -------------------------===
</span><span style="color:#75715e"> *
</span><span style="color:#75715e"> * Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.
</span><span style="color:#75715e"> * See https://llvm.org/LICENSE.txt for license information.
</span><span style="color:#75715e"> * SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception
</span><span style="color:#75715e"> *
</span><span style="color:#75715e"> *===-----------------------------------------------------------------------===
</span><span style="color:#75715e"> */</span>

<span style="color:#75715e">#ifndef __STDBOOL_H
</span><span style="color:#75715e">#define __STDBOOL_H
</span><span style="color:#75715e"></span>
<span style="color:#75715e">/* Don&#39;t define bool, true, and false in C++, except as a GNU extension. */</span>
<span style="color:#75715e">#ifndef __cplusplus
</span><span style="color:#75715e">#define bool _Bool
</span><span style="color:#75715e">#define true 1
</span><span style="color:#75715e">#define false 0
</span><span style="color:#75715e">#elif defined(__GNUC__) &amp;&amp; !defined(__STRICT_ANSI__)
</span><span style="color:#75715e"></span><span style="color:#75715e">/* Define _Bool as a GNU extension. */</span>
<span style="color:#75715e">#define _Bool bool
</span><span style="color:#75715e">#if __cplusplus &lt; 201103L
</span><span style="color:#75715e"></span><span style="color:#75715e">/* For C++98, define bool, false, true as a GNU extension. */</span>
<span style="color:#75715e">#define bool  bool
</span><span style="color:#75715e">#define false false
</span><span style="color:#75715e">#define true  true
</span><span style="color:#75715e">#endif
</span><span style="color:#75715e">#endif
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#define __bool_true_false_are_defined 1
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#endif </span><span style="color:#75715e">/* __STDBOOL_H */</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// ---
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// macOS 10.15 - Frameworks - Kernel - stdbool.h
</span><span style="color:#75715e"></span><span style="color:#75715e">#ifndef _STDBOOL_H_
</span><span style="color:#75715e">#define	_STDBOOL_H_
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#define	__bool_true_false_are_defined	1
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#ifndef __cplusplus
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#define	false	0
</span><span style="color:#75715e">#define	true	1
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#define	bool	_Bool
</span><span style="color:#75715e">#if __STDC_VERSION__ &lt; 199901L &amp;&amp; __GNUC__ &lt; 3
</span><span style="color:#75715e"></span><span style="color:#66d9ef">typedef</span>	<span style="color:#66d9ef">int</span>	_Bool;
<span style="color:#75715e">#endif
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#endif </span><span style="color:#75715e">/* !__cplusplus */</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#endif </span><span style="color:#75715e">/* !_STDBOOL_H_ */</span><span style="color:#75715e">
</span></code></pre></div><p>C 语言在 C99 标准诞生之前并没有原生的布尔类型，而 C99 标准为 C 语言提供了布尔类型，即 <code>_Bool</code> 关键字，但需要额外引入 <code>stdbool.h</code> 来使用。<code>_Bool</code> 的真值为 <code>1</code> 假值为 <code>0</code>。</p>
<blockquote>
<p>The type
<code>_Bool</code> and the unsigned integer types that correspond to the standard signed integer types are the <em>standard unsigned integer types</em>. The unsigned integer types that correspond to the extended signed integer types are the <em>extended unsigned integer types</em>. The standard and extended unsigned integer types are collectively called <em>unsigned integer types</em>.</p>
<p><code>_Bool</code> 类型与对应标准有符号整型的无符号整型类型是<em>标准无符号整型类型</em>。对应扩展有符号整型的无符号整型类型是<em>扩展无符号整型类型</em>。标准与扩展无符号整型类型统称为<em>无符号整型</em>。</p>
<p>—— C99 §6.2.5.6</p>
</blockquote>
<p>关于 <code>_Bool</code> 的底层类型，C99 标准中没有直接明确说明，但根据 C99 §6.2.5.6 我们可以认为 <code>_Bool</code> 属于 <code>unsigned int</code>，但实际仍只占用一个字节：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c">printf(<span style="color:#e6db74">&#34;%lu</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, <span style="color:#66d9ef">sizeof</span>(_Bool));
printf(<span style="color:#e6db74">&#34;%lu</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, <span style="color:#66d9ef">sizeof</span>(<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span>));

<span style="color:#75715e">// 1
</span><span style="color:#75715e">// 4
</span></code></pre></div><p>在 <code>stdbool.h</code> 中，非 <code>__cplusplus</code> 情况（即未使用 C++ 编译器）下，<code>_Bool</code> 被宏定义为 <code>bool</code>，<code>1</code> 被宏定义为 <code>true</code>，<code>0</code> 被宏定义为 <code>false</code>。因此在引入 <code>stdbool.h</code> 的项目中，<code>bool</code> 就等同于 <code>_Bool</code>。不同于 C 语言，C++ 诞生即拥有原生的布尔类型 <code>bool</code>，其真值为 <code>true</code> 假值为 <code>false</code>。那么 Obj-C 中的 <code>bool</code> 又是什么呢？</p>
<p>我们知道，Obj-C 是 C 语言的超集，因此其中的 <code>bool</code> 其实来自于 <code>stdbool.h</code> 头文件中对 <code>_Bool</code> 的宏定义。只是在 Obj-C 中，我们无需再手动引入该头文件，因为其已经间接被 <code>CoreFoundation.h</code> - <code>Foundation.h</code> 引入。</p>
<p>而在 Obj-C++ 中，情况变得有些不同。按照 <code>stdbool.h</code> 中的定义，如果 <code>__cplusplus</code> 被定义了，则通常不再宏定义 <code>bool</code>、<code>true</code> 和 <code>false</code>，从而避免覆盖 C++ 中布尔类型 <code>bool</code>。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec"><span style="color:#75715e">#import &#34;Foo.h&#34;
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">@implementation</span> <span style="color:#a6e22e">Foo</span>

+ (<span style="color:#66d9ef">void</span>)<span style="color:#a6e22e">foo</span> {
    <span style="color:#75715e">// Foo.m 时，报错：Use of undeclared identifier &#39;__cplusplus&#39;
</span><span style="color:#75715e"></span>
    <span style="color:#75715e">// Foo.mm 时，可以正常编译运行，默认输出结果为 201402（Xcode 11.5 中默认为 C++14）；
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// 当更改 Build Settings - Apple Clang - Language - C++ - C++ Language Dialect 为 C++98 时，
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// 输出为 199711
</span><span style="color:#75715e"></span>    NSLog(<span style="color:#e6db74">@&#34;%ld&#34;</span>, __cplusplus);
}

<span style="color:#66d9ef">@end</span>
</code></pre></div><blockquote>
<p>⚠️ 注意：</p>
<p>由于 C 和 C++ 的代码可以较为容易地相互引入、使用、并编译，两种相似类型的二进制兼容问题就变得尤为重要和棘手。虽然 <code>stdbool.h</code> 中的宏定义能够解决一部分二进制兼容问题，但宏定义仅作用于编译阶段。如果我们使用 C 编译器已经编译好的代码库，暴露给 C++ 代码使用并由 C++ 编译器编译（或反之），则仍然可能出现二进制兼容的问题。因此我们要尽量保证一致性，或者使用 <code>int</code> 等兼容类型替代。关于两者兼容的问题，也可以在 StackOverflow 中的 <a href="https://stackoverflow.com/questions/3529831/bool-and-bool-how-do-i-solve-the-problem-of-a-c-library-that-uses-bool">_Bool and bool: How do I solve the problem of a C library that uses _Bool?</a> 问题中讨论。</p>
</blockquote>
<h2 id="bool">BOOL</h2>
<p><code>BOOL</code> 是 Obj-C 中的布尔类型，但其本质是来自于宏定义：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec"><span style="color:#75715e">// usr/include - objc - objc.h
</span><span style="color:#75715e"></span>
<span style="color:#75715e">/// Type to represent a boolean value.
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#if defined(__OBJC_BOOL_IS_BOOL)
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// Honor __OBJC_BOOL_IS_BOOL when available.
</span><span style="color:#75715e"></span><span style="color:#75715e">#   if __OBJC_BOOL_IS_BOOL
</span><span style="color:#75715e">#       define OBJC_BOOL_IS_BOOL 1
</span><span style="color:#75715e">#   else
</span><span style="color:#75715e">#       define OBJC_BOOL_IS_BOOL 0
</span><span style="color:#75715e">#   endif
</span><span style="color:#75715e">#else
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// __OBJC_BOOL_IS_BOOL not set.
</span><span style="color:#75715e"></span><span style="color:#75715e">#   if TARGET_OS_OSX || TARGET_OS_MACCATALYST || ((TARGET_OS_IOS || 0) &amp;&amp; !__LP64__ &amp;&amp; !__ARM_ARCH_7K)
</span><span style="color:#75715e">#      define OBJC_BOOL_IS_BOOL 0
</span><span style="color:#75715e">#   else
</span><span style="color:#75715e">#      define OBJC_BOOL_IS_BOOL 1
</span><span style="color:#75715e">#   endif
</span><span style="color:#75715e">#endif
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#if OBJC_BOOL_IS_BOOL
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">bool</span> <span style="color:#66d9ef">BOOL</span>;
<span style="color:#75715e">#else
</span><span style="color:#75715e">#   define OBJC_BOOL_IS_CHAR 1
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">signed</span> <span style="color:#66d9ef">char</span> <span style="color:#66d9ef">BOOL</span>;
    <span style="color:#75715e">// BOOL is explicitly signed so @encode(BOOL) == &#34;c&#34; rather than &#34;C&#34;
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// even if -funsigned-char is used.
</span><span style="color:#75715e"></span><span style="color:#75715e">#endif
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#define OBJC_BOOL_DEFINED
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#if __has_feature(objc_bool)
</span><span style="color:#75715e">#define YES __objc_yes
</span><span style="color:#75715e">#define NO  __objc_no
</span><span style="color:#75715e">#else
</span><span style="color:#75715e">#define YES ((BOOL)1)
</span><span style="color:#75715e">#define NO  ((BOOL)0)
</span><span style="color:#75715e">#endif
</span></code></pre></div><p>根据宏定义，当目标平台为 macOS、Mac Catalyst 或 32 位 iOS 时，<code>BOOL</code> 为 <code>signed char</code>；当目标平台为 64 位 iOS、tvOS、或 watchOS 时，<code>BOOL</code> 为 <code>bool</code>（即 <code>_Bool</code>）。因此在使用时，我们也要务必注意这些差异：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec"><span style="color:#75715e">#import &#34;Foo.h&#34;
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">@implementation</span> <span style="color:#a6e22e">Foo</span>

+ (<span style="color:#66d9ef">BOOL</span>)<span style="color:#a6e22e">booleanValue1</span> {
    <span style="color:#75715e">// 当 BOOL 实际为 signed char 时，其行为将不同于 C 语言中的 _Bool 以及 C++ 中的 bool；
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// 由于 signed char 大小为 1 个字节，取值范围为 [-128, 127]（换算二进制为 1000,0000~0111,1111）
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// 因此只要当二进制后 8 位为 0 时，比如 0001,0000,0000，高位都将被截断（丢失高位）为 0，即逻辑假
</span><span style="color:#75715e"></span>    printf(<span style="color:#e6db74">&#34;%lu</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, <span style="color:#66d9ef">sizeof</span>(<span style="color:#66d9ef">signed</span> <span style="color:#66d9ef">char</span>)); <span style="color:#75715e">// 1
</span><span style="color:#75715e"></span>    printf(<span style="color:#e6db74">&#34;%lu</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, <span style="color:#66d9ef">sizeof</span>(<span style="color:#66d9ef">BOOL</span>));        <span style="color:#75715e">// 1
</span><span style="color:#75715e"></span>
    <span style="color:#75715e">// macOS Warning: Implicit conversion from constant value 256 to &#39;BOOL&#39;; the only well defined values for &#39;BOOL&#39; are YES and NO
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">256</span>;
}

+ (<span style="color:#66d9ef">BOOL</span>)<span style="color:#a6e22e">booleanValue2</span> {
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
}

+ (<span style="color:#66d9ef">BOOL</span>)<span style="color:#a6e22e">booleanValue3</span> {
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;
}

+ (<span style="color:#66d9ef">bool</span>)<span style="color:#a6e22e">booleanValue4</span> {
    <span style="color:#75715e">// bool 则本质为 _Bool，因此该函数在所有平台下均返回 true
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">256</span>;
}

+ (<span style="color:#66d9ef">BOOL</span>)<span style="color:#a6e22e">booleanValue5</span> {
    <span style="color:#66d9ef">return</span> <span style="color:#f92672">!!</span><span style="color:#ae81ff">256</span>;
}

+ (<span style="color:#66d9ef">void</span>)<span style="color:#a6e22e">bar</span> {
    NSLog(<span style="color:#e6db74">@&#34;%@&#34;</span>, [self booleanValue1] <span style="color:#f92672">?</span> <span style="color:#e6db74">@&#34;YES&#34;</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">@&#34;NO&#34;</span>);
    NSLog(<span style="color:#e6db74">@&#34;%@&#34;</span>, [self booleanValue2] <span style="color:#f92672">?</span> <span style="color:#e6db74">@&#34;YES&#34;</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">@&#34;NO&#34;</span>);
    NSLog(<span style="color:#e6db74">@&#34;%@&#34;</span>, [self booleanValue3] <span style="color:#f92672">?</span> <span style="color:#e6db74">@&#34;true&#34;</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">@&#34;false&#34;</span>);
    NSLog(<span style="color:#e6db74">@&#34;%@&#34;</span>, [self booleanValue4] <span style="color:#f92672">?</span> <span style="color:#e6db74">@&#34;YES&#34;</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">@&#34;NO&#34;</span>);
    NSLog(<span style="color:#e6db74">@&#34;%@&#34;</span>, [self booleanValue5] <span style="color:#f92672">?</span> <span style="color:#e6db74">@&#34;YES&#34;</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">@&#34;NO&#34;</span>);
}
<span style="color:#66d9ef">@end</span>

<span style="color:#75715e">// macOS OUTPUT:
</span><span style="color:#75715e">// NO
</span><span style="color:#75715e">// NO
</span><span style="color:#75715e">// true
</span><span style="color:#75715e">// YES
</span><span style="color:#75715e">// YES
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// iOS ARM64 OUTPUT:
</span><span style="color:#75715e">// YES
</span><span style="color:#75715e">// NO
</span><span style="color:#75715e">// true
</span><span style="color:#75715e">// YES
</span><span style="color:#75715e">// YES
</span></code></pre></div><p><code>BOOL</code> 中对应的逻辑是 <code>YES</code> 为真，<code>NO</code> 为假，其本质分别即 <code>__objc_yes</code> 和 <code>__objc_no</code>：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec"><span style="color:#75715e">// 摘自上文
</span><span style="color:#75715e"></span>
<span style="color:#75715e">//...
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// __has_feature 可以用来检查编译器是否包含某个功能，以区分针对不同编译器的实现
</span><span style="color:#75715e"></span><span style="color:#75715e">#if __has_feature(objc_bool)
</span><span style="color:#75715e">#define YES __objc_yes
</span><span style="color:#75715e">#define NO  __objc_no
</span><span style="color:#75715e">#else
</span><span style="color:#75715e">#define YES ((BOOL)1)
</span><span style="color:#75715e">#define NO  ((BOOL)0)
</span></code></pre></div><p>而 <code>__objc_yes</code> 与 <code>__objc_no</code> 的本质，我们可以在 LLVM 官网的《Objective-C 字面量》文档中找到：</p>
<blockquote>
<p>The compiler implicitly converts <code>__objc_yes</code> and <code>__objc_no</code> to <code>(BOOL)1</code> and <code>(BOOL)0</code>. The keywords are used to disambiguate <code>BOOL</code> and integer literals.</p>
<p>编译器隐式将 <code>__objc_yes</code> 转换为 <code>(BOOL)1</code>，将 <code>__objc_no</code> 转换为 <code>(BOOL)0</code>。这些关键字是用来区分 <code>BOOL</code> 与整型字面量的。</p>
<p>—— Objective-C Literals</p>
</blockquote>
<h2 id="__nscfboolean-与-cfboolean">__NSCFBoolean 与 CFBoolean</h2>
<p>使用 <code>NSUserDefaults</code> 使得我们可以很容易持久化一些值，这里我们将 <code>BOOL</code> 的 <code>YES</code> 保存，并尝试取出：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec">[[NSUserDefaults standardUserDefaults] setBool:YES forKey:<span style="color:#e6db74">@&#34;BOOL_YES&#34;</span>];
<span style="color:#75715e">// [[NSUserDefaults standardUserDefaults] setObject:@YES forKey:@&#34;BOOL_YES&#34;];
</span><span style="color:#75715e">// [[NSUserDefaults standardUserDefaults] setObject:@(YES) forKey:@&#34;BOOL_YES&#34;];
</span><span style="color:#75715e">// - (id)valueForKey:(NSString *)key;
</span><span style="color:#75715e"></span><span style="color:#66d9ef">id</span> boolYes <span style="color:#f92672">=</span> [[NSUserDefaults standardUserDefaults] valueForKey:<span style="color:#e6db74">@&#34;BOOL_YES&#34;</span>];
NSLog(<span style="color:#e6db74">@&#34;%@&#34;</span>, [boolYes <span style="color:#66d9ef">class</span>]);

<span style="color:#75715e">// __NSCFBoolean
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// (lldb) p [boolYes superclass]
</span><span style="color:#75715e"></span>(<span style="color:#75715e">// Class) $0 = NSNumber
</span></code></pre></div><p>由于 <code>valueForKey:</code> 是一个返回 <code>id</code> 类型的方法，此时我们发现 <code>boolYes</code> 的类是 <code>__NSCFBoolean</code>，父类为 <code>NSNumber</code>。<code>__NSCFBoolean</code> 的本质是桥接 <code>CoreFoundation</code> 中的 <code>CFBoolean</code>。</p>
<blockquote>
<p>CFBoolean objects are used to wrap boolean values for use in Core Foundation property lists and collection types.</p>
<p>CFBoolean 对象包装了布尔值，用在 CoreFoundation 中的属性列表和集合类型。</p>
<p>—— CFBoolean, Apple Documentation</p>
</blockquote>
<p><code>CFBoolean</code> 中真值为 <code>kCFBooleanTrue</code>，假值为 <code>kCFBooleanFalse</code>：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">// CoreFoundation - CFNumber.h
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">CF_BRIDGED_TYPE</span>(NSNumber) __CFBoolean <span style="color:#f92672">*</span> CFBooleanRef;

CF_EXPORT
<span style="color:#66d9ef">const</span> CFBooleanRef kCFBooleanTrue;
CF_EXPORT
<span style="color:#66d9ef">const</span> CFBooleanRef kCFBooleanFalse;

CF_EXPORT
CFTypeID <span style="color:#a6e22e">CFBooleanGetTypeID</span>(<span style="color:#66d9ef">void</span>);

CF_EXPORT
Boolean <span style="color:#a6e22e">CFBooleanGetValue</span>(CFBooleanRef boolean);
</code></pre></div><h2 id="boolean-与-boolean_t">Boolean 与 boolean_t</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec"><span style="color:#75715e">// usr/include - MacTypes.h
</span><span style="color:#75715e"></span>
<span style="color:#75715e">/********************************************************************************
</span><span style="color:#75715e">
</span><span style="color:#75715e">    Boolean types and values
</span><span style="color:#75715e">
</span><span style="color:#75715e">        Boolean         Mac OS historic type, sizeof(Boolean)==1
</span><span style="color:#75715e">        bool            Defined in stdbool.h, ISO C/C++ standard type
</span><span style="color:#75715e">        false           Now defined in stdbool.h
</span><span style="color:#75715e">        true            Now defined in stdbool.h
</span><span style="color:#75715e">
</span><span style="color:#75715e">*********************************************************************************/</span>
<span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">char</span>                   <span style="color:#66d9ef">Boolean</span>;
</code></pre></div><p><code>Boolean</code> 在 Obj-C 中是一个并不常用的类型。根据头文件，其来源于 macOS 历史遗留，实际类型为 <code>unsigned char</code>。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">// usr/include - mach - i386 - boolean.h
</span><span style="color:#75715e"></span>
<span style="color:#75715e">/*
</span><span style="color:#75715e"> *	File:	boolean.h
</span><span style="color:#75715e"> *
</span><span style="color:#75715e"> *	Boolean type, for I386.
</span><span style="color:#75715e"> */</span>

<span style="color:#75715e">#ifndef _MACH_I386_BOOLEAN_H_
</span><span style="color:#75715e">#define _MACH_I386_BOOLEAN_H_
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#if defined(__x86_64__) &amp;&amp; !defined(KERNEL)
</span><span style="color:#75715e"></span><span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span>    boolean_t;
<span style="color:#75715e">#else
</span><span style="color:#75715e"></span><span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">int</span>             boolean_t;
<span style="color:#75715e">#endif
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#endif  </span><span style="color:#75715e">/* _MACH_I386_BOOLEAN_H_ */</span><span style="color:#75715e">
</span></code></pre></div><p><code>boolean_t</code> 也不常用，根据头文件，当目标平台为 x86_64 架构时，其相当于 <code>unsigned int</code>，反之则为 <code>int</code>。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec">printf(<span style="color:#e6db74">&#34;%lu</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, <span style="color:#66d9ef">sizeof</span>(<span style="color:#66d9ef">Boolean</span>));
printf(<span style="color:#e6db74">&#34;%lu</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, <span style="color:#66d9ef">sizeof</span>(boolean_t));

<span style="color:#75715e">// 1
</span><span style="color:#75715e">// 4
</span></code></pre></div><p><code>Boolean</code> 和 <code>boolean_t</code> 分别占用 1 个和 4 个字节（该大小不区分目标平台）。而在日常开发中，由于我们几乎很少会使用到这两个类型，故本文不再赘述。</p>
<h2 id="dyld_bool">DYLD_BOOL</h2>
<p><code>DYLD_BOOL</code> 在平时我们也不常用，其本质是来自于 <code>dyld.h</code> 中的一个枚举类型，其中 <code>TRUE</code> 为 <code>1</code>，<code>FALSE</code> 为 <code>0</code>：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec"><span style="color:#75715e">// usr/include - mach-o - dyld.h
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#ifndef ENUM_DYLD_BOOL
</span><span style="color:#75715e">#define ENUM_DYLD_BOOL
</span><span style="color:#75715e"></span>  <span style="color:#75715e">#undef FALSE
</span><span style="color:#75715e"></span>  <span style="color:#75715e">#undef TRUE
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">enum</span> DYLD_BOOL { FALSE, TRUE };
<span style="color:#75715e">#endif </span><span style="color:#75715e">/* ENUM_DYLD_BOOL */</span><span style="color:#75715e">
</span></code></pre></div><h2 id="逻辑表达式">逻辑表达式</h2>
<p>在开发过程中，另一个离不开逻辑判断的地方是逻辑表达式。在这些表达式中，我们通常会使用 <code>&amp;&amp;</code>、<code>||</code>、<code>==</code>、<code>!=</code>、<code>!</code> 等逻辑运算符。那么它们的返回值是什么类型呢？</p>
<p>为了避免编译器进行类型转换，这里使用了 <code>__auto_type</code> 来代表表达式的返回类型，并通过打断点查看逻辑表达式的返回值类型：</p>
<p><img src="/o_img/2020/booleans_in_objc/1.png" alt="1"></p>
<blockquote>
<p><code>__auto_type</code></p>
<p>在 Swift 中，我们已经习惯于编译器自动进行的类型推断。而 GCC 4.9 为 C 语言引入了 <code>__auto_type</code> 关键字，用处主要在于一些宏定义中能够实现「类型推断」，类似 C++ 中的 <code>auto</code>。LLVM 中也加入了该关键字。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#if defined(__cplusplus)
</span><span style="color:#75715e">#define let auto const
</span><span style="color:#75715e">#else
</span><span style="color:#75715e">#define let const __auto_type
</span><span style="color:#75715e">#endif
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#if defined(__cplusplus)
</span><span style="color:#75715e">#define var auto
</span><span style="color:#75715e">#else
</span><span style="color:#75715e">#define var __auto_type
</span><span style="color:#75715e">#endif
</span></code></pre></div></blockquote>
<p>我们也可以通过「Xcode - Debug - Debug Workflow - View Memory」，查看变量的实际内存占用：</p>
<p><img src="/o_img/2020/booleans_in_objc/2.png" alt="2"></p>
<p>最终我们可以确定逻辑表达式的返回值类型其实是 <code>int</code>，占用 4 个字节。我们也可以在 C99 标准中找到以下说明来佐证：</p>
<blockquote>
<p>The <code>==</code> (equal to) and <code>!=</code> (not equal to) operators are analogous to the relational operators except for their lower precedence. Each of the operators yields 1 if the specified relation is true and 0 if it is false. The result has type <code>int</code>. For any pair of operands, exactly one of the relations is true.</p>
<p><code>==</code>（等于）和 <code>!=</code>（不等于）运算符与关系运算符类似，只是它们的优先级较低。如果指定的关系为真，运算符会返回 1，如果为假，则返回 0。结果类型为 <code>int</code>。对于任何一项（判等）操作，都必有一个关系为真。</p>
<p>—— C99 §6.5.9.3</p>
</blockquote>
<h2 id="conclusion">Conclusion</h2>
<table>
<thead>
<tr>
<th align="center">类型</th>
<th align="center">底层类型</th>
<th align="center">头文件</th>
<th align="center">sizeof</th>
<th align="center">真值</th>
<th align="center">假值</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">_Bool（C）</td>
<td align="center">unsigned int</td>
<td align="center">stdbool.h</td>
<td align="center">1</td>
<td align="center">1</td>
<td align="center">0</td>
</tr>
<tr>
<td align="center">bool（C）</td>
<td align="center">_Bool（C）</td>
<td align="center">stdbool.h</td>
<td align="center">1</td>
<td align="center">true</td>
<td align="center">false</td>
</tr>
<tr>
<td align="center">bool（C++）</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">1</td>
<td align="center">true</td>
<td align="center">false</td>
</tr>
<tr>
<td align="center">BOOL<br>（Obj-C）</td>
<td align="center">macOS/iOS 32bit<br>signed char<br>iOS 64bit:<br>_Bool</td>
<td align="center">objc.h</td>
<td align="center">1</td>
<td align="center">YES</td>
<td align="center">NO</td>
</tr>
<tr>
<td align="center">BOOL<br>（Obj-C++）</td>
<td align="center">macOS/iOS 32bit:<br>signed char<br>iOS 64bit:<br>bool（C++）</td>
<td align="center">objc.h</td>
<td align="center">1</td>
<td align="center">YES</td>
<td align="center">NO</td>
</tr>
<tr>
<td align="center">__NSCFBoolean</td>
<td align="center">CFBoolean</td>
<td align="center">-</td>
<td align="center">-</td>
<td align="center">@YES</td>
<td align="center">@NO</td>
</tr>
<tr>
<td align="center">CFBooleanRef</td>
<td align="center">CFBoolean</td>
<td align="center">CFNumber.h</td>
<td align="center">8</td>
<td align="center">kCFBooleanTrue</td>
<td align="center">kCFBooleanFalse</td>
</tr>
<tr>
<td align="center">Boolean</td>
<td align="center">unsigned char</td>
<td align="center">MacTypes.h</td>
<td align="center">1</td>
<td align="center">-</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">boolean_t</td>
<td align="center">x86_64:<br>unsigned int<br>others:<br>int</td>
<td align="center">boolean.h</td>
<td align="center">4</td>
<td align="center">-</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">DYLD_BOOL</td>
<td align="center">enum DYLD_BOOL</td>
<td align="center">dyld.h</td>
<td align="center">4</td>
<td align="center">TRUE（1）</td>
<td align="center">FALSE（0）</td>
</tr>
</tbody>
</table>
<h2 id="reference">Reference</h2>
<ul>
<li><a href="https://nshipster.com/bool/">BOOL / bool / Boolean / NSCFBoolean - by Mattt</a></li>
<li><a href="http://www.open-std.org/jtc1/sc22/WG14/www/docs/n1256.pdf">C99 Standard PDF - open-std.org</a></li>
<li><a href="https://stackoverflow.com/questions/24602814/bool-data-type-of-c99">_Bool data type of C99 - StackOverflow</a></li>
<li><a href="https://stackoverflow.com/questions/3529831/bool-and-bool-how-do-i-solve-the-problem-of-a-c-library-that-uses-bool">_Bool and bool: How do I solve the problem of a C library that uses _Bool? - StackOverflow</a></li>
<li><a href="https://en.wikipedia.org/wiki/Boolean_data_type#C,_C++,_Objective-C,_AWK">Boolean data type - Wikipedia</a></li>
<li><a href="https://developer.apple.com/documentation/objectivec/bool">BOOL - Apple Documentation</a></li>
<li><a href="https://releases.llvm.org/3.1/tools/clang/docs/ObjectiveCLiterals.html">Objective-C Literals - LLVM.org</a></li>
<li><a href="https://developer.apple.com/documentation/corefoundation/cfboolean">CFBoolean - Apple Documentation</a></li>
<li><a href="https://opensource.apple.com/source/CF/">CF Source Browser - Apple Opensource</a></li>
<li><a href="https://gcc.gnu.org/onlinedocs/gcc/Typeof.html">Referring to a Type with typeof - GCC</a></li>
<li><a href="https://reviews.llvm.org/D12686">Add support for GCC&rsquo;s &lsquo;__auto_type&rsquo; extension. - LLVM</a></li>
</ul>

    </div>
    
      <div class="pagination">
        <div class="pagination__title">
          <span class="pagination__title-h">Read other posts</span>
          <hr />
        </div>
        <div class="pagination__buttons">
          
          
            <span class="button next">
              <a href="/posts/2020/deskmini_hack/">
                <span class="button__text">DeskMini 310 黑苹果组装记</span>
                <span class="button__icon">→</span>
              </a>
            </span>
          
        </div>
      </div>
    

    

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<table style="border: 0;">
  <tr>
  <td style="border: 0; width: 30%;">
    <img src='/img/about/1.jpg'>
  </td>
  <td style="border: 0;">
    <ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-9925978992661955"
     data-ad-slot="3213735320"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
  </td>
  </tr>
</table>



<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>


    
    
    <div>
      <div id="github-comment">
      </div>

      <script type="text/javascript">
        function getUtterances(isDark) {
          var utterances = document.createElement('script');
          utterances.type = 'text/javascript';
          utterances.async = true;
          utterances.setAttribute('issue-term', "pathname")
          utterances.setAttribute('repo', "kingcos\/kingcos.github.io")
          utterances.setAttribute('label', "comments")
          isDark ? utterances.setAttribute('theme', "github-dark") : utterances.setAttribute('theme', "github-light")
          utterances.crossorigin = 'anonymous';
          utterances.src = 'https://utteranc.es/client.js';

          return utterances
        }

        var themeToggle = document.querySelector(".theme-toggle")
        themeToggle.addEventListener("click", function () {
          var getTheme = window.localStorage && window.localStorage.getItem("theme")
          var divNode = document.getElementById('github-comment')
          while(divNode.hasChildNodes()) {
            divNode.removeChild(divNode.firstChild);
          }
          
          
          

          
          
          
          
          
          
          document.getElementById('github-comment').appendChild(getUtterances(getTheme !== "dark"))
        })

        var getTheme = window.localStorage && window.localStorage.getItem("theme")
        document.getElementById('github-comment').appendChild(getUtterances(getTheme === "dark"))
      </script>
    </div>
    

    </div>

      </div>

      
        <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright copyright--user">All rights reserved by kingcos.me</div>
    
  </div>
</footer>

<script src="/assets/main.js"></script>
<script src="/assets/prism.js"></script>



      
    </div>

    
      
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-138311951-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

    
  </body>
</html>
