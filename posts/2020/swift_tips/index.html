<!DOCTYPE html>
<html lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="kingcos" />
	
	
	
	<title>Swift 拾遗 - Swift Tips ｜ kingcos</title>
	
    
    
    <meta name="description" content="《Swift 拾遗》是一个关于 Swift 的新文章专辑，这个系列的文章将不会涉及基本语法的层面，而是尝试从底层「拾」起之前所忽视的内容。那么作为起始篇，随着整个系列的进行，其中「遗」漏的基本使用将在本文中得到补充。" />
    

    
    
    <meta name="keywords" content="Hugo, theme, zozo" />
    

	
    
    <link rel="shortcut icon" href="https://kingcos.me/images/favicon.png" />

    <link rel="stylesheet" type="text/css" media="screen" href="https://kingcos.me/css/normalize.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.0/animate.min.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="https://kingcos.me/css/zozo.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://cdn.jsdelivr.net/npm/remixicon@2.5.0/fonts/remixicon.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="https://kingcos.me/css/highlight.css" />

    
    
</head>

<script data-ad-client="ca-pub-9925978992661955" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<body>
    <div class="main animate__animated animate__fadeInDown">
        <div class="nav_container animated fadeInDown">
    <div class="site_nav" id="site_nav">
        <ul>
            
            <li>
                <a href="/">Home</a>
            </li>
            
            <li>
                <a href="/posts/">Archive</a>
            </li>
            
            <li>
                <a href="/tags/">Tags</a>
            </li>
            
            <li>
                <a href="/about/">About</a>
            </li>
            
        </ul>
    </div>
    <div class="menu_icon">
        <a id="menu_icon"><i class="ri-menu-line"></i></a>
    </div>
</div>


<link rel="stylesheet" href="https://kingcos.me/scss/main.min.7b6e5090dd63f35c42913c169ca8464a3ba4c70a9de89e9ca3535ce45de13d3d.css" integrity="sha256-e25QkN1j81xCkTwWnKhGSjukxwqd6J6co1Nc5F3hPT0=" media="screen">

<style>
.nav_container {
  height: 1rem;
}
 
table {
    width: 100%;
    table-layout: fixed;
}

 
.markdown code {
    white-space: normal;
    word-wrap: break-word;
    line-height: 1.5em;
    font-size: 0.85em;
    font-weight: bold;
    display: inline-block;
     
}

 
.menu_icon a {
    font-size: 16px;
}

 
body {
    font-family: 'Hiragino Sans GB', 'SFMono', 'Lato', '-apple-system';
    -webkit-font-smoothing: 'antialiased';
}

 
.markdown strong, .markdown b, .markdown em {
    font-weight: bold;
}

.post .post_content p {
     

    line-height: 1.75em;
}

 
.markdown img {
     
    margin: 0 auto;
    display: block;
}

 
.ri-stack-line {
    vertical-align: middle;
}

 
.ri-map-pin-time-line {
    vertical-align: middle;
}

 

 
.markdown .book-hint::before {
    content: none;
}

.markdown .book-hint {
    margin: 1rem 0;
    padding: 0.5rem 1rem 0.5rem 0.75rem;

    border-inline-start: 0.25rem solid #e9ecef;
    border-radius: 0.25rem;

    font-style: normal;
     
}

.book-hint strong {
    background-color: transparent;
}

.markdown .book-hint.info {
    border-left-color:#6bf;
    background-color:rgba(102,187,255,.1);
}

.markdown .book-hint.warning {
    border-left-color:#fd6;
    background-color:rgba(255,221,102,.1);
}

.markdown .book-hint.danger {
    border-left-color:#f66;
    background-color:rgba(255,102,102,.1);
}

</style>

        <div class="header animated fadeInDown">
    <div class="site_title_container">
        <div class="site_title">
            <h1>
                <a href="https://kingcos.me/">
                    
                    <img src="/title.svg" width="150px">
                </a>
            </h1>
        </div>
        <div class="description">
            <p class="sub_title">专注、坚持</p>
            <div class="my_socials">
                
                
                <a href="https://github.com/kingcos" title="github" target="_blank"><i class="ri-github-fill"></i></a>
                
                
                
                <a href="https://www.instagram.com/kingcos_v/" title="instagram" target="_blank"><i class="ri-instagram-fill"></i></a>
                
                
                
                <a href="https://twitter.com/kingcos_v" title="twitter" target="_blank"><i class="ri-twitter-fill"></i></a>
                
                
                
                <a href="https://weibo.com/u/1798410923" title="weibo" target="_blank"><i class="ri-weibo-fill"></i></a>
                
                
                
            </div>
        </div>
    </div>
</div>
        <div class="content">
            <div class="post_page">
                <div class="post animate__animated animate__fadeInDown">
                    <div class="post_title post_detail_title">
                        <h2><a href='/posts/2020/swift_tips/'>Swift 拾遗 - Swift Tips</a></h2>
                        <span class="date">2021.04.16</span>
                        <span>by kingcos</span>
                        
                        
                        
                    </div>
                    <div class="post_content markdown"><h2 id="preface">Preface</h2>
<p>《Swift 拾遗》是一个关于 Swift 的新文章专辑，这个系列的文章将不会涉及基本语法的层面，而是尝试从底层「拾」起之前所忽视的内容。那么作为起始篇，随着整个系列的进行，其中「遗」漏的基本使用内容将在本文中得到补充。</p>
<h2 id="contents">Contents</h2>
<h3 id="void">Void</h3>
<p>按照 Swift 标准库的定义，<code>Void</code> 即空元组 <code>()</code>：</p>
<div class="highlight"><pre class="chroma"><code class="language-swift" data-lang="swift"><span class="kd">public</span> <span class="kd">typealias</span> <span class="nb">Void</span> <span class="p">=</span> <span class="p">()</span>
</code></pre></div><h3 id="函数重载overload">函数重载（Overload）</h3>
<p>Swift 中的函数重载有一些「坑」，因此尽量不要产生命名歧义性（比如结合默认参数值等用法）。</p>
<ul>
<li>另可参考《<a href="/posts/2019/override_and_overload_in_obj-c">Obj-C 中的重载与重写</a>》</li>
</ul>
<h3 id="discardableresult">@discardableResult</h3>
<p>Swift 是一门要求很严格的语言，当函数的返回值未被使用到时，编译器就会提示相关的警告。我们可以使用 <code>@discardableResult</code> 将函数声明为可丢弃结果，即可告知编译器不产生警告：</p>
<div class="highlight"><pre class="chroma"><code class="language-swift" data-lang="swift"><span class="kd">import</span> <span class="nc">Foundation</span>

<span class="kd">func</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">-&gt;</span> <span class="nb">String</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s">&#34;kingcos.me&#34;</span>
<span class="p">}</span>

<span class="p">@</span><span class="n">discardableResult</span>
<span class="kd">func</span> <span class="nf">bar</span><span class="p">()</span> <span class="p">-&gt;</span> <span class="nb">String</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s">&#34;kingcos.me&#34;</span>
<span class="p">}</span>

<span class="n">foo</span><span class="p">()</span> <span class="c1">// WARNING: Result of call to &#39;foo()&#39; is unused</span>

<span class="c1">// 当然也可以赋值到占位符 _ 以避免警告</span>
<span class="kc">_</span> <span class="p">=</span> <span class="n">foo</span><span class="p">()</span>

<span class="n">bar</span><span class="p">()</span>
</code></pre></div><ul>
<li>另可参考《<a href="https://github.com/apple/swift-evolution/blob/master/proposals/0047-nonvoid-warn.md">Defaulting non-Void functions so they warn on unused results - swift-evolution</a>》</li>
</ul>
<h3 id="swiftc">swiftc</h3>
<p><img src="/img/2020/swift_tips/2.svg" alt="2"></p>
<p><code>swiftc</code> 是 Swift 编译器（前端），位于 Xcode 中 <code>Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/</code> 目录，其本质是同目录下 <code>swift</code> 的符号链接：</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">-rwxr-xr-x  1 root  wheel  95341344 Jul  2 14:37 swift
lrwxr-xr-x  1 root  wheel         5 Jul 18 00:20 swiftc -&gt; swift
</code></pre></div><ul>
<li>生成语法树：<code>swiftc -dump-ast demo.swift</code></li>
<li>生成最简洁的 SIL 代码：<code>swiftc -emit-sil demo.swift</code></li>
<li>生成 LLVM IR 代码：<code>swiftc -emit-ir demo.swift -o demo.ll</code></li>
<li>生成汇编代码：<code>swiftc -emit-assembly demo.swift -o demo.s</code></li>
</ul>
<p><img src="/img/2020/swift_tips/1.svg" alt="1"></p>
<ul>
<li>另可参考《<a href="../swift_compiler/">[译] Swift 编译器</a>》</li>
</ul>
<h3 id="隐式原始值">隐式原始值</h3>
<p>当 Swift 中的枚举原始值（Raw Value）类型为 <code>Int</code> 或 <code>String</code> 时，其将获得默认值，即隐式原始值（Implicitly Assigned Raw Values）：</p>
<div class="highlight"><pre class="chroma"><code class="language-swift" data-lang="swift"><span class="kd">enum</span> <span class="nc">IntFoo</span><span class="p">:</span> <span class="nb">Int</span> <span class="p">{</span>
    <span class="k">case</span> <span class="bp">first</span>
    <span class="k">case</span> <span class="n">second</span> <span class="p">=</span> <span class="mi">200</span>
    <span class="k">case</span> <span class="n">third</span>
    <span class="k">case</span> <span class="n">fourth</span> <span class="p">=</span> <span class="mi">400</span>
    <span class="k">case</span> <span class="n">fifth</span>
<span class="p">}</span>

<span class="bp">print</span><span class="p">(</span><span class="n">IntFoo</span><span class="p">.</span><span class="bp">first</span><span class="p">.</span><span class="n">rawValue</span><span class="p">)</span>  <span class="c1">// 0</span>
<span class="bp">print</span><span class="p">(</span><span class="n">IntFoo</span><span class="p">.</span><span class="n">second</span><span class="p">.</span><span class="n">rawValue</span><span class="p">)</span> <span class="c1">// 200</span>
<span class="bp">print</span><span class="p">(</span><span class="n">IntFoo</span><span class="p">.</span><span class="n">third</span><span class="p">.</span><span class="n">rawValue</span><span class="p">)</span>  <span class="c1">// 201</span>
<span class="bp">print</span><span class="p">(</span><span class="n">IntFoo</span><span class="p">.</span><span class="n">fourth</span><span class="p">.</span><span class="n">rawValue</span><span class="p">)</span> <span class="c1">// 400</span>
<span class="bp">print</span><span class="p">(</span><span class="n">IntFoo</span><span class="p">.</span><span class="n">fifth</span><span class="p">.</span><span class="n">rawValue</span><span class="p">)</span>  <span class="c1">// 401</span>

<span class="kd">enum</span> <span class="nc">StrFoo</span><span class="p">:</span> <span class="nb">String</span> <span class="p">{</span>
    <span class="k">case</span> <span class="bp">first</span>
    <span class="k">case</span> <span class="n">second</span> <span class="p">=</span> <span class="s">&#34;2&#34;</span>
    <span class="k">case</span> <span class="n">third</span>
<span class="p">}</span>

<span class="bp">print</span><span class="p">(</span><span class="n">StrFoo</span><span class="p">.</span><span class="bp">first</span><span class="p">.</span><span class="n">rawValue</span><span class="p">)</span>  <span class="c1">// first</span>
<span class="bp">print</span><span class="p">(</span><span class="n">StrFoo</span><span class="p">.</span><span class="n">second</span><span class="p">.</span><span class="n">rawValue</span><span class="p">)</span> <span class="c1">// 2</span>
<span class="bp">print</span><span class="p">(</span><span class="n">StrFoo</span><span class="p">.</span><span class="n">third</span><span class="p">.</span><span class="n">rawValue</span><span class="p">)</span>  <span class="c1">// third</span>
</code></pre></div><h3 id="递归枚举">递归枚举</h3>
<p>递归枚举（Recursive Enumeration）指的是枚举的关联值（Associated Value）类型使用到了该枚举类型本身，此时需要 <code>indirect</code> 修饰：</p>
<div class="highlight"><pre class="chroma"><code class="language-swift" data-lang="swift"><span class="kr">indirect</span> <span class="kd">enum</span> <span class="nc">IndirectBar</span> <span class="p">{</span>
    <span class="k">case</span> <span class="bp">first</span><span class="p">(</span><span class="nb">Int</span><span class="p">)</span>
    <span class="k">case</span> <span class="n">second</span><span class="p">(</span><span class="n">IndirectBar</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">enum</span> <span class="nc">Bar</span> <span class="p">{</span>
    <span class="k">case</span> <span class="bp">first</span><span class="p">(</span><span class="nb">Int</span><span class="p">)</span>
    <span class="kr">indirect</span> <span class="k">case</span> <span class="n">second</span><span class="p">(</span><span class="n">Bar</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">let</span> <span class="nv">bar1</span> <span class="p">=</span> <span class="n">IndirectBar</span><span class="p">.</span><span class="n">second</span><span class="p">(.</span><span class="n">second</span><span class="p">(.</span><span class="n">second</span><span class="p">(.</span><span class="bp">first</span><span class="p">(</span><span class="mi">0</span><span class="p">))))</span>
<span class="kd">let</span> <span class="nv">bar2</span> <span class="p">=</span> <span class="n">Bar</span><span class="p">.</span><span class="n">second</span><span class="p">(.</span><span class="n">second</span><span class="p">(.</span><span class="n">second</span><span class="p">(.</span><span class="bp">first</span><span class="p">(</span><span class="mi">0</span><span class="p">))))</span>

<span class="bp">print</span><span class="p">(</span><span class="n">bar1</span><span class="p">)</span> <span class="c1">// second(demo.IndirectBar.second(demo.IndirectBar.second(demo.IndirectBar.first(0))))</span>
<span class="bp">print</span><span class="p">(</span><span class="n">bar2</span><span class="p">)</span> <span class="c1">// second(demo.Bar.second(demo.Bar.second(demo.Bar.first(0))))</span>
</code></pre></div><h3 id="memorylayout">MemoryLayout</h3>
<p>不同于 Obj-C/C++，Swift 变得更加注重安全且无法直接使用 C/C++ 中的 API，这使得我们剖析 Swift 底层时有些「不踏实」。而 <code>MemoryLayout</code> 正是来帮助我们描述类型的内存布局，提供诸如大小、步进、以及对齐的信息：</p>
<div class="highlight"><pre class="chroma"><code class="language-swift" data-lang="swift"><span class="c1">// 支持泛型</span>

<span class="c1">// size：实际占用的空间大小</span>
<span class="bp">print</span><span class="p">(</span><span class="n">MemoryLayout</span><span class="p">&lt;</span><span class="nb">Int</span><span class="p">&gt;.</span><span class="n">size</span><span class="p">)</span>      <span class="c1">// 8</span>
<span class="c1">// stride：最终分配的空间大小</span>
<span class="bp">print</span><span class="p">(</span><span class="n">MemoryLayout</span><span class="p">&lt;</span><span class="nb">Int</span><span class="p">&gt;.</span><span class="bp">stride</span><span class="p">)</span>    <span class="c1">// 8</span>
<span class="c1">// alignment：内存对齐参数（最终分配的空间大小即其倍数）</span>
<span class="bp">print</span><span class="p">(</span><span class="n">MemoryLayout</span><span class="p">&lt;</span><span class="nb">Int</span><span class="p">&gt;.</span><span class="n">alignment</span><span class="p">)</span> <span class="c1">// 8</span>

<span class="kd">var</span> <span class="nv">intFoo</span> <span class="p">=</span> <span class="mi">100</span> <span class="c1">// 16 * 6 + 4 =&gt; 0x0000000000000064</span>
<span class="kd">var</span> <span class="nv">intBar</span> <span class="p">=</span> <span class="mi">18</span>  <span class="c1">// 16 * 1 + 2 =&gt; 0x0000000000000012</span>

<span class="bp">print</span><span class="p">(</span><span class="n">MemoryLayout</span><span class="p">.</span><span class="n">size</span><span class="p">(</span><span class="n">ofValue</span><span class="p">:</span> <span class="n">intFoo</span><span class="p">))</span>      <span class="c1">// 8</span>
<span class="bp">print</span><span class="p">(</span><span class="n">MemoryLayout</span><span class="p">.</span><span class="bp">stride</span><span class="p">(</span><span class="n">ofValue</span><span class="p">:</span> <span class="n">intFoo</span><span class="p">))</span>    <span class="c1">// 8</span>
<span class="bp">print</span><span class="p">(</span><span class="n">MemoryLayout</span><span class="p">.</span><span class="n">alignment</span><span class="p">(</span><span class="n">ofValue</span><span class="p">:</span> <span class="n">intFoo</span><span class="p">))</span> <span class="c1">// 8</span>

<span class="c1">// 打印值类型变量的内存地址</span>
<span class="bp">withUnsafePointer</span><span class="p">(</span><span class="n">to</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">intFoo</span><span class="p">)</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="s">&#34;</span><span class="si">\(</span><span class="nv">$0</span><span class="si">)</span><span class="s">&#34;</span><span class="p">)</span> <span class="p">}</span> <span class="c1">// 0x0000000100003088</span>

<span class="kd">struct</span> <span class="nc">StructFoo</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nv">a</span> <span class="p">=</span> <span class="mi">1</span> <span class="c1">// 0 + 1 =&gt; 0x0000000000000001</span>
    <span class="kd">var</span> <span class="nv">b</span> <span class="p">=</span> <span class="mi">1</span> <span class="c1">// 0 + 1 =&gt; 0x0000000000000001</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nv">foo</span> <span class="p">=</span> <span class="n">StructFoo</span><span class="p">()</span>
<span class="c1">// 打印结构体类型变量的内存地址</span>
<span class="bp">withUnsafeMutablePointer</span><span class="p">(</span><span class="n">to</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">foo</span><span class="p">)</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="s">&#34;</span><span class="si">\(</span><span class="nv">$0</span><span class="si">)</span><span class="s">&#34;</span><span class="p">)</span> <span class="p">}</span> <span class="c1">// 0x0000000100003098</span>

<span class="c1">// x86_64 / arm64 小端：高位字节存放在高位地址</span>
<span class="c1">// eg. 0x0000000000000064，64 为低位，00 为高位，内存地址从左至右依次升高，64 低位字节存放在低位地址即开头</span>
<span class="c1">// (lldb) memory read 0x0000000100003088</span>
<span class="c1">// 0x100003088: 64 00 00 00 00 00 00 00 12 00 00 00 00 00 00 00  d...............</span>
<span class="c1">// 0x100003098: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................</span>
<span class="c1">// (lldb) memory read 0x0000000100003098</span>
<span class="c1">// 0x100003098: 01 00 00 00 00 00 00 00 01 00 00 00 00 00 00 00  ................</span>
<span class="c1">// 0x1000030a8: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................</span>
</code></pre></div><ul>
<li>另可参考《<a href="https://developer.apple.com/documentation/swift/memorylayout">MemoryLayout - Apple Inc.</a>》</li>
</ul>
<h3 id="main">main</h3>
<p>Swift 项目中没有显式的 <code>main</code> 函数作为整个程序的入口，但当我们断点在 <code>main.swift</code> 中时，Debug Navigator 中仍将展示 <code>0 main</code>，此时打开汇编也会在第一行展示<code>demo`main:</code>。需要注意的是，声明在 <code>main.swift</code> 的变量将类似全局变量，存储在内存的全局区（数据段），可以直接在其它文件中使用：</p>
<div class="highlight"><pre class="chroma"><code class="language-swift" data-lang="swift"><span class="c1">// main.swift</span>

<span class="kd">var</span> <span class="nv">gloA</span> <span class="p">=</span> <span class="mi">100</span>

<span class="bp">withUnsafePointer</span><span class="p">(</span><span class="n">to</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">gloA</span><span class="p">)</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="s">&#34;</span><span class="si">\(</span><span class="nv">$0</span><span class="si">)</span><span class="s">&#34;</span><span class="p">)</span> <span class="p">}</span> <span class="c1">// 0x00000001000031c0</span>
</code></pre></div><h3 id="下标subscript">下标（Subscript）</h3>
<p>下标是指可以在类、结构体、或枚举中定义 <code>subscript</code> 方法，即可使相应实例获得通过下标访问的能力：</p>
<div class="highlight"><pre class="chroma"><code class="language-swift" data-lang="swift"><span class="kd">class</span> <span class="nc">Foo</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nv">a</span> <span class="p">=</span> <span class="mi">10</span>
    <span class="kd">var</span> <span class="nv">b</span> <span class="p">=</span> <span class="mi">20</span>

    <span class="kd">subscript</span><span class="p">(</span><span class="n">index</span><span class="p">:</span> <span class="nb">Int</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="nb">Int</span> <span class="p">{</span> <span class="c1">// 省略 `func` 关键字</span>
        <span class="kr">get</span> <span class="p">{</span>                      <span class="c1">// 通过 subscript 获取，类似计算属性</span>
            <span class="k">switch</span> <span class="n">index</span> <span class="p">{</span>
            <span class="k">case</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">a</span>
            <span class="k">case</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">b</span>
            <span class="k">default</span><span class="p">:</span>
                <span class="bp">fatalError</span><span class="p">(</span><span class="s">&#34;Index out of range.&#34;</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="kr">set</span> <span class="p">{</span>                      <span class="c1">// 通过 subscript 设置，类似计算属性</span>
            <span class="k">switch</span> <span class="n">index</span> <span class="p">{</span>
            <span class="k">case</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">a</span> <span class="p">=</span> <span class="n">newValue</span>
            <span class="k">case</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">b</span> <span class="p">=</span> <span class="n">newValue</span>
            <span class="k">default</span><span class="p">:</span>
                <span class="bp">fatalError</span><span class="p">(</span><span class="s">&#34;Index out of range.&#34;</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nv">foo</span> <span class="p">=</span> <span class="n">Foo</span><span class="p">()</span>

<span class="n">foo</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">=</span> <span class="mi">100</span>
<span class="n">foo</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">=</span> <span class="mi">200</span>

<span class="bp">print</span><span class="p">(</span><span class="n">foo</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="c1">// 100</span>
<span class="bp">print</span><span class="p">(</span><span class="n">foo</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="c1">// 200</span>
</code></pre></div><p>当不实现 <code>set</code> 时，将变成只读下标，即只可以通过下标访问而不能更改。下标支持设置显式的参数标签，以及支持同时多个下标索引；也支持针对于类型的下标，只需要在声明前添加 <code>static</code> 或 <code>class</code> 关键字修饰即可（但需要注意由于 <code>static</code> 修饰的方法将不能被子类重写，下标也同理）：</p>
<div class="highlight"><pre class="chroma"><code class="language-swift" data-lang="swift"><span class="kd">class</span> <span class="nc">Bar</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nv">colmunA</span> <span class="p">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
    <span class="kd">var</span> <span class="nv">columnB</span> <span class="p">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">]</span>

    <span class="kd">static</span> <span class="kd">var</span> <span class="nv">c</span> <span class="p">=</span> <span class="mi">30</span>
    <span class="kd">static</span> <span class="kd">var</span> <span class="nv">d</span> <span class="p">=</span> <span class="mi">40</span>

    <span class="kd">subscript</span><span class="p">(</span><span class="n">i</span> <span class="n">index</span><span class="p">:</span> <span class="nb">Int</span><span class="p">,</span> <span class="n">row</span><span class="p">:</span> <span class="nb">Int</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="nb">Int</span> <span class="p">{</span> <span class="c1">// 只读下标 &amp; 多下标索引</span>
        <span class="kr">get</span> <span class="p">{</span>
            <span class="k">switch</span> <span class="n">index</span> <span class="p">{</span>
            <span class="k">case</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">colmunA</span><span class="p">[</span><span class="n">row</span><span class="p">]</span>
            <span class="k">case</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">columnB</span><span class="p">[</span><span class="n">row</span><span class="p">]</span>
            <span class="k">default</span><span class="p">:</span>
                <span class="bp">fatalError</span><span class="p">(</span><span class="s">&#34;Index out of range.&#34;</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">static</span> <span class="kd">subscript</span><span class="p">(</span><span class="n">index</span><span class="p">:</span> <span class="nb">Int</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="nb">Int</span> <span class="p">{</span>
        <span class="k">switch</span> <span class="n">index</span> <span class="p">{</span>
        <span class="k">case</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">c</span>
        <span class="k">case</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">d</span>
        <span class="k">default</span><span class="p">:</span>
            <span class="bp">fatalError</span><span class="p">(</span><span class="s">&#34;Index out of range.&#34;</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="bp">print</span><span class="p">(</span><span class="n">Bar</span><span class="p">()[</span><span class="n">i</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span> <span class="c1">// 10</span>
<span class="bp">print</span><span class="p">(</span><span class="n">Bar</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>         <span class="c1">// 30</span>
</code></pre></div><p>当为只读下标时，通过下标获取的类型根据是结构体还是类的情况有些许不同：</p>
<div class="highlight"><pre class="chroma"><code class="language-swift" data-lang="swift"><span class="kd">class</span> <span class="nc">ClassFoo</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nv">a</span> <span class="p">=</span> <span class="mi">10</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="nc">StructBar</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nv">b</span> <span class="p">=</span> <span class="mi">20</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">BazByClass</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nv">foo</span> <span class="p">=</span> <span class="n">ClassFoo</span><span class="p">()</span>

    <span class="kd">subscript</span><span class="p">(</span><span class="n">index</span><span class="p">:</span> <span class="nb">Int</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">ClassFoo</span> <span class="p">{</span>
        <span class="kr">get</span> <span class="p">{</span> <span class="n">foo</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">BazByStruct</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nv">bar</span> <span class="p">=</span> <span class="n">StructBar</span><span class="p">()</span>

    <span class="kd">subscript</span><span class="p">(</span><span class="n">index</span><span class="p">:</span> <span class="nb">Int</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">StructBar</span> <span class="p">{</span>
        <span class="kr">get</span> <span class="p">{</span> <span class="n">bar</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nv">baz1</span> <span class="p">=</span> <span class="n">BazByClass</span><span class="p">()</span>
<span class="n">baz1</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">a</span> <span class="p">=</span> <span class="mi">100</span>
<span class="c1">// baz1[0] = ClassFoo() // ERROR: Cannot assign through subscript: subscript is get-only</span>
<span class="bp">print</span><span class="p">(</span><span class="n">baz1</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">a</span><span class="p">)</span>

<span class="kd">var</span> <span class="nv">baz2</span> <span class="p">=</span> <span class="n">BazByStruct</span><span class="p">()</span>
<span class="c1">// baz2[0].b = 200 // ERROR: Cannot assign to property: subscript is get-only</span>
<span class="bp">print</span><span class="p">(</span><span class="n">baz2</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">b</span><span class="p">)</span>
</code></pre></div><p>当只读下标获取的类型为类时（引用类型），只读只针对于指向堆空间实例的地址，即无法设置指向为新的实例，但仍可以读写堆的内存空间；而当只读下标获取的类型为结构体时（值类型），将无法通过下标设置结构体变量的值，那么想要修改就要通过 <code>set</code> 实现：</p>
<div class="highlight"><pre class="chroma"><code class="language-swift" data-lang="swift"><span class="kd">class</span> <span class="nc">BazByStruct2</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nv">bar</span> <span class="p">=</span> <span class="n">StructBar</span><span class="p">()</span>

    <span class="kd">subscript</span><span class="p">(</span><span class="n">index</span><span class="p">:</span> <span class="nb">Int</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">StructBar</span> <span class="p">{</span>
        <span class="kr">get</span> <span class="p">{</span> <span class="n">bar</span> <span class="p">}</span>
        <span class="kr">set</span> <span class="p">{</span>
            <span class="n">bar</span> <span class="p">=</span> <span class="n">newValue</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nv">baz3</span> <span class="p">=</span> <span class="n">BazByStruct2</span><span class="p">()</span>
<span class="bp">withUnsafeMutablePointer</span><span class="p">(</span><span class="n">to</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">baz3</span><span class="p">.</span><span class="n">bar</span><span class="p">)</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="s">&#34;</span><span class="si">\(</span><span class="nv">$0</span><span class="si">)</span><span class="s">&#34;</span><span class="p">)</span> <span class="p">}</span> <span class="c1">// 0x0000000100523ac0</span>
<span class="n">baz3</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">b</span> <span class="p">=</span> <span class="mi">200</span>
<span class="bp">withUnsafeMutablePointer</span><span class="p">(</span><span class="n">to</span><span class="p">:</span> <span class="p">&amp;</span><span class="n">baz3</span><span class="p">.</span><span class="n">bar</span><span class="p">)</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="s">&#34;</span><span class="si">\(</span><span class="nv">$0</span><span class="si">)</span><span class="s">&#34;</span><span class="p">)</span> <span class="p">}</span> <span class="c1">// 0x0000000100523ac0</span>
<span class="bp">print</span><span class="p">(</span><span class="n">baz3</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">b</span><span class="p">)</span> <span class="c1">// 200</span>
</code></pre></div><h3 id="static-与-class">static 与 class</h3>
<p><code>static</code> 和 <code>class</code> 均可以在 <code>class</code> 类型中修饰方法或属性，即类型方法或类型属性。但两者的不同是，<code>static</code> 修饰的方法或属性子类将不能重写：</p>
<div class="highlight"><pre class="chroma"><code class="language-swift" data-lang="swift"><span class="kd">class</span> <span class="nc">Foo</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="kd">var</span> <span class="nv">staticProp</span> <span class="p">=</span> <span class="mi">1</span>
    <span class="kd">static</span> <span class="kd">func</span> <span class="nf">staticFunc</span><span class="p">()</span> <span class="p">{</span> <span class="p">}</span>

    <span class="kd">class</span> <span class="nc">var</span> <span class="n">classProp</span><span class="p">:</span> <span class="nb">Int</span> <span class="p">{</span> <span class="mi">1</span> <span class="p">}</span>
    <span class="kd">class</span> <span class="nc">func</span> <span class="n">classFunc</span><span class="p">()</span> <span class="p">{</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">SubFoo</span><span class="p">:</span> <span class="n">Foo</span> <span class="p">{</span>
    <span class="c1">// static 修饰的属性 / 方法不可被重写</span>
    <span class="c1">// ERROR: Cannot override static property</span>
<span class="c1">//    static var staticProp: Int {</span>
<span class="c1">//        get { super.staticProp }</span>
<span class="c1">//        set { super.staticProp = newValue }</span>
<span class="c1">//    }</span>

    <span class="c1">// ERROR: Cannot override static method</span>
<span class="c1">//    static func staticFunc() { }</span>
    
    <span class="c1">// class 修饰的属性 / 方法可被重写</span>
    <span class="kr">override</span> <span class="kd">class</span> <span class="nc">var</span> <span class="n">classProp</span><span class="p">:</span> <span class="nb">Int</span> <span class="p">{</span>
        <span class="kr">get</span> <span class="p">{</span> <span class="kc">super</span><span class="p">.</span><span class="n">staticProp</span> <span class="p">}</span>
        <span class="kr">set</span> <span class="p">{</span> <span class="kc">super</span><span class="p">.</span><span class="n">staticProp</span> <span class="p">=</span> <span class="n">newValue</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="kr">override</span> <span class="kd">static</span> <span class="kd">func</span> <span class="nf">classFunc</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">SubSubFoo</span><span class="p">:</span> <span class="n">SubFoo</span> <span class="p">{</span>
    <span class="c1">// 二次重写时使用 class 修饰，子类仍可重写</span>
    <span class="kr">override</span> <span class="kd">class</span> <span class="nc">var</span> <span class="n">classProp</span><span class="p">:</span> <span class="nb">Int</span> <span class="p">{</span>
        <span class="kr">get</span> <span class="p">{</span> <span class="kc">super</span><span class="p">.</span><span class="n">staticProp</span> <span class="p">}</span>
        <span class="kr">set</span> <span class="p">{</span> <span class="kc">super</span><span class="p">.</span><span class="n">staticProp</span> <span class="p">=</span> <span class="n">newValue</span> <span class="o">+</span> <span class="mi">2</span> <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// 二次重写时使用 static 修饰，子类将不可重写</span>
    <span class="c1">// ERROR: Cannot override static method</span>
<span class="c1">//    override class func classFunc() {}</span>
<span class="p">}</span>
</code></pre></div><h3 id="any-与-anyobject">Any 与 AnyObject</h3>
<p>Swift 中的 <code>Any</code> 类型可以代表包括结构体、枚举、类、函数等任意类型；<code>AnyObject</code> 类型仅可以代表任意 <code>class</code> 类型。</p>
<div class="highlight"><pre class="chroma"><code class="language-swift" data-lang="swift"><span class="kd">struct</span> <span class="nc">Foo</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nv">foo</span> <span class="p">=</span> <span class="mi">1</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">Bar</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nv">bar</span> <span class="p">=</span> <span class="mi">2</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">AnotherBar</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nv">bar</span> <span class="p">=</span> <span class="mi">3</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">baz</span><span class="p">()</span> <span class="p">{}</span>

<span class="kd">var</span> <span class="nv">any</span><span class="p">:</span> <span class="nb">Any</span> <span class="p">=</span> <span class="mi">10</span>
<span class="n">any</span> <span class="p">=</span> <span class="mf">3.14</span>
<span class="n">any</span> <span class="p">=</span> <span class="n">Foo</span><span class="p">()</span>
<span class="n">any</span> <span class="p">=</span> <span class="n">Bar</span><span class="p">()</span>
<span class="n">any</span> <span class="p">=</span> <span class="n">baz</span>

<span class="kd">var</span> <span class="nv">anyObject</span><span class="p">:</span> <span class="nb">AnyObject</span> <span class="p">=</span> <span class="n">Bar</span><span class="p">()</span>
<span class="n">anyObject</span> <span class="p">=</span> <span class="n">AnotherBar</span><span class="p">()</span>
<span class="c1">// ERROR: Value of type &#39;Foo&#39; expected to be an instance of a class or class-constrained type in assignment</span>
<span class="c1">// anyObject = Foo()</span>
</code></pre></div><p>当 Swift 的协议遵守 <code>AnyObject</code> 时，该协议将只能被类遵守：</p>
<div class="highlight"><pre class="chroma"><code class="language-swift" data-lang="swift"><span class="kd">protocol</span> <span class="nc">ProtocolA</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">a</span><span class="p">()</span>
<span class="p">}</span>

<span class="kd">protocol</span> <span class="nc">ProtocolB</span><span class="p">:</span> <span class="nb">AnyObject</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">b</span><span class="p">()</span>
<span class="p">}</span>

<span class="c1">// 协议遵守 class 时也将只能被类遵守</span>
<span class="kd">protocol</span> <span class="nc">ProtocolC</span><span class="p">:</span> <span class="kd">class</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">c</span><span class="p">()</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="nc">Foo</span><span class="p">:</span> <span class="n">ProtocolA</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">a</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="c1">// class Bar: ProtocolA, ProtocolB, ProtocolC {</span>
<span class="kd">class</span> <span class="nc">Bar</span><span class="p">:</span> <span class="n">ProtocolA</span> <span class="o">&amp;</span> <span class="n">ProtocolB</span> <span class="o">&amp;</span> <span class="n">ProtocolC</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">a</span><span class="p">()</span> <span class="p">{}</span>
    <span class="kd">func</span> <span class="nf">b</span><span class="p">()</span> <span class="p">{}</span>
    <span class="kd">func</span> <span class="nf">c</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">}</span>
</code></pre></div><ul>
<li>另可参考《<a href="../../2019/type_introspection_and_reflection/">Obj-C &amp; Swift 的类型内省与反射</a>》</li>
</ul>
<h3 id="tselfttypeself-与-typeof">T.self、T.Type、Self 与 type(of:)</h3>
<p>若 <code>T</code> 为某一类型，<code>T.self</code> 是元类型（Metatype）的指针，类型为 <code>T.Type</code>，元类型中存储了类型本身的信息：</p>
<div class="highlight"><pre class="chroma"><code class="language-swift" data-lang="swift"><span class="kd">class</span> <span class="nc">Foo</span> <span class="p">{</span> <span class="p">}</span>
<span class="kd">struct</span> <span class="nc">Bar</span> <span class="p">{</span> <span class="p">}</span>

<span class="kd">var</span> <span class="nv">selfInt</span> <span class="p">=</span> <span class="nb">Int</span><span class="p">.</span><span class="kc">self</span>           <span class="c1">// Int.Type</span>
<span class="kd">var</span> <span class="nv">selfFoo</span><span class="p">:</span> <span class="n">Foo</span><span class="p">.</span><span class="kr">Type</span> <span class="p">=</span> <span class="n">Foo</span><span class="p">.</span><span class="kc">self</span> <span class="c1">// Foo.Type</span>
<span class="kd">var</span> <span class="nv">selfBar</span><span class="p">:</span> <span class="n">Bar</span><span class="p">.</span><span class="kr">Type</span> <span class="p">=</span> <span class="n">Bar</span><span class="p">.</span><span class="kc">self</span> <span class="c1">// Bar.Type</span>

<span class="kd">var</span> <span class="nv">intA</span> <span class="p">=</span> <span class="n">intSelf</span><span class="p">.</span><span class="kd">init</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>       <span class="c1">// 5: Int</span>
</code></pre></div><p><code>AnyClass</code> 是 <code>AnyObject.Type</code> 的类型别名，即任意 <code>class</code> 类型的元类型指针：</p>
<div class="highlight"><pre class="chroma"><code class="language-swift" data-lang="swift"><span class="c1">// Swift / Misc</span>
<span class="kd">public</span> <span class="kd">typealias</span> <span class="nb">AnyClass</span> <span class="p">=</span> <span class="nb">AnyObject</span><span class="p">.</span><span class="kr">Type</span>
</code></pre></div><p>我们可以尝试将其转换为不同的元类型指针，用以构造：</p>
<div class="highlight"><pre class="chroma"><code class="language-swift" data-lang="swift"><span class="kd">class</span> <span class="nc">Foo</span> <span class="p">{</span>
    <span class="kr">required</span> <span class="kd">init</span><span class="p">(</span><span class="kc">_</span> <span class="n">str</span><span class="p">:</span> <span class="nb">String</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">initAnyClass</span><span class="p">(</span><span class="kc">_</span> <span class="n">ac</span><span class="p">:</span> <span class="nb">AnyClass</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="nb">AnyObject</span> <span class="p">{</span>
    <span class="k">if</span> <span class="kd">let</span> <span class="nv">ac</span> <span class="p">=</span> <span class="n">ac</span> <span class="k">as</span><span class="p">?</span> <span class="n">Foo</span><span class="p">.</span><span class="kr">Type</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">ac</span><span class="p">.</span><span class="kd">init</span><span class="p">(</span><span class="s">&#34;ac&#34;</span><span class="p">)</span> <span class="c1">// 编译器已经替我们尝试约束 Foo 所必须具备（required）的 init 方法</span>
    <span class="p">}</span>
    
    <span class="bp">fatalError</span><span class="p">()</span>
<span class="p">}</span>

<span class="bp">print</span><span class="p">(</span><span class="n">initAnyClass</span><span class="p">(</span><span class="n">Foo</span><span class="p">.</span><span class="kc">self</span><span class="p">))</span> <span class="c1">// demo.Foo</span>
</code></pre></div><p><code>Self</code> 代表当前所在的<strong>类型</strong>本身（类似于 Obj-C 中的 <code>instancetype</code>），可定义为函数的返回值：</p>
<div class="highlight"><pre class="chroma"><code class="language-swift" data-lang="swift"><span class="kd">protocol</span> <span class="nc">Protocol</span> <span class="p">{</span>
    <span class="c1">// 在协议中，Self 可作为函数参数使用</span>
    <span class="kd">func</span> <span class="nf">function</span><span class="p">(</span><span class="kc">_</span> <span class="n">param</span><span class="p">:</span> <span class="kc">Self</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">Foo</span><span class="p">:</span> <span class="kr">Protocol</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{}</span>

    <span class="c1">// 必须声明为 required，防止子类声明其它构造方法导致 init() 丢失后无法被调用</span>
    <span class="kr">required</span> <span class="kd">init</span><span class="p">()</span> <span class="p">{</span> <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">-&gt;</span> <span class="kc">Self</span> <span class="p">{</span>
        <span class="c1">// type(of value: T) -&gt; Metatype ：返回参数的类型</span>
        <span class="c1">// 即使子类也可获取类型，并初始化</span>
        <span class="k">return</span> <span class="n">type</span><span class="p">(</span><span class="n">of</span><span class="p">:</span> <span class="kc">self</span><span class="p">).</span><span class="kd">init</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">function</span><span class="p">(</span><span class="kc">_</span> <span class="n">param</span><span class="p">:</span> <span class="n">Foo</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">SubFoo</span><span class="p">:</span> <span class="n">Foo</span> <span class="p">{</span> <span class="p">}</span>

<span class="kd">struct</span> <span class="nc">Bar</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">bar</span><span class="p">()</span> <span class="p">-&gt;</span> <span class="kc">Self</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">type</span><span class="p">(</span><span class="n">of</span><span class="p">:</span> <span class="kc">self</span><span class="p">).</span><span class="kd">init</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p><code>type(of:)</code> 在 Swift 中看似被认为是函数，带有参数与返回值，但从现有汇编中可以得出其本质上并非函数调用：</p>
<div class="highlight"><pre class="chroma"><code class="language-swift" data-lang="swift"><span class="kd">class</span> <span class="nc">Foo</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nv">f</span> <span class="p">=</span> <span class="n">Foo</span><span class="p">()</span>
<span class="kd">var</span> <span class="nv">fType</span> <span class="p">=</span> <span class="n">type</span><span class="p">(</span><span class="n">of</span><span class="p">:</span> <span class="n">f</span><span class="p">)</span>  <span class="c1">// Foo.Type；BREAKPOINT 🔴</span>
<span class="c1">// Foo.self 为指向元类型的指针，即类型信息的地址，因此与 type(of:) 返回值相同</span>
<span class="bp">print</span><span class="p">(</span><span class="n">Foo</span><span class="p">.</span><span class="kc">self</span> <span class="p">==</span> <span class="n">fType</span><span class="p">)</span> <span class="c1">// true</span>
</code></pre></div><p>运行至断点处并查看汇编：</p>
<div class="highlight"><pre class="chroma"><code class="language-asm" data-lang="asm"><span class="nf">demo</span><span class="err">`</span><span class="no">main</span><span class="p">:</span>
    <span class="err">0</span><span class="nf">x100002ad0</span> <span class="err">&lt;+</span><span class="mi">0</span><span class="err">&gt;</span><span class="p">:</span>   <span class="no">pushq</span>  <span class="nv">%rbp</span>
    <span class="err">0</span><span class="nf">x100002ad1</span> <span class="err">&lt;+</span><span class="mi">1</span><span class="err">&gt;</span><span class="p">:</span>   <span class="no">movq</span>   <span class="nv">%rsp</span><span class="p">,</span> <span class="nv">%rbp</span>
    <span class="err">0</span><span class="nf">x100002ad4</span> <span class="err">&lt;+</span><span class="mi">4</span><span class="err">&gt;</span><span class="p">:</span>   <span class="no">pushq</span>  <span class="nv">%r13</span>
    <span class="err">0</span><span class="nf">x100002ad6</span> <span class="err">&lt;+</span><span class="mi">6</span><span class="err">&gt;</span><span class="p">:</span>   <span class="no">subq</span>   <span class="no">$0x58</span><span class="p">,</span> <span class="nv">%rsp</span>
    <span class="err">0</span><span class="nf">x100002ada</span> <span class="err">&lt;+</span><span class="mi">10</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">xorl</span>   <span class="nv">%eax</span><span class="p">,</span> <span class="nv">%eax</span>
    <span class="err">0</span><span class="nf">x100002adc</span> <span class="err">&lt;+</span><span class="mi">12</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">movl</span>   <span class="nv">%eax</span><span class="p">,</span> <span class="nv">%ecx</span>
    <span class="err">0</span><span class="nf">x100002ade</span> <span class="err">&lt;+</span><span class="mi">14</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">movl</span>   <span class="nv">%edi</span><span class="p">,</span> <span class="p">-</span><span class="mi">0x24</span><span class="p">(</span><span class="nv">%rbp</span><span class="p">)</span>
    <span class="err">0</span><span class="nf">x100002ae1</span> <span class="err">&lt;+</span><span class="mi">17</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">movq</span>   <span class="nv">%rcx</span><span class="p">,</span> <span class="nv">%rdi</span>
    <span class="err">0</span><span class="nf">x100002ae4</span> <span class="err">&lt;+</span><span class="mi">20</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">movq</span>   <span class="nv">%rsi</span><span class="p">,</span> <span class="p">-</span><span class="mi">0x30</span><span class="p">(</span><span class="nv">%rbp</span><span class="p">)</span>
    <span class="err">0</span><span class="nf">x100002ae8</span> <span class="err">&lt;+</span><span class="mi">24</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">callq</span>  <span class="mi">0x100002b80</span>               <span class="c">; type metadata accessor for demo.Foo at &lt;compiler-generated&gt;
</span><span class="c"></span>    <span class="mi">0x100002aed</span> <span class="err">&lt;+</span><span class="mi">29</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">movq</span>   <span class="nv">%rax</span><span class="p">,</span> <span class="nv">%r13</span>
    <span class="err">0</span><span class="nf">x100002af0</span> <span class="err">&lt;+</span><span class="mi">32</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">movq</span>   <span class="nv">%rdx</span><span class="p">,</span> <span class="p">-</span><span class="mi">0x38</span><span class="p">(</span><span class="nv">%rbp</span><span class="p">)</span>
    <span class="err">0</span><span class="nf">x100002af4</span> <span class="err">&lt;+</span><span class="mi">36</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">callq</span>  <span class="mi">0x100002c20</span>               <span class="c">; demo.Foo.__allocating_init() -&gt; demo.Foo at main.swift:3
</span><span class="c"></span>    <span class="c">; 将 rip（0x100002b00）+ 0x57b8（0x1000082B8）存储在 rcx 寄存器中（全局变量 f）
</span><span class="c"></span>    <span class="mi">0x100002af9</span> <span class="err">&lt;+</span><span class="mi">41</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">leaq</span>   <span class="mi">0x57b8</span><span class="p">(</span><span class="nv">%rip</span><span class="p">),</span> <span class="nv">%rcx</span>        <span class="c">; demo.f : demo.Foo
</span><span class="c"></span>    <span class="mi">0x100002b00</span> <span class="err">&lt;+</span><span class="mi">48</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">xorl</span>   <span class="nv">%r8d</span><span class="p">,</span> <span class="nv">%r8d</span>
    <span class="err">0</span><span class="nf">x100002b03</span> <span class="err">&lt;+</span><span class="mi">51</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">movl</span>   <span class="nv">%r8d</span><span class="p">,</span> <span class="nv">%edx</span>
    <span class="err">0</span><span class="nf">x100002b06</span> <span class="err">&lt;+</span><span class="mi">54</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">movq</span>   <span class="nv">%rax</span><span class="p">,</span> <span class="mi">0x57ab</span><span class="p">(</span><span class="nv">%rip</span><span class="p">)</span>        <span class="c">; demo.f : demo.Foo
</span><span class="c"></span><span class="p">-</span><span class="err">&gt;</span>  <span class="mi">0x100002b0d</span> <span class="err">&lt;+</span><span class="mi">61</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">movq</span>   <span class="nv">%rcx</span><span class="p">,</span> <span class="nv">%rdi</span>
    <span class="err">0</span><span class="nf">x100002b10</span> <span class="err">&lt;+</span><span class="mi">64</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">leaq</span>   <span class="p">-</span><span class="mi">0x20</span><span class="p">(</span><span class="nv">%rbp</span><span class="p">),</span> <span class="nv">%rsi</span>
    <span class="err">0</span><span class="nf">x100002b14</span> <span class="err">&lt;+</span><span class="mi">68</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">movl</span>   <span class="no">$0x20</span><span class="p">,</span> <span class="nv">%eax</span>
    <span class="err">0</span><span class="nf">x100002b19</span> <span class="err">&lt;+</span><span class="mi">73</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">movq</span>   <span class="nv">%rdx</span><span class="p">,</span> <span class="p">-</span><span class="mi">0x40</span><span class="p">(</span><span class="nv">%rbp</span><span class="p">)</span>
    <span class="err">0</span><span class="nf">x100002b1d</span> <span class="err">&lt;+</span><span class="mi">77</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">movq</span>   <span class="nv">%rax</span><span class="p">,</span> <span class="nv">%rdx</span>
    <span class="err">0</span><span class="nf">x100002b20</span> <span class="err">&lt;+</span><span class="mi">80</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">movq</span>   <span class="p">-</span><span class="mi">0x40</span><span class="p">(</span><span class="nv">%rbp</span><span class="p">),</span> <span class="nv">%rcx</span>
    <span class="err">0</span><span class="nf">x100002b24</span> <span class="err">&lt;+</span><span class="mi">84</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">callq</span>  <span class="mi">0x100003d12</span>               <span class="c">; symbol stub for: swift_beginAccess
</span><span class="c"></span>    <span class="c">; 移动 rip（0x100002b30）+ 0x5788（0x1000082B8，全局变量 f，即 Foo 类型对象的指针）至 rax 寄存器
</span><span class="c"></span>    <span class="mi">0x100002b29</span> <span class="err">&lt;+</span><span class="mi">89</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">movq</span>   <span class="mi">0x5788</span><span class="p">(</span><span class="nv">%rip</span><span class="p">),</span> <span class="nv">%rax</span>        <span class="c">; demo.f : demo.Foo
</span><span class="c"></span>    <span class="mi">0x100002b30</span> <span class="err">&lt;+</span><span class="mi">96</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">movq</span>   <span class="nv">%rax</span><span class="p">,</span> <span class="nv">%rcx</span>
    <span class="err">0</span><span class="nf">x100002b33</span> <span class="err">&lt;+</span><span class="mi">99</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">movq</span>   <span class="nv">%rcx</span><span class="p">,</span> <span class="nv">%rdi</span>
    <span class="c">; 移动 rax 寄存器内容至 rbp - 0x48
</span><span class="c"></span>    <span class="err">0</span><span class="nf">x100002b36</span> <span class="err">&lt;+</span><span class="mi">102</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">movq</span>   <span class="nv">%rax</span><span class="p">,</span> <span class="p">-</span><span class="mi">0x48</span><span class="p">(</span><span class="nv">%rbp</span><span class="p">)</span>
    <span class="err">0</span><span class="nf">x100002b3a</span> <span class="err">&lt;+</span><span class="mi">106</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">callq</span>  <span class="mi">0x100003d2a</span>               <span class="c">; symbol stub for: swift_retain
</span><span class="c"></span>    <span class="mi">0x100002b3f</span> <span class="err">&lt;+</span><span class="mi">111</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">leaq</span>   <span class="p">-</span><span class="mi">0x20</span><span class="p">(</span><span class="nv">%rbp</span><span class="p">),</span> <span class="nv">%rdi</span>
    <span class="err">0</span><span class="nf">x100002b43</span> <span class="err">&lt;+</span><span class="mi">115</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">movq</span>   <span class="nv">%rax</span><span class="p">,</span> <span class="p">-</span><span class="mi">0x50</span><span class="p">(</span><span class="nv">%rbp</span><span class="p">)</span>
    <span class="err">0</span><span class="nf">x100002b47</span> <span class="err">&lt;+</span><span class="mi">119</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">callq</span>  <span class="mi">0x100003d1e</span>               <span class="c">; symbol stub for: swift_endAccess
</span><span class="c"></span>    <span class="c">; 移动 rbp - 0x48 内容至 rax 寄存器
</span><span class="c"></span>    <span class="mi">0x100002b4c</span> <span class="err">&lt;+</span><span class="mi">124</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">movq</span>   <span class="p">-</span><span class="mi">0x48</span><span class="p">(</span><span class="nv">%rbp</span><span class="p">),</span> <span class="nv">%rax</span>
    <span class="c">; 取 rax 寄存器内容所指向的内存空间的内容（前八个字节，即类型信息）至 rcx 寄存器
</span><span class="c"></span>    <span class="err">0</span><span class="nf">x100002b50</span> <span class="err">&lt;+</span><span class="mi">128</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">movq</span>   <span class="p">(</span><span class="nv">%rax</span><span class="p">),</span> <span class="nv">%rcx</span>
    <span class="err">0</span><span class="nf">x100002b53</span> <span class="err">&lt;+</span><span class="mi">131</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">movq</span>   <span class="nv">%rax</span><span class="p">,</span> <span class="nv">%rdi</span>
    <span class="c">; 移动 rcx 寄存器内容至 rbp - 0x58
</span><span class="c"></span>    <span class="err">0</span><span class="nf">x100002b56</span> <span class="err">&lt;+</span><span class="mi">134</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">movq</span>   <span class="nv">%rcx</span><span class="p">,</span> <span class="p">-</span><span class="mi">0x58</span><span class="p">(</span><span class="nv">%rbp</span><span class="p">)</span>
    <span class="err">0</span><span class="nf">x100002b5a</span> <span class="err">&lt;+</span><span class="mi">138</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">callq</span>  <span class="mi">0x100003d24</span>               <span class="c">; symbol stub for: swift_release
</span><span class="c"></span>    <span class="mi">0x100002b5f</span> <span class="err">&lt;+</span><span class="mi">143</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">xorl</span>   <span class="nv">%eax</span><span class="p">,</span> <span class="nv">%eax</span>
    <span class="c">; 移动 rbp - 0x58 内容至 rcx 寄存器
</span><span class="c"></span>    <span class="err">0</span><span class="nf">x100002b61</span> <span class="err">&lt;+</span><span class="mi">145</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">movq</span>   <span class="p">-</span><span class="mi">0x58</span><span class="p">(</span><span class="nv">%rbp</span><span class="p">),</span> <span class="nv">%rcx</span>
    <span class="c">; 移动 rcx 寄存器内容（前八个字节）至 rip + 0x5754（全局变量 fType）
</span><span class="c"></span>    <span class="err">0</span><span class="nf">x100002b65</span> <span class="err">&lt;+</span><span class="mi">149</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">movq</span>   <span class="nv">%rcx</span><span class="p">,</span> <span class="mi">0x5754</span><span class="p">(</span><span class="nv">%rip</span><span class="p">)</span>        <span class="c">; demo.fType : demo.Foo.Type
</span><span class="c"></span>    <span class="mi">0x100002b6c</span> <span class="err">&lt;+</span><span class="mi">156</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">addq</span>   <span class="no">$0x58</span><span class="p">,</span> <span class="nv">%rsp</span>
    <span class="err">0</span><span class="nf">x100002b70</span> <span class="err">&lt;+</span><span class="mi">160</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">popq</span>   <span class="nv">%r13</span>
    <span class="err">0</span><span class="nf">x100002b72</span> <span class="err">&lt;+</span><span class="mi">162</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">popq</span>   <span class="nv">%rbp</span>
    <span class="err">0</span><span class="nf">x100002b73</span> <span class="err">&lt;+</span><span class="mi">163</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">retq</span>
</code></pre></div><h3 id="customstringconvertible">CustomStringConvertible</h3>
<div class="highlight"><pre class="chroma"><code class="language-swift" data-lang="swift"><span class="kd">public</span> <span class="kd">protocol</span> <span class="nc">CustomStringConvertible</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nv">description</span><span class="p">:</span> <span class="nb">String</span> <span class="p">{</span> <span class="kr">get</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kd">public</span> <span class="kd">protocol</span> <span class="nc">LosslessStringConvertible</span> <span class="p">:</span> <span class="n">CustomStringConvertible</span> <span class="p">{</span>
    <span class="kd">init</span><span class="p">?(</span><span class="kc">_</span> <span class="n">description</span><span class="p">:</span> <span class="nb">String</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">public</span> <span class="kd">protocol</span> <span class="nc">CustomDebugStringConvertible</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nv">debugDescription</span><span class="p">:</span> <span class="nb">String</span> <span class="p">{</span> <span class="kr">get</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p><code>CustomStringConvertible</code> 协议中只有一个 <code>description</code> 属性，类似 Obj-C 中 <code>NSObject</code> 的 <code>description</code> 方法，Swift 中的类型可以通过实现该协议在需要打印对象的时候进行自定义表示。<code>LosslessStringConvertible</code> 协议继承自 <code>CustomStringConvertible</code>，提供了从表示到对象的可失败构造方法。<code>CustomDebugStringConvertible</code> 则提供了更多 Debug 下常用的对象打印，如 <code>debugPrint</code> 与 LLDB 的 <code>po</code> 命令：</p>
<div class="highlight"><pre class="chroma"><code class="language-swift" data-lang="swift"><span class="c1">// Swift / Misc</span>

<span class="kd">struct</span> <span class="nc">Foo</span><span class="p">:</span> <span class="n">CustomStringConvertible</span><span class="p">,</span>
            <span class="n">LosslessStringConvertible</span><span class="p">,</span>
            <span class="n">CustomDebugStringConvertible</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nv">foo</span><span class="p">:</span> <span class="nb">String</span>
    
    <span class="kd">init</span><span class="p">?(</span><span class="kc">_</span> <span class="n">description</span><span class="p">:</span> <span class="nb">String</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">foo</span> <span class="p">=</span> <span class="n">description</span>
    <span class="p">}</span>
    
    <span class="kd">var</span> <span class="nv">description</span><span class="p">:</span> <span class="nb">String</span> <span class="p">{</span>
        <span class="s">&#34;Foo - </span><span class="si">\(</span><span class="n">foo</span><span class="si">)</span><span class="s">&#34;</span>
    <span class="p">}</span>
    
    <span class="kd">var</span> <span class="nv">debugDescription</span><span class="p">:</span> <span class="nb">String</span> <span class="p">{</span>
        <span class="s">&#34;Debug - Foo - </span><span class="si">\(</span><span class="n">foo</span><span class="si">)</span><span class="s">&#34;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">let</span> <span class="nv">f</span> <span class="p">=</span> <span class="n">Foo</span><span class="p">(</span><span class="s">&#34;foo&#34;</span><span class="p">)</span><span class="o">!</span>

<span class="bp">print</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>      <span class="c1">// Foo - foo，BREAKPOINT 🔴</span>
<span class="bp">debugPrint</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="c1">// Debug - Foo - foo</span>

<span class="c1">// LLDB:</span>
<span class="c1">// (lldb) po f</span>
<span class="c1">// ▿ Debug - Foo - foo</span>
<span class="c1">//   - foo : &#34;foo&#34;</span>
<span class="c1">// (lldb) p f</span>
<span class="c1">// (demo.Foo) $R4 = (foo = &#34;foo&#34;) </span>
</code></pre></div><blockquote>
<p><strong>默认情况</strong></p>
<p>当未实现 <code>CustomStringConvertible</code> 协议时，<code>print</code>、<code>debugPrint</code>、<code>po</code> 均可正常使用，表现如下；当仅实现 <code>CustomStringConvertible</code> 协议时，<code>debugPrint</code> 与 <code>po</code> 将默认以实现的 <code>description</code> 为准，表现如下：</p>
<div class="highlight"><pre class="chroma"><code class="language-swift" data-lang="swift"><span class="kd">struct</span> <span class="nc">Bar</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nv">bar</span><span class="p">:</span> <span class="nb">String</span>
<span class="p">}</span>

<span class="kd">let</span> <span class="nv">bar</span> <span class="p">=</span> <span class="n">Bar</span><span class="p">(</span><span class="n">bar</span><span class="p">:</span> <span class="s">&#34;bar&#34;</span><span class="p">)</span>

<span class="bp">print</span><span class="p">(</span><span class="n">bar</span><span class="p">)</span>      <span class="c1">// Bar(bar: &#34;bar&#34;)</span>
<span class="bp">debugPrint</span><span class="p">(</span><span class="n">bar</span><span class="p">)</span> <span class="c1">// demo.Bar(bar: &#34;bar&#34;)</span>

<span class="kd">struct</span> <span class="nc">Baz</span><span class="p">:</span> <span class="n">CustomStringConvertible</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nv">baz</span><span class="p">:</span> <span class="nb">String</span>
    
    <span class="kd">var</span> <span class="nv">description</span><span class="p">:</span> <span class="nb">String</span> <span class="p">{</span>
        <span class="s">&#34;Baz - </span><span class="si">\(</span><span class="n">baz</span><span class="si">)</span><span class="s">&#34;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">let</span> <span class="nv">baz</span> <span class="p">=</span> <span class="n">Baz</span><span class="p">(</span><span class="n">baz</span><span class="p">:</span> <span class="s">&#34;baz&#34;</span><span class="p">)</span>

<span class="bp">print</span><span class="p">(</span><span class="n">baz</span><span class="p">)</span>      <span class="c1">// Baz - baz，BREAKPOINT 🔴</span>
<span class="bp">debugPrint</span><span class="p">(</span><span class="n">baz</span><span class="p">)</span> <span class="c1">// Baz - baz</span>

<span class="c1">// LLDB:</span>
<span class="c1">// (lldb) po bar</span>
<span class="c1">// ▿ Bar</span>
<span class="c1">//   - bar : &#34;bar&#34;</span>
<span class="c1">// (lldb) po baz</span>
<span class="c1">// ▿ Baz - baz</span>
<span class="c1">//   - baz : &#34;baz&#34;</span>
</code></pre></div></blockquote>
<h3 id="断言assert">断言（assert）</h3>
<p>我们常在 Debug 模式下使用断言来保证代码的健壮性。默认情况下，Swift 中的断言仅在 Debug 模式下生效，但我们也可以通过编译选项配置：</p>
<table>
<thead>
<tr>
<th style="text-align:center">Other Swift Flags</th>
<th style="text-align:center">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">-assert-config Release</td>
<td style="text-align:center">断言失效</td>
</tr>
<tr>
<td style="text-align:center">-assert-config Debug</td>
<td style="text-align:center">断言生效</td>
</tr>
</tbody>
</table>
<!-- ### API & ABI

- API（Application Programming Interface，应用程序编程接口）：源代码和库之间的接口。
- ABI（Application Binary Interface，应用程序二进制接口）：
  - 应用程序与操作系统之间的底层接口
  - 涉及的内容有：
    - 目标文件格式（eg. Mach-O）
    - 数据类型的大小 / 布局 / 对齐（eg. 基本类型占用的内存大小）
    - 函数调用约定（eg. 函数调用时使用栈空间还是寄存器、函数参数的入栈顺序）等 -->
</div>
                    <div class="post_footer">
                        
                        <div class="meta">
                            <div class="info">
                                <span class="field tags">
                                    <i class="ri-stack-line"></i>
                                    
                                    <a href="https://kingcos.me/tags/swift/">Swift</a>
                                    
                                    <a href="https://kingcos.me/tags/swift-%E6%8B%BE%E9%81%97/">Swift 拾遗</a>
                                    
                                </span>
                            </div>
                        </div>
                        
                    </div>
                </div>
                <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<table style="border: 0;">
  <tr>
  <td style="border: 0; width: 30%;">
    <img width='100%' src='/img/about/1.jpg'>
  </td>
  <td style="border: 0; width: 50%;">
    <ins class="adsbygoogle"
     style="display:block;width:100%;"
     data-ad-client="ca-pub-9925978992661955"
     data-ad-slot="3213735320"
     data-ad-format="rectangle"
     data-full-width-responsive="false"></ins>
  </td>
  </tr>
</table>

<hr>

<script>
    (adsbygoogle = window.adsbygoogle || []).push({});
</script>
                
                
                <div class="doc_comments"><div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "kingcos" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a></div>
                
            </div>
        </div>
    </div>
    <a id="back_to_top" href="#" class="back_to_top"><i class="ri-arrow-up-s-line"></i></a>
    <footer class="footer">
    <div class="powered_by">
        <a href="https://kingcos.me">Powered by kingcos with love.</a>
    </div>

    <div class="footer_slogan">
        <span>❤️</span>
    </div>
</footer>
    <script src="https://kingcos.me/js/jquery-3.5.1.min.js"></script>
<link href="https://kingcos.me/css/fancybox.min.css" rel="stylesheet">
<script src="https://kingcos.me/js/fancybox.min.js"></script>
<script src="https://kingcos.me/js/zozo.js"></script>


<script type="text/javascript" async
    src="https://cdn.bootcss.com/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
        MathJax.Hub.Config({
            tex2jax: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\[\[', '\]\]']],
                processEscapes: true,
                processEnvironments: true,
                skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
                TeX: {
                    equationNumbers: { autoNumber: "AMS" },
                    extensions: ["AMSmath.js", "AMSsymbols.js"]
                }
            }
        });

        MathJax.Hub.Queue(function () {
            
            
            
            var all = MathJax.Hub.getAllJax(), i;
            for (i = 0; i < all.length; i += 1) {
                all[i].SourceElement().parentNode.className += ' has-jax';
            }
        });
    </script>

<style>
    code.has-jax {
        font: inherit;
        font-size: 100%;
        background: inherit;
        border: inherit;
        color: #515151;
    }
</style>



<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-138311951-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</body>

</html>