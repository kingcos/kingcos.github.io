<!DOCTYPE html>
<html lang="en">
  <head>
    
      <title>从 0 开始使用 Docker 快速搭建 Hadoop 集群环境 :: iBlog — github.com/kingcos</title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content="Date Notes Hadoop Other     2017-03-27 首次提交 2.7.2 Docker CE, IntelliJ IDEA 2016.3    Preface 自从学习 iOS/Swift 以来，就没有太多时间分配给 Java 专业课，毕竟我不是个三心二用还能样样学好的人。不过作为大三的专业课，分布式计算技术还是有去上课的，毕竟不能最后挂科吧 :]
曾有人说，「开发一个项目，至少有 50% 时间在配置环境」。确实，在折腾了三周的课时之后，我才按照老师给的详细步骤配置好 Hadoop 的环境。尽管如此，由于种种原因，班里仍有很多同学还没有配置好 Hadoop 的环境，导致课程一直停滞。在偶然中，我想到了 Docker，Docker 这个词我至少在半年前已经听说（当然，恕我孤陋寡闻，Docker 早在 13 年即发行），但一直没有去了解和使用。时至今日，我对 Docker 的了解也十分少，简单的来说，Docker 是一种容器（Container）管理工具，通过 Docker 我们可以配置可移植的环境，方便发布。Docker 基于 Linux，但也提供了 macOS 和 Windows 桌面版，方便在我们的本地机器测试、使用。
虽然本文是一个小白向的文章，但下载和安装的过程也不会在本文涉及。一是官方网站必然提供了相应的教程，纯粹的翻译毫无意义；二是下载和安装可能随着后续更新发生略微的区别，而本文只着眼于配置 Hadoop 集群环境的搭建。
不过由于个人对 Hadoop 和 Docker 的了解甚少，如有错误，希望指出，我会学习、改正。
Linux  Info: Ubuntu 16.10 x64   Docker 本身就是基于 Linux 的，所以首先以我的一台服务器做实验。虽然最后跑 wordcount 已经由于内存不足而崩掉，但是之前的过程还是可以参考的。"/>
<meta name="keywords" content="ios,swift,objective-c,obj-c,objc,oc,geek,python,ruby"/>
<meta name="robots" content="noodp"/>
<link rel="canonical" href="/posts/2017/docker_for_hadoop/" />





<link rel="stylesheet" href="/assets/style.css">


<link rel="stylesheet" href="/style.css">


<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/img/apple-touch-icon-144-precomposed.png">
<link rel="shortcut icon" href="/img/favicon.png">


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="从 0 开始使用 Docker 快速搭建 Hadoop 集群环境"/>
<meta name="twitter:description" content="从 0 开始使用 Docker 快速搭建 Hadoop 集群环境。"/>



<meta property="og:title" content="从 0 开始使用 Docker 快速搭建 Hadoop 集群环境" />
<meta property="og:description" content="从 0 开始使用 Docker 快速搭建 Hadoop 集群环境。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/2017/docker_for_hadoop/" />
<meta property="article:published_time" content="2017-03-27T00:00:00+00:00" />
<meta property="article:modified_time" content="2017-03-27T00:00:00+00:00" /><meta property="og:site_name" content="iBlog" />






  </head>
  <body class="dark-theme">
    <div class="container">
      <header class="header">
  <span class="header__inner">
    <a href="/" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367"/>
</svg>
</span>
    <span class="logo__text">iBlog</span>
    <span class="logo__cursor"></span>
  
</a>

    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/about">About &amp; AMA</a></li>
        
      
        
          <li><a href="/links">Links</a></li>
        
      
        
          <li><a href="/perspective">Perspective</a></li>
        
      
        
          <li><a href="/words">Words</a></li>
        
      
      
    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/about">About &amp; AMA</a></li>
      
    
      
        <li><a href="/links">Links</a></li>
      
    
      
        <li><a href="/perspective">Perspective</a></li>
      
    
      
        <li><a href="/words">Words</a></li>
      
    
  </ul>
</nav>

        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none"/>
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
          </svg>
        </span>
      
      <span class="theme-toggle">
        <svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>

      </span>
    </span>
  </span>
</header>


      <div class="content">
        
  <div class="post">
    <h2 class="post-title"><a href="/posts/2017/docker_for_hadoop/">从 0 开始使用 Docker 快速搭建 Hadoop 集群环境</a></h2>
    <div class="post-meta">
      
        <span class="post-date">
            2017-03-27
        </span>
      
      
      
        <span class="post-read-time">— 3 min read</span>
      
    </div>

    
      <span class="post-tags">
        
          #<a href="/tags/practice/">Practice</a>&nbsp;
        
          #<a href="/tags/hadoop/">Hadoop</a>&nbsp;
        
          #<a href="/tags/docker/">Docker</a>&nbsp;
        
          #<a href="/tags/java/">Java</a>&nbsp;
        
      </span>
    

    

    <div class="post-content">
      

<table>
<thead>
<tr>
<th align="center">Date</th>
<th align="center">Notes</th>
<th align="center">Hadoop</th>
<th align="center">Other</th>
</tr>
</thead>

<tbody>
<tr>
<td align="center">2017-03-27</td>
<td align="center">首次提交</td>
<td align="center">2.7.2</td>
<td align="center">Docker CE, IntelliJ IDEA 2016.3</td>
</tr>
</tbody>
</table>

<h2 id="preface">Preface</h2>

<p>自从学习 iOS/Swift 以来，就没有太多时间分配给 Java 专业课，毕竟我不是个三心二用还能样样学好的人。不过作为大三的专业课，分布式计算技术还是有去上课的，毕竟不能最后挂科吧 :]</p>

<p>曾有人说，「开发一个项目，至少有 50% 时间在配置环境」。确实，在折腾了三周的课时之后，我才按照老师给的详细步骤配置好 Hadoop 的环境。尽管如此，由于种种原因，班里仍有很多同学还没有配置好 Hadoop 的环境，导致课程一直停滞。在偶然中，我想到了 Docker，Docker 这个词我至少在半年前已经听说（当然，恕我孤陋寡闻，Docker 早在 13 年即发行），但一直没有去了解和使用。时至今日，我对 Docker 的了解也十分少，简单的来说，Docker 是一种容器（Container）管理工具，通过 Docker 我们可以配置可移植的环境，方便发布。Docker 基于 Linux，但也提供了 macOS 和 Windows 桌面版，方便在我们的本地机器测试、使用。</p>

<p>虽然本文是一个小白向的文章，但下载和安装的过程也不会在本文涉及。一是官方网站必然提供了相应的教程，纯粹的翻译毫无意义；二是下载和安装可能随着后续更新发生略微的区别，而本文只着眼于配置 Hadoop 集群环境的搭建。</p>

<p><strong>不过由于个人对 Hadoop 和 Docker 的了解甚少，如有错误，希望指出，我会学习、改正。</strong></p>

<h2 id="linux">Linux</h2>

<ul>
<li>Info:</li>
<li>Ubuntu 16.10 x64</li>
</ul>

<blockquote>
<p>Docker 本身就是基于 Linux 的，所以首先以我的一台服务器做实验。虽然最后跑 wordcount 已经由于内存不足而崩掉，但是之前的过程还是可以参考的。</p>
</blockquote>

<h4 id="连接服务器">连接服务器</h4>

<ul>
<li><p>使用 ssh 命令连接远程服务器。</p>

<pre><code class="language-shell">ssh root@[Your IP Address]
</code></pre></li>
</ul>

<p><img src="/img/2017/Docker_for_Hadoop/1.png" alt="ssh root@127.0.0.1" /></p>

<h4 id="更新软件列表">更新软件列表</h4>

<pre><code class="language-shell">apt-get update
</code></pre>

<p><img src="/img/2017/Docker_for_Hadoop/2.png" alt="apt-get update" /></p>

<ul>
<li>更新完成。</li>
</ul>

<p><img src="/img/2017/Docker_for_Hadoop/3.png" alt="更新完成" /></p>

<h4 id="安装-docker">安装 Docker</h4>

<pre><code class="language-shell">sudo apt-get install docker.io
</code></pre>

<p><img src="/img/2017/Docker_for_Hadoop/4.png" alt="sudo apt-get install docker.io" /></p>

<ul>
<li>当遇到输入是否继续时，输入「Y／y」继续。</li>
</ul>

<p><img src="/img/2017/Docker_for_Hadoop/5.png" alt="Y" /></p>

<ul>
<li>安装完成。</li>
</ul>

<p><img src="/img/2017/Docker_for_Hadoop/6.png" alt="安装完成" /></p>

<ul>
<li>输入「docker」测试是否安装成功。</li>
</ul>

<p><img src="/img/2017/Docker_for_Hadoop/7.png" alt="docker" /></p>

<h4 id="拉取镜像">拉取镜像</h4>

<ul>
<li>镜像，是 Docker 的核心，可以通过从远程拉取镜像即可配置好我们所需要的环境，我们这次需要的是 Hadoop 集群的镜像。</li>
</ul>

<p><img src="/img/2017/Docker_for_Hadoop/8.png" alt="kiwenlau/hadoop-cluster-docker" /></p>

<ul>
<li><p>在本文中，我们将使用 <a href="http://kiwenlau.com">kiwenlau</a> 的 Hadoop 集群镜像以及其配置。由于我的服务器本身即在国外，因此拉取镜像的速度较快，国内由于众所周知的原因，可以替换为相应的国内源，以加快拉取速度。</p>

<pre><code class="language-shell">sudo docker pull kiwenlau/hadoop:1.0
</code></pre></li>

<li><p>拉取镜像完成。</p></li>
</ul>

<p><img src="/img/2017/Docker_for_Hadoop/9.png" alt="sudo docker pull kiwenlau/hadoop:1.0" /></p>

<h4 id="克隆仓库">克隆仓库</h4>

<ul>
<li><p>克隆仓库到当前文件夹（可以自行创建并切换到相应文件夹）。</p>

<pre><code class="language-shell">git clone https://github.com/kiwenlau/hadoop-cluster-docker
</code></pre></li>

<li><p>克隆仓库完成。</p></li>
</ul>

<p><img src="/img/2017/Docker_for_Hadoop/10.png" alt="克隆仓库完成" /></p>

<h4 id="桥接网络">桥接网络</h4>

<pre><code class="language-shell">sudo docker network create --driver=bridge hadoop
</code></pre>

<p><img src="/img/2017/Docker_for_Hadoop/11.png" alt="sudo docker network create --driver=bridge hadoop" /></p>

<h4 id="运行容器">运行容器</h4>

<pre><code class="language-shell">cd hadoop-cluster-docker
./start-container.sh
</code></pre>

<ul>
<li>默认是 1 个主节点，2 个从节点，当然也可以根据性能调整为 N 节点，详见文末参考链接。</li>
</ul>

<p><img src="/img/2017/Docker_for_Hadoop/12.png" alt="./start-container.sh" /></p>

<h4 id="启动-hadoop">启动 Hadoop</h4>

<pre><code class="language-shell">./start-hadoop.sh
</code></pre>

<ul>
<li>在上一步，我们已经运行容器，即可直接运行 Hadoop。启动时长与机器性能有关，也是难为了我这一台 512 MB 内存的服务器。</li>
</ul>

<p><img src="/img/2017/Docker_for_Hadoop/13.png" alt="./start-hadoop.sh" /></p>

<h4 id="测试-word-count">测试 Word Count</h4>

<pre><code class="language-shell">./run-wordcount.sh
</code></pre>

<ul>
<li>Word Count 是一个测试 Hadoop 的 Shell 脚本，即计算文本中的单词个数。不过由于我的服务器内存不够分配无法完成，所以后续以本机进行测试。</li>
</ul>

<h4 id="网页管理">网页管理</h4>

<ul>
<li>我们可以通过网页远程管理 Hadoop：</li>
<li>Name Node: [Your IP Address]:50070/</li>
<li>Resource Manager: [Your IP Address]:8088/</li>
</ul>

<h2 id="macos">macOS</h2>

<ul>
<li>Info:</li>
<li>macOS 10.12.4 beta (16E191a)</li>
</ul>

<h4 id="下载-安装">下载 &amp; 安装</h4>

<ul>
<li>打开 Docker 官方网站：<a href="https://www.docker.com">https://www.docker.com</a>，选择社区版，并下载、安装。Windows 系统用户可以选择 Windows 版本。</li>
</ul>

<p><img src="/img/2017/Docker_for_Hadoop/14.png" alt="Docker CE" /></p>

<p><img src="/img/2017/Docker_for_Hadoop/15.png" alt="macOS or Windows" /></p>

<h4 id="运行-docker">运行 Docker</h4>

<ul>
<li>打开 Docker。为了简单，我没有改动配置，如需更改，可以在 Preferences 中修改。</li>
</ul>

<p><img src="/img/2017/Docker_for_Hadoop/16.png" alt="Docker is running" /></p>

<ul>
<li>我们可以在终端（Terminal）输入「docker」，测试是否安装成功。</li>
</ul>

<p><img src="/img/2017/Docker_for_Hadoop/17.png" alt="docker" /></p>

<h4 id="拉取镜像-克隆仓库-桥接网络-运行容器-启动-hadoop">拉取镜像 &amp; 克隆仓库 &amp; 桥接网络 &amp; 运行容器 &amp; 启动 Hadoop</h4>

<ul>
<li>同 Linux。</li>
</ul>

<h4 id="测试-word-count-1">测试 Word Count</h4>

<pre><code class="language-shell">./run-wordcount.sh
</code></pre>

<ul>
<li>同 Linux，但这次我们可以运算出结果了。</li>
</ul>

<p><img src="/img/2017/Docker_for_Hadoop/18.png" alt="./run-wordcount.sh" /></p>

<h2 id="windows">Windows</h2>

<blockquote>
<p>其实最开始就没有打算放出 Windows 版，倒不是因为觉得 Windows 不好，而是目前手头没有 Windows 的电脑，借用同学的电脑也不是很方便。如果需要安装 Docker，需要 CPU 支持虚拟化，且安装了 64 位 Windows 10 Pro/企业版（需要开启 Hyper-V）。其他版本的 Windows 可以安装 Docker Toolbox。</p>
</blockquote>

<ul>
<li>暂无。</li>
</ul>

<h2 id="intellij-idea">IntelliJ IDEA</h2>

<blockquote>
<p>我们的 Hadoop 集群已经在容器里安装完成，而且已经可以运行。相比自己一个个建立虚拟机，这样的确十分方便、快捷。为了便于开发调试，接下来就需要在 IntelliJ IDEA 下配置开发环境，包管理工具选择 Gradle。Maven 配合 Eclipse 的配置网上已经有很多了，需要的同学可以自行搜索。</p>
</blockquote>

<h3 id="docker-开启-9000-端口映射">Docker 开启 9000 端口映射</h3>

<ul>
<li><p>由于我们使用的是 <a href="http://kiwenlau.com">kiwenlau</a> 的镜像和开源脚本，虽然加快了配置过程，但是也屏蔽了很多细节。比如在其脚本中只默认开启了 50070 和 8088 的端口映射，我们可以通过 <code>docker ps</code>（注意是在本机，而不是在容器运行该命令）列出所有容器，查看容器映射的端口。</p>

<pre><code class="language-shell">cd hadoop-cluster-docker
vim start-container.sh
</code></pre></li>

<li><p>切换到脚本文件夹，使用 Vim 编辑 start-container.sh。在图中光标处添加以下内容，保存并退出。</p>

<pre><code>-p 9000:9000 \
</code></pre></li>
</ul>

<p><img src="/img/2017/Docker_for_Hadoop/19.png" alt="映射 9000 端口" /></p>

<ul>
<li>重启容器，并查看容器状态，如图即为映射成功。</li>
</ul>

<p><img src="/img/2017/Docker_for_Hadoop/20.png" alt="映射端口成功" /></p>

<h3 id="开启-web-hdfs-管理">开启 Web HDFS 管理*</h3>

<blockquote>
<p>该步非必须。为了方便在网页端管理，因此开启 Web 端，默认关闭。</p>
</blockquote>

<pre><code class="language-shell">which hadoop
cd /usr/local/hadoop/etc/hadoop/
ls

vi core-site.xml
</code></pre>

<ul>
<li>找到 Hadoop 配置文件路径，使用 Vi 编辑，若 Vi 的插入模式（Insert Mode）中，上下左右变成了 ABCD，那么可以使用以下命令即可：<code>cp /etc/vim/vimrc ~/.vimrc</code> 修复。</li>
</ul>

<p><img src="/img/2017/Docker_for_Hadoop/21.png" alt="Hadoop 配置文件" /></p>

<ul>
<li><p>添加以下内容。</p>

<pre><code class="language-xml">&lt;property&gt;
&lt;name&gt;dfs.webhdfs.enabled&lt;/name&gt;
&lt;value&gt;true&lt;/value&gt;
&lt;/property&gt;
</code></pre></li>
</ul>

<p><img src="/img/2017/Docker_for_Hadoop/22.png" alt="添加以上内容" /></p>

<h3 id="启动-hadoop-1">启动 Hadoop</h3>

<ul>
<li>同 Linux。</li>
</ul>

<h3 id="构建依赖">构建依赖</h3>

<ul>
<li><p>使用 IntelliJ IDEA 新建一个 Gradle 项目，在 Build.gradle 中加入以下依赖（对应容器 Hadoop 版本）。</p>

<pre><code class="language-groovy">compile group: 'org.apache.hadoop', name: 'hadoop-common', version: '2.7.2'
compile group: 'org.apache.hadoop', name: 'hadoop-hdfs', version: '2.7.2'
</code></pre></li>
</ul>

<h3 id="demo">Demo</h3>

<pre><code class="language-java">import org.apache.commons.io.IOUtils;
import org.apache.hadoop.conf.Configuration;
import org.apache.hadoop.fs.*;
import org.junit.Before;
import org.junit.Test;

import java.io.FileInputStream;
import java.io.IOException;
import java.net.URI;

/**
* Created by kingcos on 25/03/2017.
*/
public class HDFSOperations {

FileSystem fileSystem;

@Before
public void configure() throws Exception {
Configuration configuration = new Configuration();
configuration.set(&quot;fs.defaultFS&quot;, &quot;hdfs://192.168.1.120:9000&quot;);
fileSystem = FileSystem.get(URI.create(&quot;hdfs://192.168.1.120:9000&quot;), configuration, &quot;root&quot;);
}

@Test
public void listFiles() throws IOException {
Path path = new Path(&quot;/&quot;);
RemoteIterator&lt;LocatedFileStatus&gt; iterator = fileSystem.listFiles(path, true);

while (iterator.hasNext()) {
LocatedFileStatus status = iterator.next();
System.out.println(status.getPath().getName());
}
}

@Test
public void rm() throws IOException {
Path path = new Path(&quot;/&quot;);
fileSystem.delete(path, true);
}

@Test
public void mkdir() throws IOException {
Path path = new Path(&quot;/demo&quot;);
fileSystem.mkdirs(path);
}
}
</code></pre>

<ul>
<li>之后便可以通过 IDEA 直接写代码来测试，这里简单写了几个方法。</li>
</ul>

<h2 id="总结">总结</h2>

<ul>
<li>在写这篇文章之前，其实我对 Docker 的概念很不了解。但是通过 Learn by do it. 大致知道了其中的概念和原理。我们完全可以构建自己的容器 Dockerfile，来部署生产和开发环境，其强大的可移植性大大缩短配置的过程。</li>
<li>由于个人对 Hadoop 和 Docker 的了解甚少，如有错误，希望指出，我会学习、改正。</li>
<li>如果有时间，我会再折腾一下其他的玩法 :]</li>
</ul>

<h2 id="reference">Reference</h2>

<ul>
<li><a href="http://kiwenlau.com/2016/06/12/160612-hadoop-cluster-docker-update/">基于 Docker 搭建 Hadoop 集群之升级版</a></li>
</ul>

    </div>
    
      <div class="pagination">
        <div class="pagination__title">
          <span class="pagination__title-h">Read other posts</span>
          <hr />
        </div>
        <div class="pagination__buttons">
          
            <span class="button previous">
              <a href="/posts/2017/ios_app_start_up/">
                <span class="button__icon">←</span>
                <span class="button__text">浅谈 iOS 应用启动过程</span>
              </a>
            </span>
          
          
            <span class="button next">
              <a href="/posts/2017/uiviewcontroller_life_cycle/">
                <span class="button__text">探究 UIViewController 生命周期</span>
                <span class="button__icon">→</span>
              </a>
            </span>
          
        </div>
      </div>
    

    

    
    
    <div>
      <div id="github-comment">
      </div>

      <script type="text/javascript">
        function getUtterances(isDark) {
          var utterances = document.createElement('script');
          utterances.type = 'text/javascript';
          utterances.async = true;
          utterances.setAttribute('issue-term', "pathname")
          utterances.setAttribute('repo', "kingcos\/kingcos.github.io")
          utterances.setAttribute('label', "comments")
          isDark ? utterances.setAttribute('theme', "github-dark") : utterances.setAttribute('theme', "github-light")
          utterances.crossorigin = 'anonymous';
          utterances.src = 'https://utteranc.es/client.js';

          return utterances
        }

        var themeToggle = document.querySelector(".theme-toggle")
        themeToggle.addEventListener("click", function () {
          var getTheme = window.localStorage && window.localStorage.getItem("theme")
          var divNode = document.getElementById('github-comment')
          while(divNode.hasChildNodes()) {
            divNode.removeChild(divNode.firstChild);
          }
          
          
          

          
          
          
          
          
          
          document.getElementById('github-comment').appendChild(getUtterances(getTheme !== "dark"))
        })

        var getTheme = window.localStorage && window.localStorage.getItem("theme")
        document.getElementById('github-comment').appendChild(getUtterances(getTheme === "dark"))
      </script>
    </div>
    

    </div>

      </div>

      
        <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright copyright--user">Powered by github.com/kingcos</div>
    
  </div>
</footer>

<script src="/assets/main.js"></script>
<script src="/assets/prism.js"></script>


      
    </div>

    
      
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-138311951-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

    
  </body>
</html>
