<!DOCTYPE html>
<html lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="kingcos" />
	
	
	
	<title>Combine åŸºç¡€ ï½œ kingcos</title>
	
    
    
    <meta name="description" content="30-day challenge" />
    

    
    
    <meta name="keywords" content="Hugo, theme, zozo" />
    

	
    
    <link rel="shortcut icon" href="https://kingcos.me/images/favicon.png" />

    <link rel="stylesheet" type="text/css" media="screen" href="https://kingcos.me/css/normalize.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.0/animate.min.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="https://kingcos.me/css/zozo.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://cdn.jsdelivr.net/npm/remixicon@2.5.0/fonts/remixicon.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="https://kingcos.me/css/highlight.css" />

    
    
</head>




<body>
    <div class="main animate__animated animate__fadeInDown">
        <div class="nav_container animated fadeInDown">
    <div class="site_nav" id="site_nav">
        <ul>
            
            <li>
                <a href="/">Home</a>
            </li>
            
            <li>
                <a href="/posts/">Archive</a>
            </li>
            
            <li>
                <a href="/tags/">Tags</a>
            </li>
            
            <li>
                <a href="/about/">About</a>
            </li>
            
        </ul>
    </div>
    <div class="menu_icon">
        <a id="menu_icon"><i class="ri-menu-line"></i></a>
    </div>
</div>


<link rel="stylesheet" href="https://kingcos.me/scss/main.min.75b49085bfb07b1bf150a1d59b4773d857e0452a747e37243805218b528a4045.css" integrity="sha256-dbSQhb&#43;wexvxUKHVm0dz2FfgRSp0fjckOAUhi1KKQEU=" media="screen">

<style>
.nav_container {
  height: 1rem;
}
 
table {
    width: 100%;
    table-layout: fixed;
}

 
.markdown code {
    white-space: normal;
    word-wrap: break-word;
    word-break: break-word;
    line-height: 1.5em;
    font-size: 0.85em;
    font-weight: bold;
    display: inline-block;
     
}

 
.menu_icon a {
    font-size: 16px;
}

 
body {
    font-family: 'Hiragino Sans GB', 'SFMono', 'Lato', '-apple-system';
    -webkit-font-smoothing: 'antialiased';
}

 
.markdown strong, .markdown b, .markdown em {
    font-weight: bold;
}

.post .post_content p {
     

    line-height: 1.75em;
}

 
.markdown img {
    max-width: 100%;
    margin: 0 auto;
    display: block;
    border-radius: 0.25rem;
}

 
.ri-stack-line {
    vertical-align: middle;
}

 
.ri-map-pin-time-line {
    vertical-align: middle;
}

 
.chroma .lntd:nth-child(2) {
    width: 100%;
}

 

 
.markdown .book-hint::before {
    content: none;
}

.markdown .book-hint {
    margin: 1rem 0;
    padding: 0.5rem 1rem 0.5rem 0.75rem;

    border-inline-start: 0.25rem solid #e9ecef;
    border-radius: 0.25rem;

    font-style: normal;
     
}

.book-hint strong {
    background-color: transparent;
}

.markdown .book-hint.info {
    border-left-color:#6bf;
    background-color:rgba(102,187,255,.1);
}

.markdown .book-hint.warning {
    border-left-color:#fd6;
    background-color:rgba(255,221,102,.1);
}

.markdown .book-hint.danger {
    border-left-color:#f66;
    background-color:rgba(255,102,102,.1);
}

</style>

        <div class="header animated fadeInDown">
    <div class="site_title_container">
        <div class="site_title">
            
                <a href="https://kingcos.me/">
                    
                    <img class="kingcos" style="margin-top: -20px; margin-left: -10px;" src="/title.svg" width="150px">
                </a>
            
        </div>
        <div class="description">
            <p class="sub_title">ä¸“æ³¨ã€åšæŒ</p>
            <div class="my_socials">
                
                
                <a href="https://github.com/kingcos" title="github" target="_blank"><i class="ri-github-fill"></i></a>
                
                
                
                <a href="https://www.instagram.com/kingcos_v/" title="instagram" target="_blank"><i class="ri-instagram-fill"></i></a>
                
                
                
                <a href="https://twitter.com/kingcos_v" title="twitter" target="_blank"><i class="ri-twitter-fill"></i></a>
                
                
                
                <a href="https://weibo.com/u/1798410923" title="weibo" target="_blank"><i class="ri-weibo-fill"></i></a>
                
                
                
            </div>
        </div>
    </div>
</div>
        <div class="content">
            <div class="post_page">
                <div class="post animate__animated animate__fadeInDown">
                    <div class="post_title post_detail_title">
                        <h2><a href='/posts/2022/swift_combine_basics/'>Combine åŸºç¡€</a></h2>
                        <span class="date">2022.07.02</span>
                        <span>by kingcos</span>
                        
                        
                        
                        
                    </div>
                    <div class="post_content markdown">
<div class="book-expand">
  <label>
    <div class="book-expand-head flex justify-between">
      <span>Release Notes</span>
      <span>â†•</span>
    </div>
    <input type="checkbox" class="hidden" />
    <div class="book-expand-content markdown-inner">
      <table>
<thead>
<tr>
<th style="text-align:center">Date</th>
<th style="text-align:center">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">2022-06-29</td>
<td style="text-align:center">é¦–æ¬¡æäº¤</td>
</tr>
</tbody>
</table>

    </div>
  </label>
</div>

<h2 id="preface">Preface</h2>
<p>Combine æ˜¯ Apple ä¸ºå“åº”å¼ç¼–ç¨‹æ¨å‡ºçš„å…¨æ–°æ¡†æ¶ã€‚</p>
<h2 id="æ¦‚è§ˆ">æ¦‚è§ˆ</h2>
<p>Combine ä¸­æœ€åŸºæœ¬çš„ä¸‰ä¸ªå…ƒç´ æ˜¯ï¼š</p>
<ul>
<li>Pulisherï¼ˆå‘å¸ƒè€…ï¼‰-&gt; Operatorï¼ˆæ“ä½œç¬¦ï¼‰-&gt; Subscriberï¼ˆè®¢é˜…è€…ï¼‰</li>
</ul>
<p>å³å‘å¸ƒäº‹ä»¶ã€æ“ä½œä¸è½¬æ¢ã€è®¢é˜…äº‹ä»¶ã€‚</p>
<h2 id="pulisher">Pulisher</h2>
<h3 id="ä»‹ç»">ä»‹ç»</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="line"><span class="cl"><span class="c1">/// Declares that a type can transmit a sequence of values over time.</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// å£°æ˜ä¸€ç§å¯ä»¥éšæ—¶é—´ä¼ è¾“ï¼ˆå‘å¸ƒï¼‰å€¼åºåˆ—çš„ç±»å‹ã€‚</span>
</span></span><span class="line"><span class="cl"><span class="c1">///</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// A publisher delivers elements to one or more ``Subscriber`` instances.</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// å‘å¸ƒè€…å°†å…ƒç´ ä¼ é€’ç»™ä¸€ä¸ªæˆ–å¤šä¸ª ``Subscriber`` å®ä¾‹ã€‚</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// The subscriberâ€™s ``Subscriber/Input`` and ``Subscriber/Failure`` associated types must match the ``Publisher/Output`` and ``Publisher/Failure`` types declared by the publisher.</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// è®¢é˜…è€…çš„ ``Subscriber/Input`` å’Œ ``Subscriber/Failure`` çš„å…³è”ç±»å‹å¿…é¡»ä¸å‘å¸ƒè€…å£°æ˜çš„ ``Publisher/Output`` å’Œ ``Publisher/Failure`` ç±»å‹åŒ¹é…ã€‚</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// The publisher implements the ``Publisher/receive(subscriber:)``method to accept a subscriber.</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// å‘å¸ƒè€…å®ç° ``Publisher/receive(subscriber:)`` æ–¹æ³•æ¥æ¥å—è®¢é˜…è€…ã€‚</span>
</span></span><span class="line"><span class="cl"><span class="c1">///</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// After this, the publisher can call the following methods on the subscriber:</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// åœ¨æ­¤ä¹‹åï¼Œå‘å¸ƒè€…å¯ä»¥åœ¨è®¢é˜…è€…ä¸Šè°ƒç”¨ä»¥ä¸‹æ–¹æ³•ï¼š</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// - ``Subscriber/receive(subscription:)``: Acknowledges the subscribe request and returns a ``Subscription`` instance. The subscriber uses the subscription to demand elements from the publisher and can use it to cancel publishing.</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// - ``Subscriber/receive(subscription:)``: ç¡®è®¤è®¢é˜…è¯·æ±‚å¹¶è¿”å› ``Subscription`` å®ä¾‹ã€‚è®¢é˜…è€…ä½¿ç”¨ subscription ä»å‘å¸ƒè€…è¯·æ±‚å…ƒç´ ï¼Œå¹¶å¯ä»¥ç”¨å…¶å–æ¶ˆå‘å¸ƒã€‚</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// - ``Subscriber/receive(_:)``: Delivers one element from the publisher to the subscriber.</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// - ``Subscriber/receive(_:)``: å°†ä¸€ä¸ªå…ƒç´ ä»å‘å¸ƒè€…ä¼ é€’ç»™è®¢é˜…è€…ã€‚</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// - ``Subscriber/receive(completion:)``:Â Informs the subscriber that publishing has ended, either normally or with an error.</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// - ``Subscriber/receive(completion:)``:Â é€šçŸ¥è®¢é˜…è€…å‘å¸ƒå·²ç»“æŸï¼ˆæ­£å¸¸æˆ–å‡ºç°é”™è¯¯ï¼‰ã€‚</span>
</span></span><span class="line"><span class="cl"><span class="c1">///</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// Every `Publisher` must adhere to this contract for downstream subscribers to function correctly.</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// æ¯ä¸ª `Publisher` éƒ½å¿…é¡»éµå®ˆæœ¬åè®®ï¼Œä»¥ä¾¿ä¸‹æ¸¸è®¢é˜…è€…æ­£å¸¸å·¥ä½œã€‚</span>
</span></span><span class="line"><span class="cl"><span class="c1">///</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// Extensions on `Publisher` define a wide variety of _operators_ that you compose to create sophisticated event-processing chains.</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// `Publisher` ä¸Šçš„æ‰©å±•å®šä¹‰äº†å„ç§å„æ ·çš„ç¬¦ï¼Œå¯ä»¥ç»„åˆè¿™äº›æ“ä½œç¬¦æ¥åˆ›å»ºå¤æ‚çš„äº‹ä»¶å¤„ç†é“¾ã€‚</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// Each operator returns a type that implements the ``Publisher`` protocol</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// æ¯ä¸ªæ“ä½œç¬¦è¿”å›ä¸€ä¸ªå®ç° `Publisher` ä¸Šåè®®çš„ç±»å‹</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// Most of these types exist as extensions on the ``Publishers`` enumeration.</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// è¿™äº›ç±»å‹ä¸­çš„å¤§å¤šæ•°ä½œä¸º ``Publishers`` æšä¸¾çš„æ‰©å±•å­˜åœ¨ã€‚</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// For example, the ``Publisher/map(_:)-99evh`` operator returns an instance of ``Publishers/Map``.</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// ä¾‹å¦‚ï¼Œ``Publisher/map(_:)-99evh`` æ“ä½œç¬¦è¿”å› ``Publishers/Map`` çš„å®ä¾‹ã€‚</span>
</span></span><span class="line"><span class="cl"><span class="c1">///</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// &gt; Tip: A Combine publisher fills a role similar to, but distinct from, the</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// &lt;doc://com.apple.documentation/documentation/Swift/AsyncSequence&gt; in the</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// Swift standard library. A `Publisher` and an</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// `AsyncSequence` both produce elements over time. However, the pull model in Combine</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// uses a ``Combine/Subscriber`` to request elements from a publisher, while Swift</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// concurrency uses the `for`-`await`-`in` syntax to iterate over elements</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// published by an `AsyncSequence`. Both APIs offer methods to modify the sequence</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// by mapping or filtering elements, while only Combine provides time-based</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// operations like</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// ``Publisher/debounce(for:scheduler:options:)`` and</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// ``Publisher/throttle(for:scheduler:latest:)``, and combining operations like</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// ``Publisher/merge(with:)-7fk3a`` and ``Publisher/combineLatest(_:_:)-1n30g``.</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// To bridge the two approaches, the property ``Publisher/values-1dm9r`` exposes</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// a publisher&#39;s elements as an `AsyncSequence`, allowing you to iterate over</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// them with `for`-`await`-`in` rather than attaching a ``Subscriber``.</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// &gt; æç¤º</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// &gt; Combine å‘å¸ƒè€…æ‰®æ¼”çš„è§’è‰²ç±»ä¼¼äºä½†ä¸åŒäº Swift æ ‡å‡†åº“ä¸­çš„ &lt;doc://com.apple.documentation/documentation/Swift/AsyncSequence&gt;ã€‚</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// &gt; `Publisher` å’Œ `AsyncSequence` éƒ½å¯ä»¥éšæ—¶é—´äº§ç”Ÿå…ƒç´ ã€‚ä½†æ˜¯ï¼ŒCombine ä¸­çš„æ‹‰å–æ¨¡å‹ï¼ˆpull modelï¼‰ä½¿ç”¨ ``Combine/Subscriber`` æ¥ä»å‘å¸ƒè€…è¯·æ±‚å…ƒç´ ï¼Œè€Œ Swift å¹¶å‘ä¸­ä½¿ç”¨ `for`-`await`-`in` è¯­æ³•æ¥éå† `AsyncSequence` å‘å¸ƒçš„å…ƒç´ ã€‚</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// &gt; ä¸¤ä¸ª API å‡æä¾›é€šè¿‡æ˜ å°„ï¼ˆmapï¼‰æˆ–è¿‡æ»¤ï¼ˆfilterï¼‰å…ƒç´ çš„æ–¹æ³•æ¥ä¿®æ”¹åºåˆ—ï¼Œä½†åªæœ‰ Combine æä¾›äº†åŸºäºæ—¶é—´çš„æ“ä½œï¼Œä¾‹å¦‚ï¼š</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// &gt; ``Publisher/debounce(for:scheduler:options:)`` å’Œ ``Publisher/throttle(for:scheduler:latest:)``ï¼Œä»¥åŠç»„åˆæ“ä½œï¼Œä¾‹å¦‚ ``Publisher/merge(with:)-7fk3a`` å’Œ  ``Publisher/combineLatest(_:_:)-1n30g``ã€‚</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// &gt; ä¸ºäº†æ¡¥æ¥è¿™ä¸¤ç§æ–¹æ³•ï¼Œ`Publisher/values-1dm9r`` å±æ€§æš´éœ²ä¸€ä¸ªå‘å¸ƒè€…å…ƒç´ ä½œä¸º `AsyncSequence`ï¼Œå…è®¸ä½¿ç”¨ `for`-`await`-`in` è¿­ä»£å…ƒç´ ï¼Œè€Œä¸æ˜¯é™„åŠ ä¸€ä¸ª ``Subscriber``ã€‚</span>
</span></span><span class="line"><span class="cl"><span class="c1">///</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// # Creating Your Own Publishers</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// # åˆ›å»ºä½ è‡ªå·±çš„å‘å¸ƒè€…</span>
</span></span><span class="line"><span class="cl"><span class="c1">///</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// Rather than implementing the `Publisher` protocol yourself, you can create your own publisher by using one of several types provided by the Combine framework:</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// å¯ä»¥ä½¿ç”¨ Combine æä¾›çš„å‡ ç§ç±»å‹ä¸­çš„ä¸€ç§æ¥åˆ›å»ºè‡ªå·±çš„å‘å¸ƒè€…ï¼Œè€Œä¸æ˜¯è‡ªå·±å®ç° `Publisher` åè®®ï¼š</span>
</span></span><span class="line"><span class="cl"><span class="c1">///</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// - Use a concrete subclass of ``Subject``, such as ``PassthroughSubject``, to publish values on-demand by calling its ``Subject/send(_:)`` method.</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// - ä½¿ç”¨ ``Subject`` çš„å…·ä½“å­ç±»ï¼Œä¾‹å¦‚ ``PassthroughSubject``ï¼Œé€šè¿‡è°ƒç”¨å…¶ ``Subject/send(_:)`` æ–¹æ³•æŒ‰éœ€å‘å¸ƒå€¼ã€‚</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// - Use a ``CurrentValueSubject`` to publish whenever you update the subjectâ€™s underlying value.</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// - ä½¿ç”¨ ``CurrentValueSubject`` æ¥æ ¹æ®å½“å‰å€¼æ¥å‘å¸ƒå€¼ã€‚</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// - Add the `@Published` annotation to a property of one of your own types. In doing so, the property gains a publisher that emits an event whenever the propertyâ€™s value changes. See the ``Published`` type for an example of this approach.</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// - å°† `@Published` æ ‡è®°æ·»åŠ åˆ°è‡ªå·±çš„ç±»å‹çš„å±æ€§ä¸Šï¼Œè¿™æ ·å±æ€§å°±ä¼šè·å¾—ä¸€ä¸ªå‘å¸ƒè€…ï¼Œå®ƒä¼šåœ¨å±æ€§çš„å€¼å‘ç”Ÿå˜åŒ–æ—¶å‘å¸ƒä¸€ä¸ªäº‹ä»¶ã€‚è¯·å‚è€ƒ ``Published`` ç±»çš„ç¤ºä¾‹æ¥äº†è§£è¿™ç§æ–¹æ³•ã€‚</span>
</span></span><span class="line"><span class="cl"><span class="p">@</span><span class="n">available</span><span class="p">(</span><span class="n">macOS</span> <span class="mf">10.15</span><span class="p">,</span> <span class="n">iOS</span> <span class="mf">13.0</span><span class="p">,</span> <span class="n">tvOS</span> <span class="mf">13.0</span><span class="p">,</span> <span class="n">watchOS</span> <span class="mf">6.0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">protocol</span> <span class="nc">Publisher</span><span class="p">&lt;</span><span class="n">Output</span><span class="p">,</span> <span class="n">Failure</span><span class="p">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">/// The kind of values published by this publisher.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// è¯¥å‘å¸ƒè€…å‘å¸ƒçš„å€¼çš„ç±»å‹ã€‚</span>
</span></span><span class="line"><span class="cl">    <span class="n">associatedtype</span> <span class="n">Output</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">/// The kind of errors this publisher might publish.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// è¯¥å‘å¸ƒè€…å¯èƒ½ä¼šå‘å¸ƒçš„é”™è¯¯ç±»å‹ã€‚</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// Use `Never` if this `Publisher` does not publish errors.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// å¦‚æœè¯¥å‘å¸ƒè€…ä¸ä¼šå‘å¸ƒé”™è¯¯ï¼Œè¯·ä½¿ç”¨ `Never`ã€‚</span>
</span></span><span class="line"><span class="cl">    <span class="n">associatedtype</span> <span class="n">Failure</span> <span class="p">:</span> <span class="n">Error</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">/// Attaches the specified subscriber to this publisher.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// å°†æŒ‡å®šçš„è®¢é˜…è€…é™„åŠ åˆ°è¯¥å‘å¸ƒè€…ã€‚</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// Implementations of ``Publisher`` must implement this method.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// ``Publisher`` çš„å®ç°å¿…é¡»å®ç°è¯¥æ–¹æ³•ã€‚</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// The provided implementation of ``Publisher/subscribe(_:)-4u8kn``calls this method.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// ``Publisher/subscribe(_:)-4u8kn`` æä¾›çš„å®ç°è°ƒç”¨æ­¤æ–¹æ³•ã€‚</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// - Parameter subscriber: The subscriber to attach to this ``Publisher``, after which it can receive values.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// - å‚æ•°è®¢é˜…è€…ï¼šé™„åŠ åˆ°æ­¤ ``Publisher`` çš„è®¢é˜…è€…ï¼Œåœ¨æ­¤ä¹‹åå¯ä»¥æ¥æ”¶å€¼ã€‚</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// </span>
</span></span><span class="line"><span class="cl">    <span class="kd">func</span> <span class="nf">receive</span><span class="p">&lt;</span><span class="n">S</span><span class="p">&gt;(</span><span class="n">subscriber</span><span class="p">:</span> <span class="n">S</span><span class="p">)</span> <span class="k">where</span> <span class="n">S</span> <span class="p">:</span> <span class="n">Subscriber</span><span class="p">,</span> <span class="kc">Self</span><span class="p">.</span><span class="n">Failure</span> <span class="p">==</span> <span class="n">S</span><span class="p">.</span><span class="n">Failure</span><span class="p">,</span> <span class="kc">Self</span><span class="p">.</span><span class="n">Output</span> <span class="p">==</span> <span class="n">S</span><span class="p">.</span><span class="n">Input</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Pulisher å¯ä»¥å‘å¸ƒä¸‰ç§äº‹ä»¶ï¼š</p>
<ol>
<li>Output å€¼</li>
<li>Failure é”™è¯¯ï¼Œå¹¶ç»“æŸ</li>
<li>å®Œæˆï¼Œå¹¶ç»“æŸ</li>
</ol>
<p>ä»¥åŠäº‹ä»¶æµå¯ä»¥åˆ†ä¸ºæœ‰é™äº‹ä»¶æµå’Œæ— é™äº‹ä»¶æµã€‚</p>
<h3 id="subject">Subject</h3>
<h2 id="operator">Operator</h2>
<p>ç”±ä¸Šä¸€èŠ‚å¯ä»¥å¾—çŸ¥ Pulisher è´Ÿè´£å‘å¸ƒäº‹ä»¶ï¼Œä½†æœ‰æ—¶å‘å‡ºçš„äº‹ä»¶ä»ç„¶éœ€è¦è½¬æ¢æ‰èƒ½ä¸ºæˆ‘æ‰€ç”¨ï¼Œæ­¤æ—¶å°±éœ€è¦ Operatorã€‚Operator ä»¥ä¸Šæ¸¸ Publisher ä½œä¸ºè¾“å…¥ï¼Œç»è¿‡è½¬æ¢äº§ç”Ÿæ–°çš„æ•°æ®ï¼Œç„¶åå†ä½œä¸º Publisher è¾“å‡ºç»™ä¸‹æ¸¸ã€‚</p>
<h3 id="scan">scan</h3>

<div class="book-expand">
  <label>
    <div class="book-expand-head flex justify-between">
      <span>scan in Xcode</span>
      <span>â†•</span>
    </div>
    <input type="checkbox" class="hidden" />
    <div class="book-expand-content markdown-inner">
      <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="line"><span class="cl"><span class="p">@</span><span class="n">available</span><span class="p">(</span><span class="n">macOS</span> <span class="mf">10.15</span><span class="p">,</span> <span class="n">iOS</span> <span class="mf">13.0</span><span class="p">,</span> <span class="n">tvOS</span> <span class="mf">13.0</span><span class="p">,</span> <span class="n">watchOS</span> <span class="mf">6.0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">extension</span> <span class="nc">Publisher</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">/// Transforms elements from the upstream publisher by providing the current</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// element to a closure along with the last value returned by the closure.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// Use ``Publisher/scan(_:_:)`` to accumulate all previously-published values into a single</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// value, which you then combine with each newly-published value.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// The following example logs a running total of all values received</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// from the sequence publisher.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///     let range = (0...5)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///     cancellable = range.publisher</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///         .scan(0) { return $0 + $1 }</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///         .sink { print (&#34;\($0)&#34;, terminator: &#34; &#34;) }</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///      // Prints: &#34;0 1 3 6 10 15 &#34;.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// - Parameters:</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///   - initialResult: The previous result returned by the `nextPartialResult` closure.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///   - nextPartialResult: A closure that takes as its arguments the previous value returned by the closure and the next element emitted from the upstream publisher.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// - Returns: A publisher that transforms elements by applying a closure that receives its previous return value and the next element from the upstream publisher.</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">func</span> <span class="nf">scan</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;(</span><span class="kc">_</span> <span class="n">initialResult</span><span class="p">:</span> <span class="n">T</span><span class="p">,</span> <span class="kc">_</span> <span class="n">nextPartialResult</span><span class="p">:</span> <span class="p">@</span><span class="n">escaping</span> <span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="kc">Self</span><span class="p">.</span><span class="n">Output</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">T</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">Publishers</span><span class="p">.</span><span class="n">Scan</span><span class="p">&lt;</span><span class="kc">Self</span><span class="p">,</span> <span class="n">T</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">/// Transforms elements from the upstream publisher by providing the current element to an error-throwing closure along with the last value returned by the closure.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// Use ``Publisher/tryScan(_:_:)`` to accumulate all previously-published values into a single value, which you then combine with each newly-published value.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// If your accumulator closure throws an error, the publisher terminates with the error.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// In the example below, ``Publisher/tryScan(_:_:)`` calls a division function on elements of a collection publisher. The ``Publishers/TryScan`` publisher publishes each result until the function encounters a `DivisionByZeroError`, which terminates the publisher.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///     struct DivisionByZeroError: Error {}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///     /// A function that throws a DivisionByZeroError if `current` provided by the TryScan publisher is zero.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///     func myThrowingFunction(_ lastValue: Int, _ currentValue: Int) throws -&gt; Int {</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///         guard currentValue != 0 else { throw DivisionByZeroError() }</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///         return (lastValue + currentValue) / currentValue</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///      }</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///     let numbers = [1,2,3,4,5,0,6,7,8,9]</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///     cancellable = numbers.publisher</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///         .tryScan(10) { try myThrowingFunction($0, $1) }</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///         .sink(</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///             receiveCompletion: { print (&#34;\($0)&#34;) },</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///             receiveValue: { print (&#34;\($0)&#34;, terminator: &#34; &#34;) }</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///          )</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///     // Prints: &#34;11 6 3 1 1 -1 failure(DivisionByZeroError())&#34;.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// If the closure throws an error, the publisher fails with the error.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// - Parameters:</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///   - initialResult: The previous result returned by the `nextPartialResult` closure.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///   - nextPartialResult: An error-throwing closure that takes as its arguments the previous value returned by the closure and the next element emitted from the upstream publisher.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// - Returns: A publisher that transforms elements by applying a closure that receives its previous return value and the next element from the upstream publisher.</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">func</span> <span class="nf">tryScan</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;(</span><span class="kc">_</span> <span class="n">initialResult</span><span class="p">:</span> <span class="n">T</span><span class="p">,</span> <span class="kc">_</span> <span class="n">nextPartialResult</span><span class="p">:</span> <span class="p">@</span><span class="n">escaping</span> <span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="kc">Self</span><span class="p">.</span><span class="n">Output</span><span class="p">)</span> <span class="kr">throws</span> <span class="p">-&gt;</span> <span class="n">T</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">Publishers</span><span class="p">.</span><span class="n">TryScan</span><span class="p">&lt;</span><span class="kc">Self</span><span class="p">,</span> <span class="n">T</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div>
    </div>
  </label>
</div>

<p><code>scan</code> æ“ä½œç¬¦ä»¥ä¸Šæ¸¸æ•°æ®å’Œä¸€ä¸ªå›ºå®šçš„åˆå§‹å€¼ä¸ºè¾“å…¥ï¼Œä»¥é—­åŒ…è¿”å›çš„æ•°æ®ä½œä¸ºæ–°çš„å‘å¸ƒè€…ä¸ºè¾“å‡ºï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="line"><span class="cl"><span class="kd">let</span> <span class="nv">array</span> <span class="p">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="c1">// (1...4)</span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nv">initialValue</span> <span class="p">=</span> <span class="mi">100</span>
</span></span><span class="line"><span class="cl"><span class="kc">_</span> <span class="p">=</span> <span class="n">array</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="n">publisher</span>             <span class="c1">// å°†æ•°ç»„ä½œä¸ºå‘å¸ƒè€…ï¼Œä¾æ¬¡å‘å¸ƒå…¶ä¸­çš„å€¼</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="n">scan</span><span class="p">(</span><span class="n">initialValue</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$0</span> <span class="o">+</span> <span class="nb">Int</span><span class="p">(</span><span class="nv">$1</span><span class="p">)</span> <span class="p">}</span> <span class="c1">// scan æ“ä½œç¬¦ï¼šä¼ å…¥ä¸€ä¸ªåˆå§‹å€¼ï¼Œä»¥åŠä¸€ä¸ªå¤„ç†åˆå§‹å€¼å’Œä¸Šæ¸¸è¾“å‡ºçš„é—­åŒ…ï¼Œé—­åŒ…è¿”å›çš„æ•°æ®å°†ä½œä¸ºæ–°çš„å‘å¸ƒè€…å‘å¸ƒ</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="n">sink</span> <span class="p">{</span> <span class="bp">print</span> <span class="p">(</span><span class="nv">$0</span><span class="p">,</span> <span class="n">terminator</span><span class="p">:</span> <span class="s">&#34; &#34;</span><span class="p">)</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 101.0 103.0 106.0 110.0</span>
</span></span></code></pre></div><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>func scan&lt;T&gt;(_ initialResult: T, _ nextPartialResult: @escaping (T, Self.Output) -&gt; T) -&gt; Publishers.Scan&lt;Self, T&gt;</code>ï¼Œ<code>scan</code> æ“ä½œç¬¦è¿”å›çš„å‘å¸ƒè€…çš„è¾“å‡ºç±»å‹æ˜¯ <code>T</code>ï¼Œå³<strong>åˆå§‹å€¼çš„ç±»å‹</strong>ã€‚</p>
<h3 id="map">map</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="line"><span class="cl"><span class="p">@</span><span class="n">available</span><span class="p">(</span><span class="n">macOS</span> <span class="mf">10.15</span><span class="p">,</span> <span class="n">iOS</span> <span class="mf">13.0</span><span class="p">,</span> <span class="n">tvOS</span> <span class="mf">13.0</span><span class="p">,</span> <span class="n">watchOS</span> <span class="mf">6.0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">extension</span> <span class="nc">Publishers</span><span class="p">.</span><span class="n">Sequence</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ...</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">func</span> <span class="nf">map</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;(</span><span class="kc">_</span> <span class="n">transform</span><span class="p">:</span> <span class="p">(</span><span class="n">Elements</span><span class="p">.</span><span class="n">Element</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">T</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">Publishers</span><span class="p">.</span><span class="n">Sequence</span><span class="o">&lt;</span><span class="p">[</span><span class="n">T</span><span class="p">],</span> <span class="n">Failure</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// ...</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p><code>map</code> æ“ä½œç¬¦åˆ™ç±»ä¼¼å¹³æ—¶ä½¿ç”¨çš„é«˜é˜¶å‡½æ•°ï¼Œå¯ä»¥å¯¹è¾“å…¥çš„ä¸Šæ¸¸æ•°æ®è¿›è¡Œæ˜ å°„æˆ–è½¬æ¢ï¼ŒåŒæ ·ä»¥ä»¥é—­åŒ…è¿”å›çš„æ•°æ®ä½œä¸ºæ–°çš„å‘å¸ƒè€…ä¸ºè¾“å‡ºï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="line"><span class="cl"><span class="kd">let</span> <span class="nv">array</span> <span class="p">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="c1">// (1...4)</span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nv">initialValue</span> <span class="p">=</span> <span class="mi">100</span>
</span></span><span class="line"><span class="cl"><span class="kc">_</span> <span class="p">=</span> <span class="n">array</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="n">publisher</span>             <span class="c1">// å°†æ•°ç»„ä½œä¸ºå‘å¸ƒè€…ï¼Œä¾æ¬¡å‘å¸ƒå…¶ä¸­çš„å€¼</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="n">scan</span><span class="p">(</span><span class="n">initialValue</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$0</span> <span class="o">+</span> <span class="nb">Int</span><span class="p">(</span><span class="nv">$1</span><span class="p">)</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="bp">map</span> <span class="p">{</span> <span class="nb">String</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">}</span>    <span class="c1">// map  æ“ä½œç¬¦ï¼šå¯åœ¨é—­åŒ…å†…å¯¹ä¸Šæ¸¸è¾“å‡ºåšæ˜ å°„æˆ–è½¬æ¢ï¼Œé—­åŒ…è¿”å›çš„æ•°æ®å°†ä½œä¸ºæ–°çš„å‘å¸ƒè€…å‘å¸ƒ</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="n">sink</span> <span class="p">{</span> <span class="bp">print</span> <span class="p">(</span><span class="nv">$0</span><span class="p">,</span> <span class="n">terminator</span><span class="p">:</span> <span class="s">&#34; &#34;</span><span class="p">)</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 101 103 106 110 </span>
</span></span></code></pre></div><h2 id="subscriber">Subscriber</h2>
<h3 id="ä»‹ç»-1">ä»‹ç»</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="line"><span class="cl"><span class="c1">/// A protocol that declares a type that can receive input from a publisher.</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// å£°æ˜ä¸€ç§å¯ä»¥æ¥æ”¶å‘å¸ƒè€…è¾“å…¥çš„ç±»å‹çš„åè®®ã€‚</span>
</span></span><span class="line"><span class="cl"><span class="c1">///</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// A ``Subscriber`` instance receives a stream of elements from a ``Publisher``, along with life cycle events describing changes to their relationship. A given subscriberâ€™s ``Subscriber/Input`` and ``Subscriber/Failure`` associated types must match the ``Publisher/Output`` and ``Publisher/Failure`` of its corresponding publisher.</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// ``Subscriber`` å®ä¾‹ä» ``Publisher`` æ¥æ”¶å…ƒç´ æµï¼Œä»¥åŠæè¿°å…¶å…³ç³»å˜åŒ–çš„ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ã€‚ç»™å®šè®¢é˜…è€…çš„ ``Subscriber/Input`` å’Œ ``Subscriber/Failure`` å…³è”ç±»å‹å¿…é¡»ä¸å…¶ç›¸åº”å‘å¸ƒè€…çš„ ``Publisher/Output`` å’Œ ``Publisher/Failure`` åŒ¹é…ã€‚</span>
</span></span><span class="line"><span class="cl"><span class="c1">///</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// You connect a subscriber to a publisher by calling the publisherâ€™s ``Publisher/subscribe(_:)-4u8kn`` method.  After making this call, the publisher invokes the subscriberâ€™s ``Subscriber/receive(subscription:)`` method. This gives the subscriber a ``Subscription`` instance, which it uses to demand elements from the publisher, and to optionally cancel the subscription. After the subscriber makes an initial demand, the publisher calls ``Subscriber/receive(_:)``, possibly asynchronously, to deliver newly-published elements. If the publisher stops publishing, it calls ``Subscriber/receive(completion:)``, using a parameter of type ``Subscribers/Completion`` to indicate whether publishing completes normally or with an error.</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// å¯ä»¥é€šè¿‡è°ƒç”¨å‘å¸ƒè€…çš„``Publisher/subscribe(_:)-4u8kn`` æ–¹æ³•å°†è®¢é˜…è€…è¿æ¥åˆ°å‘å¸ƒè€…ã€‚è°ƒç”¨è¯¥æ–¹æ³•åï¼Œå‘å¸ƒè€…è°ƒç”¨è®¢é˜…è€…çš„ ``Subscriber/receive(subscription:)`` æ–¹æ³•ã€‚è¿™ä¸ºè®¢é˜…è€…æä¾›äº†ä¸€ä¸ª ``Subscription`` å®ä¾‹ï¼Œå…¶ä½¿ç”¨è¯¥å®ä¾‹å‘å‘å¸ƒè€…è¯·æ±‚å…ƒç´ ï¼Œå¹¶å¯ä»¥é€‰æ‹©å–æ¶ˆè®¢é˜…ã€‚è®¢é˜…è€…å‘å‡ºåˆå§‹è¯·æ±‚åï¼Œå‘å¸ƒè€…è°ƒç”¨ï¼ˆå¯èƒ½æ˜¯å¼‚æ­¥ï¼‰``Subscriber/receive(_:)``ï¼Œä»¥äº¤ä»˜æ–°å‘å¸ƒçš„å…ƒç´ ã€‚å¦‚æœå‘å¸ƒè€…åœæ­¢å‘å¸ƒï¼Œå…¶å°†ä½¿ç”¨ç±»å‹ä¸º ``Subscribers/Completion`` çš„å‚æ•°è°ƒç”¨ ``Subscriber/receive(completion:)``ï¼Œä»¥æŒ‡ç¤ºå‘å¸ƒæ˜¯å¦æ­£å¸¸å®Œæˆæˆ–å‡ºç°é”™è¯¯ã€‚</span>
</span></span><span class="line"><span class="cl"><span class="c1">///</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// Combine provides the following subscribers as operators on the ``Publisher`` type:</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// Combine åœ¨ ``Publisher`` ç±»å‹ä¸Šæä¾›ä»¥ä¸‹è®¢é˜…è€…ä½œä¸ºæ“ä½œç¬¦ï¼š</span>
</span></span><span class="line"><span class="cl"><span class="c1">///</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// - ``Publisher/sink(receiveCompletion:receiveValue:)`` executes arbitrary closures when it receives a completion signal and each time it receives a new element.</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// - ``Publisher/sink(receiveCompletion:receiveValue:)`` åœ¨æ¥æ”¶åˆ°å®Œæˆä¿¡å·ä»¥åŠæ¯æ¬¡æ¥æ”¶åˆ°æ–°å…ƒç´ æ—¶æ‰§è¡Œä»»æ„é—­åŒ…ã€‚</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// - ``Publisher/assign(toğŸ”›)`` writes each newly-received value to a property identified by a key path on a given instance.</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// - ``Publisher/assign(toğŸ”›)`` å°†æ¯ä¸ªæ–°æ¥æ”¶çš„å€¼å†™å…¥ç”±ç»™å®šå®ä¾‹ä¸Šçš„é”®è·¯å¾„æ ‡è¯†çš„å±æ€§ã€‚</span>
</span></span><span class="line"><span class="cl"><span class="p">@</span><span class="n">available</span><span class="p">(</span><span class="n">macOS</span> <span class="mf">10.15</span><span class="p">,</span> <span class="n">iOS</span> <span class="mf">13.0</span><span class="p">,</span> <span class="n">tvOS</span> <span class="mf">13.0</span><span class="p">,</span> <span class="n">watchOS</span> <span class="mf">6.0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">protocol</span> <span class="nc">Subscriber</span><span class="p">&lt;</span><span class="n">Input</span><span class="p">,</span> <span class="n">Failure</span><span class="p">&gt;</span> <span class="p">:</span> <span class="n">CustomCombineIdentifierConvertible</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">/// The kind of values this subscriber receives.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// æ­¤è®¢é˜…è€…æ¥æ”¶çš„å€¼çš„ç±»å‹ã€‚</span>
</span></span><span class="line"><span class="cl">    <span class="n">associatedtype</span> <span class="n">Input</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">/// The kind of errors this subscriber might receive.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// æ­¤è®¢é˜…è€…å¯èƒ½æ”¶åˆ°çš„é”™è¯¯ç±»å‹ã€‚</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// Use `Never` if this `Subscriber` cannot receive errors.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// å¦‚æœæ­¤ `Subscriber` ä¸æ¥æ”¶é”™è¯¯ï¼Œè¯·ä½¿ç”¨ `Never`ã€‚</span>
</span></span><span class="line"><span class="cl">    <span class="n">associatedtype</span> <span class="n">Failure</span> <span class="p">:</span> <span class="n">Error</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">/// Tells the subscriber that it has successfully subscribed to the publisher and may request items.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// å‘ŠçŸ¥è®¢é˜…è€…å·²æˆåŠŸè®¢é˜…å‘å¸ƒè€…ï¼Œå¹¶å¯èƒ½è¯·æ±‚é¡¹ç›®ã€‚</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// Use the received ``Subscription`` to request items from the publisher.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// ä½¿ç”¨æ”¶åˆ°çš„ ``Subscription`` ä»å‘å¸ƒè€…è¯·æ±‚é¡¹ç›®ã€‚</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// - Parameter subscription: A subscription that represents the connection between publisher and subscriber.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// - å‚æ•° subscription: è¡¨ç¤ºå‘å¸ƒè€…å’Œè®¢é˜…è€…ä¹‹é—´è¿æ¥çš„è®¢é˜…ã€‚</span>
</span></span><span class="line"><span class="cl">    <span class="kd">func</span> <span class="nf">receive</span><span class="p">(</span><span class="n">subscription</span><span class="p">:</span> <span class="n">Subscription</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">/// Tells the subscriber that the publisher has produced an element.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// å‘Šè¯‰è®¢é˜…è€…ï¼Œå‘å¸ƒè€…å·²ç”Ÿæˆå…ƒç´ ã€‚</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// - Parameter input: The published element.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// - å‚æ•° input: å‘å¸ƒçš„å…ƒç´ ã€‚</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// - Returns: A `Subscribers.Demand` instance indicating how many more elements the subscriber expects to receive.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// - è¿”å›å€¼: è¡¨ç¤ºè®¢é˜…è€…é¢„æœŸæ¥æ”¶å¤šå°‘ä¸ªå…ƒç´ çš„ ``Subscribers.Demand`` å®ä¾‹ã€‚</span>
</span></span><span class="line"><span class="cl">    <span class="kd">func</span> <span class="nf">receive</span><span class="p">(</span><span class="kc">_</span> <span class="n">input</span><span class="p">:</span> <span class="kc">Self</span><span class="p">.</span><span class="n">Input</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">Subscribers</span><span class="p">.</span><span class="n">Demand</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">/// Tells the subscriber that the publisher has completed publishing, either normally or with an error.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// å‘Šè¯‰è®¢é˜…è€…ï¼Œå‘å¸ƒè€…å·²å®Œæˆå‘å¸ƒï¼Œå¯èƒ½æ˜¯æ­£å¸¸æˆ–å‡ºç°é”™è¯¯ã€‚</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// - Parameter completion: A ``Subscribers/Completion`` case indicating whether publishing completed normally or with an error.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// - å‚æ•° completion: è¡¨ç¤ºå‘å¸ƒæ˜¯å¦æ­£å¸¸å®Œæˆæˆ–å‡ºç°é”™è¯¯çš„ ``Subscribers/Completion`` çš„å®ä¾‹ã€‚</span>
</span></span><span class="line"><span class="cl">    <span class="kd">func</span> <span class="nf">receive</span><span class="p">(</span><span class="n">completion</span><span class="p">:</span> <span class="n">Subscribers</span><span class="p">.</span><span class="n">Completion</span><span class="p">&lt;</span><span class="kc">Self</span><span class="p">.</span><span class="n">Failure</span><span class="p">&gt;)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="sink">sink</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="line"><span class="cl"><span class="p">@</span><span class="n">available</span><span class="p">(</span><span class="n">macOS</span> <span class="mf">10.15</span><span class="p">,</span> <span class="n">iOS</span> <span class="mf">13.0</span><span class="p">,</span> <span class="n">tvOS</span> <span class="mf">13.0</span><span class="p">,</span> <span class="n">watchOS</span> <span class="mf">6.0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">extension</span> <span class="nc">Publisher</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">/// Attaches a subscriber with closure-based behavior.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// å°†é—­åŒ…è¡Œä¸ºçš„è®¢é˜…è€…é™„åŠ åˆ°å‘å¸ƒè€…ã€‚</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// Use ``Publisher/sink(receiveCompletion:receiveValue:)`` to observe values received by the publisher and process them using a closure you specify.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// ä½¿ç”¨ ``Publisher/sink(receiveCompletion:receiveValue:)`` æ¥è§‚å¯Ÿå‘å¸ƒè€…æ¥æ”¶åˆ°çš„å€¼ï¼Œå¹¶ä½¿ç”¨æŒ‡å®šçš„é—­åŒ…å¤„ç†ã€‚</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// In this example, a &lt;doc://com.apple.documentation/documentation/Swift/Range&gt; publisher publishes integers to a ``Publisher/sink(receiveCompletion:receiveValue:)`` operatorâ€™s `receiveValue` closure that prints them to the console. Upon completion the ``Publisher/sink(receiveCompletion:receiveValue:)`` operatorâ€™s `receiveCompletion` closure indicates the successful termination of the stream.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œä¸€ä¸ª &lt;doc://com.apple.documentation/documentation/Swift/Range&gt; å‘å¸ƒè€…å°†æ•´æ•°å‘å¸ƒåˆ° ``Publisher/sink(receiveCompletion:receiveValue:)`` æ“ä½œç¬¦çš„ ``receiveValue`` é—­åŒ…ä¸­ï¼Œè¯¥é—­åŒ…å°†å®ƒä»¬æ‰“å°åˆ°æ§åˆ¶å°ã€‚åœ¨å®Œæˆåï¼Œ``Publisher/sink(receiveCompletion:receiveValue:)`` æ“ä½œç¬¦çš„ ``receiveCompletion`` é—­åŒ…å°†æ ‡è¯†ä¸ºæˆåŠŸç»ˆæ­¢æµã€‚</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///     let myRange = (0...3)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///     cancellable = myRange.publisher</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///         .sink(receiveCompletion: { print (&#34;completion: \($0)&#34;) },</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///               receiveValue: { print (&#34;value: \($0)&#34;) })</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///     // Prints:</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///     //  value: 0</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///     //  value: 1</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///     //  value: 2</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///     //  value: 3</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///     //  completion: finished</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// This method creates the subscriber and immediately requests an unlimited number of values, prior to returning the subscriber.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// è¯¥æ–¹æ³•åˆ›å»ºè®¢é˜…è€…å¹¶ç«‹å³è¯·æ±‚æ— é™æ•°é‡çš„å€¼ï¼Œç„¶åè¿”å›è®¢é˜…è€…ã€‚</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// The return value should be held, otherwise the stream will be canceled.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// è¿”å›å€¼åº”ä¿ç•™ï¼Œå¦åˆ™æµå°†è¢«å–æ¶ˆã€‚</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// - parameter receiveComplete: The closure to execute on completion.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// - å‚æ•° receiveComplete: åœ¨å®Œæˆæ—¶æ‰§è¡Œçš„é—­åŒ…ã€‚</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// - parameter receiveValue: The closure to execute on receipt of a value.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// - å‚æ•° receiveValue: åœ¨æ¥æ”¶åˆ°å€¼æ—¶æ‰§è¡Œçš„é—­åŒ…ã€‚</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// - Returns: A cancellable instance, which you use when you end assignment of the received value. Deallocation of the result will tear down the subscription stream.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// - è¿”å›å€¼: ä¸€ä¸ªå¯å–æ¶ˆçš„å®ä¾‹ï¼Œå½“ç»“æŸæ¥æ”¶åˆ°çš„å€¼çš„èµ‹å€¼æ—¶ä½¿ç”¨ã€‚ç»“æœçš„é‡Šæ”¾å°†ä¸­æ–­è®¢é˜…æµã€‚</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">func</span> <span class="nf">sink</span><span class="p">(</span><span class="n">receiveCompletion</span><span class="p">:</span> <span class="p">@</span><span class="n">escaping</span> <span class="p">((</span><span class="n">Subscribers</span><span class="p">.</span><span class="n">Completion</span><span class="p">&lt;</span><span class="kc">Self</span><span class="p">.</span><span class="n">Failure</span><span class="p">&gt;)</span> <span class="p">-&gt;</span> <span class="nb">Void</span><span class="p">),</span> <span class="n">receiveValue</span><span class="p">:</span> <span class="p">@</span><span class="n">escaping</span> <span class="p">((</span><span class="kc">Self</span><span class="p">.</span><span class="n">Output</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="nb">Void</span><span class="p">))</span> <span class="p">-&gt;</span> <span class="n">AnyCancellable</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">@</span><span class="n">available</span><span class="p">(</span><span class="n">macOS</span> <span class="mf">10.15</span><span class="p">,</span> <span class="n">iOS</span> <span class="mf">13.0</span><span class="p">,</span> <span class="n">tvOS</span> <span class="mf">13.0</span><span class="p">,</span> <span class="n">watchOS</span> <span class="mf">6.0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">extension</span> <span class="nc">Publisher</span> <span class="k">where</span> <span class="kc">Self</span><span class="p">.</span><span class="n">Failure</span> <span class="p">==</span> <span class="n">Never</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">/// Attaches a subscriber with closure-based behavior to a publisher that never fails.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// å°†å…·æœ‰é—­åŒ…è¡Œä¸ºçš„è®¢é˜…è€…é™„åŠ åˆ°ä»ä¸å¤±è´¥çš„å‘å¸ƒè€…ä¸Šã€‚</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// Use ``Publisher/sink(receiveValue:)`` to observe values received by the publisher and print them to the console. This operator can only be used when the stream doesnâ€™t fail, that is, when the publisherâ€™s ``Publisher/Failure`` type is &lt;doc://com.apple.documentation/documentation/Swift/Never&gt;.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// ä½¿ç”¨ ``Publisher/sink(receiveValue:)`` ä»¥è§‚å¯Ÿå‘å¸ƒè€…æ¥æ”¶åˆ°çš„å€¼ï¼Œå¹¶å°†å…¶æ‰“å°åˆ°æ§åˆ¶å°ã€‚ä»…å½“æµæœªå¤±è´¥æ—¶ï¼Œå³å‘å¸ƒè€…çš„ ``Publisher/Failure`` ç±»å‹ä¸º &lt;doc://com.apple.documentation/documentation/Swift/Never&gt; æ—¶ï¼Œæ‰å¯ä½¿ç”¨æ­¤æ“ä½œç¬¦.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// In this example, a &lt;doc://com.apple.documentation/documentation/Swift/Range&gt; publisher publishes integers to a ``Publisher/sink(receiveValue:)`` operatorâ€™s</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// `receiveValue` closure that prints them to the console:</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// ä»¥ä¸‹ä¾‹å­ä¸­ï¼Œ&lt;doc://com.apple.documentation/documentation/Swift/Range&gt; å‘å¸ƒè€…å‘å¸ƒæ•´å‹åˆ° ``Publisher/sink(receiveValue:)`` æ“ä½œç¬¦çš„ ``receiveValue`` é—­åŒ…ä¸­ï¼Œå¹¶å°†å…¶æ‰“å°åˆ°æ§åˆ¶å°ï¼š</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///     let integers = (0...3)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///     integers.publisher</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///         .sink { print(&#34;Received \($0)&#34;) }</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///     // Prints:</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///     //  Received 0</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///     //  Received 1</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///     //  Received 2</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///     //  Received 3</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// This method creates the subscriber and immediately requests an unlimited number of values, prior to returning the subscriber.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// æ­¤æ–¹æ³•åˆ›å»ºè®¢é˜…è€…ï¼Œå¹¶åœ¨è¿”å›è®¢é˜…æœåŠ¡å™¨ä¹‹å‰ç«‹å³è¯·æ±‚æ— é™æ•°é‡çš„å€¼ã€‚</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// The return value should be held, otherwise the stream will be canceled.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// è¿”å›å€¼åº”ä¿ç•™ï¼Œå¦åˆ™æµå°†è¢«å–æ¶ˆã€‚</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// - parameter receiveValue: The closure to execute on receipt of a value.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// - å‚æ•° receiveValueï¼šåœ¨æ”¶åˆ°å€¼æ—¶æ‰§è¡Œçš„é—­åŒ…ã€‚</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// - Returns: A cancellable instance, which you use when you end assignment of the received value. Deallocation of the result will tear down the subscription stream.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// - è¿”å›å€¼ï¼šä¸€ä¸ªå¯å–æ¶ˆçš„å®ä¾‹ï¼Œå½“ç»“æŸæ¥æ”¶å€¼çš„èµ‹å€¼æ—¶å¯ä½¿ç”¨ã€‚ç»“æœçš„é‡Šæ”¾å°†é”€æ¯è®¢é˜…æµã€‚</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">func</span> <span class="nf">sink</span><span class="p">(</span><span class="n">receiveValue</span><span class="p">:</span> <span class="p">@</span><span class="n">escaping</span> <span class="p">((</span><span class="kc">Self</span><span class="p">.</span><span class="n">Output</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="nb">Void</span><span class="p">))</span> <span class="p">-&gt;</span> <span class="n">AnyCancellable</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>ä¸Šæ–‡ä¸­ä½¿ç”¨çš„ <code>sink</code> å…¶å®ç®—æ˜¯è®¢é˜…è€…ï¼ˆè™½ç„¶æ³¨é‡Šä¸­ç§°ä¸º operatorï¼‰ã€‚éœ€è¦æ³¨æ„å…¶è¿”å›å€¼æ˜¯å¦ä¿å­˜çš„å·®å¼‚ï¼š</p>
<ul>
<li>ä¸æ¥æ”¶å®Œæˆäº‹ä»¶ï¼š</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="line"><span class="cl"><span class="kd">let</span> <span class="nv">p</span> <span class="p">=</span> <span class="n">CurrentValueSubject</span><span class="p">&lt;</span><span class="nb">Int</span><span class="p">,</span> <span class="n">Never</span><span class="p">&gt;(</span><span class="mi">1</span><span class="p">)</span>    <span class="c1">// åˆ›å»ºåç«‹å³å‘å¸ƒ 1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// sink(receiveValue:) -&gt; AnyCancellable</span>
</span></span><span class="line"><span class="cl"><span class="kc">_</span> <span class="p">=</span> <span class="n">p</span><span class="p">.</span><span class="n">sink</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="s">&#34;_</span><span class="si">\(</span><span class="nv">$0</span><span class="si">)</span><span class="s">&#34;</span><span class="p">)</span> <span class="p">}</span>                <span class="c1">// ä¸ä¿å­˜ï¼Œä»…æ¥æ”¶ä¸€æ¬¡</span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nv">cancellable</span> <span class="p">=</span> <span class="n">p</span><span class="p">.</span><span class="n">sink</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="s">&#34;c_</span><span class="si">\(</span><span class="nv">$0</span><span class="si">)</span><span class="s">&#34;</span><span class="p">)</span> <span class="p">}</span> <span class="c1">// ä¿å­˜</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">cancellable</span><span class="p">.</span><span class="n">cancel</span><span class="p">()</span>                          <span class="c1">// å–æ¶ˆåï¼Œä¸å†æ¥æ”¶</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// _1</span>
</span></span><span class="line"><span class="cl"><span class="c1">// c_1</span>
</span></span><span class="line"><span class="cl"><span class="c1">// c_2</span>
</span></span></code></pre></div><ul>
<li>æ¥æ”¶å®Œæˆäº‹ä»¶ï¼š</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="line"><span class="cl"><span class="kd">let</span> <span class="nv">p</span> <span class="p">=</span> <span class="n">CurrentValueSubject</span><span class="p">&lt;</span><span class="nb">Int</span><span class="p">,</span> <span class="n">Never</span><span class="p">&gt;(</span><span class="mi">1</span><span class="p">)</span>                                <span class="c1">// åˆ›å»ºåç«‹å³å‘å¸ƒ 1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// sink(receiveCompletion:, receiveValue:) -&gt; AnyCancellable</span>
</span></span><span class="line"><span class="cl"><span class="kc">_</span> <span class="p">=</span> <span class="n">p</span><span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="kc">_</span> <span class="k">in</span> <span class="bp">print</span><span class="p">(</span><span class="s">&#34;_end&#34;</span><span class="p">)</span> <span class="p">})</span> <span class="p">{</span>                   <span class="c1">// ä¸ä¿å­˜ï¼Œä»…æœ€åˆçš„æ¥æ”¶ä¸€æ¬¡ï¼Œä¹Ÿä¸æ¥æ”¶å®Œæˆ</span>
</span></span><span class="line"><span class="cl">    <span class="bp">print</span><span class="p">(</span><span class="s">&#34;_</span><span class="si">\(</span><span class="nv">$0</span><span class="si">)</span><span class="s">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nv">cancellable2</span> <span class="p">=</span> <span class="n">p</span><span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="kc">_</span> <span class="k">in</span> <span class="bp">print</span><span class="p">(</span><span class="s">&#34;c2_end&#34;</span><span class="p">)</span> <span class="p">})</span> <span class="p">{</span>  <span class="c1">// ä¿å­˜</span>
</span></span><span class="line"><span class="cl">    <span class="bp">print</span><span class="p">(</span><span class="s">&#34;c2_</span><span class="si">\(</span><span class="nv">$0</span><span class="si">)</span><span class="s">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">completion</span><span class="p">:</span> <span class="p">.</span><span class="n">finished</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="c1">// å·²ç»“æŸçš„å‘å¸ƒè€…ï¼Œå³ä½¿è°ƒç”¨å‘å¸ƒä¹Ÿä¸ä¼šå†æ¬¡å‘å¸ƒ</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">cancellable2</span><span class="p">.</span><span class="n">cancel</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// _1</span>
</span></span><span class="line"><span class="cl"><span class="c1">// c2_1</span>
</span></span><span class="line"><span class="cl"><span class="c1">// c2_4</span>
</span></span><span class="line"><span class="cl"><span class="c1">// c2_end</span>
</span></span></code></pre></div><h3 id="assign">assign</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="line"><span class="cl"><span class="p">@</span><span class="n">available</span><span class="p">(</span><span class="n">macOS</span> <span class="mf">10.15</span><span class="p">,</span> <span class="n">iOS</span> <span class="mf">13.0</span><span class="p">,</span> <span class="n">tvOS</span> <span class="mf">13.0</span><span class="p">,</span> <span class="n">watchOS</span> <span class="mf">6.0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">extension</span> <span class="nc">Publisher</span> <span class="k">where</span> <span class="kc">Self</span><span class="p">.</span><span class="n">Failure</span> <span class="p">==</span> <span class="n">Never</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">/// Assigns each element from a publisher to a property on an object.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// å°†å‘å¸ƒè€…ä¸­çš„æ¯ä¸ªå…ƒç´ åˆ†é…ç»™å¯¹è±¡ä¸Šçš„å±æ€§ã€‚</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// Use the ``Publisher/assign(toğŸ”›)`` subscriber when you want to set a given property each time a publisher produces a value.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// å½“æƒ³è¦è®¾ç½®ç»™å®šå±æ€§æ¯æ¬¡å‘å¸ƒå€¼æ—¶ï¼Œä½¿ç”¨ ``Publisher/assign(toğŸ”›)`` è®¢é˜…è€…ã€‚</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// In this example, the ``Publisher/assign(toğŸ”›)`` sets the value of the `anInt` property on an instance of `MyClass`:</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ``Publisher/assign(toğŸ”›)`` å°†è®¾ç½® `MyClass` çš„ `anInt` å±æ€§çš„å€¼ï¼š</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///     class MyClass {</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///         var anInt: Int = 0 {</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///             didSet {</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///                 print(&#34;anInt was set to: \(anInt)&#34;, terminator: &#34;; &#34;)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///             }</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///         }</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///     }</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///     var myObject = MyClass()</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///     let myRange = (0...2)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///     cancellable = myRange.publisher</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///         .assign(to: \.anInt, on: myObject)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///     // Prints: &#34;anInt was set to: 0; anInt was set to: 1; anInt was set to: 2&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///  &gt; Important: The ``Subscribers/Assign`` instance created by this operator maintains a strong reference to `object`, and sets it to `nil` when the upstream publisher completes (either normally or with an error).</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///  &gt; é‡ç‚¹ï¼šæ­¤æ“ä½œç¬¦åˆ›å»ºçš„ ``Subscribers/Assign`` å®ä¾‹å°†ä¿æŒå¯¹ `object` çš„å¼ºå¼•ç”¨ï¼Œå¹¶åœ¨ä¸Šæ¸¸å‘å¸ƒè€…å®Œæˆï¼ˆæˆ–è€…æ˜¯å› ä¸ºé”™è¯¯è€Œå®Œæˆï¼‰æ—¶å°†å…¶è®¾ç½®ä¸º `nil`ã€‚</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// - Parameters:</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// - å‚æ•°ï¼š</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///   - keyPath: A key path that indicates the property to assign. See [Key-Path Expression](https://developer.apple.com/library/archive/documentation/Swift/Conceptual/Swift_Programming_Language/Expressions.html#//apple_ref/doc/uid/TP40014097-CH32-ID563) in _The Swift Programming Language_ to learn how to use key paths to specify a property of an object.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///   - keyPath: æŒ‡ç¤ºè¦åˆ†é…çš„å±æ€§çš„é”®è·¯å¾„ã€‚è¯·å‚è§[å…³é”®è·¯å¾„è¡¨è¾¾å¼](https://developer.apple.com/library/archive/documentation/Swift/Conceptual/Swift_Programming_Language/Expressions.html#//apple_ref/doc/uid/TP40014097-CH32-ID563å­¦ä¹ å¦‚ä½•ä½¿ç”¨é”®è·¯å¾„æŒ‡å®šå¯¹è±¡çš„å±æ€§ã€‚</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///   - object: The object that contains the property. The subscriber assigns the objectâ€™s property every time it receives a new value.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///   - object: åŒ…å«å±æ€§çš„å¯¹è±¡ã€‚è®¢é˜…è€…æ¯æ¬¡æ¥æ”¶æ–°å€¼æ—¶ï¼Œéƒ½å°†å¯¹è±¡çš„å±æ€§åˆ†é…ã€‚</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// - Returns: An ``AnyCancellable`` instance. Call ``Cancellable/cancel()`` on this instance when you no longer want the publisher to automatically assign the property. Deinitializing this instance will also cancel automatic assignment.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// - è¿”å›å€¼ï¼šä¸€ä¸ª ``AnyCancellable`` å®ä¾‹ã€‚å½“ä¸å†éœ€è¦å‘å¸ƒè€…è‡ªåŠ¨åˆ†é…å±æ€§æ—¶ï¼Œè¯·è°ƒç”¨ ``Cancellable/cancel()`` æ–¹æ³•æ¥å–æ¶ˆè¯¥å®ä¾‹çš„è®¢é˜…ã€‚é”€æ¯è¯¥å®ä¾‹æ—¶ï¼Œä¹Ÿä¼šå–æ¶ˆè‡ªåŠ¨åˆ†é…ã€‚</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">func</span> <span class="nf">assign</span><span class="p">&lt;</span><span class="n">Root</span><span class="p">&gt;(</span><span class="n">to</span> <span class="n">keyPath</span><span class="p">:</span> <span class="n">ReferenceWritableKeyPath</span><span class="p">&lt;</span><span class="n">Root</span><span class="p">,</span> <span class="kc">Self</span><span class="p">.</span><span class="n">Output</span><span class="p">&gt;,</span> <span class="n">on</span> <span class="n">object</span><span class="p">:</span> <span class="n">Root</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">AnyCancellable</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>assign</code> è®¾ç½®çš„å¯¹è±¡æœ¬èº«éœ€è¦æ˜¯ <code>class</code> ç±»å‹çš„å¯¹è±¡ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="line"><span class="cl"><span class="kd">class</span> <span class="nc">Foo</span><span class="p">:</span> <span class="n">CustomStringConvertible</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nv">bar</span> <span class="p">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nv">description</span><span class="p">:</span> <span class="nb">String</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s">&#34;Foo - </span><span class="si">\(</span><span class="n">bar</span><span class="si">)</span><span class="s">&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nv">p</span> <span class="p">=</span> <span class="n">CurrentValueSubject</span><span class="p">&lt;</span><span class="nb">Int</span><span class="p">,</span> <span class="n">Never</span><span class="p">&gt;(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nv">f</span> <span class="p">=</span> <span class="n">Foo</span><span class="p">()</span>                                <span class="c1">// Foo - 0</span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nv">cancellable</span> <span class="p">=</span> <span class="n">p</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">to</span><span class="p">:</span> <span class="err">\</span><span class="p">.</span><span class="n">bar</span><span class="p">,</span> <span class="n">on</span><span class="p">:</span> <span class="n">f</span><span class="p">)</span> <span class="c1">// Foo - 1</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>                                    <span class="c1">// Foo - 2</span>
</span></span></code></pre></div><h2 id="å…¶ä»–">å…¶ä»–</h2>
<h3 id="subject-1">Subject</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="line"><span class="cl"><span class="c1">/// A publisher that exposes a method for outside callers to publish elements.</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// å‘å¸ƒè€…ï¼Œå…è®¸å¤–éƒ¨è°ƒç”¨è€…å‘å¸ƒå…ƒç´ ã€‚</span>
</span></span><span class="line"><span class="cl"><span class="c1">///</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// A subject is a publisher that you can use to â€injectâ€ values into a stream, by calling its ``Subject/send(_:)`` method. This can be useful for adapting existing imperative code to the Combine model.</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// Subject æ˜¯ä¸€ä¸ªå‘å¸ƒè€…ï¼Œå¯ä»¥ç”¨æ¥ã€Œæ³¨å…¥ã€å€¼ï¼Œé€šè¿‡è°ƒç”¨å…¶ ``Subject/send(_:)`` æ–¹æ³•æ¥å®ç°ã€‚è¿™å¯¹é€‚é…ç°æœ‰çš„é¢å‘å¯¹è±¡è¯­è¨€çš„ä»£ç å¾ˆæœ‰ç”¨ã€‚</span>
</span></span><span class="line"><span class="cl"><span class="p">@</span><span class="n">available</span><span class="p">(</span><span class="n">macOS</span> <span class="mf">10.15</span><span class="p">,</span> <span class="n">iOS</span> <span class="mf">13.0</span><span class="p">,</span> <span class="n">tvOS</span> <span class="mf">13.0</span><span class="p">,</span> <span class="n">watchOS</span> <span class="mf">6.0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">protocol</span> <span class="nc">Subject</span><span class="p">&lt;</span><span class="n">Output</span><span class="p">,</span> <span class="n">Failure</span><span class="p">&gt;</span> <span class="p">:</span> <span class="nb">AnyObject</span><span class="p">,</span> <span class="n">Publisher</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">/// Sends a value to the subscriber.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// å‘é€ä¸€ä¸ªå€¼ç»™è®¢é˜…è€…ã€‚</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// - Parameter value: The value to send.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// - å‚æ•° value: è¦å‘é€çš„å€¼ã€‚</span>
</span></span><span class="line"><span class="cl">    <span class="kd">func</span> <span class="nf">send</span><span class="p">(</span><span class="kc">_</span> <span class="n">value</span><span class="p">:</span> <span class="kc">Self</span><span class="p">.</span><span class="n">Output</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">/// Sends a completion signal to the subscriber.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// å‘é€ä¸€ä¸ªå®Œæˆä¿¡å·ç»™è®¢é˜…è€…ã€‚</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// - Parameter completion: A `Completion` instance which indicates whether publishing has finished normally or failed with an error.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// - å‚æ•° completion: ä¸€ä¸ª ``Completion`` å®ä¾‹ï¼Œè¯¥å®ä¾‹æŒ‡ç¤ºå‘å¸ƒæ˜¯å¦å®Œæˆæ­£å¸¸æˆ–è€…å¤±è´¥ã€‚</span>
</span></span><span class="line"><span class="cl">    <span class="kd">func</span> <span class="nf">send</span><span class="p">(</span><span class="n">completion</span><span class="p">:</span> <span class="n">Subscribers</span><span class="p">.</span><span class="n">Completion</span><span class="p">&lt;</span><span class="kc">Self</span><span class="p">.</span><span class="n">Failure</span><span class="p">&gt;)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">/// Sends a subscription to the subscriber.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// å‘é€ä¸€ä¸ªè®¢é˜…ç»™è®¢é˜…è€…ã€‚</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// This call provides the ``Subject`` an opportunity to establish demand for any new upstream subscriptions.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// è¯¥è°ƒç”¨æä¾› ``Subject`` ä¸€ä¸ªæœºä¼šï¼Œä»¥ä¾¿å®ƒå¯ä»¥å»ºç«‹ä»»ä½•æ–°çš„ä¸Šæ¸¸è®¢é˜…ã€‚</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// - Parameter subscription: The subscription instance through which the subscriber can request elements.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// - å‚æ•° subscription: è®¢é˜…è€…å¯ä»¥é€šè¿‡è¯¥å®ä¾‹è¯·æ±‚å…ƒç´ çš„è®¢é˜…å®ä¾‹ã€‚</span>
</span></span><span class="line"><span class="cl">    <span class="kd">func</span> <span class="nf">send</span><span class="p">(</span><span class="n">subscription</span><span class="p">:</span> <span class="n">Subscription</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p><code>Subject</code> ä¹Ÿæ˜¯å‘å¸ƒè€…ï¼Œå¤–ç•Œå¯ä»¥é€šè¿‡ <code>send</code> æ–¹æ³•ä¸»åŠ¨å‘å¸ƒä¸åŒçš„å€¼ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="line"><span class="cl"><span class="kd">let</span> <span class="nv">p1</span> <span class="p">=</span> <span class="n">CurrentValueSubject</span><span class="p">&lt;</span><span class="nb">Int</span><span class="p">,</span> <span class="n">Never</span><span class="p">&gt;(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">p1</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nv">c1</span> <span class="p">=</span> <span class="n">p1</span><span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="kc">_</span> <span class="k">in</span> <span class="bp">print</span><span class="p">(</span><span class="s">&#34;c1_end&#34;</span><span class="p">)</span> <span class="p">})</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="s">&#34;c1_</span><span class="si">\(</span><span class="nv">$0</span><span class="si">)</span><span class="s">&#34;</span><span class="p">)</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">p1</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">p1</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">completion</span><span class="p">:</span> <span class="p">.</span><span class="n">finished</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">p1</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">c1</span><span class="p">.</span><span class="n">cancel</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// c1_2</span>
</span></span><span class="line"><span class="cl"><span class="c1">// c1_3</span>
</span></span><span class="line"><span class="cl"><span class="c1">// c1_end</span>
</span></span><span class="line"><span class="cl"><span class="c1">// ---</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nv">p2</span> <span class="p">=</span> <span class="n">PassthroughSubject</span><span class="p">&lt;</span><span class="nb">Int</span><span class="p">,</span> <span class="n">Never</span><span class="p">&gt;()</span> <span class="c1">// ä¸ä¼šå¯¹è®¢é˜…å‰çš„å€¼ä¿ç•™ / å‘å¸ƒ</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">p2</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nv">c2</span> <span class="p">=</span> <span class="n">p2</span><span class="p">.</span><span class="n">sink</span><span class="p">(</span><span class="n">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="kc">_</span> <span class="k">in</span> <span class="bp">print</span><span class="p">(</span><span class="s">&#34;c2_end&#34;</span><span class="p">)</span> <span class="p">})</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="s">&#34;c2_</span><span class="si">\(</span><span class="nv">$0</span><span class="si">)</span><span class="s">&#34;</span><span class="p">)</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">p2</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">p2</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">completion</span><span class="p">:</span> <span class="p">.</span><span class="n">finished</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">p2</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">c2</span><span class="p">.</span><span class="n">cancel</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="c1">// c2_2</span>
</span></span><span class="line"><span class="cl"><span class="c1">// c2_end</span>
</span></span></code></pre></div><h3 id="scheduler">Scheduler</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="line"><span class="cl"><span class="c1">/// A protocol that defines when and how to execute a closure.</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// ä¸€ä¸ªå®šä¹‰ä½•æ—¶ä»¥åŠæ€æ ·æ‰§è¡Œä¸€ä¸ªé—­åŒ…çš„åè®®ã€‚</span>
</span></span><span class="line"><span class="cl"><span class="c1">///</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// You can use a scheduler to execute code as soon as possible, or after a future date.</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// ä½ å¯ä»¥ä½¿ç”¨ä¸€ä¸ªè°ƒåº¦å™¨æ¥ç«‹å³æ‰§è¡Œä»£ç ï¼Œæˆ–è€…åœ¨æœªæ¥çš„æŸä¸ªæ—¶é—´ç‚¹æ‰§è¡Œä»£ç ã€‚</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// Individual scheduler implementations use whatever time-keeping system makes sense for them. Schedulers express this as their `SchedulerTimeType`. Since this type conforms to ``SchedulerTimeIntervalConvertible``, you can always express these times with the convenience functions like `.milliseconds(500)`. Schedulers can accept options to control how they execute the actions passed to them. These options may control factors like which threads or dispatch queues execute the actions.</span>
</span></span><span class="line"><span class="cl"><span class="c1">/// ä¸åŒçš„è°ƒåº¦å™¨å®ç°ä½¿ç”¨å¯¹å…¶æœ‰æ„ä¹‰çš„è®¡æ—¶ç³»ç»Ÿã€‚è°ƒåº¦å™¨å°†å…¶è¡¨ç¤ºä¸º `SchedulerTimeType`ã€‚ç”±äºæ­¤ç±»å‹éµå®ˆäº† ``SchedulerTimeIntervalConvertible``ï¼Œæ‰€ä»¥å¯ä»¥å§‹ç»ˆä½¿ç”¨è¯¸å¦‚ `.milliseconds(500)` çš„å‡½æ•°æ¥è¡¨ç¤ºè¿™äº›æ—¶é—´ã€‚è°ƒåº¦å™¨å¯ä»¥æ¥å—é€‰é¡¹æ¥æ§åˆ¶å¦‚ä½•æ‰§è¡Œä¼ é€’ç»™å®ƒä»¬çš„æ“ä½œã€‚è¿™äº›é€‰é¡¹å¯èƒ½ä¼šæ§åˆ¶æ‰§è¡Œæ“ä½œçš„çº¿ç¨‹æˆ–è°ƒåº¦é˜Ÿåˆ—ç­‰å› ç´ ã€‚</span>
</span></span><span class="line"><span class="cl"><span class="p">@</span><span class="n">available</span><span class="p">(</span><span class="n">macOS</span> <span class="mf">10.15</span><span class="p">,</span> <span class="n">iOS</span> <span class="mf">13.0</span><span class="p">,</span> <span class="n">tvOS</span> <span class="mf">13.0</span><span class="p">,</span> <span class="n">watchOS</span> <span class="mf">6.0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">protocol</span> <span class="nc">Scheduler</span><span class="p">&lt;</span><span class="n">SchedulerTimeType</span><span class="p">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">/// Describes an instant in time for this scheduler.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// æè¿°æ­¤è°ƒåº¦å™¨çš„ä¸€ä¸ªæ—¶é—´ç‚¹ã€‚</span>
</span></span><span class="line"><span class="cl">    <span class="n">associatedtype</span> <span class="n">SchedulerTimeType</span> <span class="p">:</span> <span class="nb">Strideable</span> <span class="k">where</span> <span class="kc">Self</span><span class="p">.</span><span class="n">SchedulerTimeType</span><span class="p">.</span><span class="n">Stride</span> <span class="p">:</span> <span class="n">SchedulerTimeIntervalConvertible</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">/// A type that defines options accepted by the scheduler.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// è¡¨ç¤ºè°ƒåº¦å™¨æ¥å—çš„é€‰é¡¹çš„ç±»å‹ã€‚</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// This type is freely definable by each `Scheduler`. Typically, operations that take a `Scheduler` parameter will also take `SchedulerOptions`.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// è¿™ä¸ªç±»å‹æ˜¯è‡ªç”±å®šä¹‰çš„ã€‚é€šå¸¸ï¼Œå°†ä¸€ä¸ª `Scheduler` å‚æ•°ä¼ é€’ç»™æ“ä½œæ—¶ä¹Ÿä¼šä¼ é€’ `SchedulerOptions`ã€‚</span>
</span></span><span class="line"><span class="cl">    <span class="n">associatedtype</span> <span class="n">SchedulerOptions</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">/// This schedulerâ€™s definition of the current moment in time.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// è¯¥è°ƒåº¦å™¨çš„å½“å‰æ—¶é—´ç‚¹çš„å®šä¹‰ã€‚</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nv">now</span><span class="p">:</span> <span class="kc">Self</span><span class="p">.</span><span class="n">SchedulerTimeType</span> <span class="p">{</span> <span class="kr">get</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">/// The minimum tolerance allowed by the scheduler.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// è°ƒåº¦å™¨å…è®¸çš„æœ€å°å®¹å¿åº¦ã€‚</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nv">minimumTolerance</span><span class="p">:</span> <span class="kc">Self</span><span class="p">.</span><span class="n">SchedulerTimeType</span><span class="p">.</span><span class="n">Stride</span> <span class="p">{</span> <span class="kr">get</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">/// Performs the action at the next possible opportunity.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// åœ¨ä¸‹ä¸€ä¸ªå¯èƒ½çš„æœºä¼šæ‰§è¡Œæ“ä½œã€‚</span>
</span></span><span class="line"><span class="cl">    <span class="kd">func</span> <span class="nf">schedule</span><span class="p">(</span><span class="n">options</span><span class="p">:</span> <span class="kc">Self</span><span class="p">.</span><span class="n">SchedulerOptions</span><span class="p">?,</span> <span class="kc">_</span> <span class="n">action</span><span class="p">:</span> <span class="p">@</span><span class="n">escaping</span> <span class="p">()</span> <span class="p">-&gt;</span> <span class="nb">Void</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">/// Performs the action at some time after the specified date.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// åœ¨æŒ‡å®šæ—¶é—´ä¹‹åæ‰§è¡Œæ“ä½œã€‚</span>
</span></span><span class="line"><span class="cl">    <span class="kd">func</span> <span class="nf">schedule</span><span class="p">(</span><span class="n">after</span> <span class="n">date</span><span class="p">:</span> <span class="kc">Self</span><span class="p">.</span><span class="n">SchedulerTimeType</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">:</span> <span class="kc">Self</span><span class="p">.</span><span class="n">SchedulerTimeType</span><span class="p">.</span><span class="n">Stride</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="kc">Self</span><span class="p">.</span><span class="n">SchedulerOptions</span><span class="p">?,</span> <span class="kc">_</span> <span class="n">action</span><span class="p">:</span> <span class="p">@</span><span class="n">escaping</span> <span class="p">()</span> <span class="p">-&gt;</span> <span class="nb">Void</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">/// Performs the action at some time after the specified date, at the specified frequency, optionally taking into account tolerance if possible.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// åœ¨æŒ‡å®šæ—¶é—´ä¹‹åæ‰§è¡Œæ“ä½œï¼Œåœ¨æŒ‡å®šçš„é¢‘ç‡ï¼Œå¯ä»¥é€‰æ‹©æ˜¯å¦è€ƒè™‘å®¹å¿åº¦ã€‚</span>
</span></span><span class="line"><span class="cl">    <span class="kd">func</span> <span class="nf">schedule</span><span class="p">(</span><span class="n">after</span> <span class="n">date</span><span class="p">:</span> <span class="kc">Self</span><span class="p">.</span><span class="n">SchedulerTimeType</span><span class="p">,</span> <span class="n">interval</span><span class="p">:</span> <span class="kc">Self</span><span class="p">.</span><span class="n">SchedulerTimeType</span><span class="p">.</span><span class="n">Stride</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">:</span> <span class="kc">Self</span><span class="p">.</span><span class="n">SchedulerTimeType</span><span class="p">.</span><span class="n">Stride</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="kc">Self</span><span class="p">.</span><span class="n">SchedulerOptions</span><span class="p">?,</span> <span class="kc">_</span> <span class="n">action</span><span class="p">:</span> <span class="p">@</span><span class="n">escaping</span> <span class="p">()</span> <span class="p">-&gt;</span> <span class="nb">Void</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">Cancellable</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><ul>
<li><code>receive(on:options:)</code> ä»ä¸Šæ¸¸æ¥æ”¶å¹¶å°†æ•°æ®å‘é€åˆ°ä¸‹æ¸¸ï¼Œå¹¶ä¸”åœ¨æŒ‡å®šçš„çº¿ç¨‹ä¸Šæ‰§è¡Œã€‚</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="line"><span class="cl"><span class="p">@</span><span class="n">available</span><span class="p">(</span><span class="n">macOS</span> <span class="mf">10.15</span><span class="p">,</span> <span class="n">iOS</span> <span class="mf">13.0</span><span class="p">,</span> <span class="n">tvOS</span> <span class="mf">13.0</span><span class="p">,</span> <span class="n">watchOS</span> <span class="mf">6.0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">extension</span> <span class="nc">Publisher</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">/// Specifies the scheduler on which to receive elements from the publisher.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// You use the ``Publisher/receive(on:options:)`` operator to receive results and completion on a specific scheduler, such as performing UI work on the main run loop. In contrast with ``Publisher/subscribe(on:options:)``, which affects upstream messages, ``Publisher/receive(on:options:)`` changes the execution context of downstream messages.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// In the following example, the ``Publisher/subscribe(on:options:)`` operator causes `jsonPublisher` to receive requests on `backgroundQueue`, while the</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// ``Publisher/receive(on:options:)`` causes `labelUpdater` to receive elements and completion on `RunLoop.main`.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///     let jsonPublisher = MyJSONLoaderPublisher() // Some publisher.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///     let labelUpdater = MyLabelUpdateSubscriber() // Some subscriber that updates the UI.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///     jsonPublisher</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///         .subscribe(on: backgroundQueue)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///         .receive(on: RunLoop.main)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///         .subscribe(labelUpdater)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// Prefer ``Publisher/receive(on:options:)`` over explicit use of dispatch queues when performing work in subscribers. For example, instead of the following pattern:</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///     pub.sink {</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///         DispatchQueue.main.async {</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///             // Do something.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///         }</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///     }</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// Use this pattern instead:</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///     pub.receive(on: DispatchQueue.main).sink {</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///         // Do something.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///     }</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///  &gt; Note: ``Publisher/receive(on:options:)`` doesnâ€™t affect the scheduler used to call the subscriberâ€™s ``Subscriber/receive(subscription:)`` method.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// - Parameters:</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///   - scheduler: The scheduler the publisher uses for element delivery.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">///   - options: Scheduler options used to customize element delivery.</span>
</span></span><span class="line"><span class="cl">    <span class="c1">/// - Returns: A publisher that delivers elements using the specified scheduler.</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">func</span> <span class="nf">receive</span><span class="p">&lt;</span><span class="n">S</span><span class="p">&gt;(</span><span class="n">on</span> <span class="n">scheduler</span><span class="p">:</span> <span class="n">S</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="n">S</span><span class="p">.</span><span class="n">SchedulerOptions</span><span class="p">?</span> <span class="p">=</span> <span class="kc">nil</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">Publishers</span><span class="p">.</span><span class="n">ReceiveOn</span><span class="p">&lt;</span><span class="kc">Self</span><span class="p">,</span> <span class="n">S</span><span class="p">&gt;</span> <span class="k">where</span> <span class="n">S</span> <span class="p">:</span> <span class="n">Scheduler</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><ul>
<li><code>delay</code> å»¶è¿Ÿä¸€æ®µæ—¶é—´å‘å‡ºï¼š</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="line"><span class="cl"><span class="kd">import</span> <span class="nc">UIKit</span>
</span></span><span class="line"><span class="cl"><span class="kd">import</span> <span class="nc">Combine</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">class</span> <span class="nc">ViewController</span><span class="p">:</span> <span class="n">UIViewController</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="kd">let</span> <span class="nv">p</span> <span class="p">=</span> <span class="n">PassthroughSubject</span><span class="p">&lt;</span><span class="nb">String</span><span class="p">,</span> <span class="n">Never</span><span class="p">&gt;()</span> <span class="c1">// å‘å¸ƒè€…</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nv">c</span><span class="p">:</span> <span class="n">AnyCancellable</span><span class="p">?</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kr">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kc">super</span><span class="p">.</span><span class="n">viewDidLoad</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// Do any additional setup after loading the view.</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="n">c</span> <span class="p">=</span> <span class="n">p</span>
</span></span><span class="line"><span class="cl">            <span class="p">.</span><span class="n">delay</span><span class="p">(</span><span class="k">for</span><span class="p">:</span> <span class="p">.</span><span class="n">seconds</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">scheduler</span><span class="p">:</span> <span class="n">RunLoop</span><span class="p">.</span><span class="n">main</span><span class="p">)</span> <span class="c1">// å»¶è¿Ÿä¸€ç§’</span>
</span></span><span class="line"><span class="cl">            <span class="p">.</span><span class="n">sink</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="s">&#34;</span><span class="si">\(</span><span class="n">Date</span><span class="si">())</span><span class="s"> - </span><span class="si">\(</span><span class="nv">$0</span><span class="si">)</span><span class="s">&#34;</span><span class="p">)</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kr">override</span> <span class="kd">func</span> <span class="nf">touchesBegan</span><span class="p">(</span><span class="kc">_</span> <span class="n">touches</span><span class="p">:</span> <span class="n">Set</span><span class="p">&lt;</span><span class="n">UITouch</span><span class="p">&gt;,</span> <span class="n">with</span> <span class="n">event</span><span class="p">:</span> <span class="n">UIEvent</span><span class="p">?)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="bp">print</span><span class="p">(</span><span class="n">Date</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">        <span class="n">p</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s">&#34;touched&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 2022-07-03 06:27:16 +0000</span>
</span></span><span class="line"><span class="cl"><span class="c1">// 2022-07-03 06:27:17 +0000 - touched</span>
</span></span></code></pre></div><ul>
<li><code>debounce</code> ä¸ºé˜²æŠ–ï¼Œæ¥æ”¶å‰ä¸€äº‹ä»¶åï¼Œå¼€å¯å®šæ—¶å™¨ï¼Œå®šæ—¶å™¨æœ‰æ•ˆæ—¶é—´å†…æ¯æ¬¡æ¥æ”¶åˆ°æ–°äº‹ä»¶åˆ™å°†å®šæ—¶å™¨é‡ç½®ï¼Œé™¤éåœ¨å®šæ—¶å™¨å¤±æ•ˆåä¸”æœ‰åç»­äº‹ä»¶åˆ°è¾¾æ‰å†æ¬¡å‘å‡ºï¼š</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="line"><span class="cl"><span class="kd">import</span> <span class="nc">UIKit</span>
</span></span><span class="line"><span class="cl"><span class="kd">import</span> <span class="nc">Combine</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">class</span> <span class="nc">ViewController</span><span class="p">:</span> <span class="n">UIViewController</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="kd">let</span> <span class="nv">p</span> <span class="p">=</span> <span class="n">PassthroughSubject</span><span class="p">&lt;</span><span class="nb">String</span><span class="p">,</span> <span class="n">Never</span><span class="p">&gt;()</span> <span class="c1">// å‘å¸ƒè€…</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nv">c</span><span class="p">:</span> <span class="n">AnyCancellable</span><span class="p">?</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kr">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kc">super</span><span class="p">.</span><span class="n">viewDidLoad</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// Do any additional setup after loading the view.</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="n">c</span> <span class="p">=</span> <span class="n">p</span>
</span></span><span class="line"><span class="cl">            <span class="p">.</span><span class="n">debounce</span><span class="p">(</span><span class="k">for</span><span class="p">:</span> <span class="p">.</span><span class="n">seconds</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">scheduler</span><span class="p">:</span> <span class="n">RunLoop</span><span class="p">.</span><span class="n">main</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">.</span><span class="n">sink</span> <span class="p">{</span> <span class="bp">print</span><span class="p">(</span><span class="s">&#34;</span><span class="si">\(</span><span class="n">Date</span><span class="si">())</span><span class="s"> - </span><span class="si">\(</span><span class="nv">$0</span><span class="si">)</span><span class="s">&#34;</span><span class="p">)</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kr">override</span> <span class="kd">func</span> <span class="nf">touchesBegan</span><span class="p">(</span><span class="kc">_</span> <span class="n">touches</span><span class="p">:</span> <span class="n">Set</span><span class="p">&lt;</span><span class="n">UITouch</span><span class="p">&gt;,</span> <span class="n">with</span> <span class="n">event</span><span class="p">:</span> <span class="n">UIEvent</span><span class="p">?)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="bp">print</span><span class="p">(</span><span class="n">Date</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">        <span class="n">p</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s">&#34;touched&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 2022-07-03 06:28:30 +0000</span>
</span></span><span class="line"><span class="cl"><span class="c1">// 2022-07-03 06:28:31 +0000 - touched</span>
</span></span><span class="line"><span class="cl"><span class="c1">// 2022-07-03 06:28:32 +0000</span>
</span></span><span class="line"><span class="cl"><span class="c1">// 2022-07-03 06:28:32 +0000</span>
</span></span><span class="line"><span class="cl"><span class="c1">// 2022-07-03 06:28:33 +0000</span>
</span></span><span class="line"><span class="cl"><span class="c1">// 2022-07-03 06:28:34 +0000</span>
</span></span><span class="line"><span class="cl"><span class="c1">// 2022-07-03 06:28:34 +0000</span>
</span></span><span class="line"><span class="cl"><span class="c1">// 2022-07-03 06:28:35 +0000 - touched</span>
</span></span></code></pre></div><h2 id="å‚è€ƒ">å‚è€ƒ</h2>
<ul>
<li><a href="https://developer.apple.com/documentation/combine">Combine - Apple</a></li>
<li><a href="https://objccn.io/products/swift-ui">SwiftUI ä¸ Combine ç¼–ç¨‹ - ç‹å·</a></li>
</ul>
</div>
                    <div class="post_footer">
                        
                        <div class="meta">
                            <div class="info">
                                <span class="field tags">
                                    <i class="ri-stack-line"></i>
                                    
                                    <a href="https://kingcos.me/tags/focus/">Focus</a>
                                    
                                    <a href="https://kingcos.me/tags/ios/">iOS</a>
                                    
                                    <a href="https://kingcos.me/tags/swift/">Swift</a>
                                    
                                    <a href="https://kingcos.me/tags/swiftui/">SwiftUI</a>
                                    
                                </span>
                            </div>
                        </div>
                        
                    </div>
                </div>
                <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<table style="border: 0;">
  <tr>
  <td style="border: 0; width: 30%;">
    <img width='100%' src='/img/about/1.jpg'>
  </td>
  <td style="border: 0; width: 50%;">
    
    <ins class="adsbygoogle"
     style="display:block;width:100%;"
     data-ad-client="ca-pub-9925978992661955"
     data-ad-slot="3213735320"
     data-ad-format="rectangle"
     data-full-width-responsive="false"></ins>
  </td>
  </tr>
</table>

<hr>

<script>
    (adsbygoogle = window.adsbygoogle || []).push({});
</script>
                
                
                







    
    
    
    <div>
        <div id="github-comment">
        </div>

        <script type="text/javascript">
        function getUtterances(isDark) {
            var utterances = document.createElement('script');
            utterances.type = 'text/javascript';
            utterances.async = true;
            utterances.setAttribute('issue-term', "pathname")
            utterances.setAttribute('repo', "kingcos\/kingcos.github.io")
            utterances.setAttribute('label', "comments")
            isDark ? utterances.setAttribute('theme', "github-dark") : utterances.setAttribute('theme', "github-light")
            utterances.crossorigin = 'anonymous';
            utterances.src = 'https://utteranc.es/client.js';

            return utterances
        }
        document.getElementById('github-comment').appendChild(getUtterances(false))
        </script>
    </div>
    




                
            </div>
        </div>
    </div>
    <a id="back_to_top" href="#" class="back_to_top"><i class="ri-arrow-up-s-line"></i></a>
    <footer class="footer">
    <div class="powered_by">
        <a href="https://kingcos.me">Powered by kingcos with love.</a>
    </div>

    <div class="footer_slogan">
        <span>â¤ï¸</span>
    </div>
</footer>
    <script src="https://kingcos.me/js/jquery-3.5.1.min.js"></script>
<link href="https://kingcos.me/css/fancybox.min.css" rel="stylesheet">
<script src="https://kingcos.me/js/fancybox.min.js"></script>
<script src="https://kingcos.me/js/zozo.js"></script>


<script type="text/javascript" async
    src="https://cdn.bootcss.com/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
        MathJax.Hub.Config({
            tex2jax: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\[\[', '\]\]']],
                processEscapes: true,
                processEnvironments: true,
                skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
                TeX: {
                    equationNumbers: { autoNumber: "AMS" },
                    extensions: ["AMSmath.js", "AMSsymbols.js"]
                }
            }
        });

        MathJax.Hub.Queue(function () {
            
            
            
            var all = MathJax.Hub.getAllJax(), i;
            for (i = 0; i < all.length; i += 1) {
                all[i].SourceElement().parentNode.className += ' has-jax';
            }
        });
    </script>

<style>
    code.has-jax {
        font: inherit;
        font-size: 100%;
        background: inherit;
        border: inherit;
        color: #515151;
    }
</style>



<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-138311951-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</body>

</html>