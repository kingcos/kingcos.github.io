<!DOCTYPE html>
<html lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="kingcos" />
	
	
	
	<title>Swift æ‹¾é— - å±æ€§ ï½œ kingcos</title>
	
    
    
    <meta name="description" content="ã€ŠSwift æ‹¾é—ã€‹æ˜¯ä¸€ä¸ªå…³äº Swift çš„æ–°æ–‡ç« ä¸“è¾‘ï¼Œè¿™ä¸ªç³»åˆ—çš„æ–‡ç« å°†ä¸ä¼šæ¶‰åŠåŸºæœ¬è¯­æ³•çš„å±‚é¢ï¼Œè€Œæ˜¯å°è¯•ä»åº•å±‚ã€Œæ‹¾ã€èµ·ä¹‹å‰æ‰€å¿½è§†çš„å†…å®¹ã€‚ä»Šå¤©æˆ‘ä»¬å°†ä¸€èµ·ç®€å•æ¢ç©¶ Swift ä¸­çš„å±æ€§ã€‚" />
    

    
    
    <meta name="keywords" content="Hugo, theme, zozo" />
    

	
    
    <link rel="shortcut icon" href="https://kingcos.me/images/favicon.png" />

    <link rel="stylesheet" type="text/css" media="screen" href="https://kingcos.me/css/normalize.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.0/animate.min.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="https://kingcos.me/css/zozo.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://cdn.jsdelivr.net/npm/remixicon@2.5.0/fonts/remixicon.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="https://kingcos.me/css/highlight.css" />

    
    
</head>

<script data-ad-client="ca-pub-9925978992661955" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<body>
    <div class="main animate__animated animate__fadeInDown">
        <div class="nav_container animated fadeInDown">
    <div class="site_nav" id="site_nav">
        <ul>
            
            <li>
                <a href="/">Home</a>
            </li>
            
            <li>
                <a href="/posts/">Archive</a>
            </li>
            
            <li>
                <a href="/tags/">Tags</a>
            </li>
            
            <li>
                <a href="/about/">About</a>
            </li>
            
        </ul>
    </div>
    <div class="menu_icon">
        <a id="menu_icon"><i class="ri-menu-line"></i></a>
    </div>
</div>


<link rel="stylesheet" href="https://kingcos.me/scss/main.min.75b49085bfb07b1bf150a1d59b4773d857e0452a747e37243805218b528a4045.css" integrity="sha256-dbSQhb&#43;wexvxUKHVm0dz2FfgRSp0fjckOAUhi1KKQEU=" media="screen">

<style>
.nav_container {
  height: 1rem;
}
 
table {
    width: 100%;
    table-layout: fixed;
}

 
.markdown code {
    white-space: normal;
    word-wrap: break-word;
    word-break: break-word;
    line-height: 1.5em;
    font-size: 0.85em;
    font-weight: bold;
    display: inline-block;
     
}

 
.menu_icon a {
    font-size: 16px;
}

 
body {
    font-family: 'Hiragino Sans GB', 'SFMono', 'Lato', '-apple-system';
    -webkit-font-smoothing: 'antialiased';
}

 
.markdown strong, .markdown b, .markdown em {
    font-weight: bold;
}

.post .post_content p {
     

    line-height: 1.75em;
}

 
.markdown img {
    max-width: 100%;
    margin: 0 auto;
    display: block;
    border-radius: 0.25rem;
}

 
.ri-stack-line {
    vertical-align: middle;
}

 
.ri-map-pin-time-line {
    vertical-align: middle;
}

 
.chroma .lntd:nth-child(2) {
    width: 100%;
}

 

 
.markdown .book-hint::before {
    content: none;
}

.markdown .book-hint {
    margin: 1rem 0;
    padding: 0.5rem 1rem 0.5rem 0.75rem;

    border-inline-start: 0.25rem solid #e9ecef;
    border-radius: 0.25rem;

    font-style: normal;
     
}

.book-hint strong {
    background-color: transparent;
}

.markdown .book-hint.info {
    border-left-color:#6bf;
    background-color:rgba(102,187,255,.1);
}

.markdown .book-hint.warning {
    border-left-color:#fd6;
    background-color:rgba(255,221,102,.1);
}

.markdown .book-hint.danger {
    border-left-color:#f66;
    background-color:rgba(255,102,102,.1);
}

</style>

        <div class="header animated fadeInDown">
    <div class="site_title_container">
        <div class="site_title">
            
                <a href="https://kingcos.me/">
                    
                    <img class="kingcos" style="margin-top: -20px; margin-left: -10px;" src="/title.svg" width="150px">
                </a>
            
        </div>
        <div class="description">
            <p class="sub_title">ä¸“æ³¨ã€åšæŒ</p>
            <div class="my_socials">
                
                
                <a href="https://github.com/kingcos" title="github" target="_blank"><i class="ri-github-fill"></i></a>
                
                
                
                <a href="https://www.instagram.com/kingcos_v/" title="instagram" target="_blank"><i class="ri-instagram-fill"></i></a>
                
                
                
                <a href="https://twitter.com/kingcos_v" title="twitter" target="_blank"><i class="ri-twitter-fill"></i></a>
                
                
                
                <a href="https://weibo.com/u/1798410923" title="weibo" target="_blank"><i class="ri-weibo-fill"></i></a>
                
                
                
            </div>
        </div>
    </div>
</div>
        <div class="content">
            <div class="post_page">
                <div class="post animate__animated animate__fadeInDown">
                    <div class="post_title post_detail_title">
                        <h2><a href='/posts/2016/swift_properties/'>Swift æ‹¾é— - å±æ€§</a></h2>
                        <span class="date">2020.09.18</span>
                        <span>by kingcos</span>
                        
                        
                        
                        
                    </div>
                    <div class="post_content markdown"><table>
<thead>
<tr>
<th style="text-align:center">Date</th>
<th style="text-align:center">Notes</th>
<th style="text-align:center">Info</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">2020-09-18</td>
<td style="text-align:center">çº³å…¥ Swift æ‹¾é—ç³»åˆ—ï¼Œå¹¶é‡æ–°æ•´ç†å®Œå–„</td>
<td style="text-align:center">Swift 5.3, Xcode 12.0</td>
</tr>
<tr>
<td style="text-align:center">2017-04-27</td>
<td style="text-align:center">æ‰©å……ã€Œå»¶è¿Ÿå­˜å‚¨å±æ€§ã€éƒ¨åˆ†å¹¶æ–°å¢ã€Œdevxoul/Thenã€ä¸€èŠ‚</td>
<td style="text-align:center">Swift 3.1, Xcode 8.3.2</td>
</tr>
<tr>
<td style="text-align:center">2016-10-26</td>
<td style="text-align:center">é¦–æ¬¡æäº¤</td>
<td style="text-align:center">Swift 3.0, Xcode 8.1 Beta 3</td>
</tr>
</tbody>
</table>
<h2 id="preface">Preface</h2>
<p>ã€ŠSwift æ‹¾é—ã€‹æ˜¯ä¸€ä¸ªå…³äº Swift çš„æ–°æ–‡ç« ä¸“è¾‘ï¼Œè¿™ä¸ªç³»åˆ—çš„æ–‡ç« å°†ä¸ä¼šæ¶‰åŠåŸºæœ¬è¯­æ³•çš„å±‚é¢ï¼Œè€Œæ˜¯å°è¯•ä»åº•å±‚ã€Œæ‹¾ã€èµ·ä¹‹å‰æ‰€å¿½è§†çš„å†…å®¹ã€‚ä»Šå¤©æˆ‘ä»¬å°†ä¸€èµ·ç®€å•æ¢ç©¶ Swift ä¸­çš„å±æ€§ã€‚</p>
<h2 id="å­˜å‚¨å±æ€§ä¸è®¡ç®—å±æ€§">å­˜å‚¨å±æ€§ä¸è®¡ç®—å±æ€§</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="kd">struct</span> <span class="nc">Foo</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nv">bar</span><span class="p">:</span> <span class="nb">Int</span>
    <span class="kd">var</span> <span class="nv">baz</span><span class="p">:</span> <span class="nb">Int</span> <span class="p">{</span>
        <span class="kr">get</span> <span class="p">{</span>
            <span class="n">bar</span> <span class="o">*</span> <span class="mi">2</span>
        <span class="p">}</span>

        <span class="kr">set</span> <span class="p">{</span>
            <span class="n">bar</span> <span class="p">=</span> <span class="n">newValue</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nv">customSetParamBaz</span><span class="p">:</span> <span class="nb">Int</span> <span class="p">{</span>
        <span class="kr">get</span> <span class="p">{</span>
            <span class="n">bar</span> <span class="o">*</span> <span class="mi">2</span>
        <span class="p">}</span>

        <span class="kr">set</span><span class="p">(</span><span class="n">customNewValue</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">bar</span> <span class="p">=</span> <span class="n">customNewValue</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nv">foo</span> <span class="p">=</span> <span class="n">Foo</span><span class="p">(</span><span class="n">bar</span><span class="p">:</span> <span class="mi">10</span><span class="p">)</span>

<span class="kc">_</span> <span class="p">=</span> <span class="n">foo</span><span class="p">.</span><span class="n">bar</span> <span class="c1">// 10</span>
<span class="kc">_</span> <span class="p">=</span> <span class="n">foo</span><span class="p">.</span><span class="n">baz</span> <span class="c1">// 20  // BREAKPOINT ğŸ”´</span>

<span class="n">foo</span><span class="p">.</span><span class="n">baz</span> <span class="p">=</span> <span class="mi">100</span>

<span class="kc">_</span> <span class="p">=</span> <span class="n">foo</span><span class="p">.</span><span class="n">baz</span> <span class="c1">// 100</span>
<span class="kc">_</span> <span class="p">=</span> <span class="n">foo</span><span class="p">.</span><span class="n">bar</span> <span class="c1">// 50</span>
</code></pre></div><p>å¦‚ä¸Šï¼Œ<code>bar</code> ä¸ºå­˜å‚¨å±æ€§ï¼Œå³å°†å ç”¨å®ä¾‹å¯¹è±¡çš„å†…å­˜ç©ºé—´ï¼›è€Œ <code>baz</code> ä¸ºè®¡ç®—å±æ€§ï¼Œå°†é€šè¿‡å…¶å®ƒå˜é‡å¾—å‡ºï¼Œå½“å¤–ç•Œå–å€¼æ—¶å°†å¾—åˆ°è°ƒç”¨ <code>get</code> ä¸­çš„è¿”å›ï¼Œè®¾ç½®æ—¶å°†é€šè¿‡ <code>set</code> ä¸­ <code>newValue</code> å°†å¤–ç•Œçš„å€¼ä¼ é€’è¿›å…¥å¹¶è¿›è¡Œä¸€å®šçš„è®¡ç®—ã€‚é‚£ä¹ˆè®¡ç®—å±æ€§æ˜¯å¦ä¼šå ç”¨å®ä¾‹å¯¹è±¡çš„å†…å­˜ç©ºé—´å‘¢ï¼Ÿ</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="bp">print</span><span class="p">(</span><span class="n">MemoryLayout</span><span class="p">&lt;</span><span class="n">Foo</span><span class="p">&gt;.</span><span class="n">size</span><span class="p">)</span>   <span class="c1">// 8</span>
<span class="bp">print</span><span class="p">(</span><span class="n">MemoryLayout</span><span class="p">&lt;</span><span class="n">Foo</span><span class="p">&gt;.</span><span class="bp">stride</span><span class="p">)</span> <span class="c1">// 8</span>
</code></pre></div><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥è¿è¡Œä»£ç ï¼Œå¹¶åœ¨æ–­ç‚¹å¤„ä»¥æ±‡ç¼–ä»£ç åˆ†æï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="err">-&gt;</span>  <span class="err">0</span><span class="nf">x1000027a1</span> <span class="err">&lt;+</span><span class="mi">113</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">movq</span>   <span class="nv">%rax</span><span class="p">,</span> <span class="nv">%rdi</span>
    <span class="err">0</span><span class="nf">x1000027a4</span> <span class="err">&lt;+</span><span class="mi">116</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">leaq</span>   <span class="p">-</span><span class="mi">0x38</span><span class="p">(</span><span class="nv">%rbp</span><span class="p">),</span> <span class="nv">%rsi</span>
    <span class="err">0</span><span class="nf">x1000027a8</span> <span class="err">&lt;+</span><span class="mi">120</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">movl</span>   <span class="no">$0x20</span><span class="p">,</span> <span class="nv">%edx</span>
    <span class="err">0</span><span class="nf">x1000027ad</span> <span class="err">&lt;+</span><span class="mi">125</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">callq</span>  <span class="mi">0x100003b92</span>               <span class="c">; symbol stub for: swift_beginAccess
</span><span class="c"></span>    <span class="mi">0x1000027b2</span> <span class="err">&lt;+</span><span class="mi">130</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">movq</span>   <span class="mi">0x59bf</span><span class="p">(</span><span class="nv">%rip</span><span class="p">),</span> <span class="nv">%rdi</span>        <span class="c">; demo.foo : demo.Foo
</span><span class="c"></span>    <span class="c">; å°†è°ƒç”¨è®¡ç®—å±æ€§çš„ getter
</span><span class="c"></span>    <span class="mi">0x1000027b9</span> <span class="err">&lt;+</span><span class="mi">137</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">callq</span>  <span class="mi">0x1000028c0</span>               <span class="c">; demo.Foo.baz.getter : Swift.Int at main.swift:6
</span><span class="c"></span>    <span class="mi">0x1000027be</span> <span class="err">&lt;+</span><span class="mi">142</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">leaq</span>   <span class="p">-</span><span class="mi">0x38</span><span class="p">(</span><span class="nv">%rbp</span><span class="p">),</span> <span class="nv">%rdi</span>
    <span class="err">0</span><span class="nf">x1000027c2</span> <span class="err">&lt;+</span><span class="mi">146</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">movq</span>   <span class="nv">%rax</span><span class="p">,</span> <span class="p">-</span><span class="mi">0xa0</span><span class="p">(</span><span class="nv">%rbp</span><span class="p">)</span>
    <span class="err">0</span><span class="nf">x1000027c9</span> <span class="err">&lt;+</span><span class="mi">153</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">callq</span>  <span class="mi">0x100003b98</span>               <span class="c">; symbol stub for: swift_endAccess
</span><span class="c"></span>    <span class="mi">0x1000027ce</span> <span class="err">&lt;+</span><span class="mi">158</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">leaq</span>   <span class="mi">0x59a3</span><span class="p">(</span><span class="nv">%rip</span><span class="p">),</span> <span class="nv">%rax</span>        <span class="c">; demo.foo : demo.Foo
</span><span class="c"></span>    <span class="mi">0x1000027d5</span> <span class="err">&lt;+</span><span class="mi">165</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">xorl</span>   <span class="nv">%r8d</span><span class="p">,</span> <span class="nv">%r8d</span>
    <span class="err">0</span><span class="nf">x1000027d8</span> <span class="err">&lt;+</span><span class="mi">168</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">movl</span>   <span class="nv">%r8d</span><span class="p">,</span> <span class="nv">%ecx</span>
    <span class="err">0</span><span class="nf">x1000027db</span> <span class="err">&lt;+</span><span class="mi">171</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">movq</span>   <span class="nv">%rax</span><span class="p">,</span> <span class="nv">%rdi</span>
    <span class="err">0</span><span class="nf">x1000027de</span> <span class="err">&lt;+</span><span class="mi">174</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">leaq</span>   <span class="p">-</span><span class="mi">0x50</span><span class="p">(</span><span class="nv">%rbp</span><span class="p">),</span> <span class="nv">%rsi</span>
    <span class="err">0</span><span class="nf">x1000027e2</span> <span class="err">&lt;+</span><span class="mi">178</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">movl</span>   <span class="no">$0x21</span><span class="p">,</span> <span class="nv">%edx</span>
    <span class="err">0</span><span class="nf">x1000027e7</span> <span class="err">&lt;+</span><span class="mi">183</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">callq</span>  <span class="mi">0x100003b92</span>               <span class="c">; symbol stub for: swift_beginAccess
</span><span class="c"></span>    <span class="mi">0x1000027ec</span> <span class="err">&lt;+</span><span class="mi">188</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">movl</span>   <span class="no">$0x64</span><span class="p">,</span> <span class="nv">%edi</span>
    <span class="err">0</span><span class="nf">x1000027f1</span> <span class="err">&lt;+</span><span class="mi">193</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">leaq</span>   <span class="mi">0x5980</span><span class="p">(</span><span class="nv">%rip</span><span class="p">),</span> <span class="nv">%r13</span>        <span class="c">; demo.foo : demo.Foo
</span><span class="c"></span>    <span class="c">; å°†è°ƒç”¨è®¡ç®—å±æ€§çš„ setter
</span><span class="c"></span>    <span class="mi">0x1000027f8</span> <span class="err">&lt;+</span><span class="mi">200</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">callq</span>  <span class="mi">0x100002960</span>               <span class="c">; demo.Foo.baz.setter : Swift.Int at main.swift:10
</span><span class="c"></span>    <span class="mi">0x1000027fd</span> <span class="err">&lt;+</span><span class="mi">205</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">leaq</span>   <span class="p">-</span><span class="mi">0x50</span><span class="p">(</span><span class="nv">%rbp</span><span class="p">),</span> <span class="nv">%rdi</span>
    <span class="err">0</span><span class="nf">x100002801</span> <span class="err">&lt;+</span><span class="mi">209</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">callq</span>  <span class="mi">0x100003b98</span>               <span class="c">; symbol stub for: swift_endAccess
</span></code></pre></div><p>å¦‚ä¸Šï¼Œè®¡ç®—å±æ€§å°†ä¸ä¼šäº§ç”Ÿå®é™…çš„å˜é‡ï¼Œå¤–ç•Œçš„ä½¿ç”¨å°†é€šè¿‡ <code>get</code> å’Œ <code>set</code> ä¸­æ‰€ç”Ÿæˆçš„ <code>getter</code> å’Œ <code>setter</code> æ–¹æ³•è®¿é—®æˆ–è®¾ç½®ï¼Œå› æ­¤ä¹Ÿå°±ä¸ä¼šå ç”¨å®ä¾‹å¯¹è±¡çš„å†…å­˜ç©ºé—´ã€‚</p>
<p>è®¡ç®—å±æ€§ä¹Ÿæ”¯æŒåªè¯»ï¼ˆRead-onlyï¼‰ï¼Œåªéœ€è¦ä¸å®ç° <code>set</code> å³å¯ï¼Œæ­¤æ—¶ä¹Ÿå¯çœç•¥æ˜¾å¼çš„ <code>get</code> å…³é”®å­—ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="kd">class</span> <span class="nc">Foo</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nv">bar</span><span class="p">:</span> <span class="nb">Int</span> <span class="p">=</span> <span class="mi">0</span>

    <span class="kd">var</span> <span class="nv">readonlyBaz1</span><span class="p">:</span> <span class="nb">Int</span> <span class="p">{</span>
        <span class="kr">get</span> <span class="p">{</span>
            <span class="n">bar</span> <span class="o">*</span> <span class="mi">2</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nv">readonlyBaz2</span><span class="p">:</span> <span class="nb">Int</span> <span class="p">{</span>
        <span class="n">bar</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nv">foo</span> <span class="p">=</span> <span class="n">Foo</span><span class="p">()</span>

<span class="c1">// ERROR: Cannot assign to property: &#39;readonlyBaz1&#39; is a get-only property</span>
<span class="n">foo</span><span class="p">.</span><span class="n">readonlyBaz1</span> <span class="p">=</span> <span class="mi">10</span>
<span class="c1">// ERROR: Cannot assign to property: &#39;readonlyBaz2&#39; is a get-only property</span>
<span class="n">foo</span><span class="p">.</span><span class="n">readonlyBaz2</span> <span class="p">=</span> <span class="mi">10</span>
</code></pre></div><p>å±æ€§ï¼ˆå­˜å‚¨å±æ€§ä¸è®¡ç®—å±æ€§ï¼‰ä¹Ÿæ”¯æŒä¸º <code>get</code> å’Œ <code>set</code> è®¾ç½®ä¸åŒçš„è®¿é—®æ§åˆ¶çº§åˆ«ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="kd">class</span> <span class="nc">Foo</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nv">bar</span><span class="p">:</span> <span class="nb">Int</span> <span class="p">=</span> <span class="mi">0</span>

    <span class="kd">internal</span> <span class="kd">private</span><span class="p">(</span><span class="kr">set</span><span class="p">)</span> <span class="kd">var</span> <span class="nv">privateSetBaz3</span><span class="p">:</span> <span class="nb">Int</span> <span class="p">{</span>
        <span class="kr">get</span> <span class="p">{</span>
            <span class="n">bar</span> <span class="o">*</span> <span class="mi">2</span>
        <span class="p">}</span>

        <span class="kr">set</span> <span class="p">{</span>
            <span class="n">bar</span> <span class="p">=</span> <span class="n">newValue</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">private</span><span class="p">(</span><span class="kr">set</span><span class="p">)</span> <span class="kd">var</span> <span class="nv">privateSetBaz4</span><span class="p">:</span> <span class="nb">Int</span> <span class="p">{</span>
        <span class="kr">get</span> <span class="p">{</span>
            <span class="n">bar</span> <span class="o">*</span> <span class="mi">2</span>
        <span class="p">}</span>

        <span class="kr">set</span> <span class="p">{</span>
            <span class="n">bar</span> <span class="p">=</span> <span class="n">newValue</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">innerFunc</span><span class="p">()</span> <span class="p">{</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">privateSetBaz3</span> <span class="p">=</span> <span class="mi">10</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">privateSetBaz4</span> <span class="p">=</span> <span class="mi">10</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nv">foo</span> <span class="p">=</span> <span class="n">Foo</span><span class="p">()</span>

<span class="n">foo</span><span class="p">.</span><span class="n">innerFunc</span><span class="p">()</span>

<span class="c1">// ERROR: Cannot assign to property: &#39;privateSetBaz3&#39; setter is inaccessible</span>
<span class="n">foo</span><span class="p">.</span><span class="n">privateSetBaz3</span> <span class="p">=</span> <span class="mi">10</span>
<span class="c1">// ERROR: Cannot assign to property: &#39;privateSetBaz4&#39; setter is inaccessible</span>
<span class="n">foo</span><span class="p">.</span><span class="n">privateSetBaz4</span> <span class="p">=</span> <span class="mi">10</span>
</code></pre></div><p>é‚£ä¹ˆè®¡ç®—å±æ€§æœ‰ä½•ä½¿ç”¨åœºæ™¯å‘¢ï¼Ÿå…¶å®å½“å®šä¹‰çš„å±æ€§ä¾èµ–äºå…¶å®ƒå±æ€§æ—¶ï¼Œå°±å¯ä»¥ä½¿ç”¨è®¡ç®—å±æ€§ã€‚æšä¸¾ä¸­çš„åŸå§‹å€¼ <code>rawValue</code> å°±æ˜¯é€šè¿‡åªè¯»è®¡ç®—å±æ€§å®ç°çš„ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="kd">enum</span> <span class="nc">Foo</span><span class="p">:</span> <span class="nb">Int</span> <span class="p">{</span>
    <span class="k">case</span> <span class="n">bar</span> <span class="p">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">baz</span>
<span class="p">}</span>

<span class="kc">_</span> <span class="p">=</span> <span class="n">Foo</span><span class="p">.</span><span class="n">bar</span><span class="p">.</span><span class="n">rawValue</span> <span class="c1">// 0 // BREAKPOINT ğŸ”´</span>
</code></pre></div><p>å°è¯•è¿è¡Œååœ¨æ–­ç‚¹å¤„æŸ¥çœ‹æ±‡ç¼–ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="nf">demo</span><span class="err">`</span><span class="no">main</span><span class="p">:</span>
    <span class="err">0</span><span class="nf">x100002500</span> <span class="err">&lt;+</span><span class="mi">0</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">pushq</span>  <span class="nv">%rbp</span>
    <span class="err">0</span><span class="nf">x100002501</span> <span class="err">&lt;+</span><span class="mi">1</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">movq</span>   <span class="nv">%rsp</span><span class="p">,</span> <span class="nv">%rbp</span>
    <span class="err">0</span><span class="nf">x100002504</span> <span class="err">&lt;+</span><span class="mi">4</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">subq</span>   <span class="no">$0x20</span><span class="p">,</span> <span class="nv">%rsp</span>
    <span class="err">0</span><span class="nf">x100002508</span> <span class="err">&lt;+</span><span class="mi">8</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">xorl</span>   <span class="nv">%eax</span><span class="p">,</span> <span class="nv">%eax</span>
    <span class="err">0</span><span class="nf">x10000250a</span> <span class="err">&lt;+</span><span class="mi">10</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">movl</span>   <span class="nv">%edi</span><span class="p">,</span> <span class="p">-</span><span class="mi">0x4</span><span class="p">(</span><span class="nv">%rbp</span><span class="p">)</span>
<span class="err">-&gt;</span>  <span class="err">0</span><span class="nf">x10000250d</span> <span class="err">&lt;+</span><span class="mi">13</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">movl</span>   <span class="nv">%eax</span><span class="p">,</span> <span class="nv">%edi</span>
    <span class="err">0</span><span class="nf">x10000250f</span> <span class="err">&lt;+</span><span class="mi">15</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">movq</span>   <span class="nv">%rsi</span><span class="p">,</span> <span class="p">-</span><span class="mi">0x10</span><span class="p">(</span><span class="nv">%rbp</span><span class="p">)</span>
    <span class="c">; å°†è°ƒç”¨è®¡ç®—å±æ€§çš„ getter
</span><span class="c"></span>    <span class="err">0</span><span class="nf">x100002513</span> <span class="err">&lt;+</span><span class="mi">19</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">callq</span>  <span class="mi">0x1000025a0</span>               <span class="c">; demo.Foo.rawValue.getter : Swift.Int at &lt;compiler-generated&gt;
</span><span class="c"></span>    <span class="mi">0x100002518</span> <span class="err">&lt;+</span><span class="mi">24</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">xorl</span>   <span class="nv">%ecx</span><span class="p">,</span> <span class="nv">%ecx</span>
    <span class="err">0</span><span class="nf">x10000251a</span> <span class="err">&lt;+</span><span class="mi">26</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">movq</span>   <span class="nv">%rax</span><span class="p">,</span> <span class="p">-</span><span class="mi">0x18</span><span class="p">(</span><span class="nv">%rbp</span><span class="p">)</span>
    <span class="err">0</span><span class="nf">x10000251e</span> <span class="err">&lt;+</span><span class="mi">30</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">movl</span>   <span class="nv">%ecx</span><span class="p">,</span> <span class="nv">%eax</span>
    <span class="err">0</span><span class="nf">x100002520</span> <span class="err">&lt;+</span><span class="mi">32</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">addq</span>   <span class="no">$0x20</span><span class="p">,</span> <span class="nv">%rsp</span>
    <span class="err">0</span><span class="nf">x100002524</span> <span class="err">&lt;+</span><span class="mi">36</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">popq</span>   <span class="nv">%rbp</span>
    <span class="err">0</span><span class="nf">x100002525</span> <span class="err">&lt;+</span><span class="mi">37</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">retq</span>
</code></pre></div><h2 id="å»¶è¿Ÿå­˜å‚¨å±æ€§">å»¶è¿Ÿå­˜å‚¨å±æ€§</h2>
<p>å»¶è¿Ÿå­˜å‚¨å±æ€§æ˜¯æŒ‡è¯¥å±æ€§çš„åˆå§‹åŒ–è¿‡ç¨‹å°†å»¶è¿Ÿåˆ°é¦–æ¬¡ä½¿ç”¨æ—¶ï¼Œè€Œéè·Ÿéšå®ä¾‹çš„åˆ›å»ºè€Œåˆ›å»ºã€‚å½“å±æ€§æœªè¢«ä½¿ç”¨æ—¶ï¼Œå°†é¿å…æ¶ˆè€—ä¸å¿…è¦çš„æ€§èƒ½ã€‚å»¶è¿Ÿå­˜å‚¨å±æ€§ä½¿ç”¨ <code>lazy</code> å…³é”®å­—ä¿®é¥°ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="kd">struct</span> <span class="nc">Foo</span> <span class="p">{</span>
    <span class="kr">lazy</span> <span class="kd">var</span> <span class="nv">bar</span><span class="p">:</span> <span class="nb">Int</span> <span class="p">=</span> <span class="p">{</span>
        <span class="bp">print</span><span class="p">(</span><span class="s">&#34;bar will init&#34;</span><span class="p">)</span>

        <span class="k">return</span> <span class="mi">1</span>
    <span class="p">}()</span>

    <span class="kd">var</span> <span class="nv">baz</span><span class="p">:</span> <span class="nb">Int</span> <span class="p">=</span> <span class="p">{</span>
        <span class="bp">print</span><span class="p">(</span><span class="s">&#34;baz will init&#34;</span><span class="p">)</span>

        <span class="k">return</span> <span class="mi">1</span>
    <span class="p">}()</span>
<span class="p">}</span>

<span class="kc">_</span> <span class="p">=</span> <span class="n">Foo</span><span class="p">()</span>

<span class="c1">// baz will init</span>
</code></pre></div><p>å¦‚ä¸Šï¼Œå½“æ„é€  <code>Foo</code> å®ä¾‹å¯¹è±¡æ—¶ï¼Œå»¶è¿Ÿå­˜å‚¨å±æ€§å°†æš‚æ—¶ä¸åˆå§‹åŒ–ã€‚å¦å¤–ï¼Œå»¶è¿Ÿå­˜å‚¨å±æ€§éœ€è¦æœ‰å‡ ä¸ªæ³¨æ„ç‚¹ï¼šé¦–å…ˆï¼Œå»¶è¿Ÿå­˜å‚¨å±æ€§å¿…é¡»ä½¿ç”¨ <code>var</code> ä¿®é¥°ï¼Œè€Œä¸å¯ä½¿ç”¨ <code>let</code> ä¿®é¥°ã€‚è¿™æ˜¯å› ä¸º <code>let</code> å¸¸é‡ä¸€æ—¦åˆ›å»ºåå°±ä¸èƒ½å†æ”¹å˜ï¼Œè€Œå»¶è¿Ÿå­˜å‚¨å±æ€§ä¼šåœ¨ä½¿ç”¨æ—¶å†åˆå§‹åŒ–å°†ä¸æ­¤ç›¸æ‚–ï¼›å…¶æ¬¡ï¼Œç»“æ„ä½“ç±»å‹ä¸­è‹¥å­˜åœ¨å»¶è¿Ÿå­˜å‚¨å±æ€§ï¼Œé‚£ä¹ˆä½¿ç”¨ <code>let</code> å£°æ˜çš„ç»“æ„ä½“å¸¸é‡å°†æ— æ³•è®¿é—®å»¶è¿Ÿå­˜å‚¨å±æ€§ï¼ŒåŸå› å…¶å®åŒç†ï¼Œåœ¨é¦–æ¬¡è®¿é—®æ—¶å°†æ‰§è¡Œå»¶è¿Ÿå­˜å‚¨å±æ€§çš„åˆå§‹åŒ–ï¼Œå°†ä¼šå¯¼è‡´å¸¸é‡å†…å­˜ç©ºé—´æ”¹å˜ï¼Œä¹Ÿä¸å¸¸é‡æœ¬èº«çš„æ¦‚å¿µç›¸æ‚–ï¼›ä½† <code>class</code> ç±»å‹çš„å˜é‡ç”±äºæœ¬è´¨æ˜¯å¼•ç”¨ç±»å‹ï¼Œå³ä½¿å †ç©ºé—´çš„å†…å­˜ç©ºé—´æ”¹å˜ï¼Œä¹Ÿä¸ä¼šå¯¼è‡´æŒ‡é’ˆæŒ‡å‘çš„å†…å­˜ç©ºé—´åœ°å€æ”¹å˜ï¼Œå› æ­¤ <code>class</code> ç±»å‹çš„å¸¸é‡ä»å¯ä»¥è®¿é—®å»¶è¿Ÿå­˜å‚¨å±æ€§ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="kd">class</span> <span class="nc">FooClass</span> <span class="p">{</span>
    <span class="kr">lazy</span> <span class="kd">var</span> <span class="nv">a</span> <span class="p">=</span> <span class="mi">1</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="nc">FooStruct</span> <span class="p">{</span>
    <span class="kr">lazy</span> <span class="kd">var</span> <span class="nv">a</span> <span class="p">=</span> <span class="mi">1</span>
<span class="p">}</span>

<span class="kd">let</span> <span class="nv">fc</span> <span class="p">=</span> <span class="n">FooClass</span><span class="p">()</span>
<span class="bp">print</span><span class="p">(</span><span class="n">fc</span><span class="p">.</span><span class="n">a</span><span class="p">)</span>

<span class="kd">let</span> <span class="nv">fs</span> <span class="p">=</span> <span class="n">FooStruct</span><span class="p">()</span>
<span class="c1">// ERROR: Cannot use mutating getter on immutable value: &#39;fs&#39; is a &#39;let&#39; constant</span>
<span class="bp">print</span><span class="p">(</span><span class="n">fs</span><span class="p">.</span><span class="n">a</span><span class="p">)</span>
</code></pre></div><p>è¿˜éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå»¶è¿Ÿå­˜å‚¨å±æ€§æ˜¯çº¿ç¨‹<strong>ä¸</strong>å®‰å…¨çš„ï¼Œå³æœ‰å¯èƒ½åœ¨å¤šçº¿ç¨‹ä¸­è¢«å¤šæ¬¡åˆå§‹åŒ–ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="kd">import</span> <span class="nc">Foundation</span>

<span class="kd">struct</span> <span class="nc">Foo</span> <span class="p">{</span>
    <span class="kr">lazy</span> <span class="kd">var</span> <span class="nv">bar</span><span class="p">:</span> <span class="nb">Int</span> <span class="p">=</span> <span class="p">{</span>
        <span class="bp">print</span><span class="p">(</span><span class="s">&#34;bar will init&#34;</span><span class="p">)</span>

        <span class="k">return</span> <span class="mi">1</span>
    <span class="p">}()</span>

     <span class="kd">var</span> <span class="nv">baz</span><span class="p">:</span> <span class="nb">Int</span> <span class="p">=</span> <span class="p">{</span>
        <span class="bp">print</span><span class="p">(</span><span class="s">&#34;baz will init&#34;</span><span class="p">)</span>

        <span class="k">return</span> <span class="mi">1</span>
    <span class="p">}()</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nv">foo</span> <span class="p">=</span> <span class="n">Foo</span><span class="p">()</span>

<span class="kd">var</span> <span class="nv">array</span> <span class="p">=</span> <span class="p">[</span><span class="nb">Int</span><span class="p">]()</span>

<span class="n">DispatchQueue</span><span class="p">.</span><span class="n">concurrentPerform</span><span class="p">(</span><span class="n">iterations</span><span class="p">:</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span> <span class="kc">_</span> <span class="k">in</span>
    <span class="bp">print</span><span class="p">(</span><span class="s">&#34;--- </span><span class="si">\(</span><span class="n">Thread</span><span class="p">.</span><span class="n">current</span><span class="si">)</span><span class="s"> ---&#34;</span><span class="p">)</span>
    <span class="bp">print</span><span class="p">(</span><span class="n">foo</span><span class="p">.</span><span class="n">bar</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// baz will init</span>
<span class="c1">// --- &lt;NSThread: 0x100611a40&gt;{number = 3, name = (null)} ---</span>
<span class="c1">// --- &lt;NSThread: 0x1029197f0&gt;{number = 2, name = (null)} ---</span>
<span class="c1">// --- &lt;NSThread: 0x10050c580&gt;{number = 1, name = main} ---</span>
<span class="c1">// bar will init</span>
<span class="c1">// bar will init</span>
<span class="c1">// 1</span>
<span class="c1">// 1</span>
<span class="c1">// bar will init</span>
<span class="c1">// 1</span>
</code></pre></div><p>å¦‚ä¸Šï¼Œæˆ‘ä»¬ä½¿ç”¨ GCD çš„å¹¶å‘æ‰§è¡Œ API <code>concurrentPerform</code> æ‰§è¡Œä¸‰æ¬¡ï¼Œå¦‚æœå»¶è¿Ÿå­˜å‚¨å±æ€§æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œé‚£ä¹ˆå°†åªä¼šè¿›å…¥å…¶æ„é€ æ–¹æ³•ä¸€æ¬¡ï¼Œä½†æ­¤æ—¶å…¶å®è¾“å‡ºäº†ä¸‰å¥ <code>bar will init</code>ã€‚</p>
<blockquote>
<p><strong><code>lazy</code> æ–¹æ³•</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="kd">let</span> <span class="nv">doubled</span> <span class="p">=</span> <span class="p">(</span><span class="mf">0.</span><span class="p">.&lt;</span><span class="mi">3</span><span class="p">).</span><span class="bp">map</span> <span class="p">{</span> <span class="n">i</span> <span class="p">-&gt;</span> <span class="nb">Int</span> <span class="k">in</span>
    <span class="bp">print</span><span class="p">(</span><span class="s">&#34;mapping&#34;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">2</span>
<span class="p">}</span>

<span class="kd">let</span> <span class="nv">lazyDoubled</span> <span class="p">=</span> <span class="p">(</span><span class="mf">0.</span><span class="p">.&lt;</span><span class="mi">3</span><span class="p">).</span><span class="kr">lazy</span><span class="p">.</span><span class="bp">map</span> <span class="p">{</span> <span class="n">i</span> <span class="p">-&gt;</span> <span class="nb">Int</span> <span class="k">in</span>
    <span class="bp">print</span><span class="p">(</span><span class="s">&#34;lazy mapping&#34;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">2</span>
<span class="p">}</span>

<span class="c1">// mapping</span>
<span class="c1">// mapping</span>
<span class="c1">// mapping</span>

<span class="n">lazyDoubled</span><span class="p">.</span><span class="n">forEach</span> <span class="p">{</span>
    <span class="bp">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// lazy mapping</span>
<span class="c1">// 0</span>
<span class="c1">// lazy mapping</span>
<span class="c1">// 2</span>
<span class="c1">// lazy mapping</span>
<span class="c1">// 4</span>
</code></pre></div><p>åœ¨ Swift æ ‡å‡†åº“ä¸­ä¹Ÿæœ‰ä¸€äº›å†…ç½®çš„ <code>lazy</code> æ–¹æ³•ï¼Œå®ƒä»¬çš„æ‰§è¡Œæ—¶æœºä¹Ÿå°†æ¨è¿Ÿåˆ°å®é™…ä½¿ç”¨è¯¥æ–¹æ³•è¿”å›å€¼çš„æ—¶åˆ»ã€‚</p>
</blockquote>
<h2 id="å±æ€§è§‚å¯Ÿå™¨">å±æ€§è§‚å¯Ÿå™¨</h2>
<p>åœ¨ Swift ä¸­ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å¯¹éå»¶è¿Ÿå­˜å‚¨å±æ€§æ·»åŠ å±æ€§è§‚å¯Ÿå™¨ï¼Œä»¥ä¾¿åœ¨å€¼å‘ç”Ÿæ”¹å˜ä¹‹å‰å’Œä¹‹åè¿›è¡Œä¸€äº›æ“ä½œï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="kd">struct</span> <span class="nc">Foo</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nv">bar</span><span class="p">:</span> <span class="nb">Int</span> <span class="p">{</span>
        <span class="kr">willSet</span> <span class="p">{</span>
            <span class="bp">print</span><span class="p">(</span><span class="s">&#34;</span><span class="si">\(</span><span class="n">bar</span><span class="si">)</span><span class="s"> will set to </span><span class="si">\(</span><span class="n">newValue</span><span class="si">)</span><span class="s">&#34;</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="kr">didSet</span> <span class="p">{</span>
            <span class="c1">// oldValue ä¼šåœ¨ willSet è¿›è¡Œä¿å­˜</span>
            <span class="bp">print</span><span class="p">(</span><span class="s">&#34;</span><span class="si">\(</span><span class="n">oldValue</span><span class="si">)</span><span class="s"> did set to </span><span class="si">\(</span><span class="n">bar</span><span class="si">)</span><span class="s">&#34;</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nv">customValueParamsBar</span><span class="p">:</span> <span class="nb">Int</span> <span class="p">=</span> <span class="mi">0</span> <span class="p">{</span>
        <span class="kr">willSet</span><span class="p">(</span><span class="n">new</span><span class="p">)</span> <span class="p">{</span>
            <span class="bp">print</span><span class="p">(</span><span class="s">&#34;</span><span class="si">\(</span><span class="n">customValueParamsBar</span><span class="si">)</span><span class="s"> will set </span><span class="si">\(</span><span class="n">new</span><span class="si">)</span><span class="s">&#34;</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="kr">didSet</span><span class="p">(</span><span class="n">old</span><span class="p">)</span> <span class="p">{</span>
            <span class="bp">print</span><span class="p">(</span><span class="s">&#34;</span><span class="si">\(</span><span class="n">old</span><span class="si">)</span><span class="s"> did set to </span><span class="si">\(</span><span class="n">customValueParamsBar</span><span class="si">)</span><span class="s">&#34;</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nv">foo</span> <span class="p">=</span> <span class="n">Foo</span><span class="p">(</span><span class="n">bar</span><span class="p">:</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">foo</span><span class="p">.</span><span class="n">bar</span> <span class="p">=</span> <span class="mi">20</span> <span class="c1">// BREAKPOINT ğŸ”´</span>

<span class="c1">// 10 will set to 20</span>
<span class="c1">// 10 did set to 20</span>
</code></pre></div><p>å¦‚ä¸Šï¼Œåœ¨å€¼è¢«çœŸæ­£æ”¹å˜ä¹‹å‰ï¼Œå°†å…ˆé€šè¿‡ <code>willSet</code> æ–¹æ³•ï¼Œæ–°å€¼å°†é»˜è®¤å¯ä»¥é€šè¿‡ <code>newValue</code> å˜é‡è®¿é—®ï¼Œæ­¤æ—¶å› ä¸ºå°šæœªæ‰§è¡Œèµ‹å€¼ï¼Œå› æ­¤æ—§å€¼å³å¯é€šè¿‡å˜é‡æœ¬èº« <code>bar</code> è®¿é—®ï¼›è®¾ç½®ååŒç†å¯é€šè¿‡ <code>didSet</code> æ–¹æ³•ï¼Œæ­¤æ—¶æ—§å€¼å°†é»˜è®¤å¯ä»¥é€šè¿‡ <code>oldValue</code> å˜é‡è®¿é—®ï¼Œæ–°å€¼åˆ™å¯ç›´æ¥é€šè¿‡å˜é‡æœ¬èº« <code>bar</code> è®¿é—®ã€‚</p>
<p>å°è¯•è¿è¡Œååœ¨æ–­ç‚¹å¤„æŸ¥çœ‹æ±‡ç¼–ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="err">-&gt;</span>  <span class="err">0</span><span class="nf">x100001c2e</span> <span class="err">&lt;+</span><span class="mi">62</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">movq</span>   <span class="nv">%rcx</span><span class="p">,</span> <span class="nv">%rdi</span>
    <span class="err">0</span><span class="nf">x100001c31</span> <span class="err">&lt;+</span><span class="mi">65</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">leaq</span>   <span class="p">-</span><span class="mi">0x20</span><span class="p">(</span><span class="nv">%rbp</span><span class="p">),</span> <span class="nv">%rax</span>
    <span class="err">0</span><span class="nf">x100001c35</span> <span class="err">&lt;+</span><span class="mi">69</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">movq</span>   <span class="nv">%rsi</span><span class="p">,</span> <span class="p">-</span><span class="mi">0x38</span><span class="p">(</span><span class="nv">%rbp</span><span class="p">)</span>
    <span class="err">0</span><span class="nf">x100001c39</span> <span class="err">&lt;+</span><span class="mi">73</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">movq</span>   <span class="nv">%rax</span><span class="p">,</span> <span class="nv">%rsi</span>
    <span class="err">0</span><span class="nf">x100001c3c</span> <span class="err">&lt;+</span><span class="mi">76</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">movl</span>   <span class="no">$0x21</span><span class="p">,</span> <span class="nv">%edx</span>
    <span class="err">0</span><span class="nf">x100001c41</span> <span class="err">&lt;+</span><span class="mi">81</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">movq</span>   <span class="p">-</span><span class="mi">0x38</span><span class="p">(</span><span class="nv">%rbp</span><span class="p">),</span> <span class="nv">%rcx</span>
    <span class="err">0</span><span class="nf">x100001c45</span> <span class="err">&lt;+</span><span class="mi">85</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">callq</span>  <span class="mi">0x100003bc0</span>               <span class="c">; symbol stub for: swift_beginAccess
</span><span class="c"></span>    <span class="mi">0x100001c4a</span> <span class="err">&lt;+</span><span class="mi">90</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">movl</span>   <span class="no">$0x14</span><span class="p">,</span> <span class="nv">%edi</span>
    <span class="err">0</span><span class="nf">x100001c4f</span> <span class="err">&lt;+</span><span class="mi">95</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">leaq</span>   <span class="mi">0x655a</span><span class="p">(</span><span class="nv">%rip</span><span class="p">),</span> <span class="nv">%r13</span>        <span class="c">; demo.foo : demo.Foo
</span><span class="c"></span>    <span class="c">; å°†è°ƒç”¨ setter
</span><span class="c"></span>    <span class="mi">0x100001c56</span> <span class="err">&lt;+</span><span class="mi">102</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">callq</span>  <span class="mi">0x100001cb0</span>               <span class="c">; demo.Foo.bar.setter : Swift.Int at main.swift:4
</span><span class="c"></span>    <span class="mi">0x100001c5b</span> <span class="err">&lt;+</span><span class="mi">107</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">leaq</span>   <span class="p">-</span><span class="mi">0x20</span><span class="p">(</span><span class="nv">%rbp</span><span class="p">),</span> <span class="nv">%rdi</span>
    <span class="err">0</span><span class="nf">x100001c5f</span> <span class="err">&lt;+</span><span class="mi">111</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">callq</span>  <span class="mi">0x100003bd2</span>               <span class="c">; symbol stub for: swift_endAccess
</span><span class="c"></span>
<span class="nf">demo</span><span class="err">`</span><span class="no">Foo.bar.setter</span><span class="p">:</span>
<span class="err">-&gt;</span>  <span class="err">0</span><span class="nf">x100001cb0</span> <span class="err">&lt;+</span><span class="mi">0</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">pushq</span>  <span class="nv">%rbp</span>
    <span class="err">0</span><span class="nf">x100001cb1</span> <span class="err">&lt;+</span><span class="mi">1</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">movq</span>   <span class="nv">%rsp</span><span class="p">,</span> <span class="nv">%rbp</span>
    <span class="err">0</span><span class="nf">x100001cb4</span> <span class="err">&lt;+</span><span class="mi">4</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">pushq</span>  <span class="nv">%r13</span>
    <span class="err">0</span><span class="nf">x100001cb6</span> <span class="err">&lt;+</span><span class="mi">6</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">subq</span>   <span class="no">$0x38</span><span class="p">,</span> <span class="nv">%rsp</span>
    <span class="err">0</span><span class="nf">x100001cba</span> <span class="err">&lt;+</span><span class="mi">10</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">movq</span>   <span class="no">$0x0</span><span class="p">,</span> <span class="p">-</span><span class="mi">0x10</span><span class="p">(</span><span class="nv">%rbp</span><span class="p">)</span>
    <span class="err">0</span><span class="nf">x100001cc2</span> <span class="err">&lt;+</span><span class="mi">18</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">movq</span>   <span class="no">$0x0</span><span class="p">,</span> <span class="p">-</span><span class="mi">0x18</span><span class="p">(</span><span class="nv">%rbp</span><span class="p">)</span>
    <span class="err">0</span><span class="nf">x100001cca</span> <span class="err">&lt;+</span><span class="mi">26</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">movq</span>   <span class="no">$0x0</span><span class="p">,</span> <span class="p">-</span><span class="mi">0x20</span><span class="p">(</span><span class="nv">%rbp</span><span class="p">)</span>
    <span class="err">0</span><span class="nf">x100001cd2</span> <span class="err">&lt;+</span><span class="mi">34</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">movq</span>   <span class="nv">%rdi</span><span class="p">,</span> <span class="p">-</span><span class="mi">0x10</span><span class="p">(</span><span class="nv">%rbp</span><span class="p">)</span>
    <span class="err">0</span><span class="nf">x100001cd6</span> <span class="err">&lt;+</span><span class="mi">38</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">movq</span>   <span class="nv">%r13</span><span class="p">,</span> <span class="p">-</span><span class="mi">0x18</span><span class="p">(</span><span class="nv">%rbp</span><span class="p">)</span>
    <span class="err">0</span><span class="nf">x100001cda</span> <span class="err">&lt;+</span><span class="mi">42</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">movq</span>   <span class="p">(</span><span class="nv">%r13</span><span class="p">),</span> <span class="nv">%rax</span>
    <span class="err">0</span><span class="nf">x100001cde</span> <span class="err">&lt;+</span><span class="mi">46</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">movq</span>   <span class="nv">%rax</span><span class="p">,</span> <span class="p">-</span><span class="mi">0x20</span><span class="p">(</span><span class="nv">%rbp</span><span class="p">)</span>
    <span class="err">0</span><span class="nf">x100001ce2</span> <span class="err">&lt;+</span><span class="mi">50</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">movq</span>   <span class="nv">%rdi</span><span class="p">,</span> <span class="p">-</span><span class="mi">0x28</span><span class="p">(</span><span class="nv">%rbp</span><span class="p">)</span>
    <span class="err">0</span><span class="nf">x100001ce6</span> <span class="err">&lt;+</span><span class="mi">54</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">movq</span>   <span class="nv">%r13</span><span class="p">,</span> <span class="p">-</span><span class="mi">0x30</span><span class="p">(</span><span class="nv">%rbp</span><span class="p">)</span>
    <span class="err">0</span><span class="nf">x100001cea</span> <span class="err">&lt;+</span><span class="mi">58</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">movq</span>   <span class="nv">%rax</span><span class="p">,</span> <span class="p">-</span><span class="mi">0x38</span><span class="p">(</span><span class="nv">%rbp</span><span class="p">)</span>
    <span class="c">; å°†è°ƒç”¨ willset
</span><span class="c"></span>    <span class="err">0</span><span class="nf">x100001cee</span> <span class="err">&lt;+</span><span class="mi">62</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">callq</span>  <span class="mi">0x100001d20</span>               <span class="c">; demo.Foo.bar.willset : Swift.Int at main.swift:5
</span><span class="c"></span>    <span class="mi">0x100001cf3</span> <span class="err">&lt;+</span><span class="mi">67</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">movq</span>   <span class="p">-</span><span class="mi">0x30</span><span class="p">(</span><span class="nv">%rbp</span><span class="p">),</span> <span class="nv">%rax</span>
    <span class="err">0</span><span class="nf">x100001cf7</span> <span class="err">&lt;+</span><span class="mi">71</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">movq</span>   <span class="p">-</span><span class="mi">0x28</span><span class="p">(</span><span class="nv">%rbp</span><span class="p">),</span> <span class="nv">%rcx</span>
    <span class="err">0</span><span class="nf">x100001cfb</span> <span class="err">&lt;+</span><span class="mi">75</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">movq</span>   <span class="nv">%rcx</span><span class="p">,</span> <span class="p">(</span><span class="nv">%rax</span><span class="p">)</span>
    <span class="err">0</span><span class="nf">x100001cfe</span> <span class="err">&lt;+</span><span class="mi">78</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">movq</span>   <span class="p">-</span><span class="mi">0x38</span><span class="p">(</span><span class="nv">%rbp</span><span class="p">),</span> <span class="nv">%rdi</span>
    <span class="err">0</span><span class="nf">x100001d02</span> <span class="err">&lt;+</span><span class="mi">82</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">movq</span>   <span class="nv">%rax</span><span class="p">,</span> <span class="nv">%r13</span>
    <span class="c">; å°†è°ƒç”¨ didset
</span><span class="c"></span>    <span class="err">0</span><span class="nf">x100001d05</span> <span class="err">&lt;+</span><span class="mi">85</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">callq</span>  <span class="mi">0x100001fd0</span>               <span class="c">; demo.Foo.bar.didset : Swift.Int at main.swift:9
</span><span class="c"></span>    <span class="mi">0x100001d0a</span> <span class="err">&lt;+</span><span class="mi">90</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">addq</span>   <span class="no">$0x38</span><span class="p">,</span> <span class="nv">%rsp</span>
    <span class="err">0</span><span class="nf">x100001d0e</span> <span class="err">&lt;+</span><span class="mi">94</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">popq</span>   <span class="nv">%r13</span>
    <span class="err">0</span><span class="nf">x100001d10</span> <span class="err">&lt;+</span><span class="mi">96</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">popq</span>   <span class="nv">%rbp</span>
    <span class="err">0</span><span class="nf">x100001d11</span> <span class="err">&lt;+</span><span class="mi">97</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">retq</span>
</code></pre></div><p>æ­¤æ—¶å¯ä»¥å‘ç°ï¼Œå³ä½¿æˆ‘ä»¬æ”¹å˜çš„å˜é‡æœ¬è´¨æ˜¯å­˜å‚¨å±æ€§ï¼Œä½†ç¼–è¯‘å™¨ä»ç„¶ä¸ºå…¶ç”Ÿæˆäº† <code>setter</code> æ–¹æ³•ï¼Œå¹¶åœ¨è¯¥è¡Œæ‰§è¡Œ <code>si</code> è¿›å…¥åå¯ä»¥å‘ç°ï¼Œå³ <code>setter</code> æ–¹æ³•ä¸­å…ˆè°ƒç”¨äº† <code>willSet</code>ï¼Œå¹¶åœ¨éšåè°ƒç”¨äº† <code>didSet</code>ã€‚</p>
<p>å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåˆå§‹åŒ–æ–¹æ³•æˆ–åœ¨å±æ€§å®šä¹‰æ—¶ç»™äºˆçš„é»˜è®¤å€¼æ—¶ï¼Œå°†ä¸ä¼šè§¦å‘å±æ€§è§‚å¯Ÿå™¨ï¼›å¦å¤–ï¼Œåœ¨ <code>willSet</code> ä¸­å¦‚æœç»§ç»­ç¼–å†™æ›´æ”¹åŸæœ‰å˜é‡å€¼çš„ä»£ç æ—¶ï¼Œæ—¢ä¸ä¼šå†æ¬¡è§¦å‘å±æ€§è§‚å¯Ÿå™¨ï¼Œä½†æ›´æ”¹ä¹Ÿä¸ä¼šç”Ÿæ•ˆï¼Œä½†åœ¨ <code>didSet</code> ä¸­ï¼Œè™½ç„¶ä¹Ÿä¸ä¼šå†æ¬¡è§¦å‘å±æ€§è§‚å¯Ÿå™¨ï¼Œä½†æ›´æ”¹å°†ä¼šç”Ÿæ•ˆï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="kd">struct</span> <span class="nc">Foo</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nv">bar</span><span class="p">:</span> <span class="nb">Int</span> <span class="p">{</span>
        <span class="kr">willSet</span> <span class="p">{</span>
            <span class="c1">// WARNING: Attempting to store to property &#39;bar&#39; within its own willSet, which is about to be overwritten by the new value</span>
            <span class="n">bar</span> <span class="p">=</span> <span class="mi">1000</span>
            <span class="bp">print</span><span class="p">(</span><span class="s">&#34;</span><span class="si">\(</span><span class="n">bar</span><span class="si">)</span><span class="s"> will set to </span><span class="si">\(</span><span class="n">newValue</span><span class="si">)</span><span class="s">&#34;</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="kr">didSet</span> <span class="p">{</span>
            <span class="n">bar</span> <span class="p">=</span> <span class="mi">2000</span>
            <span class="bp">print</span><span class="p">(</span><span class="s">&#34;</span><span class="si">\(</span><span class="n">oldValue</span><span class="si">)</span><span class="s"> did set to </span><span class="si">\(</span><span class="n">bar</span><span class="si">)</span><span class="s">&#34;</span><span class="p">)</span>
            <span class="n">bar</span> <span class="p">=</span> <span class="mi">3000</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nv">foo</span> <span class="p">=</span> <span class="n">Foo</span><span class="p">(</span><span class="n">bar</span><span class="p">:</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">foo</span><span class="p">.</span><span class="n">bar</span> <span class="p">=</span> <span class="mi">20</span>

<span class="bp">print</span><span class="p">(</span><span class="n">foo</span><span class="p">.</span><span class="n">bar</span><span class="p">)</span>

<span class="c1">// 10 will set to 20</span>
<span class="c1">// 10 did set to 2000</span>
<span class="c1">// 3000</span>
</code></pre></div><p>å¦‚ä¸Šï¼Œè™½ç„¶æˆ‘ä»¬å¯ä»¥äº†è§£è¿™ä¸€è¡Œä¸ºï¼Œä½†åœ¨å±æ€§è§‚å¯Ÿå™¨ä¸­å†æ¬¡è¿›è¡Œèµ‹å€¼çš„æ“ä½œæœ¬èº«å°±æœ‰äº›è¯¡å¼‚ï¼Œå› æ­¤åº”å½“é¿å…ã€‚</p>
<h2 id="è®¡ç®—å±æ€§å±æ€§è§‚å¯Ÿå™¨ä¸-inout">è®¡ç®—å±æ€§ã€å±æ€§è§‚å¯Ÿå™¨ä¸ inout</h2>
<p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ç›´æ¥é€šè¿‡å®ä¾‹å¯¹è±¡å¯¹å˜é‡æœ¬èº«è¿›è¡Œäº†æ›´æ”¹ï¼Œå¹¶è§¦å‘äº†å±æ€§è§‚å¯Ÿå™¨ï¼Œé‚£ä¹ˆå¦‚æœæˆ‘ä»¬å°†å®ƒä»¬ä¼ é€’ç»™å«æœ‰ <code>inout</code> å‚æ•°çš„æ–¹æ³•å¹¶è¿›è¡Œæ›´æ”¹æ—¶ï¼Œè¿˜ä¼šè°ƒç”¨ç›¸åº”çš„ <code>willSet</code> å’Œ <code>didSet</code> æ–¹æ³•å—ï¼Ÿ</p>
<p>é¦–å…ˆæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåä¸º <code>Foo</code> çš„ç»“æ„ä½“ç±»å‹ï¼Œå…¶ä¸­åŒ…å«æ™®é€šçš„å­˜å‚¨å±æ€§ã€å¸¦æœ‰å±æ€§è§‚å¯Ÿå™¨çš„å±æ€§ã€å’Œè®¡ç®—å±æ€§ï¼Œå¹¶åˆ›å»ºåä¸º <code>inoutFunc(_:)</code> å¸¦æœ‰ <code>inout</code> ä¿®é¥°å‚æ•°çš„æ–¹æ³•ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="kd">struct</span> <span class="nc">Foo</span><span class="p">:</span> <span class="n">CustomStringConvertible</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nv">a</span> <span class="p">=</span> <span class="mi">1</span>

    <span class="kd">var</span> <span class="nv">b</span> <span class="p">=</span> <span class="mi">1</span> <span class="p">{</span>
        <span class="kr">willSet</span> <span class="p">{</span>
            <span class="bp">print</span><span class="p">(</span><span class="s">&#34;b(</span><span class="si">\(</span><span class="n">b</span><span class="si">)</span><span class="s">) will set to </span><span class="si">\(</span><span class="n">newValue</span><span class="si">)</span><span class="s">&#34;</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="kr">didSet</span> <span class="p">{</span>
            <span class="bp">print</span><span class="p">(</span><span class="s">&#34;b(</span><span class="si">\(</span><span class="n">oldValue</span><span class="si">)</span><span class="s">) did set to </span><span class="si">\(</span><span class="n">b</span><span class="si">)</span><span class="s">&#34;</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nv">c</span><span class="p">:</span> <span class="nb">Int</span> <span class="p">{</span>
        <span class="kr">get</span> <span class="p">{</span>
            <span class="bp">print</span><span class="p">(</span><span class="s">&#34;c get&#34;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="mi">10</span>
        <span class="p">}</span>

        <span class="kr">set</span> <span class="p">{</span>
            <span class="bp">print</span><span class="p">(</span><span class="s">&#34;c set&#34;</span><span class="p">)</span>
            <span class="n">a</span> <span class="p">=</span> <span class="n">newValue</span> <span class="o">/</span> <span class="mi">10</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nv">description</span><span class="p">:</span> <span class="nb">String</span> <span class="p">{</span>
        <span class="s">&#34;a: </span><span class="si">\(</span><span class="n">a</span><span class="si">)</span><span class="s">, b: </span><span class="si">\(</span><span class="n">b</span><span class="si">)</span><span class="s">, c: </span><span class="si">\(</span><span class="n">c</span><span class="si">)</span><span class="s">&#34;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">inoutFunc</span><span class="p">(</span><span class="kc">_</span> <span class="n">param</span><span class="p">:</span> <span class="kr">inout</span> <span class="nb">Int</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">param</span> <span class="p">=</span> <span class="mi">100</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nv">foo</span> <span class="p">=</span> <span class="n">Foo</span><span class="p">()</span>

<span class="bp">print</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span>

<span class="c1">// c get</span>
<span class="c1">// a: 1, b: 1, c: 10</span>
</code></pre></div><p>é¦–å…ˆæˆ‘ä»¬å°è¯•å°†ä¸å¸¦å±æ€§è§‚å¯Ÿå™¨çš„å˜é‡ä¼ é€’åˆ° <code>inoutFunc</code> ä¸­ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="n">inoutFunc</span><span class="p">(&amp;</span><span class="n">foo</span><span class="p">.</span><span class="n">a</span><span class="p">)</span> <span class="c1">// BREAKPOINT ğŸ”´</span>

<span class="bp">print</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span>

<span class="c1">// c get</span>
<span class="c1">// a: 100, b: 1, c: 1000</span>
</code></pre></div><p>å°è¯•è¿è¡Œååœ¨æ–­ç‚¹å¤„æŸ¥çœ‹æ±‡ç¼–ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="err">-&gt;</span>  <span class="err">0</span><span class="nf">x100001958</span> <span class="err">&lt;+</span><span class="mi">296</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">movq</span>   <span class="nv">%rax</span><span class="p">,</span> <span class="nv">%rdi</span>
    <span class="err">0</span><span class="nf">x10000195b</span> <span class="err">&lt;+</span><span class="mi">299</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">leaq</span>   <span class="p">-</span><span class="mi">0x30</span><span class="p">(</span><span class="nv">%rbp</span><span class="p">),</span> <span class="nv">%rsi</span>
    <span class="err">0</span><span class="nf">x10000195f</span> <span class="err">&lt;+</span><span class="mi">303</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">movl</span>   <span class="no">$0x21</span><span class="p">,</span> <span class="nv">%edx</span>
    <span class="err">0</span><span class="nf">x100001964</span> <span class="err">&lt;+</span><span class="mi">308</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">callq</span>  <span class="mi">0x100003a3c</span>               <span class="c">; symbol stub for: swift_beginAccess
</span><span class="c"></span>    <span class="c">; å°† rip å¯„å­˜å™¨ä¸­çš„åœ°å€å€¼åŠ ä¸Š 0x6850ï¼ˆæ ¹æ®æ³¨é‡Šï¼Œè¯¥åœ°å€å¯¹åº”çš„å†…å®¹ä¸º demo.fooï¼‰å¹¶å­˜å‚¨åˆ° rdi å¯„å­˜å™¨ï¼ˆå‡½æ•°ç¬¬ä¸€ä¸ªå‚æ•°ï¼‰ä¸­
</span><span class="c"></span>    <span class="mi">0x100001969</span> <span class="err">&lt;+</span><span class="mi">313</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">leaq</span>   <span class="mi">0x6850</span><span class="p">(</span><span class="nv">%rip</span><span class="p">),</span> <span class="nv">%rdi</span>        <span class="c">; demo.foo : demo.Foo
</span><span class="c"></span>    <span class="mi">0x100001970</span> <span class="err">&lt;+</span><span class="mi">320</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">callq</span>  <span class="mi">0x1000026f0</span>               <span class="c">; demo.inoutFunc(inout Swift.Int) -&gt; () at main.swift:33
</span></code></pre></div><p>ç”±äºç»“æ„ä½“å˜é‡çš„é¦–åœ°å€å°±ç­‰åŒäºå…¶ä¸­ç¬¬ä¸€ä¸ªå£°æ˜çš„å˜é‡çš„åœ°å€ï¼Œå› æ­¤æ­¤æ—¶å­˜å‚¨å±æ€§å³æŒ‰åœ°å€ä¼ é€’åˆ° <code>inout</code> ä¿®é¥°å‚æ•°çš„æ–¹æ³•ä¸­ã€‚é‚£ä¹ˆå¸¦æœ‰å±æ€§è§‚å¯Ÿå™¨çš„å­˜å‚¨å±æ€§å‘¢ï¼Ÿ</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="c1">// inoutFunc(&amp;foo.a)</span>

<span class="n">inoutFunc</span><span class="p">(&amp;</span><span class="n">foo</span><span class="p">.</span><span class="n">b</span><span class="p">)</span> <span class="c1">// BREAKPOINT ğŸ”´</span>

<span class="bp">print</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span>

<span class="c1">// b(1) will set to 100</span>
<span class="c1">// b(1) did set to 100</span>
<span class="c1">// c get</span>
<span class="c1">// a: 1, b: 100, c: 10</span>
</code></pre></div><p>é€šè¿‡è¾“å‡ºç»“æœï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºå±æ€§è§‚å¯Ÿå™¨åŒæ ·ä¹Ÿè¢«æ‰§è¡Œäº†ã€‚å°è¯•è¿è¡Œååœ¨æ–­ç‚¹å¤„æŸ¥çœ‹æ±‡ç¼–ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="err">-&gt;</span>  <span class="err">0</span><span class="nf">x100001942</span> <span class="err">&lt;+</span><span class="mi">50</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">movq</span>   <span class="nv">%rcx</span><span class="p">,</span> <span class="nv">%rdi</span>
    <span class="err">0</span><span class="nf">x100001945</span> <span class="err">&lt;+</span><span class="mi">53</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">leaq</span>   <span class="p">-</span><span class="mi">0x20</span><span class="p">(</span><span class="nv">%rbp</span><span class="p">),</span> <span class="nv">%rax</span>
    <span class="err">0</span><span class="nf">x100001949</span> <span class="err">&lt;+</span><span class="mi">57</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">movq</span>   <span class="nv">%rsi</span><span class="p">,</span> <span class="p">-</span><span class="mi">0x58</span><span class="p">(</span><span class="nv">%rbp</span><span class="p">)</span>
    <span class="err">0</span><span class="nf">x10000194d</span> <span class="err">&lt;+</span><span class="mi">61</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">movq</span>   <span class="nv">%rax</span><span class="p">,</span> <span class="nv">%rsi</span>
    <span class="err">0</span><span class="nf">x100001950</span> <span class="err">&lt;+</span><span class="mi">64</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">movl</span>   <span class="no">$0x21</span><span class="p">,</span> <span class="nv">%edx</span>
    <span class="err">0</span><span class="nf">x100001955</span> <span class="err">&lt;+</span><span class="mi">69</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">movq</span>   <span class="p">-</span><span class="mi">0x58</span><span class="p">(</span><span class="nv">%rbp</span><span class="p">),</span> <span class="nv">%rcx</span>
    <span class="err">0</span><span class="nf">x100001959</span> <span class="err">&lt;+</span><span class="mi">73</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">callq</span>  <span class="mi">0x100003a2c</span>               <span class="c">; symbol stub for: swift_beginAccess
</span><span class="c"></span>    <span class="mi">0x10000195e</span> <span class="err">&lt;+</span><span class="mi">78</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">movq</span>   <span class="mi">0x6863</span><span class="p">(</span><span class="nv">%rip</span><span class="p">),</span> <span class="nv">%rax</span>        <span class="c">; demo.foo : demo.Foo + 8
</span><span class="c"></span>    <span class="mi">0x100001965</span> <span class="err">&lt;+</span><span class="mi">85</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">movq</span>   <span class="nv">%rax</span><span class="p">,</span> <span class="p">-</span><span class="mi">0x28</span><span class="p">(</span><span class="nv">%rbp</span><span class="p">)</span>
    <span class="err">0</span><span class="nf">x100001969</span> <span class="err">&lt;+</span><span class="mi">89</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">leaq</span>   <span class="p">-</span><span class="mi">0x28</span><span class="p">(</span><span class="nv">%rbp</span><span class="p">),</span> <span class="nv">%rdi</span>
    <span class="err">0</span><span class="nf">x10000196d</span> <span class="err">&lt;+</span><span class="mi">93</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">callq</span>  <span class="mi">0x1000026e0</span>               <span class="c">; demo.inoutFunc(inout Swift.Int) -&gt; () at main.swift:33
</span><span class="c"></span>    <span class="mi">0x100001972</span> <span class="err">&lt;+</span><span class="mi">98</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">movq</span>   <span class="p">-</span><span class="mi">0x28</span><span class="p">(</span><span class="nv">%rbp</span><span class="p">),</span> <span class="nv">%rdi</span>
    <span class="err">0</span><span class="nf">x100001976</span> <span class="err">&lt;+</span><span class="mi">102</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">leaq</span>   <span class="mi">0x6843</span><span class="p">(</span><span class="nv">%rip</span><span class="p">),</span> <span class="nv">%r13</span>        <span class="c">; demo.foo : demo.Foo
</span><span class="c"></span>    <span class="c">; å°†è°ƒç”¨ setter
</span><span class="c"></span>    <span class="mi">0x10000197d</span> <span class="err">&lt;+</span><span class="mi">109</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">callq</span>  <span class="mi">0x100001b30</span>               <span class="c">; demo.Foo.b.setter : Swift.Int at main.swift:6
</span></code></pre></div><p>ä¸ä¹‹å‰ä¸åŒçš„æ˜¯ï¼Œå½“æ‰§è¡Œå®Œ <code>inoutFunc</code> åï¼Œ<code>setter</code> ä»ç„¶å¾—åˆ°äº†è°ƒç”¨ï¼Œä½†å…·ä½“åŸå› æˆ‘ä»¬å…ˆç»§ç»­çœ‹ä¸‹è®¡ç®—å±æ€§ã€‚æˆ‘ä»¬çŸ¥é“è®¡ç®—å±æ€§å¹¶ä¸éœ€è¦å†…å­˜æ¥å­˜å‚¨ç»“æœï¼Œè€Œå…¶ç»“æœæ¥è‡ªäºå…¶å®ƒå±æ€§çš„è®¡ç®—ã€‚å› æ­¤å³ä½¿ <code>inoutFunc</code> ä¹Ÿå¹¶ä¸ä¼šè·å–åˆ°å˜é‡ <code>c</code> çš„å†…å­˜åœ°å€ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="c1">// inoutFunc(&amp;foo.a)</span>

<span class="c1">// inoutFunc(&amp;foo.b)</span>

<span class="n">inoutFunc</span><span class="p">(&amp;</span><span class="n">foo</span><span class="p">.</span><span class="n">c</span><span class="p">)</span> <span class="c1">// BREAKPOINT ğŸ”´</span>

<span class="bp">print</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span>

<span class="c1">// c get</span>
<span class="c1">// c set</span>
<span class="c1">// c get</span>
<span class="c1">// a: 10, b: 1, c: 100</span>
</code></pre></div><p>å°è¯•è¿è¡Œååœ¨æ–­ç‚¹å¤„æŸ¥çœ‹æ±‡ç¼–ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="err">-&gt;</span>  <span class="err">0</span><span class="nf">x100001932</span> <span class="err">&lt;+</span><span class="mi">50</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">movq</span>   <span class="nv">%rcx</span><span class="p">,</span> <span class="nv">%rdi</span>
    <span class="err">0</span><span class="nf">x100001935</span> <span class="err">&lt;+</span><span class="mi">53</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">leaq</span>   <span class="p">-</span><span class="mi">0x20</span><span class="p">(</span><span class="nv">%rbp</span><span class="p">),</span> <span class="nv">%rax</span>
    <span class="err">0</span><span class="nf">x100001939</span> <span class="err">&lt;+</span><span class="mi">57</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">movq</span>   <span class="nv">%rsi</span><span class="p">,</span> <span class="p">-</span><span class="mi">0x58</span><span class="p">(</span><span class="nv">%rbp</span><span class="p">)</span>
    <span class="err">0</span><span class="nf">x10000193d</span> <span class="err">&lt;+</span><span class="mi">61</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">movq</span>   <span class="nv">%rax</span><span class="p">,</span> <span class="nv">%rsi</span>
    <span class="err">0</span><span class="nf">x100001940</span> <span class="err">&lt;+</span><span class="mi">64</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">movl</span>   <span class="no">$0x21</span><span class="p">,</span> <span class="nv">%edx</span>
    <span class="err">0</span><span class="nf">x100001945</span> <span class="err">&lt;+</span><span class="mi">69</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">movq</span>   <span class="p">-</span><span class="mi">0x58</span><span class="p">(</span><span class="nv">%rbp</span><span class="p">),</span> <span class="nv">%rcx</span>
    <span class="err">0</span><span class="nf">x100001949</span> <span class="err">&lt;+</span><span class="mi">73</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">callq</span>  <span class="mi">0x100003a2c</span>               <span class="c">; symbol stub for: swift_beginAccess
</span><span class="c"></span>    <span class="mi">0x10000194e</span> <span class="err">&lt;+</span><span class="mi">78</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">movq</span>   <span class="mi">0x686b</span><span class="p">(</span><span class="nv">%rip</span><span class="p">),</span> <span class="nv">%rdi</span>        <span class="c">; demo.foo : demo.Foo
</span><span class="c"></span>    <span class="mi">0x100001955</span> <span class="err">&lt;+</span><span class="mi">85</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">movq</span>   <span class="mi">0x686c</span><span class="p">(</span><span class="nv">%rip</span><span class="p">),</span> <span class="nv">%rsi</span>        <span class="c">; demo.foo : demo.Foo + 8
</span><span class="c"></span>    <span class="c">; å°†è°ƒç”¨è®¡ç®—å±æ€§çš„ getter
</span><span class="c"></span>    <span class="mi">0x10000195c</span> <span class="err">&lt;+</span><span class="mi">92</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">callq</span>  <span class="mi">0x1000020d0</span>               <span class="c">; demo.Foo.c.getter : Swift.Int at main.swift:17
</span><span class="c"></span>    <span class="mi">0x100001961</span> <span class="err">&lt;+</span><span class="mi">97</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">movq</span>   <span class="nv">%rax</span><span class="p">,</span> <span class="p">-</span><span class="mi">0x28</span><span class="p">(</span><span class="nv">%rbp</span><span class="p">)</span>
    <span class="err">0</span><span class="nf">x100001965</span> <span class="err">&lt;+</span><span class="mi">101</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">leaq</span>   <span class="p">-</span><span class="mi">0x28</span><span class="p">(</span><span class="nv">%rbp</span><span class="p">),</span> <span class="nv">%rdi</span>
    <span class="c">; å°†è°ƒç”¨ inoutFunc
</span><span class="c"></span>    <span class="err">0</span><span class="nf">x100001969</span> <span class="err">&lt;+</span><span class="mi">105</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">callq</span>  <span class="mi">0x1000026e0</span>               <span class="c">; demo.inoutFunc(inout Swift.Int) -&gt; () at main.swift:33
</span><span class="c"></span>    <span class="mi">0x10000196e</span> <span class="err">&lt;+</span><span class="mi">110</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">movq</span>   <span class="p">-</span><span class="mi">0x28</span><span class="p">(</span><span class="nv">%rbp</span><span class="p">),</span> <span class="nv">%rdi</span>
    <span class="err">0</span><span class="nf">x100001972</span> <span class="err">&lt;+</span><span class="mi">114</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">leaq</span>   <span class="mi">0x6847</span><span class="p">(</span><span class="nv">%rip</span><span class="p">),</span> <span class="nv">%r13</span>        <span class="c">; demo.foo : demo.Foo
</span><span class="c"></span>    <span class="c">; å°†è°ƒç”¨è®¡ç®—å±æ€§çš„ setter
</span><span class="c"></span>    <span class="mi">0x100001979</span> <span class="err">&lt;+</span><span class="mi">121</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">callq</span>  <span class="mi">0x100002220</span>               <span class="c">; demo.Foo.c.setter : Swift.Int at main.swift:22
</span></code></pre></div><p>æ ¹æ®æ±‡ç¼–ï¼Œå½“é‡åˆ°è®¡ç®—å±æ€§æˆ–å¸¦æœ‰å­˜å‚¨å±æ€§è§‚å¯Ÿå™¨çš„å­˜å‚¨å±æ€§æ—¶ï¼Œå°†å…ˆé€šè¿‡ <code>getter</code> å°†å€¼æ‹·è´åˆ°ä¸€ä¸ªå¤–ç•Œçš„å±€éƒ¨å˜é‡ä¸Šï¼Œå†å°†è¯¥å˜é‡çš„åœ°å€ä¼ é€’åˆ° <code>inoutFunc</code> æ–¹æ³•ä¸­ï¼Œå¾—åˆ°ç»“æœåå¤–ç•Œå˜é‡å°†é‡æ–°é€šè¿‡ <code>setter</code> å°†å€¼è®¾ç½®å›åŸæœ‰çš„è®¡ç®—å±æ€§ã€‚å› æ­¤å±æ€§è§‚å¯Ÿå™¨ä¹Ÿæ˜¯åŒç†è¢«è§¦å‘çš„ï¼Œè€Œç”±äºå±æ€§è§‚å¯Ÿå™¨åªåŒ…å«å¯¹è®¾ç½®å€¼çš„ä¸åŒæ—¶æœºçš„ç›‘å¬ï¼Œå› æ­¤çœ‹ä¸åˆ° <code>getter</code> çš„è¿‡ç¨‹ã€‚</p>
<h2 id="ç±»å‹å±æ€§">ç±»å‹å±æ€§</h2>
<p>ç±»å‹å±æ€§æŒ‡çš„æ˜¯é€šè¿‡ç±»å‹ç›´æ¥è®¿é—®çš„å±æ€§ã€‚æˆ‘ä»¬åœ¨ç»“æ„ä½“ã€ç±»ã€æšä¸¾ä¸­å‡å¯ä»¥å®šä¹‰ç±»å‹å±æ€§ï¼Œé€šå¸¸ä½¿ç”¨ <code>static</code> å…³é”®å­—ï¼›åœ¨ç±»ä¸­ï¼Œå¦‚æœå®šä¹‰çš„ç±»å‹å±æ€§æ˜¯è®¡ç®—å±æ€§ï¼Œé‚£ä¹ˆä¹Ÿå¯ä»¥ä½¿ç”¨ <code>class</code> å…³é”®å­—ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="kd">struct</span> <span class="nc">Foo</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="kd">var</span> <span class="nv">foo</span><span class="p">:</span> <span class="nb">Int</span> <span class="p">=</span> <span class="mi">0</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">Bar</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="kd">var</span> <span class="nv">bar1</span><span class="p">:</span> <span class="nb">Int</span> <span class="p">=</span> <span class="mi">0</span>
    <span class="kd">static</span> <span class="kd">let</span> <span class="nv">bar2</span><span class="p">:</span> <span class="nb">Int</span> <span class="p">=</span> <span class="mi">0</span>

    <span class="kd">class</span> <span class="nc">var</span> <span class="n">bar3</span><span class="p">:</span> <span class="nb">Int</span> <span class="p">{</span>
        <span class="mi">0</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">enum</span> <span class="nc">Baz</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="kd">var</span> <span class="nv">baz</span> <span class="p">=</span> <span class="mi">0</span>
<span class="p">}</span>

<span class="bp">print</span><span class="p">(</span><span class="n">Foo</span><span class="p">.</span><span class="n">foo</span><span class="p">)</span>  <span class="c1">// 0</span>
<span class="bp">print</span><span class="p">(</span><span class="n">Bar</span><span class="p">.</span><span class="n">bar1</span><span class="p">)</span> <span class="c1">// 0</span>
<span class="bp">print</span><span class="p">(</span><span class="n">Bar</span><span class="p">.</span><span class="n">bar2</span><span class="p">)</span> <span class="c1">// 0</span>
<span class="bp">print</span><span class="p">(</span><span class="n">Bar</span><span class="p">.</span><span class="n">bar3</span><span class="p">)</span> <span class="c1">// 0</span>
<span class="bp">print</span><span class="p">(</span><span class="n">Baz</span><span class="p">.</span><span class="n">baz</span><span class="p">)</span>  <span class="c1">// 0</span>
</code></pre></div><p>ç±»å‹å±æ€§å…¶å®ç±»ä¼¼äºå…¨å±€å˜é‡ï¼Œå³åªä¼šåœ¨å†…å­˜ä¸­ä¿å­˜ä¸€ä»½ï¼Œä¸”å®é™…åœ¨å†…å­˜ä¸­ä¸å…¨å±€å˜é‡å­˜å‚¨åœ¨åŒä¸€ä½ç½®ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="kd">var</span> <span class="nv">foo</span> <span class="p">=</span> <span class="mi">10</span>

<span class="kd">class</span> <span class="nc">Bar</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="kd">var</span> <span class="nv">bar1</span><span class="p">:</span> <span class="nb">Int</span> <span class="p">=</span> <span class="mi">20</span>
<span class="p">}</span>

<span class="n">Bar</span><span class="p">.</span><span class="n">bar1</span> <span class="p">=</span> <span class="mi">21</span> <span class="c1">// BREAKPOINT ğŸ”´</span>
<span class="n">Bar</span><span class="p">.</span><span class="n">bar1</span> <span class="p">=</span> <span class="mi">22</span>

<span class="kd">var</span> <span class="nv">baz</span> <span class="p">=</span> <span class="mi">30</span>
</code></pre></div><p>å°è¯•è¿è¡Œååœ¨æ–­ç‚¹å¤„æŸ¥çœ‹æ±‡ç¼–ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="nf">demo</span><span class="err">`</span><span class="no">main</span><span class="p">:</span>
    <span class="err">0</span><span class="nf">x100002940</span> <span class="err">&lt;+</span><span class="mi">0</span><span class="err">&gt;</span><span class="p">:</span>   <span class="no">pushq</span>  <span class="nv">%rbp</span>
    <span class="err">0</span><span class="nf">x100002941</span> <span class="err">&lt;+</span><span class="mi">1</span><span class="err">&gt;</span><span class="p">:</span>   <span class="no">movq</span>   <span class="nv">%rsp</span><span class="p">,</span> <span class="nv">%rbp</span>
    <span class="err">0</span><span class="nf">x100002944</span> <span class="err">&lt;+</span><span class="mi">4</span><span class="err">&gt;</span><span class="p">:</span>   <span class="no">subq</span>   <span class="no">$0x50</span><span class="p">,</span> <span class="nv">%rsp</span>
    <span class="c">; å…¨å±€å˜é‡ fooï¼šç§»åŠ¨ç«‹å³æ•° 10 åˆ° rip + 0x5955ï¼ˆ0x1000082A8ï¼‰
</span><span class="c"></span>    <span class="err">0</span><span class="nf">x100002948</span> <span class="err">&lt;+</span><span class="mi">8</span><span class="err">&gt;</span><span class="p">:</span>   <span class="no">movq</span>   <span class="no">$0xa</span><span class="p">,</span> <span class="mi">0x5955</span><span class="p">(</span><span class="nv">%rip</span><span class="p">)</span>        <span class="c">; Swift51Overrides + 180
</span><span class="c"></span>    <span class="mi">0x100002953</span> <span class="err">&lt;+</span><span class="mi">19</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">movl</span>   <span class="nv">%edi</span><span class="p">,</span> <span class="p">-</span><span class="mi">0x34</span><span class="p">(</span><span class="nv">%rbp</span><span class="p">)</span>
    <span class="err">0</span><span class="nf">x100002956</span> <span class="err">&lt;+</span><span class="mi">22</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">movq</span>   <span class="nv">%rsi</span><span class="p">,</span> <span class="p">-</span><span class="mi">0x40</span><span class="p">(</span><span class="nv">%rbp</span><span class="p">)</span>
    <span class="err">0</span><span class="nf">x10000295a</span> <span class="err">&lt;+</span><span class="mi">26</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">callq</span>  <span class="mi">0x100002a20</span>               <span class="c">; demo.Bar.bar.unsafeMutableAddressor : Swift.Int at main.swift
</span><span class="c"></span>    <span class="mi">0x10000295f</span> <span class="err">&lt;+</span><span class="mi">31</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">xorl</span>   <span class="nv">%ecx</span><span class="p">,</span> <span class="nv">%ecx</span>
    <span class="err">0</span><span class="nf">x100002961</span> <span class="err">&lt;+</span><span class="mi">33</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">movq</span>   <span class="nv">%rax</span><span class="p">,</span> <span class="nv">%rdx</span>
    <span class="err">0</span><span class="nf">x100002964</span> <span class="err">&lt;+</span><span class="mi">36</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">movq</span>   <span class="nv">%rdx</span><span class="p">,</span> <span class="nv">%rdi</span>
    <span class="err">0</span><span class="nf">x100002967</span> <span class="err">&lt;+</span><span class="mi">39</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">leaq</span>   <span class="p">-</span><span class="mi">0x18</span><span class="p">(</span><span class="nv">%rbp</span><span class="p">),</span> <span class="nv">%rsi</span>
    <span class="err">0</span><span class="nf">x10000296b</span> <span class="err">&lt;+</span><span class="mi">43</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">movl</span>   <span class="no">$0x21</span><span class="p">,</span> <span class="nv">%edx</span>
    <span class="err">0</span><span class="nf">x100002970</span> <span class="err">&lt;+</span><span class="mi">48</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">movq</span>   <span class="nv">%rax</span><span class="p">,</span> <span class="p">-</span><span class="mi">0x48</span><span class="p">(</span><span class="nv">%rbp</span><span class="p">)</span>
    <span class="err">0</span><span class="nf">x100002974</span> <span class="err">&lt;+</span><span class="mi">52</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">callq</span>  <span class="mi">0x100003cd2</span>               <span class="c">; symbol stub for: swift_beginAccess
</span><span class="c"></span>    <span class="mi">0x100002979</span> <span class="err">&lt;+</span><span class="mi">57</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">movq</span>   <span class="p">-</span><span class="mi">0x48</span><span class="p">(</span><span class="nv">%rbp</span><span class="p">),</span> <span class="nv">%rax</span>
    <span class="c">; (lldb) register read rax =&gt; rax = 0x00000001000082b0  demo`static demo.Bar.bar : Swift.Int
</span><span class="c"></span>    <span class="c">; ç±»å‹å±æ€§ Bar.barï¼šç§»åŠ¨ç«‹å³æ•° 21 åˆ° rax å¯„å­˜å™¨ä¸­åœ°å€å¯¹åº”çš„å†…å­˜ç©ºé—´
</span><span class="c"></span><span class="err">-&gt;</span>  <span class="err">0</span><span class="nf">x10000297d</span> <span class="err">&lt;+</span><span class="mi">61</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">movq</span>   <span class="no">$0x15</span><span class="p">,</span> <span class="p">(</span><span class="nv">%rax</span><span class="p">)</span>
    <span class="err">0</span><span class="nf">x100002984</span> <span class="err">&lt;+</span><span class="mi">68</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">leaq</span>   <span class="p">-</span><span class="mi">0x18</span><span class="p">(</span><span class="nv">%rbp</span><span class="p">),</span> <span class="nv">%rdi</span>
    <span class="err">0</span><span class="nf">x100002988</span> <span class="err">&lt;+</span><span class="mi">72</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">callq</span>  <span class="mi">0x100003cde</span>               <span class="c">; symbol stub for: swift_endAccess
</span><span class="c"></span>    <span class="mi">0x10000298d</span> <span class="err">&lt;+</span><span class="mi">77</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">callq</span>  <span class="mi">0x100002a20</span>               <span class="c">; demo.Bar.bar.unsafeMutableAddressor : Swift.Int at main.swift
</span><span class="c"></span>    <span class="mi">0x100002992</span> <span class="err">&lt;+</span><span class="mi">82</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">xorl</span>   <span class="nv">%r8d</span><span class="p">,</span> <span class="nv">%r8d</span>
    <span class="err">0</span><span class="nf">x100002995</span> <span class="err">&lt;+</span><span class="mi">85</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">movl</span>   <span class="nv">%r8d</span><span class="p">,</span> <span class="nv">%ecx</span>
    <span class="err">0</span><span class="nf">x100002998</span> <span class="err">&lt;+</span><span class="mi">88</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">movq</span>   <span class="nv">%rax</span><span class="p">,</span> <span class="nv">%rdx</span>
    <span class="err">0</span><span class="nf">x10000299b</span> <span class="err">&lt;+</span><span class="mi">91</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">movq</span>   <span class="nv">%rdx</span><span class="p">,</span> <span class="nv">%rdi</span>
    <span class="err">0</span><span class="nf">x10000299e</span> <span class="err">&lt;+</span><span class="mi">94</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">leaq</span>   <span class="p">-</span><span class="mi">0x30</span><span class="p">(</span><span class="nv">%rbp</span><span class="p">),</span> <span class="nv">%rsi</span>
    <span class="err">0</span><span class="nf">x1000029a2</span> <span class="err">&lt;+</span><span class="mi">98</span><span class="err">&gt;</span><span class="p">:</span>  <span class="no">movl</span>   <span class="no">$0x21</span><span class="p">,</span> <span class="nv">%edx</span>
    <span class="err">0</span><span class="nf">x1000029a7</span> <span class="err">&lt;+</span><span class="mi">103</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">movq</span>   <span class="nv">%rax</span><span class="p">,</span> <span class="p">-</span><span class="mi">0x50</span><span class="p">(</span><span class="nv">%rbp</span><span class="p">)</span>
    <span class="err">0</span><span class="nf">x1000029ab</span> <span class="err">&lt;+</span><span class="mi">107</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">callq</span>  <span class="mi">0x100003cd2</span>               <span class="c">; symbol stub for: swift_beginAccess
</span><span class="c"></span>    <span class="mi">0x1000029b0</span> <span class="err">&lt;+</span><span class="mi">112</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">movq</span>   <span class="p">-</span><span class="mi">0x50</span><span class="p">(</span><span class="nv">%rbp</span><span class="p">),</span> <span class="nv">%rax</span>
    <span class="c">; (lldb) register read rax =&gt; rax = 0x00000001000082b0  demo`static demo.Bar.bar : Swift.Int
</span><span class="c"></span>    <span class="c">; ç±»å‹å±æ€§ Bar.barï¼šç§»åŠ¨ç«‹å³æ•° 22 åˆ° rax å¯„å­˜å™¨ä¸­åœ°å€å¯¹åº”çš„å†…å­˜ç©ºé—´
</span><span class="c"></span>    <span class="err">0</span><span class="nf">x1000029b4</span> <span class="err">&lt;+</span><span class="mi">116</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">movq</span>   <span class="no">$0x16</span><span class="p">,</span> <span class="p">(</span><span class="nv">%rax</span><span class="p">)</span>
    <span class="err">0</span><span class="nf">x1000029bb</span> <span class="err">&lt;+</span><span class="mi">123</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">leaq</span>   <span class="p">-</span><span class="mi">0x30</span><span class="p">(</span><span class="nv">%rbp</span><span class="p">),</span> <span class="nv">%rdi</span>
    <span class="err">0</span><span class="nf">x1000029bf</span> <span class="err">&lt;+</span><span class="mi">127</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">callq</span>  <span class="mi">0x100003cde</span>               <span class="c">; symbol stub for: swift_endAccess
</span><span class="c"></span>    <span class="mi">0x1000029c4</span> <span class="err">&lt;+</span><span class="mi">132</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">xorl</span>   <span class="nv">%eax</span><span class="p">,</span> <span class="nv">%eax</span>
    <span class="c">; å…¨å±€å˜é‡ bazï¼šç§»åŠ¨ç«‹å³æ•° 30 åˆ° rip + 0x58e7ï¼ˆ0x1000082B8ï¼‰
</span><span class="c"></span>    <span class="err">0</span><span class="nf">x1000029c6</span> <span class="err">&lt;+</span><span class="mi">134</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">movq</span>   <span class="no">$0x1e</span><span class="p">,</span> <span class="mi">0x58e7</span><span class="p">(</span><span class="nv">%rip</span><span class="p">)</span>       <span class="c">; static demo.Bar.bar : Swift.Int + 4
</span><span class="c"></span>    <span class="mi">0x1000029d1</span> <span class="err">&lt;+</span><span class="mi">145</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">addq</span>   <span class="no">$0x50</span><span class="p">,</span> <span class="nv">%rsp</span>
    <span class="err">0</span><span class="nf">x1000029d5</span> <span class="err">&lt;+</span><span class="mi">149</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">popq</span>   <span class="nv">%rbp</span>
    <span class="err">0</span><span class="nf">x1000029d6</span> <span class="err">&lt;+</span><span class="mi">150</span><span class="err">&gt;</span><span class="p">:</span> <span class="no">retq</span>

<span class="c">; å…¨å±€å˜é‡ fooï¼š0x1000082A8
</span><span class="c">; ç±»å‹å±æ€§ Bar.barï¼š0x00000001000082b0ï¼ˆfooï¼š0x1000082B0ï¼‰
</span><span class="c">; å…¨å±€å˜é‡ bazï¼š0x1000082B8
</span></code></pre></div><p>å¦‚ä¸Šï¼Œä¸‰ä¸ªå˜é‡å‡æ˜¯åœ¨å†…å­˜ä¸­å ç”¨äº†è¿ç»­çš„å­˜å‚¨ç©ºé—´ï¼Œä¹Ÿè¯æ˜äº†ç±»å‹å±æ€§æœ¬è´¨ä¹Ÿæ˜¯å­˜å‚¨åœ¨å…¨å±€åŒºï¼Œå…¶åœ¨æ•´ä¸ªç¨‹åºç”Ÿå‘½å‘¨æœŸä¸­åªä¼šæœ‰ä¸€ä»½ã€‚åªæ˜¯ç±»å‹å±æ€§å®šä¹‰ç±»çš„å†…éƒ¨ï¼Œéœ€è¦é€šè¿‡ç±»åæ¥è®¿é—®ï¼Œä»¥åŠå¯ä»¥é¢å¤–ä½¿ç”¨ä¸€äº›è®¿é—®æ§åˆ¶ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”±äºç±»å‹å±æ€§éé’ˆå¯¹äºæŸä¸€å®ä¾‹å¯¹è±¡ï¼Œå› æ­¤å…¶å¿…é¡»åœ¨å£°æ˜æ—¶å³ç»™å®šåˆå§‹å€¼ï¼›ç±»å‹å±æ€§å¦‚æœåŒæ—¶ä¸ºå­˜å‚¨å±æ€§ï¼Œé»˜è®¤å³ä¸º <code>lazy</code> å»¶è¿Ÿï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="kd">struct</span> <span class="nc">Foo</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="kd">var</span> <span class="nv">foo</span><span class="p">:</span> <span class="nb">Int</span> <span class="p">=</span> <span class="mi">0</span>

    <span class="kd">static</span> <span class="kd">var</span> <span class="nv">calculateFoo</span><span class="p">:</span> <span class="nb">Int</span> <span class="p">=</span> <span class="p">{</span>
        <span class="bp">print</span><span class="p">(</span><span class="s">&#34;calculateFoo init&#34;</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="p">}()</span>
<span class="p">}</span>

<span class="c1">// 0</span>
<span class="c1">// calculateFoo init</span>
</code></pre></div><p>ä½†æ­¤æ—¶çš„å»¶è¿Ÿå­˜å‚¨å±æ€§æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="kd">import</span> <span class="nc">Foundation</span>

<span class="kd">struct</span> <span class="nc">Foo</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="kd">var</span> <span class="nv">foo</span><span class="p">:</span> <span class="nb">Int</span> <span class="p">=</span> <span class="mi">0</span>

    <span class="kd">static</span> <span class="kd">var</span> <span class="nv">calculateFoo</span><span class="p">:</span> <span class="nb">Int</span> <span class="p">=</span> <span class="p">{</span>
        <span class="bp">print</span><span class="p">(</span><span class="s">&#34;calculateFoo init&#34;</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="p">}()</span>
<span class="p">}</span>

<span class="bp">print</span><span class="p">(</span><span class="n">Foo</span><span class="p">.</span><span class="n">foo</span><span class="p">)</span>

<span class="n">DispatchQueue</span><span class="p">.</span><span class="n">concurrentPerform</span><span class="p">(</span><span class="n">iterations</span><span class="p">:</span> <span class="mi">5</span><span class="p">)</span> <span class="p">{</span> <span class="kc">_</span> <span class="k">in</span>
    <span class="bp">print</span><span class="p">(</span><span class="s">&#34;--- </span><span class="si">\(</span><span class="n">Thread</span><span class="p">.</span><span class="n">current</span><span class="si">)</span><span class="s"> ---&#34;</span><span class="p">)</span>
    <span class="bp">print</span><span class="p">(</span><span class="n">Foo</span><span class="p">.</span><span class="n">calculateFoo</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// 0</span>
<span class="c1">// --- &lt;NSThread: 0x1020be860&gt;{number = 4, name = (null)} ---</span>
<span class="c1">// calculateFoo init</span>
<span class="c1">// 0</span>
<span class="c1">// --- &lt;NSThread: 0x1007042d0&gt;{number = 3, name = (null)} ---</span>
<span class="c1">// 0</span>
<span class="c1">// --- &lt;NSThread: 0x1021040c0&gt;{number = 2, name = (null)} ---</span>
<span class="c1">// 0</span>
<span class="c1">// --- &lt;NSThread: 0x10200ab30&gt;{number = 1, name = main} ---</span>
<span class="c1">// 0</span>
<span class="c1">// --- &lt;NSThread: 0x1022040c0&gt;{number = 5, name = (null)} ---</span>
<span class="c1">// 0</span>
<span class="c1">// 0</span>
</code></pre></div><p>å¦‚ä¸Šï¼Œå³ä½¿åŒæ—¶ 5 ä¸ªçº¿ç¨‹å¹¶å‘è®¿é—®ï¼Œ<code>calculateFoo</code> ä¹Ÿå°†è¢«ä¿è¯åªåˆå§‹åŒ–ä¸€æ¬¡ã€‚é‚£ä¹ˆå¦‚ä½•è¯æ˜å…¶æ˜¯çº¿ç¨‹å®‰å…¨çš„å‘¢ï¼Ÿ</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="kd">class</span> <span class="nc">Bar</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="kd">var</span> <span class="nv">bar</span><span class="p">:</span> <span class="nb">Int</span> <span class="p">=</span> <span class="mi">20</span> <span class="c1">// BREAKPOINT ğŸ”´</span>
<span class="p">}</span>

<span class="n">Bar</span><span class="p">.</span><span class="n">bar</span> <span class="p">=</span> <span class="mi">21</span> <span class="c1">// BREAKPOINT ğŸ”´</span>
</code></pre></div><p>å°è¯•è¿è¡Œååœ¨æ–­ç‚¹å¤„æŸ¥çœ‹æ±‡ç¼–ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">demo`main:
    0x100002990 &lt;+0&gt;:  pushq  %rbp
    0x100002991 &lt;+1&gt;:  movq   %rsp, %rbp
    0x100002994 &lt;+4&gt;:  subq   $0x30, %rsp
    0x100002998 &lt;+8&gt;:  movl   %edi, -0x1c(%rbp)
    0x10000299b &lt;+11&gt;: movq   %rsi, -0x28(%rbp)
-&gt;  0x10000299f &lt;+15&gt;: callq  0x100002a20               ; demo.Bar.bar.unsafeMutableAddressor : Swift.Int at main.swift
    ; è°ƒç”¨åè¿”å›å€¼ï¼ˆå³ Bar.bar çš„å†…å­˜åœ°å€ï¼‰å­˜å‚¨åœ¨ rax å¯„å­˜å™¨
    0x1000029a4 &lt;+20&gt;: xorl   %ecx, %ecx
    0x1000029a6 &lt;+22&gt;: movq   %rax, %rdx
    0x1000029a9 &lt;+25&gt;: movq   %rdx, %rdi
    0x1000029ac &lt;+28&gt;: leaq   -0x18(%rbp), %rsi
    0x1000029b0 &lt;+32&gt;: movl   $0x21, %edx
    0x1000029b5 &lt;+37&gt;: movq   %rax, -0x30(%rbp)
    0x1000029b9 &lt;+41&gt;: callq  0x100003cd2               ; symbol stub for: swift_beginAccess
    0x1000029be &lt;+46&gt;: movq   -0x30(%rbp), %rax
    ; (lldb) register read rax =&gt; rax = 0x0000000100008378  demo`static demo.Bar.bar : Swift.Int
    ; ç§»åŠ¨ç«‹å³æ•° 21 åˆ° raxï¼ˆ0x0000000100008378ï¼Œå³ Bar.bar çš„å†…å­˜åœ°å€ï¼‰
    0x1000029c2 &lt;+50&gt;: movq   $0x15, (%rax)
    0x1000029c9 &lt;+57&gt;: leaq   -0x18(%rbp), %rdi
    0x1000029cd &lt;+61&gt;: callq  0x100003cde               ; symbol stub for: swift_endAccess
    0x1000029d2 &lt;+66&gt;: xorl   %eax, %eax
    0x1000029d4 &lt;+68&gt;: addq   $0x30, %rsp
    0x1000029d8 &lt;+72&gt;: popq   %rbp
    0x1000029d9 &lt;+73&gt;: retq

demo`Bar.bar.unsafeMutableAddressor:
    0x100002a20 &lt;+0&gt;:  pushq  %rbp
    0x100002a21 &lt;+1&gt;:  movq   %rsp, %rbp
-&gt;  0x100002a24 &lt;+4&gt;:  cmpq   $-0x1, 0x587c(%rip)       ; Swift51Overrides + 183
    0x100002a2c &lt;+12&gt;: sete   %al
    0x100002a2f &lt;+15&gt;: testb  $0x1, %al
    0x100002a31 &lt;+17&gt;: jne    0x100002a35               ; &lt;+21&gt; at main.swift:4:16
    0x100002a33 &lt;+19&gt;: jmp    0x100002a3e               ; &lt;+30&gt; at main.swift
    ; å°† rip + 0x593cï¼ˆ0x100008378ï¼Œå³ Bar.bar çš„å†…å­˜åœ°å€ï¼‰æ”¾åœ¨ rax å¯„å­˜å™¨ä¸­ï¼ˆå³è¿”å›å€¼ï¼‰
    0x100002a35 &lt;+21&gt;: leaq   0x593c(%rip), %rax        ; static demo.Bar.bar : Swift.Int
    0x100002a3c &lt;+28&gt;: popq   %rbp
    ; å‡½æ•°è¿”å›
    0x100002a3d &lt;+29&gt;: retq
    ; å°†ç±»å‹å±æ€§åˆå§‹åŒ–ä»£ç æ‰€åœ¨é—­åŒ…çš„å‡½æ•°åœ°å€å­˜å‚¨åœ¨ rax å¯„å­˜å™¨
    0x100002a3e &lt;+30&gt;: leaq   -0x45(%rip), %rax         ; globalinit_33_8E34543FA00B3A97BCFBD7BFA4EE5AD5_func0 at main.swift
    0x100002a45 &lt;+37&gt;: leaq   0x585c(%rip), %rdi        ; globalinit_33_8E34543FA00B3A97BCFBD7BFA4EE5AD5_token0
    ; ç§»åŠ¨ rax å¯„å­˜å™¨ä¸­çš„å†…å®¹åˆ° rsi å¯„å­˜å™¨ï¼ˆä½œä¸º swift_once å‡½æ•°ç¬¬ä¸€ä¸ªå‚æ•°ï¼‰
    0x100002a4c &lt;+44&gt;: movq   %rax, %rsi
    ; ä» swift_once å¼€å§‹ siï¼Œç›´åˆ°è¿›å…¥ libswiftCore.dylib`swift_once:
    0x100002a4f &lt;+47&gt;: callq  0x100003ce4               ; symbol stub for: swift_once
    ; è·³è½¬åˆ° 0x100002a35 â¬†ï¸
    0x100002a54 &lt;+52&gt;: jmp    0x100002a35               ; &lt;+21&gt; at main.swift:4:16

libswiftCore.dylib`swift_once:
-&gt;  0x7fff6806a820 &lt;+0&gt;:  pushq  %rbp
    0x7fff6806a821 &lt;+1&gt;:  movq   %rsp, %rbp
    0x7fff6806a824 &lt;+4&gt;:  cmpq   $-0x1, (%rdi)
    0x7fff6806a828 &lt;+8&gt;:  jne    0x7fff6806a82c            ; &lt;+12&gt;
    0x7fff6806a82a &lt;+10&gt;: popq   %rbp
    0x7fff6806a82b &lt;+11&gt;: retq
    0x7fff6806a82c &lt;+12&gt;: movq   %rsi, %rax
    0x7fff6806a82f &lt;+15&gt;: movq   %rdx, %rsi
    0x7fff6806a832 &lt;+18&gt;: movq   %rax, %rdx
    ; swift_once å†…éƒ¨å®é™…è°ƒç”¨äº† dispatch_once_f
    0x7fff6806a835 &lt;+21&gt;: callq  0x7fff680bf19c            ; symbol stub for: dispatch_once_f
    0x7fff6806a83a &lt;+26&gt;: popq   %rbp
    0x7fff6806a83b &lt;+27&gt;: retq
    0x7fff6806a83c &lt;+28&gt;: nop
    0x7fff6806a83d &lt;+29&gt;: nop
    0x7fff6806a83e &lt;+30&gt;: nop
    0x7fff6806a83f &lt;+31&gt;: nop

demo`globalinit_33_8E34543FA00B3A97BCFBD7BFA4EE5AD5_func0:
    0x100002a00 &lt;+0&gt;:  pushq  %rbp
    0x100002a01 &lt;+1&gt;:  movq   %rsp, %rbp
    ; ç§»åŠ¨ç«‹å³æ•° 20 åˆ° rip + 0x5969ï¼ˆ0x100008378ï¼Œå³ Bar.bar çš„å†…å­˜åœ°å€ï¼‰
-&gt;  0x100002a04 &lt;+4&gt;:  movq   $0x14, 0x5969(%rip)       ; getExistentialTypeMetadata(swift::ProtocolClassConstraint, swift::TargetMetadata&lt;swift::InProcess&gt; const*, unsigned long, swift::TargetProtocolDescriptorRef&lt;swift::InProcess&gt; const*)::$_3::operator()() const::TheLazy + 12
    0x100002a0f &lt;+15&gt;: popq   %rbp
    0x100002a10 &lt;+16&gt;: retq
</code></pre></div><p>å› æ­¤ç±»å‹å±æ€§é»˜è®¤å³æ˜¯ <code>lazy</code> å»¶è¿Ÿåˆå§‹åŒ–çš„ï¼Œå¹¶ç”± <code>swift_once</code> å†…çš„ <code>dispatch_once_f</code> ä¿è¯äº†çº¿ç¨‹å®‰å…¨ã€‚</p>
<p>ç±»å‹å±æ€§é€šå¸¸å¯ä»¥ç”¨äºå•ä¾‹æ¨¡å¼ï¼Œå³æ•´ä¸ªç”Ÿå‘½å‘¨æœŸå†…ä»…åˆå§‹åŒ–ä¸€æ¬¡ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="kd">class</span> <span class="nc">SomeManager</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="kd">var</span> <span class="nv">manager</span><span class="p">:</span> <span class="n">SomeManager</span> <span class="p">=</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nv">manager</span> <span class="p">=</span> <span class="n">SomeManager</span><span class="p">()</span>
        <span class="n">manager</span><span class="p">.</span><span class="n">foo</span> <span class="p">=</span> <span class="mi">10</span>
        <span class="k">return</span> <span class="n">manager</span>
    <span class="p">}()</span>

    <span class="kd">var</span> <span class="nv">foo</span><span class="p">:</span> <span class="nb">Int</span> <span class="p">=</span> <span class="mi">0</span>

    <span class="kd">private</span> <span class="kd">init</span><span class="p">()</span> <span class="p">{}</span>

    <span class="kd">func</span> <span class="nf">bar</span><span class="p">()</span> <span class="p">{</span>
        <span class="bp">print</span><span class="p">(</span><span class="kc">#function</span><span class="p">,</span> <span class="n">foo</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">SomeManager</span><span class="p">.</span><span class="n">manager</span><span class="p">.</span><span class="n">bar</span><span class="p">()</span>

<span class="c1">// bar() 10</span>
</code></pre></div><h2 id="reference">Reference</h2>
<ul>
<li><a href="http://www.jianshu.com/p/80810efe5229">æµ…è°ˆ Swift 3 ä¸­çš„è®¿é—®æ§åˆ¶ - kingcos</a></li>
<li><a href="https://docs.swift.org/swift-book/LanguageGuide/AccessControl.html">Access Control - Swift.org</a></li>
<li><a href="https://docs.swift.org/swift-book/LanguageGuide/Properties.html">Properties - Swift.org</a></li>
<li><a href="https://github.com/devxoul/Then">devxoul/Then</a></li>
<li><a href="http://swifter.tips/lazy/">lazy ä¿®é¥°ç¬¦å’Œ lazy æ–¹æ³• - Swifter Tips</a></li>
<li><a href="https://www.bilibili.com/video/BV1cx411S7ay">ã€èœé¸¡ Playground 1ã€‘Swift ä¸­ lazy initialization</a></li>
<li><a href="https://www.bilibili.com/video/av10142408/">ã€èœé¸¡ Playground 2ã€‘Swift ä¸­ lazy initialization çš„ä½¿ç”¨åœºæ™¯</a></li>
</ul>
</div>
                    <div class="post_footer">
                        
                        <div class="meta">
                            <div class="info">
                                <span class="field tags">
                                    <i class="ri-stack-line"></i>
                                    
                                    <a href="https://kingcos.me/tags/swift/">Swift</a>
                                    
                                    <a href="https://kingcos.me/tags/swift-%E6%8B%BE%E9%81%97/">Swift æ‹¾é—</a>
                                    
                                </span>
                            </div>
                        </div>
                        
                    </div>
                </div>
                <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<table style="border: 0;">
  <tr>
  <td style="border: 0; width: 30%;">
    <img width='100%' src='/img/about/1.jpg'>
  </td>
  <td style="border: 0; width: 50%;">
    <ins class="adsbygoogle"
     style="display:block;width:100%;"
     data-ad-client="ca-pub-9925978992661955"
     data-ad-slot="3213735320"
     data-ad-format="rectangle"
     data-full-width-responsive="false"></ins>
  </td>
  </tr>
</table>

<hr>

<script>
    (adsbygoogle = window.adsbygoogle || []).push({});
</script>
                
                
                







    
    
    
    <div>
        <div id="github-comment">
        </div>

        <script type="text/javascript">
        function getUtterances(isDark) {
            var utterances = document.createElement('script');
            utterances.type = 'text/javascript';
            utterances.async = true;
            utterances.setAttribute('issue-term', "pathname")
            utterances.setAttribute('repo', "kingcos\/kingcos.github.io")
            utterances.setAttribute('label', "comments")
            isDark ? utterances.setAttribute('theme', "github-dark") : utterances.setAttribute('theme', "github-light")
            utterances.crossorigin = 'anonymous';
            utterances.src = 'https://utteranc.es/client.js';

            return utterances
        }
        document.getElementById('github-comment').appendChild(getUtterances(false))
        </script>
    </div>
    




                
            </div>
        </div>
    </div>
    <a id="back_to_top" href="#" class="back_to_top"><i class="ri-arrow-up-s-line"></i></a>
    <footer class="footer">
    <div class="powered_by">
        <a href="https://kingcos.me">Powered by kingcos with love.</a>
    </div>

    <div class="footer_slogan">
        <span>â¤ï¸</span>
    </div>
</footer>
    <script src="https://kingcos.me/js/jquery-3.5.1.min.js"></script>
<link href="https://kingcos.me/css/fancybox.min.css" rel="stylesheet">
<script src="https://kingcos.me/js/fancybox.min.js"></script>
<script src="https://kingcos.me/js/zozo.js"></script>


<script type="text/javascript" async
    src="https://cdn.bootcss.com/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
        MathJax.Hub.Config({
            tex2jax: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\[\[', '\]\]']],
                processEscapes: true,
                processEnvironments: true,
                skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
                TeX: {
                    equationNumbers: { autoNumber: "AMS" },
                    extensions: ["AMSmath.js", "AMSsymbols.js"]
                }
            }
        });

        MathJax.Hub.Queue(function () {
            
            
            
            var all = MathJax.Hub.getAllJax(), i;
            for (i = 0; i < all.length; i += 1) {
                all[i].SourceElement().parentNode.className += ' has-jax';
            }
        });
    </script>

<style>
    code.has-jax {
        font: inherit;
        font-size: 100%;
        background: inherit;
        border: inherit;
        color: #515151;
    }
</style>



<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-138311951-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</body>

</html>