<!DOCTYPE html>
<html lang="en">
  <head>
    
      <title>iOS ä¸­çš„ &#43;initialize æ–¹æ³• :: iBlog</title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content="Date Notes Source Code Demo     2019-04-21 é¦–æ¬¡æäº¤ objc4-750 -   2019-05-01 è¡¥å……ç»†èŠ‚ - Initialize_Demo    Preface åœ¨ iOS ä¸­ï¼Œç»å¸¸ä¸ &#43;load ç›¸æå¹¶è®ºçš„ä¸€ä¸ªæ–¹æ³•ä¾¿æ˜¯ &#43;initializeã€‚ä»æ–¹æ³•åæ¥çœ‹ï¼Œå®ƒçš„ä½œç”¨æ˜¯è¿›è¡Œåˆå§‹åŒ–ï¼Œä½†ä¸åŒäºå¹³æ—¶ä½¿ç”¨çš„ initï¼Œ&#43;initialize æ˜¯ä¸€ä¸ªç±»æ–¹æ³•ã€‚é‚£ä¹ˆå®ƒçš„æœ¬è´¨åˆ°åº•æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ
ä¸ºäº†æ›´å¥½åœ°å™è¿° &#43;initialize çš„ç‰¹ç‚¹ï¼Œæœ¬æ–‡éƒ¨åˆ†æè¿°å°è¯•ä¸ &#43;load æ–¹æ³•å¯¹æ¯”ï¼Œå»ºè®®é˜…è¯»æœ¬æ–‡å‰å…ˆé˜…è¯»ã€ŒiOS ä¸­çš„ &#43;load æ–¹æ³•ã€ã€‚
What // NSObject.h @interface NSObject &amp;lt;NSObject&amp;gt; { &#43; (void)initialize; } Obj-C ä¸­çš„ &#43;initialize æ–¹æ³•æŒ‡çš„æ˜¯ NSObject ä¸­çš„ &#43; (void)initialize ç±»æ–¹æ³•ã€‚å®˜æ–¹æ–‡æ¡£ä¸­çš„ &#43;initialize å¦‚ä¸‹ï¼š
 Initializes the class before it receives its first message."/>
<meta name="keywords" content="kingcos.me,maimieng.comios,swift,objective-c,obj-c,objc,oc,geek,python,ruby,golang,go,apple,mac"/>
<meta name="robots" content="noodp"/>
<link rel="canonical" href="/posts/2019/&#43;initialize_in_ios/" />





<link rel="stylesheet" href="/assets/style.css">


<link rel="stylesheet" href="/style.css">


<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/img/apple-touch-icon-144-precomposed.png">
<link rel="shortcut icon" href="/img/favicon.png">


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="iOS ä¸­çš„ &#43;initialize æ–¹æ³•"/>
<meta name="twitter:description" content="åœ¨ iOS ä¸­ï¼Œç»å¸¸ä¸ &#43;load ç›¸æå¹¶è®ºçš„ä¸€ä¸ªæ–¹æ³•ä¾¿æ˜¯ &#43;initializeã€‚ä»æ–¹æ³•åæ¥çœ‹ï¼Œå®ƒçš„ä½œç”¨æ˜¯è¿›è¡Œåˆå§‹åŒ–ï¼Œä½†ä¸åŒäºå¹³æ—¶ä½¿ç”¨çš„ `init`ï¼Œ&#43;initialize æ˜¯ä¸€ä¸ªç±»æ–¹æ³•ã€‚é‚£ä¹ˆå®ƒçš„æœ¬è´¨åˆ°åº•æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ"/>



<meta property="og:title" content="iOS ä¸­çš„ &#43;initialize æ–¹æ³•" />
<meta property="og:description" content="åœ¨ iOS ä¸­ï¼Œç»å¸¸ä¸ &#43;load ç›¸æå¹¶è®ºçš„ä¸€ä¸ªæ–¹æ³•ä¾¿æ˜¯ &#43;initializeã€‚ä»æ–¹æ³•åæ¥çœ‹ï¼Œå®ƒçš„ä½œç”¨æ˜¯è¿›è¡Œåˆå§‹åŒ–ï¼Œä½†ä¸åŒäºå¹³æ—¶ä½¿ç”¨çš„ `init`ï¼Œ&#43;initialize æ˜¯ä¸€ä¸ªç±»æ–¹æ³•ã€‚é‚£ä¹ˆå®ƒçš„æœ¬è´¨åˆ°åº•æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/2019/&#43;initialize_in_ios/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-04-21T00:00:00&#43;00:00" />
<meta property="article:modified_time" content="2019-04-21T00:00:00&#43;00:00" /><meta property="og:site_name" content="iBlog" />





<script data-ad-client="ca-pub-9925978992661955" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

  </head>
  <body class="">
    <div class="container">
      <header class="header">
  <span class="header__inner">
    <a href="/" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367"/>
</svg>
</span>
    <span class="logo__text">kingcos.me</span>
    <span class="logo__cursor"></span>
  
</a>

    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/about">About</a></li>
        
      
        
          <li><a href="/read">Read</a></li>
        
      
      
    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/about">About</a></li>
      
    
      
        <li><a href="/read">Read</a></li>
      
    
  </ul>
</nav>

        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none"/>
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
          </svg>
        </span>
      
      <span class="theme-toggle">
        <svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>

      </span>
    </span>
  </span>
</header>


      <div class="content">
        
  <div class="post">
    <h2 class="post-title"><a href="/posts/2019/&#43;initialize_in_ios/">iOS ä¸­çš„ +initialize æ–¹æ³•</a></h2>
    <div class="post-meta">
      
        <span class="post-date">
            2019-04-21
        </span>
      
      
      
        <span class="post-read-time">â€” 18 min read</span>
      
    </div>

    
      <span class="post-tags">
        
          #<a href="/tags/focus/">Focus</a>&nbsp;
        
          #<a href="/tags/ios/">iOS</a>&nbsp;
        
          #<a href="/tags/obj-c/">Obj-C</a>&nbsp;
        
      </span>
    

    

    <div class="post-content">
      <table>
<thead>
<tr>
<th style="text-align:center">Date</th>
<th style="text-align:center">Notes</th>
<th style="text-align:center">Source Code</th>
<th style="text-align:center">Demo</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">2019-04-21</td>
<td style="text-align:center">é¦–æ¬¡æäº¤</td>
<td style="text-align:center"><a href="https://opensource.apple.com/tarballs/objc4/">objc4-750</a></td>
<td style="text-align:center">-</td>
</tr>
<tr>
<td style="text-align:center">2019-05-01</td>
<td style="text-align:center">è¡¥å……ç»†èŠ‚</td>
<td style="text-align:center">-</td>
<td style="text-align:center"><a href="https://github.com/kingcos/Perspective/tree/writing/Posts/Practice/%2Binitialize_in_iOS">Initialize_Demo</a></td>
</tr>
</tbody>
</table>
<h2 id="preface">Preface</h2>
<p>åœ¨ iOS ä¸­ï¼Œç»å¸¸ä¸ +load ç›¸æå¹¶è®ºçš„ä¸€ä¸ªæ–¹æ³•ä¾¿æ˜¯ +initializeã€‚ä»æ–¹æ³•åæ¥çœ‹ï¼Œå®ƒçš„ä½œç”¨æ˜¯è¿›è¡Œåˆå§‹åŒ–ï¼Œä½†ä¸åŒäºå¹³æ—¶ä½¿ç”¨çš„ <code>init</code>ï¼Œ+initialize æ˜¯ä¸€ä¸ªç±»æ–¹æ³•ã€‚é‚£ä¹ˆå®ƒçš„æœ¬è´¨åˆ°åº•æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>ä¸ºäº†æ›´å¥½åœ°å™è¿° +initialize çš„ç‰¹ç‚¹ï¼Œæœ¬æ–‡éƒ¨åˆ†æè¿°å°è¯•ä¸ +load æ–¹æ³•å¯¹æ¯”ï¼Œå»ºè®®é˜…è¯»æœ¬æ–‡å‰å…ˆé˜…è¯»ã€ŒiOS ä¸­çš„ +load æ–¹æ³•ã€ã€‚</p>
<h2 id="what">What</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec"><span style="color:#75715e">// NSObject.h
</span><span style="color:#75715e"></span><span style="color:#66d9ef">@interface</span> <span style="color:#a6e22e">NSObject</span> <span style="color:#f92672">&lt;</span>NSObject<span style="color:#f92672">&gt;</span> {
<span style="color:#f92672">+</span> (<span style="color:#66d9ef">void</span>)initialize;
}
</code></pre></div><p>Obj-C ä¸­çš„ +initialize æ–¹æ³•æŒ‡çš„æ˜¯ NSObject ä¸­çš„ <code>+ (void)initialize</code> ç±»æ–¹æ³•ã€‚å®˜æ–¹æ–‡æ¡£ä¸­çš„ +initialize å¦‚ä¸‹ï¼š</p>
<blockquote>
<p>Initializes the class before it receives its first message.</p>
<p>The runtime sends <code>initialize</code> to each class in a program just before the class, or any class that inherits from it, is sent its first message from within the program. Superclasses receive this message before their subclasses.</p>
<p>The runtime sends the <code>initialize</code> message to classes in a thread-safe manner. That is, <code>initialize</code> is run by the first thread to send a message to a class, and any other thread that tries to send a message to that class will block until <code>initialize</code> completes.</p>
<p>The superclass implementation may be called multiple times if subclasses do not implement <code>initialize</code>â€”the runtime will call the inherited implementationâ€”or if subclasses explicitly call <code>[super initialize]</code>. If you want to protect yourself from being run multiple times, you can structure your implementation along these lines:</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec">+ (<span style="color:#66d9ef">void</span>)<span style="color:#a6e22e">initialize</span> {
  <span style="color:#66d9ef">if</span> (self <span style="color:#f92672">==</span> [ClassName self]) {
    <span style="color:#75715e">// ... do the initialization ...
</span><span style="color:#75715e"></span>  }
}
</code></pre></div><blockquote>
<p>Because <code>initialize</code> is called in a blocking manner, itâ€™s important to limit method implementations to the minimum amount of work necessary possible. Specifically, any code that takes locks that might be required by other classes in their <code>initialize</code> methods is liable to lead to deadlocks. Therefore, you should not rely on <code>initialize</code> for complex initialization, and should instead limit it to straightforward, class local initialization.</p>
<p><code>initialize</code> is invoked only once per class. If you want to perform independent initialization for the class and for categories of the class, you should implement <a href="https://developer.apple.com/documentation/objectivec/nsobject/1418815-load?language=objc"><code>load</code></a> methods.</p>
<p>â€”â€” Documentation, Apple Developer</p>
<p>è¯‘ï¼š</p>
<p>åœ¨ç±»æ”¶åˆ°ç¬¬ä¸€æ¡æ¶ˆæ¯å‰åˆå§‹åŒ–ã€‚</p>
<p>åœ¨ç±»å’Œæ‰€æœ‰å­ç±»æ¥æ”¶ç¬¬ä¸€æ¡æ¶ˆæ¯å‰ï¼Œè¿è¡Œæ—¶å‘é€ <code>initialize</code> æ¶ˆæ¯åˆ°ç¨‹åºä¸­æ¯ä¸ªç±»ã€‚çˆ¶ç±»åœ¨å­ç±»ä¹‹å‰æ¥æ”¶åˆ°è¯¥æ¶ˆæ¯ã€‚</p>
<p>è¿è¡Œæ—¶ä»¥çº¿ç¨‹å®‰å…¨çš„æ–¹å¼å‘é€ <code>initialize</code> æ¶ˆæ¯åˆ°ç±»ã€‚å³ <code>initialize</code> ç”±ç¬¬ä¸€ä¸ªçº¿ç¨‹è¿è¡Œæ¥å‘é€æ¶ˆæ¯åˆ°ä¸€ä¸ªç±»ï¼Œå¹¶ä¸”å…¶å®ƒä»»ä½•å°è¯•å‘é€æ¶ˆæ¯çš„çº¿ç¨‹éƒ½å°†ä¼šè¢«é˜»å¡ï¼Œç›´åˆ° <code>initialize</code> å®Œæˆã€‚</p>
<p>å¦‚æœå­ç±»æœªå®ç° <code>initialize</code> åˆ™çˆ¶ç±»çš„å®ç°å¯èƒ½ä¼šè¢«è°ƒç”¨å¤šæ¬¡ â€”â€” è¿è¡Œæ—¶å°†ä¼šè°ƒç”¨ç»§æ‰¿ï¼ˆè‡ªçˆ¶ç±»ï¼‰çš„å®ç° â€”â€” æˆ–è€…å¦‚æœå­ç±»æ˜ç¡®è°ƒç”¨ <code>[super initialize]</code>ã€‚å¦‚æœä¸å¸Œæœ›è¿è¡Œå¤šæ¬¡ï¼Œå¯ä»¥å‚è€ƒå¦‚ä¸‹å®ç°ï¼š</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec">+ (<span style="color:#66d9ef">void</span>)<span style="color:#a6e22e">initialize</span> {
  <span style="color:#66d9ef">if</span> (self <span style="color:#f92672">==</span> [ClassName self]) {
    <span style="color:#75715e">// ... do the initialization ...
</span><span style="color:#75715e"></span>  }
}
</code></pre></div><blockquote>
<p>ç”±äº <code>initialize</code> ä»¥é˜»å¡çš„æ–¹å¼è¢«è°ƒç”¨ï¼Œå› æ­¤å°†æ–¹æ³•å®ç°é™åˆ¶ä¸ºæœ€å°å·¥ä½œé‡æ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚å°¤å…¶æ˜¯åœ¨ <code>initialize</code> ä¸­ä½¿ç”¨ä»»ä½•å¯èƒ½è¢«å…¶å®ƒç±»æ‰€å¿…éœ€é”çš„ä»£ç éƒ½æœ‰å¯èƒ½ä¼šå¯¼è‡´æ­»é”ã€‚å› æ­¤ä¸åº”å½“ä¾èµ– <code>initialize</code> åšå¤æ‚çš„åˆå§‹åŒ–ï¼Œç›¸ååº”è¯¥å°†å…¶é™åˆ¶ä¸ºç®€å•çš„ç±»æœ¬åœ°åˆå§‹åŒ–ã€‚</p>
<p><code>initialize</code> åœ¨æ¯ä¸ªç±»ä¸­åªä¼šè¢«è°ƒç”¨ä¸€æ¬¡ã€‚å¦‚æœå¸Œæœ›ä¸ºç±»ä»¥åŠåˆ†ç±»æ‰§è¡Œç‹¬ç«‹çš„åˆå§‹åŒ–ï¼Œåº”å½“å®ç° <a href="https://developer.apple.com/documentation/objectivec/nsobject/1418815-load?language=objc"><code>load</code></a> æ–¹æ³•ã€‚</p>
<p>â€”â€” æ–‡æ¡£ï¼Œè‹¹æœå¼€å‘è€…</p>
</blockquote>
<h2 id="how">How</h2>
<p>æ ¹æ®å®˜æ–¹æ–‡æ¡£çš„æè¿°ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•å®šä¹‰ä¸€ä¸ªç»§æ‰¿è‡ª <code>NSObject</code> çš„ <code>Person</code> ç±»ï¼Œå¹¶å¯¹å…¶æ·»åŠ ä¸¤ä¸ªåˆ†ç±» <code>Life</code> å’Œ <code>Work</code>ï¼›å†å®šä¹‰ä¸€ä¸ª <code>Student</code> ç±»ç»§æ‰¿è‡ª <code>Person</code>ï¼Œå¹¶å¯¹å…¶æ·»åŠ  <code>School</code> åˆ†ç±»ï¼›æœ€åå®šä¹‰ä¸€ä¸ª <code>Programmer</code> ç±»ç»§æ‰¿è‡ª <code>Person</code>ã€‚åœ¨ä»¥ä¸Šé™¤äº† <code>Programmer</code> çš„ç±»å’Œåˆ†ç±»ä¸­ï¼Œå‡å®ç° +initializeï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec"><span style="color:#75715e">// Person.m
</span><span style="color:#75715e"></span><span style="color:#75715e">#import &#34;Person.h&#34;
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">@implementation</span> <span style="color:#a6e22e">Person</span>
+ (<span style="color:#66d9ef">void</span>)<span style="color:#a6e22e">initialize</span> {
    NSLog(<span style="color:#e6db74">@&#34;Person %s&#34;</span>, __func__);
}
<span style="color:#66d9ef">@end</span>

<span style="color:#75715e">// Person+Life.m
</span><span style="color:#75715e"></span><span style="color:#75715e">#import &#34;Person+Life.h&#34;
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">@implementation</span> <span style="color:#a6e22e">Person</span> (Life)
+ (<span style="color:#66d9ef">void</span>)<span style="color:#a6e22e">initialize</span> {
    NSLog(<span style="color:#e6db74">@&#34;Person+Life %s&#34;</span>, __func__);
}
<span style="color:#66d9ef">@end</span>

<span style="color:#75715e">//  Person+Work.m
</span><span style="color:#75715e"></span><span style="color:#75715e">#import &#34;Person+Work.h&#34;
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">@implementation</span> <span style="color:#a6e22e">Person</span> (Work)
+ (<span style="color:#66d9ef">void</span>)<span style="color:#a6e22e">initialize</span> {
    NSLog(<span style="color:#e6db74">@&#34;Person+Work %s&#34;</span>, __func__);
}
<span style="color:#66d9ef">@end</span>

<span style="color:#75715e">//  Student.m
</span><span style="color:#75715e"></span><span style="color:#75715e">#import &#34;Student.h&#34;
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">@implementation</span> <span style="color:#a6e22e">Student</span>
+ (<span style="color:#66d9ef">void</span>)<span style="color:#a6e22e">initialize</span> {
    NSLog(<span style="color:#e6db74">@&#34;Student %s&#34;</span>, __func__);
}
<span style="color:#66d9ef">@end</span>

<span style="color:#75715e">//  Student+School.m
</span><span style="color:#75715e"></span><span style="color:#75715e">#import &#34;Student+School.h&#34;
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">@implementation</span> <span style="color:#a6e22e">Student</span> (School)
+ (<span style="color:#66d9ef">void</span>)<span style="color:#a6e22e">initialize</span> {
    NSLog(<span style="color:#e6db74">@&#34;Student+School %s&#34;</span>, __func__);
}
<span style="color:#66d9ef">@end</span>

<span style="color:#75715e">//  Programmer.m
</span><span style="color:#75715e"></span><span style="color:#75715e">#import &#34;Programmer.h&#34;
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">@implementation</span> <span style="color:#a6e22e">Programmer</span>
<span style="color:#66d9ef">@end</span>

<span style="color:#75715e">// OUTPUT:
</span><span style="color:#75715e">// Hello, World!
</span></code></pre></div><p>é¦–å…ˆæˆ‘ä»¬ä¸æ›´æ”¹ main.mï¼Œå°è¯•è¿è¡Œç¨‹åºï¼Œç»“æœåªè¾“å‡ºäº† <code>main</code> å‡½æ•° <code>Hello, World!</code>ï¼Œå› ä¸º +initialize å¹¶ä¸åƒ +load ä¸€æ ·æ˜¯åœ¨ <code>main</code> å‡½æ•°å‰è°ƒç”¨çš„ï¼Œè€Œæ²¡æœ‰è¾“å‡ºçš„åŸå› æ˜¯è¿™äº›ç±»è¿˜æ²¡æœ‰æ”¶åˆ°ä¸€æ¡æ¶ˆæ¯ã€‚ä¼—æ‰€å‘¨çŸ¥ï¼ŒObj-C ä¸­å¤§éƒ¨åˆ†æ–¹æ³•è°ƒç”¨çš„æœ¬è´¨éƒ½æ˜¯æ¶ˆæ¯å‘é€ï¼ˆMessage Sendingï¼‰ï¼Œ<code>[SomeClass classMethod]</code> æ˜¯å‘ <code>SomeClass</code> ç±»å¯¹è±¡å‘é€ <code>classMethod</code> æ¶ˆæ¯ï¼›<code>[SomeObject instanceMethod]</code> æ˜¯å‘ <code>SomeObject</code> å®ä¾‹å¯¹è±¡å‘é€ <code>instanceMethod</code> æ–¹æ³•ï¼›ç”±äºå¦‚æœè¦è°ƒç”¨å¯¹è±¡æ–¹æ³•ï¼Œä¹Ÿå¿…é¡»è¦å…ˆè¿›è¡Œ <code>alloc</code> å¹¶ <code>init</code>ï¼ˆæˆ–è€… <code>new</code>ï¼‰æ‰èƒ½åˆ›å»ºå®Œä¸€ä¸ªå®ä¾‹å¯¹è±¡ï¼Œå› æ­¤å¯ä»¥è®¤ä¸ºç±»æ¥æ”¶åˆ°çš„ç¬¬ä¸€æ¡æ¶ˆæ¯æ°¸è¿œæ˜¯ç±»æ–¹æ³•ã€‚è¿™æ¬¡æˆ‘ä»¬å°è¯•å‘å®ƒä»¬å‘é€æ¶ˆæ¯ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec"><span style="color:#75715e">// main.m
</span><span style="color:#75715e"></span><span style="color:#75715e">#import &lt;Foundation/Foundation.h&gt;
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#import &#34;Person.h&#34;
</span><span style="color:#75715e">#import &#34;Student.h&#34;
</span><span style="color:#75715e">#import &#34;Programmer.h&#34;
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span> argv[]) {
    <span style="color:#66d9ef">@autoreleasepool</span> {
        NSLog(<span style="color:#e6db74">@&#34;---&#34;</span>);
        Student <span style="color:#f92672">*</span>stu <span style="color:#f92672">=</span> [Student alloc];
        NSLog(<span style="color:#e6db74">@&#34;---&#34;</span>);
        stu <span style="color:#f92672">=</span> [stu init];

        NSLog(<span style="color:#e6db74">@&#34;---&#34;</span>);
        [Programmer load];
    }
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
}


<span style="color:#75715e">// OUTPUT:
</span><span style="color:#75715e">// ---
</span><span style="color:#75715e">// Person+Work +[Person(Work) initialize]
</span><span style="color:#75715e">// Student+School +[Student(School) initialize]
</span><span style="color:#75715e">// ---
</span><span style="color:#75715e">// ---
</span><span style="color:#75715e">// Person+Work +[Person(Work) initialize]
</span></code></pre></div><p>é€šè¿‡ä»¥ä¸Šä»£ç çš„è¾“å‡ºï¼Œè™½ç„¶æˆ‘ä»¬å¹¶æ²¡æœ‰ä¸»åŠ¨è°ƒç”¨è¿™äº›ç±»çš„ +initialize æ–¹æ³•ï¼Œä½† +initialize ç¡®å®è¢«è‡ªåŠ¨è°ƒç”¨äº†ã€‚æˆ‘ä»¬å…ˆæŠ›å‡ºç»“è®ºï¼š<strong>+initialize æ–¹æ³•åœ¨ç±»ï¼ˆç±»å¯¹è±¡ï¼‰æ¥æ”¶åˆ°ç¬¬ä¸€æ¡æ¶ˆæ¯ï¼ˆç±»æ–¹æ³•ï¼‰å‰è¢«è°ƒç”¨ï¼›å­ç±»ä¸­å¦‚æœå®ç°äº†è¯¥æ–¹æ³•ï¼Œä¼šå…ˆçˆ¶ç±»å†å­ç±»ï¼›ä¸”éµå®ˆåˆ†ç±»ï¼ˆCategoryï¼‰ã€Œè¦†ç›–ã€ä¸»ç±»çš„ +initializeï¼›è‹¥å­ç±»æœªå®ç° +initializeï¼Œå°†è°ƒç”¨çˆ¶ç±»ä¸­çš„è¯¥æ–¹æ³•ï¼Œå› æ­¤ä¸€ä¸ªç±»ä¸­çš„ +initialize å¹¶ä¸èƒ½ä¿è¯åªè¢«è°ƒç”¨ä¸€æ¬¡ï¼Œä½†å¯¹äºæŸä¸ªç±»ï¼Œåªä¼šè¢«è°ƒç”¨ä¸€æ¬¡</strong>ã€‚</p>
<h2 id="why">Why</h2>
<h4 id="å®ç°åŸç†">å®ç°åŸç†</h4>
<p>ä¸Šé¢æˆ‘ä»¬å…ˆæŠ›å‡ºäº†ç»“è®ºï¼Œé‚£ä¹ˆè¯¥å¦‚ä½•éªŒè¯å‘¢ï¼ŸTalk is cheap, show me the code:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec"><span style="color:#75715e">// objc-class.mm
</span><span style="color:#75715e"></span><span style="color:#75715e">/***********************************************************************
</span><span style="color:#75715e">* class_getClassMethod.  Return the class method for the specified
</span><span style="color:#75715e">* class and selector.
</span><span style="color:#75715e">* ä¸ºæŒ‡å®šçš„ç±»å’Œæ–¹æ³•é€‰æ‹©å™¨è¿”å›ç›¸åº”çš„ç±»æ–¹æ³•ã€‚
</span><span style="color:#75715e">**********************************************************************/</span>
Method <span style="color:#a6e22e">class_getClassMethod</span>(<span style="color:#66d9ef">Class</span> cls, <span style="color:#66d9ef">SEL</span> sel)
{
    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>cls  <span style="color:#f92672">||</span>  <span style="color:#f92672">!</span>sel) <span style="color:#66d9ef">return</span> nil;

    <span style="color:#75715e">// â¡ï¸ è¿”å›å…ƒç±»çš„æ–¹æ³•
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// å› ä¸ºç±»å¯¹è±¡å’Œå…ƒç±»å¯¹è±¡çš„ç»“æ„ä¸€è‡´ï¼ˆå‡ä¸º Classï¼‰ï¼Œå› æ­¤å…ƒç±»çš„ç±»æ–¹æ³•å’Œç±»çš„å¯¹è±¡æ–¹æ³•å­˜å‚¨åœ¨åŒæ ·çš„ç»“æ„ä¸­
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">return</span> class_getInstanceMethod(cls<span style="color:#f92672">-&gt;</span>getMeta(), sel);
}

<span style="color:#75715e">// objc-runtime-new.mm
</span><span style="color:#75715e"></span><span style="color:#75715e">/***********************************************************************
</span><span style="color:#75715e">* class_getInstanceMethod.  Return the instance method for the
</span><span style="color:#75715e">* specified class and selector.
</span><span style="color:#75715e">* ä¸ºæŒ‡å®šçš„ç±»å’Œæ–¹æ³•é€‰æ‹©å™¨è¿”å›ç›¸åº”çš„å¯¹è±¡æ–¹æ³•ã€‚
</span><span style="color:#75715e">**********************************************************************/</span>
Method <span style="color:#a6e22e">class_getInstanceMethod</span>(<span style="color:#66d9ef">Class</span> cls, <span style="color:#66d9ef">SEL</span> sel)
{
    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>cls  <span style="color:#f92672">||</span>  <span style="color:#f92672">!</span>sel) <span style="color:#66d9ef">return</span> nil;

    <span style="color:#75715e">// This deliberately avoids +initialize because it historically did so.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// ç”±äºå†å²åŸå› ï¼Œè¿™é‡Œæ•…æ„é¿å… +initializeã€‚
</span><span style="color:#75715e"></span>
    <span style="color:#75715e">// This implementation is a bit weird because it&#39;s the only place that
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// wants a Method instead of an IMP.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// è¿™é‡Œçš„å®ç°æœ‰ç‚¹å¥‡æ€ªï¼Œå› ä¸ºè¿™æ˜¯å”¯ä¸€éœ€è¦ Method è€Œé IMP çš„åœ°æ–¹ã€‚
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#warning fixme build and search caches
</span><span style="color:#75715e"></span>
    <span style="color:#75715e">// Search method lists, try method resolver, etc.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// æœç´¢æ–¹æ³•åˆ—è¡¨ï¼Œå°è¯•æ–¹æ³•è§£æå™¨ç­‰ã€‚
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// â¡ï¸ æŸ¥æ‰¾ IMP
</span><span style="color:#75715e"></span>    lookUpImpOrNil(cls, sel, nil,
                   NO<span style="color:#75715e">/*initialize*/</span>, NO<span style="color:#75715e">/*cache*/</span>, YES<span style="color:#75715e">/*resolver*/</span>);

<span style="color:#75715e">#warning fixme build and search caches
</span><span style="color:#75715e"></span>
    <span style="color:#66d9ef">return</span> _class_getMethod(cls, sel);
}

<span style="color:#75715e">// objc-runtime-new.mm
</span><span style="color:#75715e"></span><span style="color:#75715e">/***********************************************************************
</span><span style="color:#75715e">* lookUpImpOrNil.
</span><span style="color:#75715e">* Like lookUpImpOrForward, but returns nil instead of _objc_msgForward_impcache
</span><span style="color:#75715e">* ç±»ä¼¼ lookUpImpOrForwardï¼Œä½†è¿”å› nil æ›¿ä»£ _objc_msgForward_impcache
</span><span style="color:#75715e">**********************************************************************/</span>
<span style="color:#66d9ef">IMP</span> <span style="color:#a6e22e">lookUpImpOrNil</span>(<span style="color:#66d9ef">Class</span> cls, <span style="color:#66d9ef">SEL</span> sel, <span style="color:#66d9ef">id</span> inst,
                   <span style="color:#66d9ef">bool</span> initialize, <span style="color:#66d9ef">bool</span> cache, <span style="color:#66d9ef">bool</span> resolver)
{
    <span style="color:#75715e">// â¡ï¸ æŸ¥æ‰¾ IMP
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">IMP</span> imp <span style="color:#f92672">=</span> lookUpImpOrForward(cls, sel, inst, initialize, cache, resolver);
    <span style="color:#75715e">// å½“ IMP ä¸º _objc_msgForward_impcache æ—¶ï¼Œè¿”å› nil
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (imp <span style="color:#f92672">==</span> _objc_msgForward_impcache) <span style="color:#66d9ef">return</span> nil;
    <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">return</span> imp;
}

<span style="color:#75715e">// objc-runtime-new.mm
</span><span style="color:#75715e"></span><span style="color:#75715e">/***********************************************************************
</span><span style="color:#75715e">* lookUpImpOrForward.
</span><span style="color:#75715e">* The standard IMP lookup.
</span><span style="color:#75715e">* æ ‡å‡† IMP æŸ¥æ‰¾ã€‚
</span><span style="color:#75715e">* initialize==NO tries to avoid +initialize (but sometimes fails)
</span><span style="color:#75715e">* initialize==NO å°è¯•é¿å… +initializeï¼ˆä½†æœ‰æ—¶ä¼šå¤±è´¥ï¼‰
</span><span style="color:#75715e">* cache==NO skips optimistic unlocked lookup (but uses cache elsewhere)
</span><span style="color:#75715e">* cache==NO è·³è¿‡ä¹è§‚è§£é”æŸ¥æ‰¾ï¼ˆä½†æœ‰æ—¶ä»ä¼šä½¿ç”¨ç¼“å­˜ï¼‰
</span><span style="color:#75715e">* Most callers should use initialize==YES and cache==YES.
</span><span style="color:#75715e">* å¤§å¤šæ•°è°ƒç”¨è€…åº”å½“ä½¿ç”¨ initialize==YES ä¸” cache==YESã€‚
</span><span style="color:#75715e">* inst is an instance of cls or a subclass thereof, or nil if none is known.
</span><span style="color:#75715e">* inst æ˜¯ cls æˆ–å…¶å­ç±»ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™ä¸º nilã€‚
</span><span style="color:#75715e">*   If cls is an un-initialized metaclass then a non-nil inst is faster.
</span><span style="color:#75715e">*   å¦‚æœ cls æ˜¯æœªåˆå§‹åŒ–çš„å…ƒç±»ï¼Œé‚£ä¹ˆé nil çš„ inst æ›´å¿«ã€‚
</span><span style="color:#75715e">* May return _objc_msgForward_impcache. IMPs destined for external use
</span><span style="color:#75715e">*   must be converted to _objc_msgForward or _objc_msgForward_stret.
</span><span style="color:#75715e">* å¯èƒ½è¿”å› _objc_msgForward_impcacheã€‚å¤–éƒ¨ä½¿ç”¨ IMP åˆ™æ³¨å®šå¿…é¡»è¢«è½¬æ¢ä¸º _objc_msgForward æˆ– _objc_msgForward_stretã€‚
</span><span style="color:#75715e">*   If you don&#39;t want forwarding at all, use lookUpImpOrNil() instead.
</span><span style="color:#75715e">*   å¦‚æœæ ¹æœ¬ä¸éœ€è¦è½¬å‘ï¼Œä½¿ç”¨ lookUpImpOrNil() æ›¿ä»£ã€‚
</span><span style="color:#75715e">**********************************************************************/</span>
<span style="color:#66d9ef">IMP</span> <span style="color:#a6e22e">lookUpImpOrForward</span>(<span style="color:#66d9ef">Class</span> cls, <span style="color:#66d9ef">SEL</span> sel, <span style="color:#66d9ef">id</span> inst,
                       <span style="color:#66d9ef">bool</span> initialize, <span style="color:#66d9ef">bool</span> cache, <span style="color:#66d9ef">bool</span> resolver)
{
    <span style="color:#66d9ef">IMP</span> imp <span style="color:#f92672">=</span> nil;
    <span style="color:#66d9ef">bool</span> triedResolver <span style="color:#f92672">=</span> NO;

    <span style="color:#75715e">// æ–­è¨€è§£é”
</span><span style="color:#75715e"></span>    runtimeLock.assertUnlocked();

    <span style="color:#75715e">// Optimistic cache lookup
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// ä¹è§‚ç¼“å­˜æŸ¥æ‰¾
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (cache) {
        imp <span style="color:#f92672">=</span> cache_getImp(cls, sel);
        <span style="color:#66d9ef">if</span> (imp) <span style="color:#66d9ef">return</span> imp;
    }

    <span style="color:#75715e">// runtimeLock is held during isRealized and isInitialized checking
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// to prevent races against concurrent realization.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// åœ¨ isRealized å’Œ isInitialized æ£€æŸ¥æœŸé—´ä¿æŒ runtimeLockï¼Œé˜²æ­¢å¹¶å‘å®åŒ–ç«äº‰ã€‚
</span><span style="color:#75715e"></span>
    <span style="color:#75715e">// runtimeLock is held during method search to make
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// method-lookup + cache-fill atomic with respect to method addition.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// å…³äºæ–¹æ³•æ·»åŠ ï¼Œåœ¨æ–¹æ³•æœç´¢æœŸé—´ä¿æŒ runtimeLockï¼Œä½¿å¾—æ–¹æ³•æŸ¥æ‰¾å’Œç¼“å­˜å¡«å……åŸå­åŒ–ï¼ˆä¸å¯å†åˆ†å‰²ï¼‰ã€‚
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// Otherwise, a category could be added but ignored indefinitely because
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// the cache was re-filled with the old value after the cache flush on
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// behalf of the category.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// å¦åˆ™ï¼Œåˆ†ç±»å¯ä»¥è¢«æ·»åŠ ä½†æ€»ä¼šè¢«å¿½ç•¥ï¼Œå› ä¸ºåˆ†ç±»çš„ç¼“å­˜åœ¨åˆ·æ–°åä¼šè¢«æ—§å€¼é‡å¤å¡«å……ã€‚
</span><span style="color:#75715e"></span>
    runtimeLock.lock();
    checkIsKnownClass(cls);

    <span style="color:#75715e">// å¦‚æœæœªå®åŒ–ï¼Œè¿›è¡Œå®åŒ–
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>cls<span style="color:#f92672">-&gt;</span>isRealized()) {
        realizeClass(cls);
    }

    <span style="color:#75715e">// å¦‚æœéœ€è¦åˆå§‹åŒ–ä½†æœªåˆå§‹åŒ–ï¼Œè¿›è¡Œåˆå§‹åŒ–
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (initialize  <span style="color:#f92672">&amp;&amp;</span>  <span style="color:#f92672">!</span>cls<span style="color:#f92672">-&gt;</span>isInitialized()) {
        runtimeLock.unlock();
        <span style="color:#75715e">// â¡ï¸ ç±»åˆå§‹åŒ–
</span><span style="color:#75715e"></span>        _class_initialize (_class_getNonMetaClass(cls, inst));
        runtimeLock.lock();
        <span style="color:#75715e">// If sel == initialize, _class_initialize will send +initialize and
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// then the messenger will send +initialize again after this
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// procedure finishes. Of course, if this is not being called
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// from the messenger then it won&#39;t happen. 2778172
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// å¦‚æœ sel ç­‰äº initializeï¼Œ_class_initialize å°†å‘é€ +initialize æ¶ˆæ¯ï¼Œ
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// ä¹‹åå‘é€è€…å°†ä¼šåœ¨è¯¥è¿‡ç¨‹å®Œæˆåå†æ¬¡å‘é€ +initializeã€‚å½“ç„¶ï¼Œå¦‚æœä¸æ˜¯å‘é€è€…è°ƒç”¨ï¼Œåˆ™ä¸ä¼šå‘ç”Ÿã€‚
</span><span style="color:#75715e"></span>    }


 retry:
    runtimeLock.assertLocked();

    <span style="color:#75715e">// Try this class&#39;s cache.
</span><span style="color:#75715e"></span>
    imp <span style="color:#f92672">=</span> cache_getImp(cls, sel);
    <span style="color:#66d9ef">if</span> (imp) <span style="color:#66d9ef">goto</span> done;

    <span style="color:#75715e">// Try this class&#39;s method lists.
</span><span style="color:#75715e"></span>    {
        Method meth <span style="color:#f92672">=</span> getMethodNoSuper_nolock(cls, sel);
        <span style="color:#66d9ef">if</span> (meth) {
            log_and_fill_cache(cls, meth<span style="color:#f92672">-&gt;</span>imp, sel, inst, cls);
            imp <span style="color:#f92672">=</span> meth<span style="color:#f92672">-&gt;</span>imp;
            <span style="color:#66d9ef">goto</span> done;
        }
    }

    <span style="color:#75715e">// Try superclass caches and method lists.
</span><span style="color:#75715e"></span>    {
        <span style="color:#66d9ef">unsigned</span> attempts <span style="color:#f92672">=</span> unreasonableClassCount();
        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">Class</span> curClass <span style="color:#f92672">=</span> cls<span style="color:#f92672">-&gt;</span>superclass;
             curClass <span style="color:#f92672">!=</span> nil;
             curClass <span style="color:#f92672">=</span> curClass<span style="color:#f92672">-&gt;</span>superclass)
        {
            <span style="color:#75715e">// Halt if there is a cycle in the superclass chain.
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">if</span> (<span style="color:#f92672">--</span>attempts <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>) {
                _objc_fatal(<span style="color:#e6db74">&#34;Memory corruption in class list.&#34;</span>);
            }

            <span style="color:#75715e">// Superclass cache.
</span><span style="color:#75715e"></span>            imp <span style="color:#f92672">=</span> cache_getImp(curClass, sel);
            <span style="color:#66d9ef">if</span> (imp) {
                <span style="color:#66d9ef">if</span> (imp <span style="color:#f92672">!=</span> (<span style="color:#66d9ef">IMP</span>)_objc_msgForward_impcache) {
                    <span style="color:#75715e">// Found the method in a superclass. Cache it in this class.
</span><span style="color:#75715e"></span>                    log_and_fill_cache(cls, imp, sel, inst, curClass);
                    <span style="color:#66d9ef">goto</span> done;
                }
                <span style="color:#66d9ef">else</span> {
                    <span style="color:#75715e">// Found a forward:: entry in a superclass.
</span><span style="color:#75715e"></span>                    <span style="color:#75715e">// Stop searching, but don&#39;t cache yet; call method
</span><span style="color:#75715e"></span>                    <span style="color:#75715e">// resolver for this class first.
</span><span style="color:#75715e"></span>                    <span style="color:#66d9ef">break</span>;
                }
            }

            <span style="color:#75715e">// Superclass method list.
</span><span style="color:#75715e"></span>            Method meth <span style="color:#f92672">=</span> getMethodNoSuper_nolock(curClass, sel);
            <span style="color:#66d9ef">if</span> (meth) {
                log_and_fill_cache(cls, meth<span style="color:#f92672">-&gt;</span>imp, sel, inst, curClass);
                imp <span style="color:#f92672">=</span> meth<span style="color:#f92672">-&gt;</span>imp;
                <span style="color:#66d9ef">goto</span> done;
            }
        }
    }

    <span style="color:#75715e">// No implementation found. Try method resolver once.
</span><span style="color:#75715e"></span>
    <span style="color:#66d9ef">if</span> (resolver  <span style="color:#f92672">&amp;&amp;</span>  <span style="color:#f92672">!</span>triedResolver) {
        runtimeLock.unlock();
        _class_resolveMethod(cls, sel, inst);
        runtimeLock.lock();
        <span style="color:#75715e">// Don&#39;t cache the result; we don&#39;t hold the lock so it may have
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// changed already. Re-do the search from scratch instead.
</span><span style="color:#75715e"></span>        triedResolver <span style="color:#f92672">=</span> YES;
        <span style="color:#66d9ef">goto</span> retry;
    }

    <span style="color:#75715e">// No implementation found, and method resolver didn&#39;t help.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// Use forwarding.
</span><span style="color:#75715e"></span>
    imp <span style="color:#f92672">=</span> (<span style="color:#66d9ef">IMP</span>)_objc_msgForward_impcache;
    cache_fill(cls, sel, imp, inst);

 done:
    runtimeLock.unlock();

    <span style="color:#66d9ef">return</span> imp;
}

<span style="color:#75715e">// objc-initialize.mm
</span><span style="color:#75715e"></span><span style="color:#75715e">/***********************************************************************
</span><span style="color:#75715e">* class_initialize.  Send the &#39;+initialize&#39; message on demand to any
</span><span style="color:#75715e">* uninitialized class. Force initialization of superclasses first.
</span><span style="color:#75715e">* class_initializeã€‚æŒ‰éœ€å‘é€ã€Œ+initializeã€æ¶ˆæ¯åˆ°æ‰€æœ‰æœªåˆå§‹åŒ–çš„ç±»ã€‚å¼ºåˆ¶çˆ¶ç±»æœ€å…ˆåˆå§‹åŒ–ã€‚
</span><span style="color:#75715e">**********************************************************************/</span>
<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">_class_initialize</span>(<span style="color:#66d9ef">Class</span> cls)
{
    <span style="color:#75715e">// æ–­è¨€éå…ƒç±»
</span><span style="color:#75715e"></span>    assert(<span style="color:#f92672">!</span>cls<span style="color:#f92672">-&gt;</span>isMetaClass());

    <span style="color:#66d9ef">Class</span> supercls;
    <span style="color:#66d9ef">bool</span> reallyInitialize <span style="color:#f92672">=</span> NO;

    <span style="color:#75715e">// Make sure super is done initializing BEFORE beginning to initialize cls.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// åœ¨å¼€å§‹åˆå§‹åŒ– cls å‰ç¡®ä¿çˆ¶ç±»å·²ç»å®Œæˆåˆå§‹åŒ–ã€‚
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// See note about deadlock above.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// æŸ¥çœ‹ä¸Šé¢æ­»é”çš„å¤‡æ³¨ã€‚
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// å–å¾—çˆ¶ç±»
</span><span style="color:#75715e"></span>    supercls <span style="color:#f92672">=</span> cls<span style="color:#f92672">-&gt;</span>superclass;
    <span style="color:#75715e">// å¦‚æœçˆ¶ç±»å­˜åœ¨ï¼Œä¸”æœªåˆå§‹åŒ–
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (supercls  <span style="color:#f92672">&amp;&amp;</span>  <span style="color:#f92672">!</span>supercls<span style="color:#f92672">-&gt;</span>isInitialized()) {
    	 <span style="color:#75715e">// é€’å½’åˆå§‹åŒ–çˆ¶ç±»
</span><span style="color:#75715e"></span>        _class_initialize(supercls);
    }

    <span style="color:#75715e">// Try to atomically set CLS_INITIALIZING.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// åŸå­åŒ–åœ°è®¾ç½® CLS_INITIALIZINGã€‚
</span><span style="color:#75715e"></span>    {
        monitor_locker_t lock(classInitLock);
        <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>cls<span style="color:#f92672">-&gt;</span>isInitialized() <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">!</span>cls<span style="color:#f92672">-&gt;</span>isInitializing()) {
            cls<span style="color:#f92672">-&gt;</span>setInitializing();
            reallyInitialize <span style="color:#f92672">=</span> YES;
        }
    }

    <span style="color:#66d9ef">if</span> (reallyInitialize) {
        <span style="color:#75715e">// We successfully set the CLS_INITIALIZING bit. Initialize the class.
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// æˆåŠŸè®¾ç½® CLS_INITIALIZING ä½ã€‚åˆå§‹åŒ–ç±»ã€‚
</span><span style="color:#75715e"></span>
        <span style="color:#75715e">// Record that we&#39;re initializing this class so we can message it.
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// è®°å½•æˆ‘ä»¬æ­£åœ¨åˆå§‹åŒ–è¯¥ç±»ï¼Œä»¥ä¾¿å¯ä»¥å‘é€è¿™ä¸ªæ¶ˆæ¯ã€‚
</span><span style="color:#75715e"></span>        _setThisThreadIsInitializingClass(cls);

        <span style="color:#66d9ef">if</span> (MultithreadedForkChild) {
            <span style="color:#75715e">// LOL JK we don&#39;t really call +initialize methods after fork().
</span><span style="color:#75715e"></span>            performForkChildInitialize(cls, supercls);
            <span style="color:#66d9ef">return</span>;
        }

        <span style="color:#75715e">// Send the +initialize message.
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// å‘é€ +initialize æ¶ˆæ¯ã€‚
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// Note that +initialize is sent to the superclass (again) if
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// this class doesn&#39;t implement +initialize. 2157218
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// å¦‚æœè¯¥ç±»æœªå®ç° +initializeï¼Œéœ€è¦æ³¨æ„ +initializeï¼ˆå†æ¬¡ï¼‰è¢«å‘é€åˆ°äº†çˆ¶ç±»
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// Xcode ä¸­ OBJC_PRINT_INITIALIZE_METHODS ç¯å¢ƒå˜é‡å€¼ä¸º YES æ—¶ï¼Œå°†å¯åœ¨æ§åˆ¶å°æ‰“å°è¯¥ä¿¡æ¯
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// OPTION(PrintInitializing, OBJC_PRINT_INITIALIZE_METHODS, &#34;log calls to class +initialize methods&#34;)
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> (PrintInitializing) {
            _objc_inform(<span style="color:#e6db74">&#34;INITIALIZE: thread %p: calling +[%s initialize]&#34;</span>,
                         pthread_self(), cls<span style="color:#f92672">-&gt;</span>nameForLogging());
        }

        <span style="color:#75715e">// Exceptions: A +initialize call that throws an exception
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// is deemed to be a complete and successful +initialize.
</span><span style="color:#75715e"></span>        <span style="color:#75715e">//
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// Only __OBJC2__ adds these handlers. !__OBJC2__ has a
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// bootstrapping problem of this versus CF&#39;s call to
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// objc_exception_set_functions().
</span><span style="color:#75715e"></span><span style="color:#75715e">#if __OBJC2__
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">@try</span>
<span style="color:#75715e">#endif
</span><span style="color:#75715e"></span>        {
            <span style="color:#75715e">// â¡ï¸ è°ƒç”¨ +initialize
</span><span style="color:#75715e"></span>            callInitialize(cls);

            <span style="color:#66d9ef">if</span> (PrintInitializing) {
                _objc_inform(<span style="color:#e6db74">&#34;INITIALIZE: thread %p: finished +[%s initialize]&#34;</span>,
                             pthread_self(), cls<span style="color:#f92672">-&gt;</span>nameForLogging());
            }
        }
<span style="color:#75715e">#if __OBJC2__
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">@catch</span> (...) {
            <span style="color:#66d9ef">if</span> (PrintInitializing) {
                _objc_inform(<span style="color:#e6db74">&#34;INITIALIZE: thread %p: +[%s initialize] &#34;</span>
                             <span style="color:#e6db74">&#34;threw an exception&#34;</span>,
                             pthread_self(), cls<span style="color:#f92672">-&gt;</span>nameForLogging());
            }
            <span style="color:#66d9ef">@throw</span>;
        }
        <span style="color:#66d9ef">@finally</span>
<span style="color:#75715e">#endif
</span><span style="color:#75715e"></span>        {
            <span style="color:#75715e">// Done initializing.
</span><span style="color:#75715e"></span>            lockAndFinishInitializing(cls, supercls);
        }
        <span style="color:#66d9ef">return</span>;
    }

    <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (cls<span style="color:#f92672">-&gt;</span>isInitializing()) {
        <span style="color:#75715e">// We couldn&#39;t set INITIALIZING because INITIALIZING was already set.
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// If this thread set it earlier, continue normally.
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// If some other thread set it, block until initialize is done.
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// It&#39;s ok if INITIALIZING changes to INITIALIZED while we&#39;re here,
</span><span style="color:#75715e"></span>        <span style="color:#75715e">//   because we safely check for INITIALIZED inside the lock
</span><span style="color:#75715e"></span>        <span style="color:#75715e">//   before blocking.
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> (_thisThreadIsInitializingClass(cls)) {
            <span style="color:#66d9ef">return</span>;
        } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>MultithreadedForkChild) {
            waitForInitializeToComplete(cls);
            <span style="color:#66d9ef">return</span>;
        } <span style="color:#66d9ef">else</span> {
            <span style="color:#75715e">// We&#39;re on the child side of fork(), facing a class that
</span><span style="color:#75715e"></span>            <span style="color:#75715e">// was initializing by some other thread when fork() was called.
</span><span style="color:#75715e"></span>            _setThisThreadIsInitializingClass(cls);
            performForkChildInitialize(cls, supercls);
        }
    }

    <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (cls<span style="color:#f92672">-&gt;</span>isInitialized()) {
        <span style="color:#75715e">// Set CLS_INITIALIZING failed because someone else already
</span><span style="color:#75715e"></span>        <span style="color:#75715e">//   initialized the class. Continue normally.
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// NOTE this check must come AFTER the ISINITIALIZING case.
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// Otherwise: Another thread is initializing this class. ISINITIALIZED
</span><span style="color:#75715e"></span>        <span style="color:#75715e">//   is false. Skip this clause. Then the other thread finishes
</span><span style="color:#75715e"></span>        <span style="color:#75715e">//   initialization and sets INITIALIZING=no and INITIALIZED=yes.
</span><span style="color:#75715e"></span>        <span style="color:#75715e">//   Skip the ISINITIALIZING clause. Die horribly.
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">return</span>;
    }

    <span style="color:#66d9ef">else</span> {
        <span style="color:#75715e">// We shouldn&#39;t be here.
</span><span style="color:#75715e"></span>        _objc_fatal(<span style="color:#e6db74">&#34;thread-safe class init in objc runtime is buggy!&#34;</span>);
    }
}

<span style="color:#75715e">// objc-initialize.mm
</span><span style="color:#75715e"></span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">callInitialize</span>(<span style="color:#66d9ef">Class</span> cls)
{
    <span style="color:#75715e">// ğŸ’¡ å‘ cls å‘é€ SEL_initialize æ¶ˆæ¯
</span><span style="color:#75715e"></span>    ((<span style="color:#66d9ef">void</span>(<span style="color:#f92672">*</span>)(<span style="color:#66d9ef">Class</span>, <span style="color:#66d9ef">SEL</span>))objc_msgSend)(cls, SEL_initialize);
    <span style="color:#66d9ef">asm</span>(<span style="color:#e6db74">&#34;&#34;</span>);
}
</code></pre></div><p>è¿½æ ¹æº¯æºï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° +initialize çš„æœ¬è´¨å…¶å®æ˜¯ objc_msgSendï¼Œå³æ¶ˆæ¯å‘é€æœºåˆ¶ï¼Œä¸åŒäº +load ç›´æ¥æ ¹æ® IMP æŒ‡é’ˆè¿›è¡Œè°ƒç”¨ã€‚è¿™ä¹Ÿå°±è§£é‡Šäº†åœ¨ Demo ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå°è¯•å‘ <code>Student</code> ç±»å‘é€ä¸€ä¸ª <code>alloc</code> æ¶ˆæ¯ï¼Œè¿è¡Œæ—¶ä¼šå…ˆæ‰¾åˆ°çˆ¶ç±» <code>Person</code> çš„ +initialize æ–¹æ³•è¿›è¡Œè°ƒç”¨ï¼Œè€Œç”±äºçˆ¶ç±»åˆå­˜åœ¨åˆ†ç±»ï¼Œæœ€åç¼–è¯‘çš„ <code>Person+Work</code> åˆ†ç±»ã€Œè¦†ç›–ã€äº†å…¶å®ƒåˆ†ç±»å’Œä¸»ç±»ä¸­ç›¸åŒçš„æ–¹æ³•è€Œå¾—ä»¥è°ƒç”¨ï¼›éšåè°ƒç”¨å­ç±»è‡ªèº«çš„ +initialize æ–¹æ³•ï¼Œè€Œ <code>Student+School</code> åˆ†ç±»ã€Œè¦†ç›–ã€äº†ä¸»ç±»ä¸­ç›¸åŒçš„æ–¹æ³•è€Œå¾—ä»¥è°ƒç”¨ï¼›è€Œå‘ <code>Programmer</code> ç±»æ‰‹åŠ¨å‘é€ +load æ¶ˆæ¯æ—¶ï¼ˆå½“ç„¶ï¼Œä¸€èˆ¬æˆ‘ä»¬ä¸ä¼šè¿™ä¹ˆåšï¼‰ï¼Œç”±äºè¯¥ç±»æœ¬èº«æ²¡æœ‰å®ç° +initialize æ–¹æ³•ï¼Œå› æ­¤æœ€ç»ˆé€šè¿‡çˆ¶ç±»çš„ <code>Person+Work</code> åˆ†ç±»è°ƒç”¨äº† +initialize æ–¹æ³•ã€‚</p>
<p><img src="/img/2019/+initialize_in_ios/1.png" alt=""></p>
<p>å¦‚ä¸Šæ‰€è¿°ï¼Œä¸€ä¸ªç±»çš„ +initialize æ–¹æ³•å¹¶ä¸èƒ½ä¿è¯åªä¼šè¢«è°ƒç”¨ä¸€æ¬¡ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬ä¸å¸Œæœ›å¤šæ¬¡è°ƒç”¨ï¼Œå¯ä»¥åœ¨ +initialize æ–¹æ³•ä¸­è¿›è¡Œåˆ¤æ–­ <code>self == [ClassName self]</code>ã€‚</p>
<h2 id="objc_print_initialize_methods">OBJC_PRINT_INITIALIZE_METHODS</h2>
<p>ä¸ºäº†ä¾¿äº Debug è¿è¡Œæ—¶çš„ +initialize æ–¹æ³•ï¼Œå°† <code>OBJC_PRINT_INITIALIZE_METHODS</code> åœ¨ Xcode ä¸­è®¾ç½®ä¸º YES åï¼Œå¯ä»¥æ‰“å°å‡ºå¾ˆå¤š + initialize æ–¹æ³•æ‰§è¡Œæ—¶çš„ä¿¡æ¯ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">objc[23971]: INITIALIZE: thread 0x1000aa5c0: calling +[NSObject initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: finished +[NSObject initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: NSObject is fully +initialized
objc[23971]: INITIALIZE: thread 0x1000aa5c0: calling +[OS_dispatch_data initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: finished +[OS_dispatch_data initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: OS_dispatch_data is fully +initialized
objc[23971]: INITIALIZE: thread 0x1000aa5c0: calling +[OS_object initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: finished +[OS_object initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: OS_object is fully +initialized
objc[23971]: INITIALIZE: thread 0x1000aa5c0: calling +[OS_xpc_object initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: finished +[OS_xpc_object initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: OS_xpc_object is fully +initialized
objc[23971]: INITIALIZE: thread 0x1000aa5c0: calling +[OS_xpc_string initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: finished +[OS_xpc_string initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: OS_xpc_string is fully +initialized
objc[23971]: INITIALIZE: thread 0x1000aa5c0: calling +[OS_xpc_data initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: finished +[OS_xpc_data initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: OS_xpc_data is fully +initialized
objc[23971]: INITIALIZE: thread 0x1000aa5c0: calling +[OS_xpc_dictionary initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: finished +[OS_xpc_dictionary initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: OS_xpc_dictionary is fully +initialized
objc[23971]: INITIALIZE: thread 0x1000aa5c0: calling +[OS_xpc_serializer initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: finished +[OS_xpc_serializer initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: OS_xpc_serializer is fully +initialized
objc[23971]: INITIALIZE: thread 0x1000aa5c0: calling +[OS_dispatch_object initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: finished +[OS_dispatch_object initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: OS_dispatch_object is fully +initialized
objc[23971]: INITIALIZE: thread 0x1000aa5c0: calling +[OS_dispatch_mach_msg initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: finished +[OS_dispatch_mach_msg initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: OS_dispatch_mach_msg is fully +initialized
objc[23971]: INITIALIZE: thread 0x1000aa5c0: calling +[OS_xpc_array initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: finished +[OS_xpc_array initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: OS_xpc_array is fully +initialized
objc[23971]: INITIALIZE: thread 0x1000aa5c0: calling +[__NSCFType initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: finished +[__NSCFType initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: __NSCFType is fully +initialized
objc[23971]: INITIALIZE: thread 0x1000aa5c0: calling +[__NSCFString initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: finished +[__NSCFString initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: __NSCFString is fully +initialized
objc[23971]: INITIALIZE: thread 0x1000aa5c0: calling +[NSArray initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: finished +[NSArray initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: NSArray is fully +initialized
objc[23971]: INITIALIZE: thread 0x1000aa5c0: calling +[NSMutableArray initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: finished +[NSMutableArray initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: NSMutableArray is fully +initialized
objc[23971]: INITIALIZE: thread 0x1000aa5c0: calling +[__NSPlaceholderArray initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: finished +[__NSPlaceholderArray initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: __NSPlaceholderArray is fully +initialized
objc[23971]: INITIALIZE: thread 0x1000aa5c0: calling +[__NSSingleObjectArrayI initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: finished +[__NSSingleObjectArrayI initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: __NSSingleObjectArrayI is fully +initialized
objc[23971]: INITIALIZE: thread 0x1000aa5c0: calling +[NSDictionary initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: finished +[NSDictionary initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: NSDictionary is fully +initialized
objc[23971]: INITIALIZE: thread 0x1000aa5c0: calling +[__NSDictionary0 initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: finished +[__NSDictionary0 initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: __NSDictionary0 is fully +initialized
objc[23971]: INITIALIZE: thread 0x1000aa5c0: calling +[NSMutableDictionary initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: finished +[NSMutableDictionary initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: NSMutableDictionary is fully +initialized
objc[23971]: INITIALIZE: thread 0x1000aa5c0: calling +[__NSArray0 initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: finished +[__NSArray0 initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: __NSArray0 is fully +initialized
objc[23971]: INITIALIZE: thread 0x1000aa5c0: calling +[NSEnumerator initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: finished +[NSEnumerator initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: NSEnumerator is fully +initialized
objc[23971]: INITIALIZE: thread 0x1000aa5c0: calling +[__NSEnumerator0 initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: finished +[__NSEnumerator0 initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: __NSEnumerator0 is fully +initialized
objc[23971]: INITIALIZE: thread 0x1000aa5c0: calling +[NSLock initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: finished +[NSLock initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: NSLock is fully +initialized
objc[23971]: INITIALIZE: thread 0x1000aa5c0: calling +[NSRecursiveLock initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: finished +[NSRecursiveLock initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: NSRecursiveLock is fully +initialized
objc[23971]: INITIALIZE: thread 0x1000aa5c0: calling +[NSThread initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: finished +[NSThread initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: NSThread is fully +initialized
objc[23971]: INITIALIZE: thread 0x1000aa5c0: calling +[__NSCFDictionary initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: finished +[__NSCFDictionary initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: __NSCFDictionary is fully +initialized
objc[23971]: INITIALIZE: thread 0x1000aa5c0: calling +[_NSThreadData initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: finished +[_NSThreadData initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: _NSThreadData is fully +initialized
objc[23971]: INITIALIZE: thread 0x1000aa5c0: calling +[__NSPlaceholderDictionary initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: finished +[__NSPlaceholderDictionary initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: __NSPlaceholderDictionary is fully +initialized
objc[23971]: INITIALIZE: thread 0x1000aa5c0: calling +[__NSDictionaryM initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: finished +[__NSDictionaryM initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: __NSDictionaryM is fully +initialized
objc[23971]: INITIALIZE: thread 0x1000aa5c0: calling +[__NSCFArray initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: finished +[__NSCFArray initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: __NSCFArray is fully +initialized
objc[23971]: INITIALIZE: thread 0x1000aa5c0: calling +[NSSet initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: finished +[NSSet initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: NSSet is fully +initialized
objc[23971]: INITIALIZE: thread 0x1000aa5c0: calling +[NSMutableSet initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: finished +[NSMutableSet initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: NSMutableSet is fully +initialized
objc[23971]: INITIALIZE: thread 0x1000aa5c0: calling +[__NSPlaceholderSet initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: calling +[__NSSetI initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: finished +[__NSSetI initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: __NSSetI is fully +initialized
objc[23971]: INITIALIZE: thread 0x1000aa5c0: finished +[__NSPlaceholderSet initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: __NSPlaceholderSet is fully +initialized
objc[23971]: INITIALIZE: thread 0x1000aa5c0: calling +[__NSSetM initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: finished +[__NSSetM initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: __NSSetM is fully +initialized
objc[23971]: INITIALIZE: thread 0x1000aa5c0: calling +[NSBindingSelectionMarker initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: finished +[NSBindingSelectionMarker initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: NSBindingSelectionMarker is fully +initialized
objc[23971]: INITIALIZE: thread 0x1000aa5c0: calling +[_NSStateMarker initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: finished +[_NSStateMarker initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: _NSStateMarker is fully +initialized
objc[23971]: INITIALIZE: thread 0x1000aa5c0: calling +[__NSCFConstantString initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: calling +[NSString initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: calling +[NSPlaceholderString initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: finished +[NSPlaceholderString initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: class NSPlaceholderString will be marked as fully +initialized after superclass +[NSString initialize] completes
objc[23971]: INITIALIZE: thread 0x1000aa5c0: calling +[NSTaggedPointerString initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: finished +[NSTaggedPointerString initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: class NSTaggedPointerString will be marked as fully +initialized after superclass +[NSString initialize] completes
objc[23971]: INITIALIZE: thread 0x1000aa5c0: finished +[NSString initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: NSString is fully +initialized
objc[23971]: INITIALIZE: thread 0x1000aa5c0: NSTaggedPointerString is fully +initialized
objc[23971]: INITIALIZE: thread 0x1000aa5c0: NSPlaceholderString is fully +initialized
objc[23971]: INITIALIZE: thread 0x1000aa5c0: calling +[NSMutableString initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: calling +[NSPlaceholderMutableString initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: finished +[NSPlaceholderMutableString initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: class NSPlaceholderMutableString will be marked as fully +initialized after superclass +[NSMutableString initialize] completes
objc[23971]: INITIALIZE: thread 0x1000aa5c0: finished +[NSMutableString initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: NSMutableString is fully +initialized
objc[23971]: INITIALIZE: thread 0x1000aa5c0: NSPlaceholderMutableString is fully +initialized
objc[23971]: INITIALIZE: thread 0x1000aa5c0: finished +[__NSCFConstantString initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: __NSCFConstantString is fully +initialized
objc[23971]: INITIALIZE: thread 0x1000aa5c0: calling +[NSBundle initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: finished +[NSBundle initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: NSBundle is fully +initialized
objc[23971]: INITIALIZE: thread 0x1000aa5c0: calling +[_CFXPreferencesHandle initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: finished +[_CFXPreferencesHandle initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: _CFXPreferencesHandle is fully +initialized
objc[23971]: INITIALIZE: thread 0x1000aa5c0: calling +[_CFXPreferences initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: finished +[_CFXPreferences initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: _CFXPreferences is fully +initialized
objc[23971]: INITIALIZE: thread 0x1000aa5c0: calling +[NSURL initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: finished +[NSURL initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: NSURL is fully +initialized
objc[23971]: INITIALIZE: thread 0x1000aa5c0: calling +[CFPrefsSource initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: finished +[CFPrefsSource initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: CFPrefsSource is fully +initialized
objc[23971]: INITIALIZE: thread 0x1000aa5c0: calling +[CFPrefsSearchListSource initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: finished +[CFPrefsSearchListSource initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: CFPrefsSearchListSource is fully +initialized
objc[23971]: INITIALIZE: thread 0x1000aa5c0: calling +[CFPrefsPlistSource initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: finished +[CFPrefsPlistSource initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: CFPrefsPlistSource is fully +initialized
objc[23971]: INITIALIZE: thread 0x1000aa5c0: calling +[CFPrefsManagedSource initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: finished +[CFPrefsManagedSource initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: CFPrefsManagedSource is fully +initialized
objc[23971]: INITIALIZE: thread 0x1000aa5c0: calling +[__NSArrayM initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: finished +[__NSArrayM initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: __NSArrayM is fully +initialized
objc[23971]: INITIALIZE: thread 0x1000aa5c0: calling +[OS_xpc_mach_send initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: finished +[OS_xpc_mach_send initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: OS_xpc_mach_send is fully +initialized
objc[23971]: INITIALIZE: thread 0x1000aa5c0: calling +[OS_xpc_uuid initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: finished +[OS_xpc_uuid initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: OS_xpc_uuid is fully +initialized
objc[23971]: INITIALIZE: thread 0x1000aa5c0: calling +[OS_xpc_int64 initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: finished +[OS_xpc_int64 initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: OS_xpc_int64 is fully +initialized
objc[23971]: INITIALIZE: thread 0x1000aa5c0: calling +[OS_voucher initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: finished +[OS_voucher initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: OS_voucher is fully +initialized
objc[23971]: INITIALIZE: thread 0x1000aa5c0: calling +[CFPrefsSuiteSearchListSource initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: finished +[CFPrefsSuiteSearchListSource initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: CFPrefsSuiteSearchListSource is fully +initialized
objc[23971]: INITIALIZE: thread 0x700009500000: calling +[NSData initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: blocking until +[NSData initialize] completes
objc[23971]: INITIALIZE: thread 0x700009500000: finished +[NSData initialize]
objc[23971]: INITIALIZE: thread 0x700009500000: NSData is fully +initialized
objc[23971]: INITIALIZE: thread 0x700009500000: calling +[NSMutableData initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: blocking until +[NSMutableData initialize] completes
objc[23971]: INITIALIZE: thread 0x700009500000: finished +[NSMutableData initialize]
objc[23971]: INITIALIZE: thread 0x700009500000: NSMutableData is fully +initialized
objc[23971]: INITIALIZE: thread 0x700009500000: calling +[__NSCFData initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: blocking until +[__NSCFData initialize] completes
objc[23971]: INITIALIZE: thread 0x700009500000: finished +[__NSCFData initialize]
objc[23971]: INITIALIZE: thread 0x700009500000: __NSCFData is fully +initialized
objc[23971]: INITIALIZE: thread 0x1000aa5c0: calling +[_NSDispatchData initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: finished +[_NSDispatchData initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: _NSDispatchData is fully +initialized
objc[23971]: INITIALIZE: thread 0x700009500000: calling +[NSDate initialize]
objc[23971]: INITIALIZE: thread 0x700009500000: finished +[NSDate initialize]
objc[23971]: INITIALIZE: thread 0x700009500000: NSDate is fully +initialized
objc[23971]: INITIALIZE: thread 0x700009500000: calling +[__NSPlaceholderDate initialize]
objc[23971]: INITIALIZE: thread 0x700009500000: finished +[__NSPlaceholderDate initialize]
objc[23971]: INITIALIZE: thread 0x700009500000: __NSPlaceholderDate is fully +initialized
objc[23971]: INITIALIZE: thread 0x700009500000: calling +[__NSTaggedDate initialize]
objc[23971]: INITIALIZE: thread 0x700009500000: finished +[__NSTaggedDate initialize]
objc[23971]: INITIALIZE: thread 0x700009500000: __NSTaggedDate is fully +initialized
objc[23971]: INITIALIZE: thread 0x700009500000: calling +[__NSDate initialize]
objc[23971]: INITIALIZE: thread 0x700009500000: finished +[__NSDate initialize]
objc[23971]: INITIALIZE: thread 0x700009500000: __NSDate is fully +initialized
objc[23971]: INITIALIZE: thread 0x700009500000: calling +[NSValue initialize]
objc[23971]: INITIALIZE: thread 0x700009500000: calling +[NSNumber initialize]
objc[23971]: INITIALIZE: thread 0x700009500000: finished +[NSNumber initialize]
objc[23971]: INITIALIZE: thread 0x700009500000: class NSNumber will be marked as fully +initialized after superclass +[NSValue initialize] completes
objc[23971]: INITIALIZE: thread 0x700009500000: calling +[NSPlaceholderValue initialize]
objc[23971]: INITIALIZE: thread 0x700009500000: finished +[NSPlaceholderValue initialize]
objc[23971]: INITIALIZE: thread 0x700009500000: class NSPlaceholderValue will be marked as fully +initialized after superclass +[NSNumber initialize] completes
objc[23971]: INITIALIZE: thread 0x700009500000: calling +[NSPlaceholderNumber initialize]
objc[23971]: INITIALIZE: thread 0x700009500000: finished +[NSPlaceholderNumber initialize]
objc[23971]: INITIALIZE: thread 0x700009500000: class NSPlaceholderNumber will be marked as fully +initialized after superclass +[NSPlaceholderValue initialize] completes
objc[23971]: INITIALIZE: thread 0x700009500000: finished +[NSValue initialize]
objc[23971]: INITIALIZE: thread 0x700009500000: NSValue is fully +initialized
objc[23971]: INITIALIZE: thread 0x700009500000: NSNumber is fully +initialized
objc[23971]: INITIALIZE: thread 0x700009500000: NSPlaceholderValue is fully +initialized
objc[23971]: INITIALIZE: thread 0x700009500000: NSPlaceholderNumber is fully +initialized
objc[23971]: INITIALIZE: thread 0x700009500000: calling +[__NSCFNumber initialize]
objc[23971]: INITIALIZE: thread 0x700009500000: finished +[__NSCFNumber initialize]
objc[23971]: INITIALIZE: thread 0x700009500000: __NSCFNumber is fully +initialized
2019-05-01 00:07:04.813693+0800 Initialize_Demo[23971:21942131] ---
objc[23971]: INITIALIZE: thread 0x1000aa5c0: calling +[Person initialize]
2019-05-01 00:07:04.814048+0800 Initialize_Demo[23971:21942131] Person+Work +[Person(Work) initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: finished +[Person initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: Person is fully +initialized
objc[23971]: INITIALIZE: thread 0x1000aa5c0: calling +[Student initialize]
2019-05-01 00:07:04.814168+0800 Initialize_Demo[23971:21942131] Student+School +[Student(School) initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: finished +[Student initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: Student is fully +initialized
2019-05-01 00:07:04.814271+0800 Initialize_Demo[23971:21942131] ---
2019-05-01 00:07:04.814297+0800 Initialize_Demo[23971:21942131] ---
objc[23971]: INITIALIZE: thread 0x1000aa5c0: calling +[Programmer initialize]
2019-05-01 00:07:04.814347+0800 Initialize_Demo[23971:21942131] Person+Work +[Person(Work) initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: finished +[Programmer initialize]
objc[23971]: INITIALIZE: thread 0x1000aa5c0: Programmer is fully +initialized
</code></pre></div><h2 id="å¼€é”€">å¼€é”€</h2>
<p>+initialize æ–¹æ³•ä¸åŒäº +load æ–¹æ³•ï¼Œä¸ä¼šä½¿å¾—ç¨‹åºå°†æ—¶é—´è¿‡å¤šåœ°æµªè´¹åœ¨å¯åŠ¨è¿‡ç¨‹ä¸­ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å°†ä¸€äº›åˆé€‚çš„æ“ä½œä¸‹æ²‰åˆ° +initialize ä¸­å®Œæˆã€‚ä½† +initialize æ˜¯ä»¥é˜»å¡çš„æ–¹å¼è¢«è°ƒç”¨ï¼Œä¹Ÿä¸é€‚åˆåšç‰¹åˆ«å¤šç¹é‡å°¤å…¶æ˜¯å¯èƒ½å¯¼è‡´æ­»é”çš„æ“ä½œã€‚</p>
<h2 id="reference">Reference</h2>
<ul>
<li><a href="/posts/2019/+load_in_ios/">iOS ä¸­çš„ +load æ–¹æ³•</a></li>
</ul>

    </div>
    
      <div class="pagination">
        <div class="pagination__title">
          <span class="pagination__title-h">Read other posts</span>
          <hr />
        </div>
        <div class="pagination__buttons">
          
            <span class="button previous">
              <a href="/posts/2019/url_loading_system/">
                <span class="button__icon">â†</span>
                <span class="button__text">[è¯‘] URL åŠ è½½ç³»ç»Ÿ</span>
              </a>
            </span>
          
          
            <span class="button next">
              <a href="/posts/2019/type_introspection_and_reflection/">
                <span class="button__text">Obj-C &amp; Swift çš„ç±»å‹å†…çœä¸åå°„</span>
                <span class="button__icon">â†’</span>
              </a>
            </span>
          
        </div>
      </div>
    

    

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<table style="border: 0;">
  <tr>
  <td style="border: 0; width: 30%;">
    <img src='/img/about/1.jpg'>
  </td>
  <td style="border: 0;">
    <ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-9925978992661955"
     data-ad-slot="3213735320"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
  </td>
  </tr>
</table>



<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>


    
    
    <div>
      <div id="github-comment">
      </div>

      <script type="text/javascript">
        function getUtterances(isDark) {
          var utterances = document.createElement('script');
          utterances.type = 'text/javascript';
          utterances.async = true;
          utterances.setAttribute('issue-term', "pathname")
          utterances.setAttribute('repo', "kingcos\/kingcos.github.io")
          utterances.setAttribute('label', "comments")
          isDark ? utterances.setAttribute('theme', "github-dark") : utterances.setAttribute('theme', "github-light")
          utterances.crossorigin = 'anonymous';
          utterances.src = 'https://utteranc.es/client.js';

          return utterances
        }

        var themeToggle = document.querySelector(".theme-toggle")
        themeToggle.addEventListener("click", function () {
          var getTheme = window.localStorage && window.localStorage.getItem("theme")
          var divNode = document.getElementById('github-comment')
          while(divNode.hasChildNodes()) {
            divNode.removeChild(divNode.firstChild);
          }
          
          
          

          
          
          
          
          
          
          document.getElementById('github-comment').appendChild(getUtterances(getTheme !== "dark"))
        })

        var getTheme = window.localStorage && window.localStorage.getItem("theme")
        document.getElementById('github-comment').appendChild(getUtterances(getTheme === "dark"))
      </script>
    </div>
    

    </div>

      </div>

      
        <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright copyright--user">All rights reserved by kingcos.me</div>
    
  </div>
</footer>

<script src="/assets/main.js"></script>
<script src="/assets/prism.js"></script>



      
    </div>

    
      
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-138311951-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

    
  </body>
</html>
