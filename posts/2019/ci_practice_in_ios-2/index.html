<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>iOS 项目持续集成实践（二） :: iBlog</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content="Preface 自从「iOS 项目持续集成实践（一）」发布之后，发生了很多事情，原本计划持续更新的系列文章也因此没有更新。这次我将重拾该系列，本篇的围绕核心为「使用 GitLab Runner 搭建 CI」。
What 由于我们目前使用的 Git 托管平台是公司内部的 GitLab EE，所以为了更加容易集成且统一化，选择了 GitLab CI。为了能将 CI 的状态更加好的兼容 GitLab，我们选择了 GitLab Runner 作为容器执行一些代码检查、图片压缩的任务。
How 环境搭建 为了使用 GitLab Runner，我们需要先配置一下环境。因为我们是针对 iOS 项目的 CI，必须使用 macOS 系统的机器，因此我们选择的 CI 机器是一台 Mac Pro，并重装了目前最新版本的 macOS。
   Mac Pro Info     Version Late 2013   Processor 3.5 GHz 6-Core Intel Xeon E5   Memory 16 GB 1866 MHz DDR3   Storage 256 GB Flash Storage   System macOS 10."/>
<meta name="keywords" content=""/>
<meta name="robots" content="noodp"/>
<link rel="canonical" href="/posts/2019/ci_practice_in_ios-2/" />


<link rel="stylesheet" href="/assets/style.css">

  <link rel="stylesheet" href="/assets/green.css">



<link rel="stylesheet" href="/style.css">


<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/img/apple-touch-icon-144-precomposed.png">

<link rel="shortcut icon" href="/img/favicon/favicon.ico">



<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="iOS 项目持续集成实践（二） :: iBlog — " />
<meta name="twitter:description" content="Preface 自从「iOS 项目持续集成实践（一）」发布之后，发生了很多事情，原本计划持续更新的系列文章也因此没有更新。这次我将重拾该系列，本篇的围绕核心为「使用 GitLab Runner 搭建 CI」。
What 由于我们目前使用的 Git 托管平台是公司内部的 GitLab EE，所以为了更加容易集成且统一化，选择了 GitLab CI。为了能将 CI 的状态更加好的兼容 GitLab，我们选择了 GitLab Runner 作为容器执行一些代码检查、图片压缩的任务。
How 环境搭建 为了使用 GitLab Runner，我们需要先配置一下环境。因为我们是针对 iOS 项目的 CI，必须使用 macOS 系统的机器，因此我们选择的 CI 机器是一台 Mac Pro，并重装了目前最新版本的 macOS。
   Mac Pro Info     Version Late 2013   Processor 3.5 GHz 6-Core Intel Xeon E5   Memory 16 GB 1866 MHz DDR3   Storage 256 GB Flash Storage   System macOS 10." />
<meta name="twitter:site" content="/" />
<meta name="twitter:creator" content="" />
<meta name="twitter:image" content="">


<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="iOS 项目持续集成实践（二） :: iBlog — ">
<meta property="og:description" content="Preface 自从「iOS 项目持续集成实践（一）」发布之后，发生了很多事情，原本计划持续更新的系列文章也因此没有更新。这次我将重拾该系列，本篇的围绕核心为「使用 GitLab Runner 搭建 CI」。
What 由于我们目前使用的 Git 托管平台是公司内部的 GitLab EE，所以为了更加容易集成且统一化，选择了 GitLab CI。为了能将 CI 的状态更加好的兼容 GitLab，我们选择了 GitLab Runner 作为容器执行一些代码检查、图片压缩的任务。
How 环境搭建 为了使用 GitLab Runner，我们需要先配置一下环境。因为我们是针对 iOS 项目的 CI，必须使用 macOS 系统的机器，因此我们选择的 CI 机器是一台 Mac Pro，并重装了目前最新版本的 macOS。
   Mac Pro Info     Version Late 2013   Processor 3.5 GHz 6-Core Intel Xeon E5   Memory 16 GB 1866 MHz DDR3   Storage 256 GB Flash Storage   System macOS 10." />
<meta property="og:url" content="/posts/2019/ci_practice_in_ios-2/" />
<meta property="og:site_name" content="iOS 项目持续集成实践（二）" />
<meta property="og:image" content="">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">

<meta property="article:published_time" content="2019-04-17 00:00:00 &#43;0000 UTC" />











</head>
<body class="">


<div class="container center">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="/">
  <div class="logo">
    iBlog
  </div>
</a>

    </div>
    <div class="menu-trigger">menu</div>
  </div>
  
  
    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-138311951-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  

  
    <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/about">About</a></li>
        
      
        
          <li><a href="/links">Links</a></li>
        
      
      
    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/about">About</a></li>
      
    
      
        <li><a href="/links">Links</a></li>
      
    
  </ul>
</nav>

  
</header>


  <div class="content">
    
<div class="post">
  <h1 class="post-title">
    <a href="/posts/2019/ci_practice_in_ios-2/">iOS 项目持续集成实践（二）</a></h1>
  <div class="post-meta">
    <span class="post-date">
      2019-04-17
    </span>
    
  </div>

  
  <span class="post-tags">
    
    #<a href="/tags/practice/">Practice</a>&nbsp;
    
    #<a href="/tags/ios/">iOS</a>&nbsp;
    
    #<a href="/tags/devops/">DevOps</a>&nbsp;
    
  </span>
  

  

  <div class="post-content">
    

<p><img src="/img/2019/CI_Practice_in_iOS-2/0.png" alt="CI in Practice" /></p>

<h2 id="preface">Preface</h2>

<p>自从「iOS 项目持续集成实践（一）」发布之后，发生了很多事情，原本计划持续更新的系列文章也因此没有更新。这次我将重拾该系列，本篇的围绕核心为「使用 GitLab Runner 搭建 CI」。</p>

<h2 id="what">What</h2>

<p>由于我们目前使用的 Git 托管平台是公司内部的 GitLab EE，所以为了更加容易集成且统一化，选择了 GitLab CI。为了能将 CI 的状态更加好的兼容 GitLab，我们选择了 GitLab Runner 作为容器执行一些代码检查、图片压缩的任务。</p>

<h2 id="how">How</h2>

<h3 id="环境搭建">环境搭建</h3>

<p>为了使用 GitLab Runner，我们需要先配置一下环境。因为我们是针对 iOS 项目的 CI，必须使用 macOS 系统的机器，因此我们选择的 CI 机器是一台 Mac Pro，并重装了目前最新版本的 macOS。</p>

<table>
<thead>
<tr>
<th align="center">Mac Pro</th>
<th align="center">Info</th>
</tr>
</thead>

<tbody>
<tr>
<td align="center">Version</td>
<td align="center">Late 2013</td>
</tr>

<tr>
<td align="center">Processor</td>
<td align="center">3.5 GHz 6-Core Intel Xeon E5</td>
</tr>

<tr>
<td align="center">Memory</td>
<td align="center">16 GB 1866 MHz DDR3</td>
</tr>

<tr>
<td align="center">Storage</td>
<td align="center">256 GB Flash Storage</td>
</tr>

<tr>
<td align="center">System</td>
<td align="center">macOS 10.14.4</td>
</tr>
</tbody>
</table>

<h4 id="iterm-optional">iTerm (Optional)</h4>

<p><img src="/img/2019/CI_Practice_in_iOS-2/1.png" alt="" /></p>

<p>为了后续的开发便捷，我安装了习惯使用的 iTerm 替代系统终端，以及 fish shell 替换系统自带的 bash shell。关于 fish shell 的相关配置，可以参考我的「EZConfigs」。</p>

<h4 id="安装-xcode">安装 Xcode</h4>

<p>为了各种开发相关插件能够正常安装，需要安装 Xcode Command Line Tools。Xcode 本身就自带了该工具，因此直接安装 Xcode 即可。我们这里安装的仍然是 Xcode 10.1，这是因为项目中的 Swift 版本仍使用的是 4.2 还未升级到 5.0。为了兼容 Xcode 后续版本，我们可以将 Xcode 的名称改为 Xcode-10.1，这样即可和其他 Xcode 版本共存。</p>

<p><img src="/img/2019/CI_Practice_in_iOS-2/2.png" alt="" /></p>

<p>安装成功后，在 Terminal 执行 <code>xcode-select -p</code> 尝试打印安装的 Xcode 路径。如果未正确输出，可以使用 <code>sudo xcode-select -s /Applications/Xcode-10.1.app</code> 更改。</p>

<h4 id="homebrew">Homebrew</h4>

<p>Homebrew 是 macOS 上必备的软件包管理工具。为了统一管理各种软件，我都会尽量使用 Homebrew 来安装各种软件和包。在 iTerm 中执行以下命令来安装：</p>

<pre><code>/usr/bin/ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&quot;
</code></pre>

<h4 id="安装-gitlab-runner">安装 GitLab Runner</h4>

<p>使用 Homebrew 安装 GitLab Runner：</p>

<pre><code>brew install gitlab-runner
</code></pre>

<p><img src="/img/2019/CI_Practice_in_iOS-2/3.png" alt="" /></p>

<h3 id="配置-runner">配置 Runner</h3>

<p>安装好 GitLab Runner 下面就可以来注册、配置 Runner 了。</p>

<h4 id="注册-runner">注册 Runner</h4>

<p><img src="/img/2019/CI_Practice_in_iOS-2/5.png" alt="" /></p>

<pre><code>sudo gitlab-runner register
</code></pre>

<p>依次输入操作系统账户密码；GitLab URL 和 GitLab CI Token，这两个内容可以打开 GitLab 项目，左侧「Settings」-「CI/CD」-「Runners settings」-「Expand」-「Specific Runners」下方找到（可参考下图）；描述信息，方便在 Runner 页面查看；Tag，多个标签使用 <code>,</code> 分隔，标签可以在后续指定某一确定的 Runner，因此我这里截取了 Mac Pro 序列号的后四位作为区分；执行器（Executor），代表了运行脚本的执行者，由于 iOS 项目比较特殊，无法使用 Docker 等 Linux 容器，所以这里选择 Shell，后续我们将使用 Shell 命令（<code>xcodebuild</code>）来执行 Xcode。</p>

<p><img src="/img/2019/CI_Practice_in_iOS-2/4.png" alt="" /></p>

<p>当我们完成注册后，就可以在 GitLab 上查看到我们刚刚配置的 Runner：</p>

<p><img src="/img/2019/CI_Practice_in_iOS-2/6.png" alt="" /></p>

<p>有时我们可以注意到右侧（箭头）的「Shared Runners」，如果他们并非是符合我们项目的环境，那么需要将该选项关闭，否则可能在分配 Runner 时导致莫名其妙的错误。</p>

<h2 id="reference">Reference</h2>

<ul>
<li><a href="https://maimieng.com/posts/2018/ci_practice_in_ios-1/">iOS 项目持续集成实践（一）- kingcos</a></li>
<li><a href="https://about.gitlab.com/gitlab-ci/#gitlab-runner">GitLab Runner</a></li>
<li><a href="https://github.com/kingcos/EZconfigs">EZconfigs - kingcos</a></li>
</ul>

  </div>
  
  <div class="pagination">
    <div class="pagination__title">
      <span
        class="pagination__title-h">Read other posts</span>
      <hr />
    </div>
    <div class="pagination__buttons">
      
      <span class="button previous">
        <a href="/posts/2019/&#43;load_in_ios/">
          <span class="button__icon">←</span>
          <span class="button__text">iOS 中的 &#43;load 方法</span>
        </a>
      </span>
      
      
      <span class="button next">
        <a href="/posts/2019/category_in_ios/">
          <span class="button__text">iOS 中的 Category</span>
          <span class="button__icon">→</span>
        </a>
      </span>
      
    </div>
  </div>
  

  

    
    
    <div class="post bg-white">
      <script src="https://utteranc.es/client.js"
            repo="kingcos/kingcos.github.io"
            issue-term="pathname"
            label="comments"
            theme="github-dark"
            crossorigin="anonymous"
            async>
      </script>
    </div>
    

</div>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright">
        <span>© 2019 · <a href="http://github.com/kingcos">kingcos</a></span>
      </div>
    
  </div>
</footer>

<script src="/assets/main.js"></script>
<script src="/assets/prism.js"></script>





  
</div>

</body>
</html>
