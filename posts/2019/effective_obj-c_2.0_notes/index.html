<!DOCTYPE html>
<html lang="en">
  <head>
    
      <title>ã€Šç¼–å†™é«˜è´¨é‡ iOS ä¸ OS X ä»£ç çš„ 52 ä¸ªæœ‰æ•ˆæ–¹æ³•ã€‹é˜…è¯»ç¬”è®° :: iBlog</title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content="Book ISBN Notes     ã€Šç¼–å†™é«˜è´¨é‡ iOS ä¸ OS X ä»£ç çš„ 52 ä¸ªæœ‰æ•ˆæ–¹æ³•ã€‹ 9787111451297 ã€ŠEffective Objective-C 2.0ã€‹   Date Num. Xcode   2019-05 1-3 10.2.1   2019-06 4 10.2.1   2019-07 5-12 10.2.1   2019-10 13-20 11.1 &amp;amp; 11.2   2019-11 20-52 11.1 &amp;amp; 11.2    Preface ã€Šç¼–å†™é«˜è´¨é‡ iOS ä¸ OS X ä»£ç çš„ 52 ä¸ªæœ‰æ•ˆæ–¹æ³•ã€‹åŸè‘—åä¸ºã€ŠEffective Objective-C 2.0ã€‹ï¼Œæ˜¯ç±»ä¼¼ç¬”è€…è¿™æ ·çš„ iOS åˆçº§å…¥é—¨è€…å¿…è¯»ä¹¦ç›®ä¹‹ä¸€ã€‚æœ¬æ–‡ä¸ä»…æ˜¯æ­¤ä¹¦çš„é˜…è¯»ç¬”è®°ï¼Œä¹Ÿæœ‰ Demo ä»£ç ç­‰ï¼Œè¾ƒä¸ºç‹¬ç«‹çš„ç¯‡ç« å†…å®¹åˆ™èå…¥ç¬”è€…ä»¥å¾€çš„ç‹¬ç«‹æ–‡ç« ä¸­ã€‚"/>
<meta name="keywords" content="kingcos.me,maimieng.comios,swift,objective-c,obj-c,objc,oc,geek,python,ruby,golang,go,apple,mac"/>
<meta name="robots" content="noodp"/>
<link rel="canonical" href="/posts/2019/effective_obj-c_2.0_notes/" />





<link rel="stylesheet" href="/assets/style.css">


<link rel="stylesheet" href="/style.css">


<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/img/apple-touch-icon-144-precomposed.png">
<link rel="shortcut icon" href="/img/favicon.png">


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="ã€Šç¼–å†™é«˜è´¨é‡ iOS ä¸ OS X ä»£ç çš„ 52 ä¸ªæœ‰æ•ˆæ–¹æ³•ã€‹é˜…è¯»ç¬”è®°"/>
<meta name="twitter:description" content="ã€Šç¼–å†™é«˜è´¨é‡ iOS ä¸ OS X ä»£ç çš„ 52 ä¸ªæœ‰æ•ˆæ–¹æ³•ã€‹åŸè‘—åä¸ºã€ŠEffective Objective-C 2.0ã€‹ï¼Œæ˜¯ç±»ä¼¼ç¬”è€…è¿™æ ·çš„ iOS åˆçº§å…¥é—¨è€…å¿…è¯»ä¹¦ç›®ä¹‹ä¸€ã€‚æœ¬æ–‡ä¸ä»…æ˜¯æ­¤ä¹¦çš„é˜…è¯»ç¬”è®°ï¼Œä¹Ÿæœ‰ Demo ä»£ç ç­‰ï¼Œè¾ƒä¸ºç‹¬ç«‹çš„ç¯‡ç« å†…å®¹åˆ™èå…¥ç¬”è€…çš„ç‹¬ç«‹æ–‡ç« ä¸­ã€‚"/>



<meta property="og:title" content="ã€Šç¼–å†™é«˜è´¨é‡ iOS ä¸ OS X ä»£ç çš„ 52 ä¸ªæœ‰æ•ˆæ–¹æ³•ã€‹é˜…è¯»ç¬”è®°" />
<meta property="og:description" content="ã€Šç¼–å†™é«˜è´¨é‡ iOS ä¸ OS X ä»£ç çš„ 52 ä¸ªæœ‰æ•ˆæ–¹æ³•ã€‹åŸè‘—åä¸ºã€ŠEffective Objective-C 2.0ã€‹ï¼Œæ˜¯ç±»ä¼¼ç¬”è€…è¿™æ ·çš„ iOS åˆçº§å…¥é—¨è€…å¿…è¯»ä¹¦ç›®ä¹‹ä¸€ã€‚æœ¬æ–‡ä¸ä»…æ˜¯æ­¤ä¹¦çš„é˜…è¯»ç¬”è®°ï¼Œä¹Ÿæœ‰ Demo ä»£ç ç­‰ï¼Œè¾ƒä¸ºç‹¬ç«‹çš„ç¯‡ç« å†…å®¹åˆ™èå…¥ç¬”è€…çš„ç‹¬ç«‹æ–‡ç« ä¸­ã€‚" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/2019/effective_obj-c_2.0_notes/" />
<meta property="article:published_time" content="2019-11-24T00:00:00+00:00" />
<meta property="article:modified_time" content="2019-11-24T00:00:00+00:00" /><meta property="og:site_name" content="iBlog" />




<script data-ad-client="ca-pub-9925978992661955" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

  </head>
  <body class="dark-theme">
    <div class="container">
      <header class="header">
  <span class="header__inner">
    <a href="/" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367"/>
</svg>
</span>
    <span class="logo__text">kingcos.me</span>
    <span class="logo__cursor"></span>
  
</a>

    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/about">About</a></li>
        
      
        
          <li><a href="/links">Links</a></li>
        
      
        
          <li><a href="/perspective">Perspective</a></li>
        
      
        
          <li><a href="/words">Words</a></li>
        
      
      
    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/about">About</a></li>
      
    
      
        <li><a href="/links">Links</a></li>
      
    
      
        <li><a href="/perspective">Perspective</a></li>
      
    
      
        <li><a href="/words">Words</a></li>
      
    
  </ul>
</nav>

        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none"/>
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
          </svg>
        </span>
      
      <span class="theme-toggle">
        <svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>

      </span>
    </span>
  </span>
</header>


      <div class="content">
        
  <div class="post">
    <h2 class="post-title"><a href="/posts/2019/effective_obj-c_2.0_notes/">ã€Šç¼–å†™é«˜è´¨é‡ iOS ä¸ OS X ä»£ç çš„ 52 ä¸ªæœ‰æ•ˆæ–¹æ³•ã€‹é˜…è¯»ç¬”è®°</a></h2>
    <div class="post-meta">
      
        <span class="post-date">
            2019-11-24
        </span>
      
      
      
        <span class="post-read-time">â€” 29 min read</span>
      
    </div>

    
      <span class="post-tags">
        
          #<a href="/tags/read/">Read</a>&nbsp;
        
          #<a href="/tags/ios/">iOS</a>&nbsp;
        
          #<a href="/tags/obj-c/">Obj-C</a>&nbsp;
        
          #<a href="/tags//">ğŸš§</a>&nbsp;
        
      </span>
    

    

    <div class="post-content">
      <table>
<thead>
<tr>
<th align="center">Book</th>
<th align="center">ISBN</th>
<th align="center">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">ã€Šç¼–å†™é«˜è´¨é‡ iOS ä¸ OS X ä»£ç çš„ 52 ä¸ªæœ‰æ•ˆæ–¹æ³•ã€‹</td>
<td align="center">9787111451297</td>
<td align="center">ã€ŠEffective Objective-C 2.0ã€‹</td>
</tr>
<tr>
<td align="center"><strong>Date</strong></td>
<td align="center"><strong>Num.</strong></td>
<td align="center"><strong>Xcode</strong></td>
</tr>
<tr>
<td align="center">2019-05</td>
<td align="center">1-3</td>
<td align="center">10.2.1</td>
</tr>
<tr>
<td align="center">2019-06</td>
<td align="center">4</td>
<td align="center">10.2.1</td>
</tr>
<tr>
<td align="center">2019-07</td>
<td align="center">5-12</td>
<td align="center">10.2.1</td>
</tr>
<tr>
<td align="center">2019-10</td>
<td align="center">13-20</td>
<td align="center">11.1 &amp; 11.2</td>
</tr>
<tr>
<td align="center">2019-11</td>
<td align="center">20-52</td>
<td align="center">11.1 &amp; 11.2</td>
</tr>
</tbody>
</table>
<h2 id="preface">Preface</h2>
<p>ã€Šç¼–å†™é«˜è´¨é‡ iOS ä¸ OS X ä»£ç çš„ 52 ä¸ªæœ‰æ•ˆæ–¹æ³•ã€‹åŸè‘—åä¸ºã€ŠEffective Objective-C 2.0ã€‹ï¼Œæ˜¯ç±»ä¼¼ç¬”è€…è¿™æ ·çš„ iOS åˆçº§å…¥é—¨è€…å¿…è¯»ä¹¦ç›®ä¹‹ä¸€ã€‚æœ¬æ–‡ä¸ä»…æ˜¯æ­¤ä¹¦çš„é˜…è¯»ç¬”è®°ï¼Œä¹Ÿæœ‰ Demo ä»£ç ç­‰ï¼Œè¾ƒä¸ºç‹¬ç«‹çš„ç¯‡ç« å†…å®¹åˆ™èå…¥ç¬”è€…ä»¥å¾€çš„ç‹¬ç«‹æ–‡ç« ä¸­ã€‚</p>
<h2 id="-objective-c">ç†Ÿæ‚‰ Objective-C</h2>
<h3 id="-objective-c-">äº†è§£ Objective-C è¯­è¨€çš„èµ·æº</h3>
<p>æ¶ˆæ¯ç»“æ„ï¼ˆMessage Structureï¼‰çš„è¯­è¨€ï¼Œè¿è¡Œæ—¶æ‰§è¡Œçš„ä»£ç ç”±è¿è¡Œç¯å¢ƒå†³å®šï¼›å‡½æ•°è°ƒç”¨ï¼ˆFunction Callingï¼‰çš„è¯­è¨€ï¼Œè¿è¡Œæ—¶æ‰€æ‰§è¡Œçš„ä»£ç ç”±ç¼–è¯‘å™¨å†³å®šï¼Œå¯¹äºå¤šæ€ï¼Œåˆ™æŒ‰ç…§è™šå‡½æ•°è¡¨ï¼ˆVirtual Method Tableï¼‰å¯»æ‰¾ã€‚</p>
<p>è¿è¡Œæ—¶ç»„ä»¶ï¼ˆRuntime Componentï¼‰ æœ¬è´¨ä¸Šæ˜¯ä¸€ç§ä¸å¼€å‘è€…æ‰€ç¼–å†™ä»£ç ç›¸é“¾æ¥çš„ã€ŒåŠ¨æ€åº“ï¼ˆDynamic Libraryï¼‰ï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯åªéœ€è¦æ›´æ–°è¿è¡Œæ—¶ç»„ä»¶ï¼ˆæ— éœ€é‡æ–°ç¼–è¯‘ï¼‰å³å¯æå‡ç¨‹åºæ€§èƒ½ã€‚</p>
<p>Obj-C æ˜¯ C çš„è¶…é›†ï¼›Obj-C ä¸­çš„å¯¹è±¡æ‰€å å†…å­˜æ€»æ˜¯åˆ†é…åœ¨å †ç©ºé—´ï¼ˆHeap Spaceï¼‰ï¼›è€ŒæŒ‡å‘å¯¹è±¡çš„æŒ‡é’ˆæ‰€å å†…å­˜æ€»æ˜¯åˆ†é…åœ¨æ ˆå¸§ï¼ˆStack Frameï¼‰ä¸­ï¼›å †ä¸­çš„å†…å­˜éœ€è¦ç¨‹åºå‘˜è‡ªå·±ç®¡ç†ï¼Œæ ˆä¸­çš„å†…å­˜ä¼šåœ¨å…¶æ ˆå¸§å¼¹å‡ºï¼ˆPopï¼‰æ—¶è‡ªåŠ¨æ¸…ç†ï¼›åˆ›å»ºå¯¹è±¡ç›¸æ¯”åˆ›å»ºç»“æ„ä½“ï¼ˆC ç»“æ„ä½“ï¼‰éœ€è¦é¢å¤–å¼€é”€ï¼Œä¾‹å¦‚åˆ†é…å’Œé‡Šæ”¾å †å†…å­˜ç­‰ã€‚</p>
<p><img src="/img/2019/effective_obj-c_2.0_notes/1.png" alt="1"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec"><span style="color:#75715e">// âš ï¸ ç”±äº Obj-C ä¸­çš„å­—ç¬¦ä¸²ï¼ˆNSStringï¼‰ç•¥æœ‰ç‰¹æ®Šï¼Œæ­¤å¤„å¹¶æœªä½¿ç”¨ä¹¦ä¸­çš„ NSString ä½œä¸ºèŒƒä¾‹
</span><span style="color:#75715e"></span><span style="color:#75715e">// å¯¹è±¡æœ¬èº«è¢«åˆ†é…åœ¨å †ä¸Šï¼›obj1 &amp; obj2 è¢«åˆ†é…åœ¨æ ˆä¸Š
</span><span style="color:#75715e"></span>NSObject <span style="color:#f92672">*</span>obj1 <span style="color:#f92672">=</span> [[NSObject alloc] init];
NSObject <span style="color:#f92672">*</span>obj2 <span style="color:#f92672">=</span> obj1;

<span style="color:#75715e">// (lldb) p obj1
</span><span style="color:#75715e"></span><span style="color:#75715e">// (NSObject *) $0 = 0x00000001005092b0
</span><span style="color:#75715e"></span><span style="color:#75715e">// (lldb) p obj2
</span><span style="color:#75715e"></span><span style="color:#75715e">// (NSObject *) $1 = 0x00000001005092b0
</span><span style="color:#75715e"></span><span style="color:#75715e">// (lldb) p &amp;obj1
</span><span style="color:#75715e"></span><span style="color:#75715e">// (NSObject **) $2 = 0x00007ffeefbff508
</span><span style="color:#75715e"></span><span style="color:#75715e">// (lldb) p &amp;obj2
</span><span style="color:#75715e"></span><span style="color:#75715e">// (NSObject **) $3 = 0x00007ffeefbff500
</span></code></pre></div><h3 id="heading">åœ¨ç±»çš„å¤´æ–‡ä»¶ä¸­å°½é‡å°‘å¼•å…¥å…¶ä»–å¤´æ–‡ä»¶</h3>
<p>å½“éœ€è¦çŸ¥é“æœ‰ä¸€ä¸ªç±»çš„å­˜åœ¨æ—¶ï¼Œè€Œä¸å…³å¿ƒå…¶å†…éƒ¨ç»†èŠ‚æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å‘å‰å£°æ˜ï¼ˆForward Declaringï¼‰å‘ŠçŸ¥ç¼–è¯‘å™¨ï¼Œå³å¯ä»¥åœ¨ .hï¼ˆå¤´æ–‡ä»¶ï¼‰ä¸­ <code>@class SomeClass</code>ï¼›è€Œåœ¨ .mï¼ˆå®ç°æ–‡ä»¶ï¼‰ä¸­å¼•å…¥å®é™…çš„ .hï¼›å½“åœ¨ä¸¤ä¸ªå¤´æ–‡ä»¶ä¸­äº’ç›¸å¼•å…¥å¯¹æ–¹ï¼Œåˆ™ä¼šå¯¼è‡´ã€Œå¾ªç¯ å¼•ç”¨ï¼ˆChicken-Egg Situationï¼Œåˆç§°äº¤å‰å¼•ç”¨ï¼‰ã€ï¼Œæ— æ³•é€šè¿‡ç¼–è¯‘ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec"><span style="color:#75715e">// A.h
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#</span><span style="color:#75715e">import &lt;Foundation</span><span style="color:#75715e">/</span><span style="color:#75715e">Foundation.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">import &#34;B.h&#34; </span><span style="color:#75715e">// -&gt; @class B;
</span><span style="color:#75715e"></span>
NS_ASSUME_NONNULL_BEGIN

<span style="color:#66d9ef">@interface</span> <span style="color:#a6e22e">A</span> : <span style="color:#a6e22e">NSObject</span>

<span style="color:#66d9ef">@end</span>

NS_ASSUME_NONNULL_END

<span style="color:#75715e">// B.h
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#</span><span style="color:#75715e">import &lt;Foundation</span><span style="color:#75715e">/</span><span style="color:#75715e">Foundation.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">import &#34;A.h&#34;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
NS_ASSUME_NONNULL_BEGIN

<span style="color:#75715e">// ERORR: Cannot find interface declaration for &#39;A&#39;, superclass of &#39;B&#39;
</span><span style="color:#75715e"></span><span style="color:#66d9ef">@interface</span> <span style="color:#a6e22e">B</span> : <span style="color:#a6e22e">A</span>

<span style="color:#66d9ef">@end</span>

NS_ASSUME_NONNULL_END
</code></pre></div><p>å°†å¼•å…¥å¤´æ–‡ä»¶çš„æ—¶æœºå°½é‡å»¶åï¼Œåªæœ‰åœ¨ç¡®å®šæœ‰éœ€è¦æ—¶æ‰å¼•å…¥ï¼Œå¦åˆ™ä¼šå¢åŠ è€¦åˆåº¦ã€æ‹‰é•¿ç¼–è¯‘æ—¶é—´ã€äº§ç”Ÿç›¸äº’ä¾èµ–ç­‰é—®é¢˜ã€‚</p>
<p>ç»§æ‰¿çˆ¶ç±»å’Œéµå¾ªåè®®åˆ™ä¸èƒ½ä½¿ç”¨å‘å‰å£°æ˜ï¼Œå¿…é¡»å¼•å…¥ç›¸åº”çš„å¤´æ–‡ä»¶ï¼Œå› æ­¤åè®®æœ€å¥½å£°æ˜åœ¨å•ç‹¬çš„å¤´æ–‡ä»¶ä¸­ï¼›ç”±äºä»£ç†åè®®ï¼ˆDelegate Protocolï¼‰å’Œéµå®ˆåè®®ä»£ç†çš„ç±»å£°æ˜åœ¨ä¸€èµ·æ—¶æ‰æœ‰æ„ä¹‰ï¼Œæœ€å¥½åœ¨å®ç°æ–‡ä»¶ä¸­å£°æ˜ç±»éµå®ˆäº†è¯¥ä»£ç†åè®®ï¼Œå¹¶å°†å®ç°ä»£ç æ”¾åœ¨ç±»æ‰©å±•ä¸­ï¼›å› æ­¤åªéœ€è¦åœ¨å®ç°æ–‡ä»¶ä¸­å¼•å…¥åŒ…å«ä»£ç†åè®®çš„å¤´æ–‡ä»¶å³å¯ï¼Œè€Œä¸éœ€è¦å°†å…¶æ”¾åœ¨å…¬å…±å¤´æ–‡ä»¶ï¼ˆPublic Header Fileï¼‰ä¸­ã€‚</p>
<h3 id="heading-1">å¤šç”¨å­—é¢é‡è¯­æ³•ï¼Œå°‘ç”¨ä¸ä¹‹ç­‰ä»·çš„æ–¹æ³•</h3>
<p>å­—é¢é‡ï¼ˆLiteralï¼‰è¯­æ³•ç®€åŒ–äº† Obj-C çš„éƒ¨åˆ† APIï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec">NSString <span style="color:#f92672">*</span>strValue <span style="color:#f92672">=</span> <span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">str</span><span style="color:#e6db74">&#34;</span>;
NSNumber <span style="color:#f92672">*</span>intValue <span style="color:#f92672">=</span> <span style="color:#ae81ff">@1</span>;
NSNumber <span style="color:#f92672">*</span>doubleValue <span style="color:#f92672">=</span> <span style="color:#ae81ff">@3.14</span>;
NSArray <span style="color:#f92672">*</span>arrValue <span style="color:#f92672">=</span> <span style="color:#ae81ff">@[</span><span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">a</span><span style="color:#e6db74">&#34;</span>, <span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;</span>, <span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">c</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">]</span>;
NSString <span style="color:#f92672">*</span>firstValueForArr <span style="color:#f92672">=</span> arrValue[<span style="color:#ae81ff">0</span>];
<span style="color:#75715e">// âš ï¸ å­—é¢é‡åˆ›å»ºçš„æ•°ç»„ã€å­—å…¸éƒ½æ˜¯ä¸å¯å˜çš„
</span><span style="color:#75715e"></span>NSMutableArray <span style="color:#f92672">*</span>mutableArrValue <span style="color:#f92672">=</span> [<span style="color:#ae81ff">@[</span><span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">a</span><span style="color:#e6db74">&#34;</span>, <span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;</span>, <span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">c</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">]</span> mutableCopy];
mutableArrValue[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">kingcos.me</span><span style="color:#e6db74">&#34;</span>;
NSDictionary <span style="color:#f92672">*</span>dictValue <span style="color:#f92672">=</span> <span style="color:#ae81ff">@{</span><span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">key</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">:</span> <span style="color:#ae81ff">@100</span><span style="color:#ae81ff">}</span>;
NSNumber <span style="color:#f92672">*</span>valueForDictByKey  <span style="color:#f92672">=</span> dictValue[<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">key</span><span style="color:#e6db74">&#34;</span>];
NSMutableDictionary <span style="color:#f92672">*</span>mutableDictValue <span style="color:#f92672">=</span> [<span style="color:#ae81ff">@{</span><span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">key</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">:</span> <span style="color:#ae81ff">@100</span><span style="color:#ae81ff">}</span> mutableCopy];
mutableDictValue[<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">key</span><span style="color:#e6db74">&#34;</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">@200</span>;
</code></pre></div><p>å­—é¢é‡è¯­æ³•åœ¨ <code>NSArray</code>ã€<code>NSDictionary</code> ç­‰ç±»ä¸­æ’å…¥ <code>nil</code> å¯¹è±¡æ—¶ä¼šç›´æ¥å´©æºƒï¼Œè€Œç›´æ¥ä½¿ç”¨ API åˆ™ä¼šå‘ç”Ÿã€Œæˆªæ–­ã€ï¼Œå¯¹äºè¿™ä¸¤ä¸ªç”¨æ³•å·®å¼‚åŠ¡å¿…è¦æ³¨æ„ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec"><span style="color:#66d9ef">id</span> nilObj <span style="color:#f92672">=</span> nil;
<span style="color:#75715e">// *** -[__NSPlaceholderArray initWithObjects:count:]: attempt to insert nil object from objects[3]
</span><span style="color:#75715e"></span>NSArray <span style="color:#f92672">*</span>arrWithNilObject1 <span style="color:#f92672">=</span> <span style="color:#ae81ff">@[</span><span style="color:#ae81ff">@0</span>, nilObj, <span style="color:#ae81ff">@2</span><span style="color:#ae81ff">]</span>;
<span style="color:#75715e">// (0)
</span><span style="color:#75715e"></span>NSArray <span style="color:#f92672">*</span>arrWithNilObject2 <span style="color:#f92672">=</span> [NSArray arrayWithObjects:<span style="color:#ae81ff">@0</span>, nil, <span style="color:#ae81ff">@2</span>, nil];
<span style="color:#75715e">// *** -[__NSPlaceholderDictionary initWithObjects:forKeys:count:]: attempt to insert nil object from objects[0]
</span><span style="color:#75715e"></span>NSDictionary <span style="color:#f92672">*</span>dictWithNilObject1 <span style="color:#f92672">=</span> <span style="color:#ae81ff">@{</span><span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">a</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">A</span><span style="color:#e6db74">&#34;</span>, <span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">:</span> nilObj, <span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">c</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">C</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">}</span>;
<span style="color:#75715e">// { a = A; }
</span><span style="color:#75715e"></span>NSDictionary <span style="color:#f92672">*</span>dictWithNilObject2 <span style="color:#f92672">=</span> [NSDictionary dictionaryWithObjectsAndKeys:<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">A</span><span style="color:#e6db74">&#34;</span>, <span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">a</span><span style="color:#e6db74">&#34;</span>, nilObj, <span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;</span>, <span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">C</span><span style="color:#e6db74">&#34;</span>, <span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">c</span><span style="color:#e6db74">&#34;</span>, nil];
</code></pre></div><p>é™¤äº†å­—ç¬¦ä¸²ï¼Œå­—é¢é‡è¯­æ³•ä»…é€‚ç”¨äº Foundation æ¡†æ¶ä¸­ï¼Œå³æˆ‘ä»¬è‡ªå®šä¹‰ç»§æ‰¿è‡ªä¸Šè¿°æ”¯æŒå­—é¢é‡çš„ç±»æ—¶ï¼Œå°†ä¸å†æ”¯æŒä½¿ç”¨å­—é¢é‡ã€‚</p>
<h3 id="-define-">å¤šç”¨ç±»å‹å¸¸é‡ï¼Œå°‘ç”¨ #define é¢„å¤„ç†æŒ‡ä»¤</h3>
<p><code>#define</code> é¢„å¤„ç†æŒ‡ä»¤æ²¡æœ‰ç±»å‹ä¿¡æ¯ï¼Œä¸”ä¼šåœ¨å¼•ç”¨åˆ°åŒ…å«è¯¥æŒ‡ä»¤çš„æ‰€æœ‰æ–‡ä»¶ä¸­è¿›è¡Œæ›¿æ¢ï¼Œå› æ­¤æ›´åŠ æ¨èä½¿ç”¨ç±»å‹å¸¸é‡ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec"><span style="color:#75715e">// é¢„å¤„ç†æŒ‡ä»¤ï¼ˆç¼–è¯‘å‰è¿›è¡Œç›´æ¥æ›¿æ¢ï¼‰
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">define ANIMATION_DURATION 0.3</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// Some.m
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// ç±»å‹å¸¸é‡
</span><span style="color:#75715e"></span><span style="color:#75715e">// const å†³å®šäº†å…¶ä¸ºå¸¸é‡ï¼Œä¸å¯è¢«å†æ¬¡æ”¹å˜
</span><span style="color:#75715e"></span><span style="color:#75715e">// static å†³å®šäº†å…¶ä½œç”¨åŸŸï¼Œå³å½“å‰æ–‡ä»¶ï¼ˆå› æ­¤å¦‚æœå°†å…¶å®šä¹‰åœ¨ *.h ä¸­ï¼Œå…¶å®ƒå¼•å…¥è¯¥å¤´æ–‡ä»¶çš„æ–‡ä»¶ä¹Ÿå¯ä»¥è®¿é—®åˆ°ï¼‰
</span><span style="color:#75715e"></span><span style="color:#66d9ef">static</span> <span style="color:#66d9ef">const</span> NSTimeInterval kAnimationDuration <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.3</span>;

<span style="color:#75715e">// å¦‚æœä¸ä½¿ç”¨ static ä¿®é¥°ï¼Œç¼–è¯‘å™¨ä¼šåˆ›å»ºä¸€ä¸ªå¤–éƒ¨ç¬¦å·ï¼ˆExternal Symbolsï¼‰
</span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> NSTimeInterval SomeAnimationDuration <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.3</span>;
<span style="color:#75715e">// æ­¤æ—¶å¦‚æœåœ¨å…¶å®ƒæ–‡ä»¶å†…å£°æ˜åŒåå¸¸é‡ï¼Œåˆ™ä¼šæŠ¥é”™ã€Œduplicate symbolã€
</span><span style="color:#75715e"></span><span style="color:#75715e">// Another.m
</span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> NSTimeInterval SomeAnimationDuration <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5</span>;

<span style="color:#75715e">// ---
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// main.m
</span><span style="color:#75715e"></span><span style="color:#75715e">// å£°æ˜ä¸º `static` å’Œ `const` çš„å˜é‡ï¼Œç¼–è¯‘å™¨ä¸ä¼šä¸ºå…¶å†åˆ›å»ºç¬¦å·
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">import &lt;Foundation</span><span style="color:#75715e">/</span><span style="color:#75715e">Foundation.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">int</span> foo <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;

<span style="color:#75715e">// static const + int
</span><span style="color:#75715e"></span><span style="color:#66d9ef">static</span> <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">int</span> k1 <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
<span style="color:#75715e">// static const + int *
</span><span style="color:#75715e"></span><span style="color:#75715e">// å¯¹äºæŒ‡é’ˆï¼Œæ—¢è¦ä½¿å…¶æœ¬èº«çš„å†…å®¹ä¸èƒ½æ”¹å˜ï¼Œä¹Ÿä¸èƒ½æ”¹å˜å…¶æŒ‡å‘çš„å†…å­˜åœ°å€ï¼Œå¦åˆ™è¿™ä¸ªæŒ‡é’ˆè¿˜æ˜¯æœ‰å¯èƒ½æ”¹å˜çš„
</span><span style="color:#75715e"></span><span style="color:#66d9ef">static</span> <span style="color:#66d9ef">int</span> <span style="color:#66d9ef">const</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">const</span> k2 <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>foo;
<span style="color:#75715e">// static const + NSString *
</span><span style="color:#75715e"></span><span style="color:#66d9ef">static</span> NSString <span style="color:#f92672">*</span> <span style="color:#66d9ef">const</span> k3 <span style="color:#f92672">=</span> <span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">&#34;</span>;
<span style="color:#66d9ef">static</span> NSString <span style="color:#66d9ef">const</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">const</span> k4 <span style="color:#f92672">=</span> <span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">&#34;</span>;

<span style="color:#75715e">// const
</span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">int</span> k5 <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>;
<span style="color:#75715e">// static
</span><span style="color:#75715e"></span><span style="color:#66d9ef">static</span> <span style="color:#66d9ef">int</span> k6 <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>;

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span> argv[]) {
    <span style="color:#66d9ef">@autoreleasepool</span> {
        <span style="color:#75715e">// ä¸ºäº†é˜²æ­¢ç¼–è¯‘å™¨ä¼˜åŒ–æœªç”¨åˆ°çš„ç¬¦å·ï¼Œæˆ‘ä»¬è¿™é‡Œç®€å•è¾“å‡ºä»¥ä¸Šå®šä¹‰çš„å˜é‡
</span><span style="color:#75715e"></span>        NSLog(<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">%d</span><span style="color:#e6db74">&#34;</span>, k1);
        NSLog(<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">%d</span><span style="color:#e6db74">&#34;</span>, <span style="color:#f92672">*</span>k2);
        NSLog(<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">%@</span><span style="color:#e6db74">&#34;</span>, k3);
        NSLog(<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">%@</span><span style="color:#e6db74">&#34;</span>, k4);
        NSLog(<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">%d</span><span style="color:#e6db74">&#34;</span>, k5);
        NSLog(<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">%d</span><span style="color:#e6db74">&#34;</span>, k6);
    }
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
}

<span style="color:#75715e">// è¾“å‡ºæ‰€æœ‰ç¬¦å·
</span><span style="color:#75715e"></span><span style="color:#75715e">// âœ  Debug nm -C Demo
</span><span style="color:#75715e"></span><span style="color:#75715e">// é€šè¿‡ä»¥ä¸‹è¾“å‡ºå¯ä»¥å¾—å‡ºç”± static å’Œ const ä¿®é¥°çš„ k1ï¼Œk2 ç¼–è¯‘å™¨éƒ½æ²¡æœ‰ä¸ºå…¶äº§ç”Ÿç¬¦å·
</span><span style="color:#75715e"></span><span style="color:#75715e">// ä½† NSString * æ˜¯ä¸ªä¾‹å¤–ï¼ˆWhy? çŒœæµ‹æ˜¯ç¼–è¯‘å™¨è®¤ä¸ºè¯¥å¸¸é‡åç»­è¿˜è¦è¢«ä¿®æ”¹çš„å¯èƒ½ï¼Œå› æ­¤éœ€è¦ä¿ç•™å…¶ç¬¦å·ï¼‰
</span><span style="color:#75715e"></span><span style="color:#75715e">//                  U _NSLog
</span><span style="color:#75715e"></span><span style="color:#75715e">//                  U ___CFConstantStringClassReference
</span><span style="color:#75715e"></span><span style="color:#75715e">// 0000000100000000 T __mh_execute_header
</span><span style="color:#75715e"></span><span style="color:#75715e">// 00000001000010a0 D _foo
</span><span style="color:#75715e"></span><span style="color:#75715e">// 0000000100001028 s _k3
</span><span style="color:#75715e"></span><span style="color:#75715e">// 0000000100001030 s _k4
</span><span style="color:#75715e"></span><span style="color:#75715e">// 0000000100000fb4 S _k5
</span><span style="color:#75715e"></span><span style="color:#75715e">// 00000001000010a4 d _k6
</span><span style="color:#75715e"></span><span style="color:#75715e">// 0000000100000eb0 T _main
</span><span style="color:#75715e"></span><span style="color:#75715e">//                  U _objc_autoreleasePoolPop
</span><span style="color:#75715e"></span><span style="color:#75715e">//                  U _objc_autoreleasePoolPush
</span><span style="color:#75715e"></span><span style="color:#75715e">//                  U dyld_stub_binder
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// ä»…è¾“å‡ºå¤–éƒ¨ç¬¦å·
</span><span style="color:#75715e"></span><span style="color:#75715e">// âœ  Debug nm -gC Demo
</span><span style="color:#75715e"></span><span style="color:#75715e">// æ‰€æœ‰ä½¿ç”¨ static ä¿®é¥°çš„å˜é‡å‡ä¸åœ¨å¤–éƒ¨ç¬¦å·ä¸­ï¼Œè¯´æ˜ static å°†è¿™äº›ç¬¦å·çš„ä½œç”¨åŸŸé™åˆ¶åœ¨å½“å‰æ–‡ä»¶ä¸­
</span><span style="color:#75715e"></span><span style="color:#75715e">//                  U _NSLog
</span><span style="color:#75715e"></span><span style="color:#75715e">//                  U ___CFConstantStringClassReference
</span><span style="color:#75715e"></span><span style="color:#75715e">// 0000000100000000 T __mh_execute_header
</span><span style="color:#75715e"></span><span style="color:#75715e">// 00000001000010a0 D _foo
</span><span style="color:#75715e"></span><span style="color:#75715e">// 0000000100000fb4 S _k5
</span><span style="color:#75715e"></span><span style="color:#75715e">// 0000000100000eb0 T _main
</span><span style="color:#75715e"></span><span style="color:#75715e">//                  U _objc_autoreleasePoolPop
</span><span style="color:#75715e"></span><span style="color:#75715e">//                  U _objc_autoreleasePoolPush
</span><span style="color:#75715e"></span><span style="color:#75715e">//                  U dyld_stub_binder
</span></code></pre></div><p>ç±»å‹å¸¸é‡çš„å‘½åè§„åˆ™ï¼š</p>
<ul>
<li>è‹¥å¸¸é‡å±€é™äºæŸä¸ªç¼–è¯‘å•å…ƒï¼ˆTranslation Unitï¼Œå³å®ç°æ–‡ä»¶ <code>*.m</code>ï¼‰ï¼Œåˆ™éœ€è¦ä»¥å°å†™å­—æ¯ <code>k</code> å¼€å¤´ï¼›</li>
<li>è‹¥å¸¸é‡åœ¨ç±»ä¹‹å¤–ä¹Ÿå¯è§ï¼Œåˆ™é€šå¸¸éœ€è¦ä»¥ç±»åå¼€å¤´ã€‚</li>
</ul>
<p>å…³äº <code>nm</code> å‘½ä»¤çš„åŸºæœ¬ä½¿ç”¨ï¼Œå¯ä»¥å‚è€ƒ <a href="../ivar_access_control_in_obj-c/">Obj-C ä¸­å®ä¾‹å˜é‡å’Œç±»çš„è®¿é—®æ§åˆ¶</a>ä¸€æ–‡ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec"><span style="color:#75715e">// Some.h
</span><span style="color:#75715e"></span><span style="color:#75715e">// extern å‘ŠçŸ¥ç¼–è¯‘å™¨å…¨å±€ç¬¦å·è¡¨ä¸­å­˜åœ¨è¯¥ç¬¦å·ï¼Œå…è®¸å¤–ç•Œä½¿ç”¨
</span><span style="color:#75715e"></span><span style="color:#66d9ef">extern</span> NSString <span style="color:#f92672">*</span> <span style="color:#66d9ef">const</span> SomeConstant;

<span style="color:#75715e">// Some.m
</span><span style="color:#75715e"></span><span style="color:#75715e">// å¤–ç•Œéœ€è¦è®¿é—®åˆ™ä¸èƒ½å£°æ˜ä¸º staticï¼›å¤–ç•Œä¸å¯å˜æ›´ï¼Œå› æ­¤å£°æ˜ä¸º const
</span><span style="color:#75715e"></span><span style="color:#75715e">// è¿™é‡Œçš„ const ä¿®é¥°çš„æ˜¯ NSString *ï¼ˆå³ const ä»å³å‘å·¦åŸåˆ™ï¼‰ï¼ŒSomeConstant ä¿å­˜çš„å†…å­˜åœ°å€ä¸èƒ½å†æ”¹å˜ï¼ˆå³ä¸èƒ½æŒ‡å‘å¦å¤–ä¸€ä¸ª NSString å¯¹è±¡ï¼‰
</span><span style="color:#75715e"></span><span style="color:#75715e">// ç¼–è¯‘å™¨ä¼šåœ¨æ•°æ®æ®µï¼ˆData Sectionï¼‰ä¸ºå­—ç¬¦ä¸²åˆ†é…å­˜å‚¨ç©ºé—´ï¼Œé“¾æ¥å™¨ä¼šå°†ç›®æ ‡æ–‡ä»¶ç›¸äº’é“¾æ¥ï¼Œç”Ÿæˆæœ€ç»ˆçš„å¯æ‰§è¡Œæ–‡ä»¶
</span><span style="color:#75715e"></span><span style="color:#75715e">// å…¨å±€ç¬¦å·å‘½åè§„åˆ™ï¼šèŒƒå›´ï¼ˆé€šå¸¸ä½¿ç”¨ç±»åï¼‰+ åç§°
</span><span style="color:#75715e"></span>NSString <span style="color:#f92672">*</span> <span style="color:#66d9ef">const</span> SomeConstant <span style="color:#f92672">=</span> <span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">SomeConstant</span><span style="color:#e6db74">&#34;</span>;

<span style="color:#75715e">// åœ¨ Obj-C ä¸­ï¼Œé™¤äº† C ä¸­åŸæœ‰çš„ extern è¿˜å­˜åœ¨ä»¥ä¸‹ç›¸å…³çš„å®å®šä¹‰
</span><span style="color:#75715e"></span><span style="color:#75715e">// FOUNDATION_EXTERNã€FOUNDATION_EXPORTã€FOUNDATION_IMPORTã€UIKIT_EXTERN
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// NSObjCRuntime.h
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">if defined(__cplusplus)</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">// C++ ä¸‹å…¼å®¹ C++ çš„ extern
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">define FOUNDATION_EXTERN extern &#34;C&#34;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">else</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">define FOUNDATION_EXTERN extern</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">endif</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>

    <span style="color:#75715e">#</span><span style="color:#75715e">define FOUNDATION_EXPORT  FOUNDATION_EXTERN</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>    <span style="color:#75715e">#</span><span style="color:#75715e">define FOUNDATION_IMPORT FOUNDATION_EXTERN</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// UIKitDefines.h
</span><span style="color:#75715e"></span><span style="color:#75715e">// UIKIT_EXTERN è¿˜å£°æ˜äº†ç¬¦å·çš„å¯è§èŒƒå›´
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">ifdef __cplusplus</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">define UIKIT_EXTERN		extern &#34;C&#34; __attribute__((visibility (&#34;default&#34;)))</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">else</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">define UIKIT_EXTERN	        extern __attribute__((visibility (&#34;default&#34;)))</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">endif</span><span style="color:#75715e">
</span></code></pre></div><p>å¯¹äºé€‰æ‹© <code>extern</code> è¿˜æ˜¯ä»¥ä¸Š <code>SOME_EXTERN</code>ï¼Œå¾—å‡ºä»¥ä¸‹çš„ç»“è®ºï¼š</p>
<ul>
<li>å¯¹äºè¿™äº›å›ºå®šå‰ç¼€çš„ <code>extern</code> åº”å½“åœ¨å…¶èŒƒå›´ä¸‹ä½¿ç”¨ï¼Œå³ <code>FOUNDATION_*</code> åœ¨ Foundation æ¡†æ¶å†…éƒ¨ä½¿ç”¨ï¼Œ<code>UIKIT_*</code> åœ¨ <code>UIKit</code> å†…éƒ¨ä½¿ç”¨ï¼Œåœ¨æˆ‘ä»¬è‡ªå·±çš„åº“å†…åº”å½“æ¨èè‡ªå®šä¹‰ <code>SOME_*</code> æ¥ä½¿ç”¨ï¼Œè€Œä¸æ˜¯ç›´æ¥å¥—ç”¨å…¶å®ƒåº“å†…çš„å®å®šä¹‰ï¼›</li>
<li>é»˜è®¤çš„ <code>extern</code> ç”±äºå¯èƒ½ä¸å…¼å®¹ C++ï¼Œé‚£ä¹ˆåœ¨åº“ä¸­éœ€è¦å…¼å®¹ C++ æ—¶åº”å½“ä½¿ç”¨ <code>extern &quot;C&quot;</code>ã€‚</li>
</ul>
<h3 id="heading-2">ç”¨æšä¸¾è¡¨ç¤ºçŠ¶æ€ã€é€‰é¡¹ã€çŠ¶æ€ç </h3>
<p>Obj-C ä¸­çš„æšä¸¾ï¼ˆ<code>enum</code>ï¼‰æ¥è‡ª C è¯­è¨€ï¼Œè€Œ C++11 æ ‡å‡†ä½¿å¾—æšä¸¾å¯ä»¥å®šä¹‰å…¶åº•å±‚æ•°æ®ç±»å‹ï¼ˆUnderlying Typeï¼‰ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec"><span style="color:#75715e">// å®ç°æšä¸¾æ‰€ç”¨çš„æ•°æ®ç±»å‹å–å†³äºç¼–è¯‘å™¨
</span><span style="color:#75715e"></span><span style="color:#75715e">// æšä¸¾çš„åº•å±‚æ•°æ®ç±»å‹ä¸æ˜¯å›ºå®šçš„ï¼Œå…¶äºŒè¿›åˆ¶ä½ï¼ˆbitï¼‰çš„ä¸ªæ•°å¿…é¡»èƒ½å®Œå…¨è¡¨ç¤ºä¸‹æšä¸¾ç¼–å·
</span><span style="color:#75715e"></span><span style="color:#75715e">// æ¯”å¦‚ ImageSourceType å¯ä»¥ä½¿ç”¨ char ç±»å‹ï¼ˆä½†åœ¨ Xcode é‡Œå…¶åº•å±‚æ•°æ®ç±»å‹æ˜¯ç¬¬ä¸€é¡¹é»˜è®¤ä¸º 0 çš„ int ç±»å‹ï¼‰
</span><span style="color:#75715e"></span><span style="color:#66d9ef">enum</span> ImageSourceType {
    ImageSourceTypeCamera,
    ImageSourceTypeGallery
};

<span style="color:#66d9ef">enum</span> ImageSourceType type1 <span style="color:#f92672">=</span> ImageSourceTypeCamera;

<span style="color:#75715e">// typedef å¯ä»¥ç®€åŒ–æšä¸¾ç±»å‹å£°æ˜
</span><span style="color:#75715e"></span><span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">enum</span> ImageSourceType ImageSourceType;
ImageSourceType type2 <span style="color:#f92672">=</span> ImageSourceTypeGallery;

<span style="color:#75715e">// C++ 11 æ ‡å‡†ï¼Œæ˜¾å¼å£°æ˜æšä¸¾åº•å±‚æ•°æ®ç±»å‹
</span><span style="color:#75715e"></span><span style="color:#66d9ef">enum</span> NetworkType: NSInteger {
    NetworkTypeUnknown <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#75715e">// æ˜¾å¼ä¸ºä» -1 å¼€å§‹
</span><span style="color:#75715e"></span>    NetworkTypeWiFi   <span style="color:#75715e">// 0 é€’å¢
</span><span style="color:#75715e"></span>    NetworkCellular   <span style="color:#75715e">// 1
</span><span style="color:#75715e"></span>};

<span style="color:#75715e">// æšä¸¾çš„å‘å‰å£°æ˜ï¼ˆåœ¨ .m ä¸­å¼•å…¥æˆ–å®ç°å³å¯ï¼‰
</span><span style="color:#75715e"></span><span style="color:#75715e">// Some.h
</span><span style="color:#75715e"></span><span style="color:#66d9ef">enum</span> NetworkType: NSInteger;
</code></pre></div><p>æšä¸¾ä¸­ä½¿ç”¨æŒ‰ä½æˆ–æ“ä½œç¬¦ï¼ˆBitwise OR Operatorï¼‰å¯ä»¥ä½¿å¾—æšä¸¾çš„æ¯ä¸ªé€‰é¡¹å‡å¯å¯ç”¨æˆ–ç¦ç”¨ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec"><span style="color:#75715e">// UIViewAutoresizingNone æ˜¯æ— æ³•ä¸å…¶å®ƒé¡¹ç›®åŒæ—¶å­˜åœ¨ï¼Œå› æ­¤ä¸º 0
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// UIView.h
</span><span style="color:#75715e"></span><span style="color:#66d9ef">typedef</span> <span style="color:#a6e22e">NS_OPTIONS</span>(NSUInteger, UIViewAutoresizing) {
    UIViewAutoresizingNone                 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>,
    UIViewAutoresizingFlexibleLeftMargin   <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;</span><span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span>,
    UIViewAutoresizingFlexibleWidth        <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;</span><span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">1</span>,
    UIViewAutoresizingFlexibleRightMargin  <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;</span><span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">2</span>,
    UIViewAutoresizingFlexibleTopMargin    <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;</span><span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">3</span>,
    UIViewAutoresizingFlexibleHeight       <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;</span><span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">4</span>,
    UIViewAutoresizingFlexibleBottomMargin <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;</span><span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">5</span>
};

<span style="color:#75715e">// ä½¿ç”¨æ—¶å¯ä»¥ä½¿ç”¨æŒ‰ä½æˆ–æ¥ç»„åˆå¤šä¸ªé€‰é¡¹ï¼š
</span><span style="color:#75715e"></span>UIViewAutoresizing resize <span style="color:#f92672">=</span> UIViewAutoresizingFlexibleWidth <span style="color:#f92672">|</span> UIViewAutoresizingFlexibleHeight;

<span style="color:#75715e">// åˆ¤æ–­æ—¶ä½¿ç”¨æŒ‰ä½ä¸ï¼ˆBitwise AND Operatorï¼‰å³å¯
</span><span style="color:#75715e"></span><span style="color:#66d9ef">if</span> (resize <span style="color:#f92672">&amp;</span> UIViewAutoresizingFlexibleWidth) {
    NSLog(<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">UIViewAutoresizingFlexibleWidth</span><span style="color:#e6db74">&#34;</span>);
}
<span style="color:#66d9ef">if</span> (resize <span style="color:#f92672">&amp;</span> UIViewAutoresizingFlexibleHeight) {
    NSLog(<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">UIViewAutoresizingFlexibleHeight</span><span style="color:#e6db74">&#34;</span>);
}

<span style="color:#75715e">// OUTPUT:
</span><span style="color:#75715e"></span><span style="color:#75715e">// UIViewAutoresizingFlexibleWidth
</span><span style="color:#75715e"></span><span style="color:#75715e">// UIViewAutoresizingFlexibleHeight
</span></code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec"><span style="color:#75715e">/* NS_ENUM supports the use of one or two arguments. The first argument is always the integer type used for the values of the enum. The second argument is an optional type name for the macro. When specifying a type name, you must precede the macro with &#39;typedef&#39; like so:
</span><span style="color:#75715e">
</span><span style="color:#75715e">typedef NS_ENUM(NSInteger, NSComparisonResult) {
</span><span style="color:#75715e">    ...
</span><span style="color:#75715e">};
</span><span style="color:#75715e">
</span><span style="color:#75715e">If you do not specify a type name, do not use &#39;typedef&#39;. For example:
</span><span style="color:#75715e">
</span><span style="color:#75715e">NS_ENUM(NSInteger) {
</span><span style="color:#75715e">    ...
</span><span style="color:#75715e">};
</span><span style="color:#75715e">*/</span>
<span style="color:#75715e">#</span><span style="color:#75715e">define NS_ENUM(...) CF_ENUM(__VA_ARGS__)</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">define NS_OPTIONS(_type, _name) CF_OPTIONS(_type, _name)</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// CFAvailability.h
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">define CF_ENUM(...) __CF_ENUM_GET_MACRO(__VA_ARGS__, __CF_NAMED_ENUM, __CF_ANON_ENUM, )(__VA_ARGS__)</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">// æ ¹æ®æ˜¯å¦æŒ‰ç…§ C++ æ¨¡å¼ç¼–è¯‘è€Œä¸åŒ
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">define __CF_ENUM_GET_MACRO(_1, _2, NAME, ...) NAME</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">if (__cplusplus &amp;&amp; __cplusplus &gt;= 201103L &amp;&amp; (__has_extension(cxx_strong_enums) || __has_feature(objc_fixed_enum))) || (!__cplusplus &amp;&amp; __has_feature(objc_fixed_enum))</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>    <span style="color:#75715e">#</span><span style="color:#75715e">define __CF_NAMED_ENUM(_type, _name)     enum __CF_ENUM_ATTRIBUTES _name : _type _name; enum _name : _type</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>    <span style="color:#75715e">#</span><span style="color:#75715e">define __CF_ANON_ENUM(_type)             enum __CF_ENUM_ATTRIBUTES : _type</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>    <span style="color:#75715e">#</span><span style="color:#75715e">define CF_CLOSED_ENUM(_type, _name)      enum __CF_CLOSED_ENUM_ATTRIBUTES _name : _type _name; enum _name : _type</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>    <span style="color:#75715e">#</span><span style="color:#75715e">if (__cplusplus)</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>        <span style="color:#75715e">#</span><span style="color:#75715e">define CF_OPTIONS(_type, _name) _type _name; enum __CF_OPTIONS_ATTRIBUTES : _type</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>    <span style="color:#75715e">#</span><span style="color:#75715e">else</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>        <span style="color:#75715e">#</span><span style="color:#75715e">define CF_OPTIONS(_type, _name) enum __CF_OPTIONS_ATTRIBUTES _name : _type _name; enum _name : _type</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>    <span style="color:#75715e">#</span><span style="color:#75715e">endif</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">else</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>    <span style="color:#75715e">#</span><span style="color:#75715e">define __CF_NAMED_ENUM(_type, _name) _type _name; enum</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>    <span style="color:#75715e">#</span><span style="color:#75715e">define __CF_ANON_ENUM(_type) enum</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>    <span style="color:#75715e">#</span><span style="color:#75715e">define CF_CLOSED_ENUM(_type, _name) _type _name; enum</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>    <span style="color:#75715e">#</span><span style="color:#75715e">define CF_OPTIONS(_type, _name) _type _name; enum</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">endif</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// Some.mm
</span><span style="color:#75715e"></span><span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">enum</span> Direction: <span style="color:#66d9ef">int</span> FooDirection;
<span style="color:#66d9ef">enum</span> Direction: <span style="color:#66d9ef">int</span> {
    Up      <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;</span><span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span>,
    Down    <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;</span><span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">1</span>,
    Left    <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;</span><span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">2</span>,
    Right   <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;</span><span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">3</span>
};

<span style="color:#75715e">// åœ¨ä½¿ç”¨æˆ–è¿ç®—æ“ä½œä¸¤ä¸ªæšä¸¾å€¼æ—¶ï¼ŒC++ è®¤ä¸ºè¿ç®—ç»“æœçš„æ•°æ®ç±»å‹åº”å½“æ˜¯æšä¸¾çš„åº•å±‚æ•°æ®ç±»å‹ï¼Œå³ `NSUInteger`ï¼Œä¸” C++ ä¸æ”¯æŒå°†åº•å±‚æ•°æ®ç±»å‹éšå¼è½¬æ¢ä¸ºæšä¸¾ç±»å‹æœ¬èº«
</span><span style="color:#75715e"></span><span style="color:#75715e">// ERROR: Cannot initialize a variable of type &#39;FooDirection&#39; (aka &#39;Direction&#39;) with an rvalue of type &#39;int&#39;
</span><span style="color:#75715e"></span><span style="color:#75715e">// FooDirection direct = Up | Left;
</span></code></pre></div><p>Foundation æ¡†æ¶ä¸­æšä¸¾çš„è¾…åŠ©å®å…·å¤‡å‘åå…¼å®¹ï¼ˆBackward Compatibilityï¼‰èƒ½åŠ›ï¼Œå³æ ¹æ®ç›®æ ‡å¹³å°å†³å®šç›¸åº”çš„è¯­æ³•ï¼›å‡¡æ˜¯éœ€è¦æŒ‰ä½æˆ–æ“ä½œæ¥ç»„åˆçš„æšä¸¾éƒ½åº”å½“ä½¿ç”¨ <code>NS_OPTIONS</code> æ¥å®šä¹‰ï¼›å¦åˆ™ä½¿ç”¨ <code>NS_ENUM</code>ã€‚</p>
<h2 id="heading-3">å¯¹è±¡ã€æ¶ˆæ¯ã€è¿è¡ŒæœŸ</h2>
<h3 id="heading-4">ç†è§£ã€Œå±æ€§ã€è¿™ä¸€æ¦‚å¿µ</h3>
<p>åº”ç”¨ç¨‹åºäºŒè¿›åˆ¶æ¥å£ï¼ˆApplication Binary Interfaceï¼Œå³ ABIï¼‰å®šä¹‰äº†å¾ˆå¤šå†…å®¹ï¼Œå…¶ä¸­æœ‰ç”Ÿæˆä»£ç æ—¶æ‰€åº”éµå¾ªçš„è§„èŒƒã€‚Obj-C ä¸­å®ä¾‹å˜é‡ï¼ˆivarï¼‰çš„å†…å­˜å¸ƒå±€åœ¨ç¼–è¯‘æ—¶åˆ»å›ºå®šï¼Œå› æ­¤è®¿é—®å®ä¾‹å˜é‡æ—¶ï¼Œç¼–è¯‘å™¨ä¼šå°†å…¶æ›¿æ¢ä¸ºåç§»é‡ï¼ˆOffsetï¼‰ï¼Œè€Œåç§»é‡æ˜¯ç¡¬ç¼–ç ï¼Œè¡¨ç¤ºå…¶è·ç¦»å†…å­˜èµ·å§‹åœ°å€çš„é•¿åº¦ï¼›å¦‚æœä»£ç ä½¿ç”¨äº†ç¼–è¯‘æ—¶åˆ»è®¡ç®—çš„åç§»é‡ï¼Œé‚£ä¹ˆåœ¨ä¿®æ”¹ç±»å®šä¹‰ä¹‹åå¿…é¡»é‡æ–°ç¼–è¯‘ï¼Œå³é‡æ–°è®¡ç®—åç§»é‡ï¼›</p>
<p>å¯¹äºæ—§çš„ç±»å®šä¹‰é“¾æ¥äº†æ–°çš„ç±»å®šä¹‰ä¼šå‡ºç°ä¸å…¼å®¹æƒ…å†µï¼ŒObj-C çš„åšæ³•å¦‚ä¸‹ï¼š</p>
<ul>
<li>å°†å®ä¾‹å˜é‡å½“ä½œä¸€ç§å­˜å‚¨åç§»é‡æ‰€ç”¨çš„ç‰¹æ®Šå˜é‡ï¼Œäº¤ç”±ç±»å¯¹è±¡ä¿ç®¡ï¼Œåç§»é‡å°†åœ¨è¿è¡Œæ—¶æŸ¥æ‰¾ï¼Œè¿™æ ·å³ä½¿ç±»å®šä¹‰å˜åŒ–äº†ï¼Œä¹Ÿèƒ½æ‰¾åˆ°æ­£ç¡®çš„åç§»é‡ï¼Œç”šè‡³å¯ä»¥åœ¨è¿è¡Œæ—¶æ–°å¢å®ä¾‹å˜é‡ï¼›</li>
<li>å°½é‡ä¸è¦ç›´æ¥è®¿é—®å®ä¾‹å˜é‡ï¼Œè€Œæ˜¯é€šè¿‡ getter &amp; setterï¼ŒObj-C ä¸­å¯ä»¥ä½¿ç”¨ <code>@property</code> è¯­æ³•ï¼›</li>
</ul>
<p>è‡ªåŠ¨åˆæˆï¼ˆAutosynthesisï¼‰ï¼šç¼–è¯‘å™¨ä¼šè‡ªåŠ¨ä¸º Obj-C ä¸­çš„å±æ€§ä¾¿æºå…¶æ‰€éœ€çš„æ–¹æ³•ï¼Œè¯¥è¿‡ç¨‹ç”±ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶åˆ»æ‰§è¡Œï¼›ç¼–è¯‘å™¨è¿˜ä¼šè‡ªåŠ¨ä¸º Obj-C ä¸­çš„å±æ€§æ·»åŠ é€‚å½“ç±»å‹çš„å®ä¾‹å˜é‡ï¼Œå¹¶åœ¨å±æ€§åå‰åŠ  <code>_</code> å‰ç¼€ä½œä¸ºå®ä¾‹å˜é‡åã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec"><span style="color:#75715e">// Some.h
</span><span style="color:#75715e"></span><span style="color:#66d9ef">@property</span> NSString <span style="color:#f92672">*</span>foo;
<span style="color:#66d9ef">@property</span> NSString <span style="color:#f92672">*</span>bar;

<span style="color:#75715e">// Some.m
</span><span style="color:#75715e"></span><span style="color:#75715e">// @dynamic å°†ä¸ä¼šè‡ªåŠ¨åˆæˆï¼Œä¹Ÿä¸ä¼šåˆ›å»ºå®ä¾‹å˜é‡
</span><span style="color:#75715e"></span><span style="color:#75715e">// ä½†ä½¿ç”¨ getter &amp; setter å¯ä»¥ç¼–è¯‘ï¼Œå› ä¸ºå…¶ç›¸ä¿¡ä¼šåœ¨è¿è¡Œæ—¶æ‰¾åˆ°è¿™äº›æ–¹æ³•
</span><span style="color:#75715e"></span><span style="color:#66d9ef">@dynamic</span> bar;

<span style="color:#75715e">// @synthesize æŒ‡å®šäº†å±æ€§çš„å®ä¾‹å˜é‡å
</span><span style="color:#75715e"></span><span style="color:#66d9ef">@synthesize</span> foo <span style="color:#f92672">=</span> _foooo;

self<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>_foooo <span style="color:#f92672">=</span> <span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">Foo</span><span style="color:#e6db74">&#34;</span>;
NSLog(<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">%@</span><span style="color:#e6db74">&#34;</span>, [self foo]);
</code></pre></div><p>åŸå­æ€§</p>
<ul>
<li>åœ¨åŒ–å­¦ä¸­ï¼ŒåŸå­æ˜¯ä¸å¯åˆ†å‰²çš„æœ€å°ç²’å­ï¼Œå› æ­¤å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªåŸå­æ“ä½œæ˜¯ä¸ä¼šè¢«ä¸­æ–­çš„ï¼Œå³çº¿ç¨‹å®‰å…¨çš„ï¼ˆä½†è¿™å¹¶ä¸ä»£è¡¨ <code>atomic</code> çš„å±æ€§æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼‰ï¼›</li>
<li>é»˜è®¤æƒ…å†µä¸‹ï¼ˆå³ä¸æ˜ç¡®æŒ‡å®šåŸå­æ€§æ—¶ï¼‰ï¼Œç”±ç¼–è¯‘å™¨æ‰€åˆæˆçš„æ–¹æ³•ï¼ˆå³ getter &amp; setterï¼‰ä¼šé€šè¿‡é”å®šæœºåˆ¶ç¡®ä¿å…¶åŸå­æ€§ï¼ˆAtomicityï¼‰ï¼›</li>
<li>è‡ªå·±å®ç°çš„ getter &amp; setter éœ€è¦è‡ªå·±æ¥ä¿è¯ç›¸åº”çš„åŸå­æ€§ï¼ˆå³è‡ªå·±å®ç°æ—¶ä¸å£°æ˜çš„åŸå­æ€§æ²¡æœ‰å…³ç³»ï¼‰ï¼›</li>
<li>è‹¥å±æ€§ä¸º <code>nonatomic</code> åˆ™ä¸ä½¿ç”¨åŒæ­¥é”ï¼ŒiOS ä¸­ä½¿ç”¨åŒæ­¥é”å¼€é”€è¾ƒå¤§ï¼Œå¯èƒ½å¸¦æ¥æ€§èƒ½é—®é¢˜ï¼Œå› æ­¤ <code>nonatomic</code> æ€§èƒ½ä¼šå¥½ç‚¹ä¸” <code>atomic</code> å¹¶ä¸èƒ½ä¿è¯æ“ä½œæ˜¯åŸå­çš„ï¼Œå› æ­¤é€šå¸¸éƒ½ä½¿ç”¨ <code>nonatomic</code>ã€‚</li>
</ul>
<p>è¯»å†™æƒé™</p>
<ul>
<li><code>readwrite</code> å³æ‹¥æœ‰ getter &amp; setterï¼Œ<code>readonly</code> å³ä»…æ‹¥æœ‰ <code>getter</code>ï¼›</li>
<li><code>readwrite</code> å¯ä»¥ç”¨åœ¨ <code>.h</code> å£°æ˜ä¸º <code>readonly</code> ä½†å†…éƒ¨ç±»æ‰©å±•ä¸­å£°æ˜ä¸º <code>readwrite</code> æ¥å…è®¸å†…éƒ¨è®¾ç½®çš„æƒ…å†µã€‚</li>
</ul>
<p>å†…å­˜ç®¡ç†è¯­ä¹‰</p>
<ul>
<li><code>assign</code>ï¼šsetter åªä¼šé’ˆå¯¹çº¯é‡ç±»å‹ï¼ˆScalar Typeï¼‰ä¾‹å¦‚ <code>CGFloat</code>ã€<code>NSInteger</code> ç­‰çš„ç®€å•èµ‹å€¼æ“ä½œï¼›</li>
<li><code>strong</code>ï¼šå®šä¹‰ä¸€ç§æ‹¥æœ‰å…³ç³»ï¼Œä¸ºè¿™ç§å±æ€§è®¾ç½®æ–°å€¼æ—¶ï¼Œsetter ä¼šå…ˆä¿ç•™æ–°å€¼ï¼Œå¹¶é‡Šæ”¾æ—§å€¼ï¼Œç„¶åå†å°†æ–°å€¼è®¾ç½®ä¸Šå»ï¼›</li>
<li><code>weak</code>ï¼šå®šä¹‰ä¸€ç§éæ‹¥æœ‰å…³ç³»ï¼Œä¸ºè¿™ç§å±æ€§è®¾ç½®æ–°å€¼æ—¶ï¼Œsetter æ—¢ä¸ä¿ç•™æ–°å€¼ï¼Œä¹Ÿä¸é‡Šæ”¾æ—§å€¼ï¼Œç±»ä¼¼ <code>assign</code>ï¼Œä½†å½“å±æ€§æ‰€æŒ‡å‘çš„å¯¹è±¡é”€æ¯æ—¶ï¼Œå±æ€§å€¼ä¹Ÿä¼šç½®ä¸º <code>nil</code>ï¼›</li>
<li><code>unsafe_unretained</code>ï¼šå†…å­˜è¯­ä¹‰ä¸ <code>assign</code> ç›¸åŒï¼Œä½†é€‚ç”¨äºå¯¹è±¡ç±»å‹ï¼Œå®šä¹‰ä¸€ç§éæ‹¥æœ‰ï¼ˆä¸ä¿ç•™ï¼‰å…³ç³»ï¼Œä½†å½“å±æ€§æ‰€æŒ‡å‘çš„å¯¹è±¡é”€æ¯æ—¶ï¼Œå±æ€§å€¼<strong>ä¸ä¼š</strong>è‡ªåŠ¨ç½®ä¸º <code>nil</code>ï¼ˆAutonilingï¼Œä¸ <code>weak</code> çš„å·®å¼‚ï¼‰ï¼›</li>
<li><code>copy</code>ï¼šç±»ä¼¼ <code>strong</code>ï¼Œä½† setter ä¸ä¿ç•™æ–°å€¼ï¼Œè€Œæ˜¯å°†å…¶æ‹·è´ï¼›å½“å±æ€§ç±»å‹ä¸º <code>NSString *</code> æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ <code>copy</code> ä¿æŠ¤å…¶å°è£…æ€§ï¼Œå› ä¸º setter æ¥æ”¶çš„æ–°å€¼æœ‰å¯èƒ½æ˜¯æŒ‡å‘ <code>NSMutableString</code> çš„å®ä¾‹ï¼Œè‹¥ä¸æ‹·è´åˆ™å¯èƒ½ä¼šè¢«å¤–ç•Œéšæ—¶æ›´æ”¹ï¼Œå› æ­¤éœ€è¦æ‹·è´ä¸ºä¸å¯å˜çš„æƒ…å†µï¼›</li>
</ul>
<p>æ–¹æ³•å</p>
<ul>
<li><code>getter=&lt;name&gt;</code> å¯ä»¥æŒ‡å®š getter åç§°ï¼›</li>
<li><code>setter=&lt;name&gt;</code> å¯ä»¥æŒ‡å®š setter åç§°ï¼›</li>
</ul>
<p>å±æ€§ç‰¹æ€§ï¼ˆAttributeï¼‰åªåœ¨è‡ªåŠ¨ç”Ÿæˆæ—¶æœ‰æ•ˆï¼Œè‡ªå·±å®ç°çš„ getter &amp; setter è¦ä¿è¯å…¶å…·å¤‡ç›¸åº”çš„å±æ€§ç‰¹æ€§ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec"><span style="color:#66d9ef">@interface</span> <span style="color:#a6e22e">Foo</span> : <span style="color:#a6e22e">NSObject</span>
<span style="color:#75715e">// å³ä½¿ readonly ä¹Ÿè¦æ³¨æ˜ copyï¼Œå› ä¸ºåœ¨ init ä¸­è¿›è¡Œäº† copy
</span><span style="color:#75715e"></span><span style="color:#66d9ef">@property</span> (<span style="color:#66d9ef">copy</span>, <span style="color:#66d9ef">readonly</span>) NSString <span style="color:#f92672">*</span>bar;
<span style="color:#66d9ef">@end</span>

<span style="color:#66d9ef">@implementation</span> <span style="color:#a6e22e">Foo</span>

- (<span style="color:#66d9ef">instancetype</span>)<span style="color:#a6e22e">initWithBar:</span>(NSString <span style="color:#f92672">*</span>)bar
{
    self <span style="color:#f92672">=</span> [super init];
    <span style="color:#66d9ef">if</span> (self) {
        <span style="color:#75715e">// è¦ä¿è¯å±æ€§çš„å†…å­˜è¯­ä¹‰
</span><span style="color:#75715e"></span>        _bar <span style="color:#f92672">=</span> [bar <span style="color:#66d9ef">copy</span>];
    }
    <span style="color:#66d9ef">return</span> self;
}

<span style="color:#66d9ef">@end</span>
</code></pre></div><h3 id="heading-5">åœ¨å¯¹è±¡å†…éƒ¨å°½é‡ç›´æ¥è®¿é—®å®ä¾‹å˜é‡</h3>
<p>ç›´æ¥è®¿é—®å®ä¾‹å˜é‡ï¼ˆivarï¼‰ä¸é€šè¿‡å±æ€§ï¼ˆgetter &amp; setterï¼‰è®¿é—®çš„åŒºåˆ«ï¼š</p>
<ul>
<li>ç›´æ¥è®¿é—®ä¸ç»è¿‡æ–¹æ³•æ´¾å‘ï¼Œé€Ÿåº¦æ›´å¿«ï¼›</li>
<li>ç›´æ¥è®¿é—®ä¸ç»è¿‡æ‰€å®šä¹‰çš„å†…å­˜ç®¡ç†è¯­ä¹‰ï¼ˆä¾‹å¦‚ <code>copy</code>ï¼‰ï¼›</li>
<li>ç›´æ¥è®¿é—®ä¸ç»è¿‡ KVOï¼›</li>
<li>é€šè¿‡å±æ€§è®¿é—®ä¾¿äº Debugï¼ˆå¯ä»¥æ‰“æ–­ç‚¹ï¼‰ã€‚</li>
</ul>
<p>å› æ­¤å»ºè®®è¯»å–æ—¶ç›´æ¥è®¿é—®ï¼Œå†™å…¥æ—¶é€šè¿‡å±æ€§ï¼Œå½“ç„¶å…·ä½“é—®é¢˜è§ä»è§æ™ºã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec"><span style="color:#75715e">// æ‡’åŠ è½½çš„å±æ€§å¿…é¡»è¦é€šè¿‡ getter è®¿é—®
</span><span style="color:#75715e"></span>- (NSObject <span style="color:#f92672">*</span>)<span style="color:#a6e22e">foo</span> {
    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>_foo) {
        _foo <span style="color:#f92672">=</span> [NSObject new];
        <span style="color:#66d9ef">return</span> _foo;
    }
}
</code></pre></div><h3 id="heading-6">ç†è§£ã€Œå¯¹è±¡ç­‰åŒæ€§ã€è¿™ä¸€æ¦‚å¿µ</h3>
<p>å¯¹äº Obj-C ä¸­çš„å¯¹è±¡ç±»å‹ï¼Œ<code>==</code> æ¯”è¾ƒçš„æ˜¯ä¸¤ä¸ªæŒ‡é’ˆæœ¬èº«çš„å€¼ï¼ˆå³å­˜å‚¨çš„åœ°å€ï¼‰æ˜¯å¦ä¸€è‡´ã€‚NSString ç±»ä¸­çš„ <code>isEqualToString:</code> æ¯” <code>isEqual:</code> æ–¹æ³•é€Ÿåº¦æ›´å¿«ï¼ˆä½†å…¶å®å·®åˆ«ä¸å¤§ï¼‰ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec">- (<span style="color:#66d9ef">BOOL</span>)<span style="color:#a6e22e">isEqual:</span>(<span style="color:#66d9ef">id</span>)object {
    <span style="color:#75715e">// åœ°å€ä¸€è‡´ï¼Œåˆ™å¿…ç„¶ä¸€æ ·
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (self <span style="color:#f92672">=</span><span style="color:#f92672">=</span> object) <span style="color:#66d9ef">return</span> YES;
    <span style="color:#75715e">// å¦‚æœéåŒç±»ï¼Œåˆ™ä¸ç›¸ç­‰ï¼ˆå­çˆ¶ç±»ä¹‹é—´æ¯”è¾ƒè§†æƒ…å†µè€Œå®šï¼‰
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> ([self <span style="color:#66d9ef">class</span>] <span style="color:#f92672">!</span><span style="color:#f92672">=</span> [object <span style="color:#66d9ef">class</span>]) <span style="color:#66d9ef">return</span> NO;

    Foo <span style="color:#f92672">*</span>foo <span style="color:#f92672">=</span> (Foo <span style="color:#f92672">*</span>)object;
    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>[_bar isEqualToString:foo.bar])
        <span style="color:#66d9ef">return</span> NO;

    <span style="color:#66d9ef">if</span> (_baz <span style="color:#f92672">!</span><span style="color:#f92672">=</span> foo.baz)
        <span style="color:#66d9ef">return</span> NO;

    <span style="color:#66d9ef">return</span> YES;
}
</code></pre></div><p>è‹¥ä¸¤ä¸ªå¯¹è±¡ç›¸ç­‰ï¼Œ<code>hash</code> ä¹Ÿç›¸ç­‰ï¼›<code>hash</code> ç›¸ç­‰ï¼Œä½†ä¸¤ä¸ªå¯¹è±¡å¹¶ä¸ä¸€å®šç›¸ç­‰ã€‚å®ç° <code>hash</code> æ–¹æ³•è¦åœ¨å‡å°‘ç¢°æ’ä¸é™ä½è¿ç®—å¤æ‚ç¨‹åº¦ï¼ˆæ€§èƒ½å½±å“ï¼‰ä¹‹é—´æƒè¡¡ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec"><span style="color:#75715e">// è¿”å›å›ºå®šå€¼
</span><span style="color:#75715e"></span><span style="color:#75715e">// å¯è¡Œï¼Œä½†åœ¨ collection ä¸­ä½¿ç”¨è¯¥ç±»å‹å¯¹è±¡å°†äº§ç”Ÿæ€§èƒ½é—®é¢˜ï¼Œå› ä¸º collection æ£€ç´¢å“ˆå¸Œè¡¨ï¼ˆHash Tableï¼‰æ—¶ï¼Œä¼šç”¨å¯¹è±¡çš„å“ˆå¸Œç ï¼ˆHash Codeï¼‰åšç´¢å¼•ã€‚
</span><span style="color:#75715e"></span><span style="color:#75715e">// å‡å¦‚æŸä¸ª collection æ˜¯ç”¨ set å®ç°çš„ï¼Œå…¶å¯èƒ½ä¼šæ ¹æ®å“ˆå¸Œç æŠŠå¯¹è±¡åˆ†è£…åˆ°ä¸åŒçš„æ•°ç»„ä¸­ã€‚
</span><span style="color:#75715e"></span><span style="color:#75715e">// è‹¥æ¯ä¸ªå¯¹è±¡éƒ½è¿”å›ç›¸åŒçš„å“ˆå¸Œç ï¼Œåˆ™éœ€è¦å°†æ‰€æœ‰å¯¹è±¡å…¨éƒ¨æ‰«æã€‚
</span><span style="color:#75715e"></span>- (NSUInteger)<span style="color:#a6e22e">hash</span> {
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1024</span>;
}

<span style="color:#75715e">// å±æ€§æ‹¼æ¥å­—ç¬¦ä¸²å¹¶ hash
</span><span style="color:#75715e"></span><span style="color:#75715e">// ä½†éœ€æ‰¿æ‹…åˆ›å»ºå­—ç¬¦ä¸²çš„å¼€é”€ï¼›æ·»åŠ åˆ° collection ä¸­ç”±äºå¿…é¡»è®¡ç®—å“ˆå¸Œç ä¹Ÿä¼šäº§ç”Ÿæ€§èƒ½é—®é¢˜
</span><span style="color:#75715e"></span>- (NSUInteger)<span style="color:#a6e22e">hash</span> {
    NSString <span style="color:#f92672">*</span>str <span style="color:#f92672">=</span> [NSString stringWithFormat:<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">%@:%i</span><span style="color:#e6db74">&#34;</span>, _bar, _baz];
    <span style="color:#66d9ef">return</span> [str hash];
}

<span style="color:#75715e">// æ•ˆç‡é«˜ï¼ŒèŒƒå›´ç¡®å®š
</span><span style="color:#75715e"></span><span style="color:#75715e">// è™½ç„¶ä¼šç¢°æ’ï¼Œä½†å…è®¸
</span><span style="color:#75715e"></span>- (NSUInteger)<span style="color:#a6e22e">hash</span> {
    NSUInteger bar <span style="color:#f92672">=</span> [_bar hash];
    NSUInteger baz <span style="color:#f92672">=</span> _baz;
    <span style="color:#66d9ef">return</span> bar <span style="color:#f92672">^</span> baz;
}
</code></pre></div><p>ç¼–å†™ç‰¹å®šç±»çš„ç­‰åŒæ€§åˆ¤å®šæ–¹æ³•ï¼ˆæ¯”å¦‚ <code>isEqualToString:</code>ï¼‰æ—¶ï¼Œåº”ä¸€å¹¶é‡å†™ <code>isEqual:</code> æ–¹æ³•ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec">- (<span style="color:#66d9ef">BOOL</span>)<span style="color:#a6e22e">isEqualToFoo:</span>(Foo <span style="color:#f92672">*</span>)foo {
    <span style="color:#66d9ef">if</span> (self <span style="color:#f92672">=</span><span style="color:#f92672">=</span> object) <span style="color:#66d9ef">return</span> YES;

    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>[_bar isEqualToString:foo.bar])
        <span style="color:#66d9ef">return</span> NO;

    <span style="color:#66d9ef">if</span> (_baz <span style="color:#f92672">!</span><span style="color:#f92672">=</span> foo.baz)
        <span style="color:#66d9ef">return</span> NO;

    <span style="color:#66d9ef">return</span> YES;
}

- (<span style="color:#66d9ef">BOOL</span>)<span style="color:#a6e22e">isEqual:</span>(<span style="color:#66d9ef">id</span>)object {
    <span style="color:#75715e">// ç›¸åŒç±»åˆ™è‡ªå·±åˆ¤æ–­
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> ([self <span style="color:#66d9ef">class</span>] <span style="color:#f92672">=</span><span style="color:#f92672">=</span> [object <span style="color:#66d9ef">class</span>]) {
        <span style="color:#66d9ef">return</span> [self isEqualToFoo:(Foo <span style="color:#f92672">*</span>)object];
    }

    <span style="color:#75715e">// ä¸åŒç±»åˆ™äº¤ç»™çˆ¶ç±»
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">return</span> [super isEqual:object];
}
</code></pre></div><p>ç­‰åŒæ€§åˆ¤å®šçš„æ‰§è¡Œæ·±åº¦å–å†³äºå—æµ‹å¯¹è±¡ï¼Œå³è‹¥æœ‰æŸä¸ª ID å­—æ®µåˆ™å¯ä»¥ç›´æ¥æ ¹æ®è¯¥ ID æ¥åˆ¤å®šã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec"><span style="color:#75715e">// å°†å¯¹è±¡æ”¾å…¥ collection ä¸­ï¼Œä¸åº”å†æ”¹å˜å…¶å“ˆå¸Œç ï¼Œå³éœ€è¦ç¡®ä¿å“ˆå¸Œç å¹¶éæ ¹æ®å¯¹è±¡çš„å¯å˜éƒ¨åˆ†è®¡ç®—å¾—å‡º
</span><span style="color:#75715e"></span>NSMutableSet <span style="color:#f92672">*</span>set <span style="color:#f92672">=</span> [NSMutableSet new];
NSMutableArray <span style="color:#f92672">*</span>arr1 <span style="color:#f92672">=</span> [<span style="color:#ae81ff">@[</span><span style="color:#ae81ff">@1</span><span style="color:#ae81ff">]</span> mutableCopy];
NSMutableArray <span style="color:#f92672">*</span>arr2 <span style="color:#f92672">=</span> [<span style="color:#ae81ff">@[</span><span style="color:#ae81ff">@1</span>, <span style="color:#ae81ff">@2</span><span style="color:#ae81ff">]</span> mutableCopy];

[set addObject:arr1];
[set addObject:arr2];

<span style="color:#75715e">// {((1), (1,2))}
</span><span style="color:#75715e"></span>NSLog(<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">%@</span><span style="color:#e6db74">&#34;</span>, set);

<span style="color:#75715e">// Set ä¸­å­˜åœ¨äº†ä¸¤ä¸ªå®Œå…¨ç›¸åŒçš„ç»“æ„
</span><span style="color:#75715e"></span><span style="color:#75715e">// {((1,2), (1,2))}
</span><span style="color:#75715e"></span>[arr1 addObject:<span style="color:#ae81ff">@2</span>];
NSLog(<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">%@</span><span style="color:#e6db74">&#34;</span>, set);
</code></pre></div><h3 id="heading-7">ä»¥ã€Œç±»æ—æ¨¡å¼ã€éšè—å®ç°ç»†èŠ‚</h3>
<p>ç±»æ—ï¼ˆClass Clusterï¼Œåˆç§°ç±»ç°‡ï¼‰æ˜¯ä¸€ç§éšè—æŠ½è±¡åŸºç±»èƒŒåçš„å®ç°ç»†èŠ‚çš„æ¨¡å¼ï¼ˆä¾‹å¦‚ <code>UIButton</code> çš„ <code>buttonWithType:</code> ç±»æ–¹æ³•ï¼‰ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-swift" data-lang="swift"><span style="color:#75715e">//</span><span style="color:#75715e"> </span><span style="color:#75715e">æ¨¡</span><span style="color:#75715e">å¼</span><span style="color:#75715e">æ˜¯</span><span style="color:#75715e">ä¸</span><span style="color:#75715e">é™</span><span style="color:#75715e">å®š</span><span style="color:#75715e">äº</span><span style="color:#75715e">è¯­</span><span style="color:#75715e">è¨€</span><span style="color:#75715e">çš„</span><span style="color:#75715e">ï¼Œ</span><span style="color:#75715e">å› </span><span style="color:#75715e">æ­¤</span><span style="color:#75715e">è¿™</span><span style="color:#75715e">é‡Œ</span><span style="color:#75715e">ä½¿</span><span style="color:#75715e">ç”¨</span><span style="color:#75715e">äº†</span><span style="color:#75715e"> </span><span style="color:#75715e">S</span><span style="color:#75715e">w</span><span style="color:#75715e">i</span><span style="color:#75715e">f</span><span style="color:#75715e">t</span><span style="color:#75715e"> </span><span style="color:#75715e">æ¥</span><span style="color:#75715e">ç®€</span><span style="color:#75715e">å•</span><span style="color:#75715e">å®</span><span style="color:#75715e">ç°</span>

<span style="color:#66d9ef">enum</span> <span style="color:#a6e22e">FooType</span> {
    <span style="color:#66d9ef">case</span> first
    <span style="color:#66d9ef">case</span> second
}

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Foo</span> {
    <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">func</span> <span style="color:#a6e22e">build</span>(<span style="color:#66d9ef">_</span> type: FooType) -&gt; Foo {
        <span style="color:#66d9ef">switch</span> type {
        <span style="color:#66d9ef">case</span> .first: <span style="color:#66d9ef">return</span> FooFirst()
        <span style="color:#66d9ef">case</span> .second: <span style="color:#66d9ef">return</span> FooSecond()
        }
    }

    <span style="color:#66d9ef">func</span> <span style="color:#a6e22e">bar</span>() {
        fatalError(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">bar should be implemented in subclasses.</span><span style="color:#e6db74">&#34;</span>)
    }
}

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">FooFirst</span>: Foo {
    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">func</span> <span style="color:#a6e22e">bar</span>() {
        print(<span style="color:#66d9ef">#function</span>)
    }
}

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">FooSecond</span>: Foo {
    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">func</span> <span style="color:#a6e22e">bar</span>() {
        print(<span style="color:#66d9ef">#function</span>)
    }
}

<span style="color:#75715e">//</span><span style="color:#75715e"> </span><span style="color:#75715e">ç±»</span><span style="color:#75715e">æ—</span><span style="color:#75715e">æ¨¡</span><span style="color:#75715e">å¼</span><span style="color:#75715e">ç›®</span><span style="color:#75715e">çš„</span><span style="color:#75715e">æ˜¯</span><span style="color:#75715e">éš</span><span style="color:#75715e">è—</span><span style="color:#75715e">å†…</span><span style="color:#75715e">éƒ¨</span><span style="color:#75715e">å®</span><span style="color:#75715e">ç°</span><span style="color:#75715e">çš„</span><span style="color:#75715e">ç»†</span><span style="color:#75715e">èŠ‚</span><span style="color:#75715e">ï¼Œ</span><span style="color:#75715e">å› </span><span style="color:#75715e">æ­¤</span><span style="color:#75715e">å¤–</span><span style="color:#75715e">ç•Œ</span><span style="color:#75715e">åˆ›</span><span style="color:#75715e">å»º</span><span style="color:#75715e">çš„</span><span style="color:#75715e">å˜</span><span style="color:#75715e">é‡</span><span style="color:#75715e">è™½</span><span style="color:#75715e">ç„¶</span><span style="color:#75715e">æ˜¯</span><span style="color:#75715e">å·¥</span><span style="color:#75715e">å‚</span><span style="color:#75715e">ç±»</span><span style="color:#75715e">çš„</span><span style="color:#75715e">ç±»</span><span style="color:#75715e">å‹</span><span style="color:#75715e">ï¼Œ</span><span style="color:#75715e">ä½†</span><span style="color:#75715e">å®</span><span style="color:#75715e">é™…</span><span style="color:#75715e">ä¸Š</span><span style="color:#75715e">å…¶</span><span style="color:#75715e">å®</span><span style="color:#75715e">æ˜¯</span><span style="color:#75715e">å†…</span><span style="color:#75715e">éƒ¨</span><span style="color:#75715e">å­</span><span style="color:#75715e">ç±»</span><span style="color:#75715e">çš„</span><span style="color:#75715e">ç±»</span><span style="color:#75715e">å‹</span><span style="color:#75715e">ã€‚</span>
<span style="color:#75715e">//</span><span style="color:#75715e"> </span><span style="color:#75715e">å› </span><span style="color:#75715e">æ­¤</span><span style="color:#75715e">åœ¨</span><span style="color:#75715e"> </span><span style="color:#75715e">O</span><span style="color:#75715e">b</span><span style="color:#75715e">j</span><span style="color:#75715e">-</span><span style="color:#75715e">C</span><span style="color:#75715e"> </span><span style="color:#75715e">ä¸­</span><span style="color:#75715e">ä½¿</span><span style="color:#75715e">ç”¨</span><span style="color:#75715e"> </span><span style="color:#75715e">i</span><span style="color:#75715e">s</span><span style="color:#75715e">M</span><span style="color:#75715e">e</span><span style="color:#75715e">m</span><span style="color:#75715e">b</span><span style="color:#75715e">e</span><span style="color:#75715e">r</span><span style="color:#75715e">O</span><span style="color:#75715e">f</span><span style="color:#75715e">C</span><span style="color:#75715e">l</span><span style="color:#75715e">a</span><span style="color:#75715e">s</span><span style="color:#75715e">s</span><span style="color:#75715e"> </span><span style="color:#75715e">åˆ¤</span><span style="color:#75715e">æ–­</span><span style="color:#75715e">ç±»</span><span style="color:#75715e">æ˜¯</span><span style="color:#75715e">å¦</span><span style="color:#75715e">ä¸º</span><span style="color:#75715e">å·¥</span><span style="color:#75715e">å‚</span><span style="color:#75715e">ç±»</span><span style="color:#75715e">æœ¬</span><span style="color:#75715e">èº«</span><span style="color:#75715e">ï¼Œ</span><span style="color:#75715e">åˆ™</span><span style="color:#75715e">ä¼š</span><span style="color:#75715e">è¿”</span><span style="color:#75715e">å›</span><span style="color:#75715e"> </span><span style="color:#75715e">N</span><span style="color:#75715e">O</span><span style="color:#75715e">ã€‚</span>
<span style="color:#75715e">//</span><span style="color:#75715e"> </span><span style="color:#75715e">f</span><span style="color:#75715e">o</span><span style="color:#75715e">o</span><span style="color:#75715e"> </span><span style="color:#75715e">åœ¨</span><span style="color:#75715e"> </span><span style="color:#75715e">S</span><span style="color:#75715e">w</span><span style="color:#75715e">i</span><span style="color:#75715e">f</span><span style="color:#75715e">t</span><span style="color:#75715e"> </span><span style="color:#75715e">ä¸­</span><span style="color:#75715e">è¢«</span><span style="color:#75715e">æ¨</span><span style="color:#75715e">æ–­</span><span style="color:#75715e">ä¸º</span><span style="color:#75715e"> </span><span style="color:#75715e">F</span><span style="color:#75715e">o</span><span style="color:#75715e">o</span>
<span style="color:#66d9ef">let</span> foo = Foo.build(.first)

print(foo <span style="color:#66d9ef">is</span> Foo)
print(foo <span style="color:#66d9ef">is</span> FooFirst)
print(foo <span style="color:#66d9ef">is</span> FooSecond)

<span style="color:#75715e">//</span><span style="color:#75715e"> </span><span style="color:#75715e">O</span><span style="color:#75715e">U</span><span style="color:#75715e">T</span><span style="color:#75715e">P</span><span style="color:#75715e">U</span><span style="color:#75715e">T</span><span style="color:#75715e">:</span>
<span style="color:#75715e">//</span><span style="color:#75715e"> </span><span style="color:#75715e">t</span><span style="color:#75715e">r</span><span style="color:#75715e">u</span><span style="color:#75715e">e</span>
<span style="color:#75715e">//</span><span style="color:#75715e"> </span><span style="color:#75715e">t</span><span style="color:#75715e">r</span><span style="color:#75715e">u</span><span style="color:#75715e">e</span>
<span style="color:#75715e">//</span><span style="color:#75715e"> </span><span style="color:#75715e">f</span><span style="color:#75715e">a</span><span style="color:#75715e">l</span><span style="color:#75715e">s</span><span style="color:#75715e">e</span>
</code></pre></div><p>ç³»ç»Ÿæ¡†æ¶ä¸­æœ‰è®¸å¤šç±»æ—ï¼Œæ¯”å¦‚å¤§éƒ¨åˆ†çš„ collection ç±»ï¼ˆæ¯”å¦‚ <code>NSArray</code>ï¼‰ï¼›ç”±äº <code>NSArray</code> æ˜¯ç±»æ—ï¼Œå› æ­¤ <code>[fooArr class] == [NSArray class]</code> å°†ä¸€ç›´è¿”å› <code>false</code>ï¼Œä½†å¯ä½¿ç”¨ <code>[fooArr isKindOfClass:[NSArray class]]</code>ã€‚</p>
<p>å‘ç±»æ—ä¸­æ–°å¢å®ä½“å­ç±»éœ€è¦éµå®ˆä»¥ä¸‹è§„åˆ™ï¼š</p>
<ul>
<li>å­ç±»åº”è¯¥ç»§æ‰¿è‡ªç±»æ—ä¸­çš„æŠ½è±¡åŸºç±»ï¼›</li>
<li>å­ç±»åº”è¯¥å®šä¹‰è‡ªå·±çš„æ•°æ®å­˜å‚¨æ–¹å¼ï¼šç±»æ—åªæ˜¯å®šä¹‰äº†é€šç”¨çš„æ¥å£ï¼Œå®é™…å­˜å‚¨çš„æ–¹å¼åˆ™ç”±èƒŒåå…·ä½“çš„å®ä½“å­ç±»æ‰¿æ‹…ï¼›</li>
<li>å­ç±»åº”å½“è¦†å†™è¶…ç±»æ–‡æ¡£ä¸­æŒ‡æ˜éœ€è¦è¦†å†™çš„æ–¹æ³•ï¼šç±»æ—ä¸­çš„é€šç”¨æ¥å£éœ€è¦å­ç±»å®ç°ã€‚</li>
</ul>
<h3 id="heading-8">åœ¨æ—¢æœ‰ç±»ä¸­ä½¿ç”¨å…³è”å¯¹è±¡å­˜æ”¾è‡ªå®šä¹‰æ•°æ®</h3>
<p>ç•¥ï¼›å…³äºå…³è”å¯¹è±¡ï¼Œå¯è¯¦è§ã€Š<a href="../associated_objects_in_ios">iOS ä¸­çš„å…³è”å¯¹è±¡</a>ã€‹ä¸€æ–‡ã€‚</p>
<h3 id="-objc-msgsend-">ç†è§£ objc_msgSend çš„ä½œç”¨</h3>
<p>ç•¥ï¼›å…³äº objc_msgSendï¼Œå¯è¯¦è§ã€Š<a href="../objc_msgsend">æµ…å° objc_msgSend</a>ã€‹ä¸€æ–‡ã€‚</p>
<h3 id="heading-9">ç†è§£æ¶ˆæ¯è½¬å‘æœºåˆ¶</h3>
<p>ç•¥ï¼›å…³äºæ¶ˆæ¯è½¬å‘æœºåˆ¶ï¼Œå¯è¯¦è§ã€Š<a href="../objc_msgsend">æµ…å° objc_msgSend</a>ã€‹ä¸€æ–‡ã€‚</p>
<h3 id="heading-10">ç”¨ã€Œæ–¹æ³•è°ƒé…æŠ€æœ¯ã€è°ƒè¯•ã€Œé»‘ç›’æ–¹æ³•ã€</h3>
<p>ã€Œæ–¹æ³•è°ƒé…æŠ€æœ¯ã€å³ Method Swizzlingï¼Œç°åœ¨æ™®éç§°ä¹‹ä¸ºæ–¹æ³•äº¤æ¢ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec"><span style="color:#75715e">#</span><span style="color:#75715e">import &lt;Foundation</span><span style="color:#75715e">/</span><span style="color:#75715e">Foundation.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">import &lt;objc</span><span style="color:#75715e">/</span><span style="color:#75715e">runtime.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// Foo_BASE åŸºç±»
</span><span style="color:#75715e"></span><span style="color:#66d9ef">@interface</span> <span style="color:#a6e22e">Foo_BASE</span> : <span style="color:#a6e22e">NSObject</span>
- (<span style="color:#66d9ef">void</span>)<span style="color:#a6e22e">a</span>;
<span style="color:#66d9ef">@end</span>

<span style="color:#66d9ef">@implementation</span> <span style="color:#a6e22e">Foo_BASE</span>
- (<span style="color:#66d9ef">void</span>)<span style="color:#a6e22e">a</span> {
    NSLog(<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">a - Foo_BASE - %@</span><span style="color:#e6db74">&#34;</span>, self);
}
<span style="color:#66d9ef">@end</span>

<span style="color:#75715e">// Foo_SUB å­ç±»
</span><span style="color:#75715e"></span><span style="color:#66d9ef">@interface</span> <span style="color:#a6e22e">Foo_SUB</span> : <span style="color:#a6e22e">Foo_BASE</span>
- (<span style="color:#66d9ef">void</span>)<span style="color:#a6e22e">b</span>;
<span style="color:#66d9ef">@end</span>

<span style="color:#66d9ef">@implementation</span> <span style="color:#a6e22e">Foo_SUB</span>
- (<span style="color:#66d9ef">void</span>)<span style="color:#a6e22e">b</span> {
    NSLog(<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">b - Foo_SUB - %@</span><span style="color:#e6db74">&#34;</span>, self);
}
<span style="color:#66d9ef">@end</span>

<span style="color:#66d9ef">@interface</span> <span style="color:#a6e22e">Bar</span> : <span style="color:#a6e22e">NSObject</span>
- (<span style="color:#66d9ef">void</span>)<span style="color:#a6e22e">e</span>;
<span style="color:#66d9ef">@end</span>

<span style="color:#66d9ef">@implementation</span> <span style="color:#a6e22e">Bar</span>
- (<span style="color:#66d9ef">void</span>)<span style="color:#a6e22e">e</span> {
    <span style="color:#75715e">// self ä¸º Foo_SUB
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// [self e];  -[Foo_SUB e]: unrecognized selector sent to instance 0x1007031e0
</span><span style="color:#75715e"></span>
    <span style="color:#75715e">// [self performSelector:NSSelectorFromString(@&#34;f&#34;)]; // EXC_BAD_ACCESS
</span><span style="color:#75715e"></span>
    NSLog(<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">e - Bar - %@</span><span style="color:#e6db74">&#34;</span>, self);
}
<span style="color:#66d9ef">@end</span>

<span style="color:#75715e">// Foo_SUB (Extension) åˆ†ç±»
</span><span style="color:#75715e"></span><span style="color:#66d9ef">@interface</span> <span style="color:#a6e22e">Foo_SUB</span> (Extension)
<span style="color:#66d9ef">@end</span>

<span style="color:#66d9ef">@implementation</span> <span style="color:#a6e22e">Foo_SUB</span> (Extension)

- (<span style="color:#66d9ef">void</span>)<span style="color:#a6e22e">c</span> {
    NSLog(<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">c - Foo_SUB - %@</span><span style="color:#e6db74">&#34;</span>, self);
}

- (<span style="color:#66d9ef">void</span>)<span style="color:#a6e22e">d</span> {
    NSLog(<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">d - Foo_SUB - %@</span><span style="color:#e6db74">&#34;</span>, self);
}

- (<span style="color:#66d9ef">void</span>)<span style="color:#a6e22e">f</span> {
    <span style="color:#75715e">// self ä¸º Bar
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// [self f]; // -[Bar f]: unrecognized selector sent to instance 0x102300290
</span><span style="color:#75715e"></span>
    <span style="color:#75715e">// [self performSelector:NSSelectorFromString(@&#34;e&#34;)]; // EXC_BAD_ACCESS
</span><span style="color:#75715e"></span>
    NSLog(<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">f - Foo_SUB - %@</span><span style="color:#e6db74">&#34;</span>, self);
}

+ (<span style="color:#66d9ef">void</span>)<span style="color:#a6e22e">load</span> {
    <span style="color:#66d9ef">static</span> dispatch_once_t onceToken;
    dispatch_once(<span style="color:#f92672">&amp;</span>onceToken, <span style="color:#f92672">^</span>{
        <span style="color:#75715e">// 1. äº¤æ¢ b &amp; cï¼ˆb æ¥è‡ªæœ¬ç±»ï¼Œc æ¥è‡ªæœ¬ç±»çš„åˆ†ç±»ï¼‰
</span><span style="color:#75715e"></span>        {
            Method m_b <span style="color:#f92672">=</span> class_getInstanceMethod([self <span style="color:#66d9ef">class</span>], <span style="color:#66d9ef">@selector</span>(b));
            Method m_c <span style="color:#f92672">=</span> class_getInstanceMethod([self <span style="color:#66d9ef">class</span>], <span style="color:#66d9ef">@selector</span>(c));

            <span style="color:#75715e">// ç›´æ¥äº¤æ¢
</span><span style="color:#75715e"></span>            method_exchangeImplementations(m_b, m_c);
        }

        <span style="color:#75715e">// 2. äº¤æ¢ a &amp; dï¼ˆa æ¥è‡ªåŸºç±»ï¼Œæœ¬ç±»æœªå®ç°ï¼Œd æ¥è‡ªæœ¬ç±»çš„åˆ†ç±»ï¼‰
</span><span style="color:#75715e"></span>        {
            Method m_a <span style="color:#f92672">=</span> class_getInstanceMethod([self <span style="color:#66d9ef">class</span>], <span style="color:#66d9ef">@selector</span>(a));
            Method m_d <span style="color:#f92672">=</span> class_getInstanceMethod([self <span style="color:#66d9ef">class</span>], <span style="color:#66d9ef">@selector</span>(d));

            <span style="color:#75715e">// 2-1. äº¤æ¢ IMP
</span><span style="color:#75715e"></span>            {
                <span style="color:#75715e">// ä¸ºäº†é˜²æ­¢åŸºç±»çš„æ–¹æ³•è¢«æ”¹å˜ï¼Œé‚£ä¹ˆéœ€è¦å…ˆä¸ºæœ¬ç±»æ·»åŠ  m_a æ–¹æ³•ï¼ˆoverrideï¼‰
</span><span style="color:#75715e"></span>                class_addMethod([self <span style="color:#66d9ef">class</span>], <span style="color:#66d9ef">@selector</span>(a), method_getImplementation(m_a), method_getTypeEncoding(m_a));
                <span style="color:#75715e">// å†è·å–æœ¬ç±»ä¸­æ·»åŠ çš„æ–¹æ³•
</span><span style="color:#75715e"></span>                Method m_a_sub <span style="color:#f92672">=</span> class_getInstanceMethod([self <span style="color:#66d9ef">class</span>], <span style="color:#66d9ef">@selector</span>(a));
                <span style="color:#75715e">// äº¤æ¢
</span><span style="color:#75715e"></span>                method_exchangeImplementations(m_a_sub, m_d);
            }

            <span style="color:#75715e">// 2-2. æ›¿æ¢æ–¹æ³•
</span><span style="color:#75715e"></span>            {
                <span style="color:#75715e">// ä¸ºäº†é˜²æ­¢åŸºç±»çš„æ–¹æ³•è¢«æ”¹å˜ï¼Œé‚£ä¹ˆéœ€è¦å…ˆä¸ºæœ¬ç±»æ·»åŠ  m_a æ–¹æ³•ï¼ˆoverrideï¼‰ï¼Œä½† IMP å’Œ TypeEncoding å¯ç›´æ¥ä½¿ç”¨ m_d çš„ä¿¡æ¯
</span><span style="color:#75715e"></span>                class_addMethod([self <span style="color:#66d9ef">class</span>], <span style="color:#66d9ef">@selector</span>(a), method_getImplementation(m_d), method_getTypeEncoding(m_d));
                <span style="color:#75715e">// å†æ›¿ä»£æ–¹æ³• d æ–¹æ³•çš„ IMP å’Œ TypeEncoding ä¸º m_a çš„ä¿¡æ¯
</span><span style="color:#75715e"></span>                class_replaceMethod([self <span style="color:#66d9ef">class</span>], <span style="color:#66d9ef">@selector</span>(d), method_getImplementation(m_a), method_getTypeEncoding(m_a));
            }
        }

        <span style="color:#75715e">// 3. äº¤æ¢ e &amp; fï¼ˆe æ¥è‡ª Bar ç±»ï¼Œf æ¥è‡ª Foo_SUB ç±»ï¼‰
</span><span style="color:#75715e"></span>        {
            Method m_e <span style="color:#f92672">=</span> class_getInstanceMethod([Bar <span style="color:#66d9ef">class</span>], <span style="color:#66d9ef">@selector</span>(e));
            Method m_f <span style="color:#f92672">=</span> class_getInstanceMethod([Foo_SUB <span style="color:#66d9ef">class</span>], <span style="color:#66d9ef">@selector</span>(f));

            <span style="color:#75715e">// ç›´æ¥äº¤æ¢
</span><span style="color:#75715e"></span>            method_exchangeImplementations(m_e, m_f);

            <span style="color:#75715e">// âš ï¸ éœ€è¦æ³¨æ„çš„æ˜¯ï¼š
</span><span style="color:#75715e"></span>            <span style="color:#75715e">// 1. æ­¤æ—¶ä¸èƒ½åœ¨ç›¸åº”çš„æ–¹æ³•ä¸­å†è°ƒç”¨è‡ªèº«çš„æ–¹æ³•ï¼Œè¿™ä¸äº¤æ¢æœ¬ç±»çš„ä¸¤ä¸ªæ–¹æ³•ä¸åŒã€‚
</span><span style="color:#75715e"></span>            <span style="color:#75715e">// æ¯”å¦‚æ­¤æ—¶çš„ `f` æ–¹æ³•ï¼Œäº¤æ¢åæ˜¯é€šè¿‡ `Bar` å®ä¾‹å¯¹è±¡è°ƒç”¨ï¼ˆå‘é€ï¼‰çš„ï¼Œéšå¼å‚æ•° `self` ä¸º `Bar` ç±»å‹ï¼Œè€Œè¯¥ç±»çš„æ–¹æ³•åˆ—è¡¨ä¸­æ ¹æœ¬ä¸åŒ…å« `f` æ–¹æ³•ï¼Œå› æ­¤è°ƒç”¨æ—¶å³å‘ç”Ÿ Crashï¼Œåä¹‹ `e` æ–¹æ³•åŒç†ï¼›
</span><span style="color:#75715e"></span>            <span style="color:#75715e">// 2. æ­¤æ—¶ä¹Ÿä¸èƒ½åœ¨ç›¸åº”çš„æ–¹æ³•ä¸­å†è°ƒç”¨å½“å‰æ–¹æ³•ã€‚
</span><span style="color:#75715e"></span>            <span style="color:#75715e">// æ¯”å¦‚æ­¤æ—¶çš„ `e` æ–¹æ³•ï¼Œäº¤æ¢åæ˜¯é€šè¿‡ `Foo_SUB` å®ä¾‹å¯¹è±¡è°ƒç”¨ï¼ˆå‘é€ï¼‰çš„ï¼Œéšå¼å‚æ•° `self` ä¸º `Foo_SUB` ç±»å‹ï¼Œè¯¥ç±»ä¸­ç¡®å®åŒ…å« `f` æ–¹æ³•ï¼Œä½†ç”±äºå…¶ IMP å·²ç»è¢«äº¤æ¢ï¼Œè°ƒç”¨åä¼šå†æ¬¡è¿›å…¥å½“å‰ `e` æ–¹æ³•ï¼Œä»è€Œé€ æˆæ­»å¾ªç¯ï¼Œåä¹‹ `f` æ–¹æ³•åŒç†ã€‚
</span><span style="color:#75715e"></span>        }

        <span style="color:#75715e">// 4. é€šç”¨å¤„ç†
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> (false) {
            Method m1 <span style="color:#f92672">=</span> class_getInstanceMethod([self <span style="color:#66d9ef">class</span>], <span style="color:#66d9ef">@selector</span>(b));
            Method m2 <span style="color:#f92672">=</span> class_getInstanceMethod([self <span style="color:#66d9ef">class</span>], <span style="color:#66d9ef">@selector</span>(c));
            
            <span style="color:#66d9ef">if</span> (class_addMethod([self <span style="color:#66d9ef">class</span>], <span style="color:#66d9ef">@selector</span>(b), method_getImplementation(m2), method_getTypeEncoding(m2))) {
                class_replaceMethod([self <span style="color:#66d9ef">class</span>], <span style="color:#66d9ef">@selector</span>(c), method_getImplementation(m1), method_getTypeEncoding(m1));
            } <span style="color:#66d9ef">else</span> {
                method_exchangeImplementations(m1, m2);
            }
        }
    });
}

<span style="color:#66d9ef">@end</span>

<span style="color:#66d9ef">int</span> main(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span> argv[]) {
    <span style="color:#66d9ef">@autoreleasepool</span> {
        {
            Foo_SUB <span style="color:#f92672">*</span>f <span style="color:#f92672">=</span> [[Foo_SUB alloc] init];
            [f b];
            [f c];

            <span style="color:#75715e">// c - Foo_SUB - &lt;Foo_SUB: 0x10051b090&gt;
</span><span style="color:#75715e"></span>            <span style="color:#75715e">// b - Foo_SUB - &lt;Foo_SUB: 0x10051b090&gt;
</span><span style="color:#75715e"></span>        }

        {
            Foo_SUB <span style="color:#f92672">*</span>f1 <span style="color:#f92672">=</span> [[Foo_SUB alloc] init];
            [f1 a];
            [f1 d];
            <span style="color:#75715e">// d - Foo_SUB - &lt;Foo_SUB: 0x100505fd0&gt;
</span><span style="color:#75715e"></span>            <span style="color:#75715e">// a - Foo_BASE - &lt;Foo_SUB: 0x100505fd0&gt;
</span><span style="color:#75715e"></span>
            Foo_BASE <span style="color:#f92672">*</span>f2 <span style="color:#f92672">=</span> [[Foo_BASE alloc] init];
            [f2 a];
            <span style="color:#75715e">// a - Foo_BASE - &lt;Foo_BASE: 0x1021008a0&gt;
</span><span style="color:#75715e"></span>        }

        {
            Bar <span style="color:#f92672">*</span>b <span style="color:#f92672">=</span> [[Bar alloc] init];
            Foo_SUB <span style="color:#f92672">*</span>f <span style="color:#f92672">=</span> [[Foo_SUB alloc] init];

            [b e]; <span style="color:#75715e">// f - Foo_SUB - &lt;Bar: 0x103001f10&gt;
</span><span style="color:#75715e"></span>            [f f]; <span style="color:#75715e">// e - Bar - &lt;Foo_SUB: 0x103000cc0&gt;
</span><span style="color:#75715e"></span>        }
    }
}
</code></pre></div><h3 id="heading-11">ç†è§£ã€Œç±»å¯¹è±¡ã€çš„ç”¨æ„</h3>
<p>ç•¥ï¼›å…³äºç±»å¯¹è±¡ï¼Œå¯è¯¦è§ã€Š<a href="../objects_in_obj-c/">Obj-C ä¸­çš„å¯¹è±¡</a>ã€‹ä¸€æ–‡ï¼›å…³äºå†…çœï¼Œå¯è¯¦è§ã€Š<a href="../type_introspection_and_reflection/">Obj-C &amp; Swift çš„ç±»å‹å†…çœä¸åå°„</a>ã€‹ä¸€æ–‡ï¼›</p>
<h2 id="-api-">æ¥å£ä¸ API è®¾è®¡</h2>
<h3 id="heading-12">ç”¨å‰ç¼€é¿å…å‘½åç©ºé—´å†²çª</h3>
<p>Obj-C æ²¡æœ‰å‘½åç©ºé—´ï¼ˆNamespaceï¼‰æœºåˆ¶ï¼›å› æ­¤ä¸ºäº†é¿å…é‡å¤ç¬¦å·ï¼ˆDuplicate Symbolï¼‰é”™è¯¯ï¼Œéœ€åœ¨ç±»åå‰åŠ å…¥å‰ç¼€ä»¥åŒºåˆ†ã€‚</p>
<h3 id="heading-13">æä¾›ã€Œå…¨èƒ½åˆå§‹åŒ–æ–¹æ³•ã€</h3>
<p>å…¨èƒ½åˆå§‹åŒ–æ–¹æ³•ï¼ˆDesignated Initializerï¼Œåˆç§°æŒ‡å®šåˆå§‹åŒ–æ–¹æ³•ï¼‰æŒ‡çš„æ˜¯ä¸ºå¯¹è±¡æä¾›å¿…è¦ä¿¡æ¯ä»¥ä¾¿å…¶èƒ½å®Œæˆå·¥ä½œçš„åˆå§‹åŒ–æ–¹æ³•ã€‚ä¸€ä¸ªç±»å¯èƒ½ä¸æ­¢æœ‰ä¸€ä¸ªåˆå§‹åŒ–æ–¹æ³•ï¼Œä½†é€šå¸¸å°†é€‰æ‹©å…¶ä¸­ä¹‹ä¸€ä½œä¸ºå…¨èƒ½åˆå§‹åŒ–æ–¹æ³•ï¼Œè€Œå…¶å®ƒåˆå§‹åŒ–æ–¹æ³•é—´æ¥ä¾èµ–å®ƒï¼Œè¿™æ ·å¯ä»¥ä¿è¯åˆå§‹åŒ–é€»è¾‘çš„ç»Ÿä¸€ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec"><span style="color:#66d9ef">@interface</span> <span style="color:#a6e22e">Rectangle</span> : <span style="color:#a6e22e">NSObject</span>
<span style="color:#66d9ef">@property</span> (<span style="color:#66d9ef">nonatomic</span>, <span style="color:#66d9ef">assign</span>, <span style="color:#66d9ef">readonly</span>) <span style="color:#66d9ef">double</span> width;
<span style="color:#66d9ef">@property</span> (<span style="color:#66d9ef">nonatomic</span>, <span style="color:#66d9ef">assign</span>, <span style="color:#66d9ef">readonly</span>) <span style="color:#66d9ef">double</span> height;

- (<span style="color:#66d9ef">instancetype</span>)<span style="color:#a6e22e">initWithWidth:</span>(<span style="color:#66d9ef">double</span>)width <span style="color:#a6e22e">height:</span>(<span style="color:#66d9ef">double</span>)height;
<span style="color:#66d9ef">@end</span>

<span style="color:#66d9ef">@implementation</span> <span style="color:#a6e22e">Rectangle</span>
- (<span style="color:#66d9ef">instancetype</span>)<span style="color:#a6e22e">initWithWidth:</span>(<span style="color:#66d9ef">double</span>)width <span style="color:#a6e22e">height:</span>(<span style="color:#66d9ef">double</span>)height {
    self <span style="color:#f92672">=</span> [super init];
    <span style="color:#66d9ef">if</span> (self) {
        _width <span style="color:#f92672">=</span> width;
        _height <span style="color:#f92672">=</span> height;
    }
    <span style="color:#66d9ef">return</span> self;
}

- (<span style="color:#66d9ef">instancetype</span>)<span style="color:#a6e22e">init</span> {
    <span style="color:#75715e">// è°ƒç”¨å…¨èƒ½åˆå§‹åŒ–æ–¹æ³•ä»¥æ„é€ 
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">return</span> [self initWithWidth:<span style="color:#ae81ff">0.0</span> height:<span style="color:#ae81ff">0.0</span>];
    <span style="color:#75715e">// ä¹Ÿå¯æŠ›å‡ºå¼‚å¸¸ï¼Œé¿å…å¤–ç•Œé€šè¿‡ init æ„é€ 
</span><span style="color:#75715e"></span><span style="color:#75715e">//    @throw [NSException exceptionWithName:NSInternalInconsistencyException
</span><span style="color:#75715e"></span><span style="color:#75715e">//                                   reason:@&#34;Must use initWithWidth:height: instead.&#34;
</span><span style="color:#75715e"></span><span style="color:#75715e">//                                 userInfo:nil];
</span><span style="color:#75715e"></span>}

<span style="color:#75715e">// å¦ä¸€ä¸ªå…¨èƒ½æ„é€ æ–¹æ³•
</span><span style="color:#75715e"></span>- (<span style="color:#66d9ef">instancetype</span>)<span style="color:#a6e22e">initWithCoder:</span>(NSCoder <span style="color:#f92672">*</span>)coder {
    self <span style="color:#f92672">=</span> [super init];
    <span style="color:#66d9ef">if</span> (self) {
        _width <span style="color:#f92672">=</span> [coder decodeDoubleForKey:<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">width</span><span style="color:#e6db74">&#34;</span>];
        _height <span style="color:#f92672">=</span> [coder decodeDoubleForKey:<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">height</span><span style="color:#e6db74">&#34;</span>];
    }
    <span style="color:#66d9ef">return</span> self;
}
<span style="color:#66d9ef">@end</span>

<span style="color:#66d9ef">@interface</span> <span style="color:#a6e22e">Square</span> : <span style="color:#a6e22e">Rectangle</span>
- (<span style="color:#66d9ef">instancetype</span>)<span style="color:#a6e22e">initWithDimension:</span>(<span style="color:#66d9ef">double</span>)dimension;
<span style="color:#66d9ef">@end</span>

<span style="color:#66d9ef">@implementation</span> <span style="color:#a6e22e">Square</span>
- (<span style="color:#66d9ef">instancetype</span>)<span style="color:#a6e22e">initWithDimension:</span>(<span style="color:#66d9ef">double</span>)dimension {
    <span style="color:#75715e">// è°ƒç”¨çˆ¶ç±»å…¨èƒ½åˆå§‹åŒ–æ–¹æ³•ä»¥æ„é€ 
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">return</span> [super initWithWidth:dimension height:dimension];
}

- (<span style="color:#66d9ef">instancetype</span>)<span style="color:#a6e22e">initWithWidth:</span>(<span style="color:#66d9ef">double</span>)width <span style="color:#a6e22e">height:</span>(<span style="color:#66d9ef">double</span>)height {
    <span style="color:#75715e">// å­ç±»å…¨èƒ½åˆå§‹åŒ–æ–¹æ³•ä¸åŒï¼Œéœ€é‡å†™çˆ¶ç±»å…¨èƒ½åˆå§‹åŒ–æ–¹æ³•
</span><span style="color:#75715e"></span><span style="color:#75715e">//    return [self initWithDimension:MAX(width, height)];
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// æˆ–å¯æŠ›å‡ºå¼‚å¸¸ï¼Œé¿å…å¤–ç•Œé€šè¿‡çˆ¶ç±»å…¨èƒ½åˆå§‹åŒ–æ–¹æ³•æ„é€ 
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">@throw</span> [NSException exceptionWithName:NSInternalInconsistencyException
                                   reason:<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">Must use initWithDimension: instead.</span><span style="color:#e6db74">&#34;</span>
                                 userInfo:nil];
}

- (<span style="color:#66d9ef">instancetype</span>)<span style="color:#a6e22e">init</span> {
    <span style="color:#75715e">// ä¹Ÿéœ€é‡å†™çˆ¶ç±» init æ–¹æ³•ï¼Œä½¿ç”¨å­ç±»å…¨èƒ½æ„é€ æ–¹æ³•
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">return</span> [self initWithDimension:<span style="color:#ae81ff">0.0</span>];
}

- (<span style="color:#66d9ef">instancetype</span>)<span style="color:#a6e22e">initWithCoder:</span>(NSCoder <span style="color:#f92672">*</span>)coder {
    <span style="color:#75715e">// å…ˆè°ƒç”¨çˆ¶ç±» initWithCoder: å…¨èƒ½æ„é€ æ–¹æ³•
</span><span style="color:#75715e"></span>    self <span style="color:#f92672">=</span> [super initWithCoder:coder];
    <span style="color:#66d9ef">if</span> (self) {
        <span style="color:#75715e">// ...
</span><span style="color:#75715e"></span>    }
    <span style="color:#66d9ef">return</span> self;
}
<span style="color:#66d9ef">@end</span>
</code></pre></div><h3 id="-description-">å®ç° description æ–¹æ³•</h3>
<p>NSObject å­ç±»å¯ä»¥é‡å†™ <code>description</code> æ–¹æ³•æ¥æè¿°å®ä¾‹ï¼Œåœ¨æ‰“å°ï¼ˆ<code>NSLog</code>ï¼‰å®ä¾‹ä¿¡æ¯æ—¶å³å¯è¾“å‡ºï¼›ä¹Ÿå¯é‡å†™ <code>debugDescription</code> ç”¨æ¥åœ¨æ§åˆ¶å°ä½¿ç”¨ LLDB <code>po</code> å‘½ä»¤è¾“å‡ºï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec"><span style="color:#75715e">// ...
</span><span style="color:#75715e"></span><span style="color:#66d9ef">@implementation</span> <span style="color:#a6e22e">Rectangle</span>
<span style="color:#75715e">// ...
</span><span style="color:#75715e"></span>
- (NSString <span style="color:#f92672">*</span>)<span style="color:#a6e22e">description</span> {
    <span style="color:#66d9ef">return</span> [NSString stringWithFormat:<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">&lt;%lf, %lf&gt;</span><span style="color:#e6db74">&#34;</span>, _width, _height];
}

- (NSString <span style="color:#f92672">*</span>)<span style="color:#a6e22e">debugDescription</span> {
    <span style="color:#66d9ef">return</span> [NSString stringWithFormat:<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">&lt;%@: %p&gt; &lt;%lf, %lf&gt;</span><span style="color:#e6db74">&#34;</span>, [self <span style="color:#66d9ef">class</span>], self, _width, _height];
}
<span style="color:#66d9ef">@end</span>

Rectangle <span style="color:#f92672">*</span>rect <span style="color:#f92672">=</span> [[Rectangle alloc] initWithWidth:<span style="color:#ae81ff">30</span> height:<span style="color:#ae81ff">50</span>];
NSLog(<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">%@</span><span style="color:#e6db74">&#34;</span>, rect);

<span style="color:#75715e">// OUTPUT:
</span><span style="color:#75715e"></span><span style="color:#75715e">// &lt;30.000000, 50.000000&gt;
</span><span style="color:#75715e"></span><span style="color:#75715e">// (lldb) po rect
</span><span style="color:#75715e"></span><span style="color:#75715e">// &lt;Rectangle: 0x6000037887e0&gt; &lt;30.000000, 50.000000&gt;
</span></code></pre></div><h3 id="heading-14">å°½é‡ä½¿ç”¨ä¸å¯å˜å¯¹è±¡</h3>
<p>å°½é‡å°†å¤–ç•Œä¸èƒ½æ”¹å˜çš„å±æ€§å¯¹å¤–å£°æ˜ä¸º <code>readonly</code>ï¼Œæ­¤æ—¶å°†åªå­˜åœ¨ getter è€Œä¸å­˜åœ¨ setterã€‚æˆ‘ä»¬å¯ä»¥åœ¨å®ç°æ–‡ä»¶ä¸­ç›´æ¥é€šè¿‡è®¿é—®æˆå‘˜å˜é‡æ¥æ›´æ”¹ï¼Œä¹Ÿå¯å°†å±æ€§å†æ¬¡å£°æ˜åœ¨ç±»æ‰©å±•ä¸­ä»¥é€šè¿‡ setter æ›´æ”¹ã€‚</p>
<p>ç”±äºå†…å­˜ç®¡ç†è¯­ä¹‰ä»…é’ˆå¯¹ setterï¼Œå› æ­¤å£°æ˜ä¸º <code>readonly</code> æ—¶ä¹Ÿå¯ä½¿ç”¨é»˜è®¤çš„å†…å­˜ç®¡ç†è¯­ä¹‰ã€‚<code>readonly</code> å¹¶éæ˜¯å®Œå…¨å®‰å…¨çš„ï¼Œå¤–éƒ¨ä»ç„¶å¯ä»¥é€šè¿‡ KVCã€æˆ–è€…æ ¹æ®å†…å­˜å¸ƒå±€çš„åç§»é‡ç›´æ¥è®¿é—®ä¿®æ”¹ã€‚å¯¹äºé›†åˆç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¸å¯å˜å±æ€§æœ¬èº«ä½œä¸º <code>readonly</code> æš´éœ²åœ¨å¤–ï¼Œå¹¶é€šè¿‡é¢å¤–æ–¹æ³•ä½¿å¾—å¤–ç•Œå¯ä»¥æ·»åŠ æˆ–åˆ é™¤ç­‰æ“ä½œé›†åˆï¼›åœ¨å†…éƒ¨åˆ™é€šè¿‡å¦å¤–çš„å¯å˜ç±»å‹å±æ€§ä½œä¸ºå…·ä½“å®ç°ï¼Œä»è€Œé¿å…ä»åº•å±‚ç›´æ¥ä¿®æ”¹å¯¹è±¡ä¸­çš„æ•°æ®ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec"><span style="color:#66d9ef">@interface</span> <span style="color:#a6e22e">Rectangle</span> : <span style="color:#a6e22e">NSObject</span>
<span style="color:#66d9ef">@property</span> (<span style="color:#66d9ef">nonatomic</span>, <span style="color:#66d9ef">assign</span>, <span style="color:#66d9ef">readonly</span>) <span style="color:#66d9ef">double</span> width;
<span style="color:#66d9ef">@property</span> (<span style="color:#66d9ef">nonatomic</span>, <span style="color:#66d9ef">readonly</span>) <span style="color:#66d9ef">double</span> height;
<span style="color:#66d9ef">@property</span> (<span style="color:#66d9ef">nonatomic</span>, <span style="color:#66d9ef">strong</span>, <span style="color:#66d9ef">readonly</span>) NSArray<span style="color:#f92672">&lt;</span>Rectangle <span style="color:#f92672">*</span><span style="color:#f92672">&gt;</span> <span style="color:#f92672">*</span>array;

- (<span style="color:#66d9ef">void</span>)<span style="color:#a6e22e">addElement:</span>(Rectangle <span style="color:#f92672">*</span>)element;
- (<span style="color:#66d9ef">void</span>)<span style="color:#a6e22e">removeElement:</span>(Rectangle <span style="color:#f92672">*</span>)element;
<span style="color:#66d9ef">@end</span>

<span style="color:#66d9ef">@interface</span> <span style="color:#a6e22e">Rectangle</span> ()
<span style="color:#66d9ef">@property</span> (<span style="color:#66d9ef">nonatomic</span>, <span style="color:#66d9ef">assign</span>, <span style="color:#66d9ef">readwrite</span>) <span style="color:#66d9ef">double</span> width;
<span style="color:#66d9ef">@property</span> (<span style="color:#66d9ef">nonatomic</span>, <span style="color:#66d9ef">assign</span>) <span style="color:#66d9ef">double</span> height;
<span style="color:#66d9ef">@end</span>

<span style="color:#66d9ef">@implementation</span> <span style="color:#a6e22e">Rectangle</span> {
    NSMutableArray <span style="color:#f92672">*</span>_mutableArray;
}

- (NSArray <span style="color:#f92672">*</span>)<span style="color:#a6e22e">array</span> {
    <span style="color:#66d9ef">return</span> [_mutableArray <span style="color:#66d9ef">copy</span>];
}

- (<span style="color:#66d9ef">void</span>)<span style="color:#a6e22e">addElement:</span>(Rectangle <span style="color:#f92672">*</span>)element {
    [_mutableArray addObject:element];
}

- (<span style="color:#66d9ef">void</span>)<span style="color:#a6e22e">removeElement:</span>(Rectangle <span style="color:#f92672">*</span>)element {
    [_mutableArray removeObject:element];
}

- (<span style="color:#66d9ef">instancetype</span>)<span style="color:#a6e22e">initWithWidth:</span>(<span style="color:#66d9ef">double</span>)width <span style="color:#a6e22e">height:</span>(<span style="color:#66d9ef">double</span>)height {
    self <span style="color:#f92672">=</span> [super init];
    <span style="color:#66d9ef">if</span> (self) {
        _width <span style="color:#f92672">=</span> width;
        _height <span style="color:#f92672">=</span> height;
        _mutableArray <span style="color:#f92672">=</span> [NSMutableArray new];
    }
    <span style="color:#66d9ef">return</span> self;
}
<span style="color:#66d9ef">@end</span>

Rectangle <span style="color:#f92672">*</span>rect1 <span style="color:#f92672">=</span> [[Rectangle alloc] initWithWidth:<span style="color:#ae81ff">10</span> height:<span style="color:#ae81ff">20</span>];
Rectangle <span style="color:#f92672">*</span>rect2 <span style="color:#f92672">=</span> [[Rectangle alloc] initWithWidth:<span style="color:#ae81ff">10</span> height:<span style="color:#ae81ff">20</span>];
[rect1 addElement:rect2];
</code></pre></div><h3 id="heading-15">ä½¿ç”¨æ¸…æ™°è€Œåè°ƒçš„å‘½åæ–¹å¼</h3>
<p>ä¸€äº› Obj-C çš„æ–¹æ³•åååˆ†å†—é•¿ï¼Œä½†å´è¯­ä¹‰åŒ–æ›´åŠ ï¼Œè¿™ç‚¹ Swift ä¹Ÿç»§æ‰¿äº†å…¶ä¼˜ç‚¹ï¼Œå¹¶é€‚å½“ç²¾ç®€æ–¹æ³•åã€‚æ–¹æ³•çš„å‘½åè§„åˆ™ï¼š</p>
<ul>
<li>è‹¥è¿”å›å€¼æ˜¯æ–°åˆ›å»ºçš„ï¼Œé‚£ä¹ˆæ–¹æ³•ååº”å½“ä»¥è¿”å›å€¼ç±»å‹å¼€å§‹ï¼Œä¹Ÿå¯åŠ å…¥å¯¹å…¶ä¿®é¥°ï¼›</li>
<li>è¡¨ç¤ºå‚æ•°ç±»å‹çš„åè¯åº”å½“ç½®äºå‚æ•°ä¹‹å‰ï¼›</li>
<li>æ–¹æ³•å†…çš„è¡Œä¸ºè¦æ“ä½œå½“å‰å¯¹è±¡ï¼Œé‚£ä¹ˆåº”å½“åŒ…å«åŠ¨è¯ï¼›è‹¥æ‰§è¡Œæ—¶éœ€è¦å‚æ•°ï¼Œåˆ™åº”å½“åœ¨åŠ¨è¯ä¹‹ååŠ ä¸Šä¸€ä¸ªæˆ–å¤šä¸ªåè¯ï¼›</li>
<li>ä½¿ç”¨ <code>string</code> å…¨ç§°è€Œé <code>str</code> ç®€ç§°ï¼›</li>
<li><code>Boolean</code> å±æ€§åº”å½“åŠ  <code>is</code> å‰ç¼€ï¼›æ ¹æ®åŠŸèƒ½å°†è¿”å› <code>Boolean</code> ç±»å‹çš„æ–¹æ³•åé€‰æ‹© <code>has</code> æˆ– <code>is</code> å‰ç¼€ï¼›</li>
<li>ä½¿ç”¨è¾“å‡ºå‚æ•°ï¼ˆOut Parameterï¼‰ä¿å­˜è¿”å›å€¼çš„æ–¹æ³•å¯ä»¥ä½¿ç”¨ <code>get</code> å‰ç¼€ã€‚</li>
</ul>
<p>ç±»ä¸åè®®çš„åç§°å°½é‡è¦åŠ ä¸Šå‰ç¼€ï¼Œä»¥é¿å…å‘½åç©ºé—´å†²çªã€‚å‘½åç¬¬ä¸€è¦åŠ¡æ˜¯ç¡®ä¿å…¶é£æ ¼ä¸ä»£ç æ¡†æ¶ç›¸ç¬¦åˆã€‚</p>
<h3 id="heading-16">ä¸ºç§æœ‰æ–¹æ³•ååŠ å‰ç¼€</h3>
<p>ç§æœ‰æ–¹æ³•é™¤äº†ä¸åº”å¯¹å¤–å£°æ˜ï¼Œä¹Ÿåº”åŠ ä¸Šå‰ç¼€ä¸ä»¥åŒºåˆ†ã€‚ä½†ä¸æ¨èå•ç”¨ä¸€ä¸ªä¸‹åˆ’çº¿ <code>_</code> ä½œä¸ºå‰ç¼€ï¼Œå› ä¸ºç³»ç»Ÿåº“ä¸­æœ‰å¾ˆå¤šç§æœ‰æ–¹æ³•å³æ˜¯ä»¥ <code>_</code> ä¸ºå‰ç¼€çš„ã€‚</p>
<h3 id="-objective-c--1">ç†è§£ Objective-C é”™è¯¯æ¨¡å‹</h3>
<p>å¼‚å¸¸ï¼ˆExceptionï¼‰ä¸é”™è¯¯ï¼ˆErrorï¼‰åœ¨è®¡ç®—æœºä¸­ä»£è¡¨ç€å®Œå…¨ä¸åŒçš„ä¸¤ç§æ„ä¹‰ã€‚</p>
<p>å¼‚å¸¸å®‰å…¨ï¼ˆException Safeï¼‰æŒ‡çš„æ˜¯å½“æŠ›å‡ºå¼‚å¸¸æ—¶ï¼Œéœ€è¦é‡Šæ”¾çš„èµ„æºæˆ–å¯¹è±¡ä¹Ÿèƒ½å¾—åˆ°å®‰å…¨åœ°é‡Šæ”¾ã€‚è‡ªåŠ¨å¼•ç”¨è®¡æ•°é»˜è®¤æ˜¯éå¼‚å¸¸å®‰å…¨çš„ï¼Œä½†å¯ä»¥é€šè¿‡ <code>-fobjc-arc-exceptions</code> è®¾ç½®ç¼–è¯‘å™¨ä»¥è¾¾åˆ°å¼‚å¸¸å®‰å…¨ï¼ˆè¯¦è§ä¸‹æ–‡ã€Œç¼–å†™ã€Œå¼‚å¸¸å®‰å…¨ä»£ç æ—¶ã€ç•™æ„å†…å­˜ç®¡ç†é—®é¢˜ã€ä¸€èŠ‚ï¼‰ã€‚ç”±äºå¼‚å¸¸å®‰å…¨å¾ˆéš¾å¾—åˆ°ä¿è¯ï¼Œå› æ­¤æ¨èåªåœ¨å¿…è¦æ—¶ï¼ˆå¦‚é‡å¤§é”™è¯¯ï¼‰æŠ›å‡ºå¼‚å¸¸ï¼Œå¹¶ç»ˆæ­¢ç¨‹åºï¼Œè€Œä¸å†è€ƒè™‘å¼‚å¸¸å®‰å…¨ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec"><span style="color:#66d9ef">@throw</span> [NSException exceptionWithName:NSInternalInconsistencyException reason:<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">Some reason.</span><span style="color:#e6db74">&#34;</span> userInfo:nil];
</code></pre></div><p>éè‡´å‘½é”™è¯¯ï¼ˆNon-fatal Errorï¼‰å¯ä»¥ä»¤æ–¹æ³•è¿”å› <code>nil</code> / <code>0</code> æˆ– <code>NSError</code>ï¼Œä»¥è¡¨æ˜æœ‰é”™è¯¯å‘ç”Ÿã€‚å¯¹äº NSErrorï¼š</p>
<ul>
<li>Error Domainï¼ˆ<code>NSErrorDomain</code> æœ¬è´¨ä¸º <code>NSString</code>ï¼‰ï¼šé”™è¯¯èŒƒå›´è¡¨æ˜äº†é”™è¯¯æ ¹æºï¼Œeg. <code>NSURLErrorDomain</code>ã€<code>NSCocoaErrorDomain</code> ç­‰ï¼›</li>
<li>Error Codeï¼ˆ<code>NSInteger</code>ï¼‰ï¼šé”™è¯¯ä»£ç è¡¨æ˜äº†å…·ä½“çš„ç‹¬æœ‰é”™è¯¯ï¼Œå¯ä½¿ç”¨æšä¸¾å®šä¹‰ï¼›</li>
<li>User Infoï¼ˆ<code>NSDictionary&lt;NSErrorUserInfoKey,id&gt;</code>ï¼Œ<code>NSErrorUserInfoKey</code> æœ¬è´¨ä¸º <code>NSString</code>ï¼‰ï¼šç”¨æˆ·ä¿¡æ¯è¡¨æ˜äº†å…³äºé”™è¯¯çš„é¢å¤–ä¿¡æ¯ï¼Œæ¯”å¦‚æœ¬åœ°åŒ–çš„é”™è¯¯æè¿°ã€‚</li>
</ul>
<p><code>NSError</code> å¸¸è§ç”¨æ³•ä¸€æ˜¯é€šè¿‡ä»£ç†åè®®ï¼ˆDelegate Protocolsï¼‰ä¼ é€’ã€‚å½“é”™è¯¯å‘ç”Ÿæ—¶ï¼Œå°†é€šè¿‡è°ƒç”¨ä»£ç†å¯¹è±¡çš„æŸä¸ªåè®®æ–¹æ³•æ¥å‘ŠçŸ¥ä»£ç†æœ¬èº«ï¼›äºŒæ˜¯é€šè¿‡æ–¹æ³•çš„è¾“å‡ºå‚æ•°è¿”å›ç»™è°ƒç”¨è€…ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec"><span style="color:#75715e">// NSURLConnection.h
</span><span style="color:#75715e"></span><span style="color:#66d9ef">@protocol</span> <span style="color:#a6e22e">NSURLConnectionDelegate</span> <span style="color:#f92672">&lt;</span>NSObject<span style="color:#f92672">&gt;</span>
<span style="color:#66d9ef">@optional</span>
<span style="color:#f92672">-</span> (<span style="color:#66d9ef">void</span>)connection:(NSURLConnection <span style="color:#f92672">*</span>)connection didFailWithError:(NSError <span style="color:#f92672">*</span>)error;
<span style="color:#66d9ef">@end</span>

<span style="color:#75715e">// âŒ é”™è¯¯å‘ç”Ÿ
</span><span style="color:#75715e"></span>[self.delegate connection:someConnection didFailWithError:someError];

<span style="color:#75715e">// ---
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">extern</span> NSString <span style="color:#f92672">*</span><span style="color:#66d9ef">const</span> VErrorDomain;

<span style="color:#66d9ef">typedef</span> <span style="color:#a6e22e">NS_ENUM</span>(NSUInteger, VError) {
    VErrorUnknown <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,
    VErrorFirst   <span style="color:#f92672">=</span> <span style="color:#ae81ff">100</span>,
    VErrorSecond  <span style="color:#f92672">=</span> <span style="color:#ae81ff">200</span>
};

NSString <span style="color:#f92672">*</span><span style="color:#66d9ef">const</span> VErrorDomain <span style="color:#f92672">=</span> <span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">VErrorDomain</span><span style="color:#e6db74">&#34;</span>;

- (<span style="color:#66d9ef">BOOL</span>)<span style="color:#a6e22e">doSomething:</span>(NSError <span style="color:#f92672">*</span><span style="color:#f92672">*</span>)error {
    <span style="color:#75715e">// ...
</span><span style="color:#75715e"></span>
    <span style="color:#75715e">// å¦‚æœé”™è¯¯å‘ç”Ÿ
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (errorOccured) {
        <span style="color:#75715e">// å¦‚æœå¤–ç•Œå…³å¿ƒé”™è¯¯
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> (error) {
            <span style="color:#75715e">// è§£å¼•ç”¨ï¼ˆDereferenceï¼‰å‰è¦ä¿è¯ error ä¸ä¸º nil
</span><span style="color:#75715e"></span>            <span style="color:#75715e">// å¦åˆ™å¯¹ç©ºæŒ‡é’ˆè§£å¼•ç”¨ä¼šå¯¼è‡´æ®µé”™è¯¯ï¼ˆSegmentation Faultï¼‰å¹¶å´©æºƒï¼ˆEXC_BAD_ACCESSï¼‰
</span><span style="color:#75715e"></span>            <span style="color:#f92672">*</span>error <span style="color:#f92672">=</span> [NSError errorWithDomain:VErrorDomain code:VErrorFirst userInfo:nil];
        }

        <span style="color:#66d9ef">return</span> NO;
    } <span style="color:#66d9ef">else</span> {
        <span style="color:#66d9ef">return</span> YES;
    }
}
<span style="color:#75715e">// âŒ é”™è¯¯å‘ç”Ÿ
</span><span style="color:#75715e"></span>NSError <span style="color:#f92672">*</span>error <span style="color:#f92672">=</span> nil;
<span style="color:#66d9ef">BOOL</span> result <span style="color:#f92672">=</span> [obj doSomething:<span style="color:#f92672">&amp;</span>error];
<span style="color:#66d9ef">if</span> (error) {
    NSLog(<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">Error occurred!</span><span style="color:#e6db74">&#34;</span>);
}
</code></pre></div><p>ARC ä¸‹ï¼Œç¼–è¯‘å™¨å°†æŠŠç¬¬äºŒç§æ–¹æ³•ç­¾åä¸­çš„ <code>NSError **</code> è½¬æ¢ä¸º <code>NSError *__autoreleasing *</code>ï¼Œå³æŒ‡é’ˆæ‰€æŒ‡å‘çš„å¯¹è±¡å°†åœ¨æ–¹æ³•æ‰§è¡Œå®Œæ¯•åè‡ªåŠ¨é‡Šæ”¾ï¼Œå› ä¸ºè¯¥æ–¹æ³•ä¸èƒ½ä¿è¯è°ƒç”¨è€…å°†å…¶ä¸­åˆ›å»ºçš„ <code>NSError</code> é‡Šæ”¾ï¼Œç”±æ­¤ä¿è¯ä¸å¤§éƒ¨åˆ†æ–¹æ³•ï¼ˆé™¤ <code>new</code> / <code>alloc</code> / <code>copy</code> / <code>mutableCopy</code> å¼€å¤´çš„æ–¹æ³•ï¼‰è¿”å›å€¼æ‰€å…·å¤‡çš„è¯­ä¹‰ç›¸åŒã€‚</p>
<!-- raw HTML omitted -->
<h3 id="-nscopying-">ç†è§£ NSCopying åè®®</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec"><span style="color:#66d9ef">@protocol</span> <span style="color:#a6e22e">NSCopying</span>
- (<span style="color:#66d9ef">id</span>)<span style="color:#a6e22e">copyWithZone:</span>(nullable NSZone <span style="color:#f92672">*</span>)zone;
<span style="color:#66d9ef">@end</span>

<span style="color:#66d9ef">@protocol</span> <span style="color:#a6e22e">NSMutableCopying</span>
- (<span style="color:#66d9ef">id</span>)<span style="color:#a6e22e">mutableCopyWithZone:</span>(nullable NSZone <span style="color:#f92672">*</span>)zone;
<span style="color:#66d9ef">@end</span>
</code></pre></div><p>å½“æˆ‘ä»¬è°ƒç”¨ä¸€ä¸ªå¯¹è±¡çš„ <code>copy</code> / <code>mutableCopy</code> æ–¹æ³•æ—¶ï¼Œè¯¥ç±»å¿…é¡»å®ç° <code>NSCopying</code> / <code>NSMutableCopying</code> åè®®ä¸­çš„å”¯ä¸€æ–¹æ³•ï¼ŒæŒ‡å®šè¯¥ç±»å®ä¾‹å¯¹è±¡çš„æ‹·è´é€»è¾‘ï¼Œè€Œ <code>copy</code> / <code>mutableCopy</code> æœ¬èº«ç”± <code>NSObject</code> å®ç°ã€‚è¿™é‡Œçš„ <code>NSZone</code> å®˜æ–¹è§£é‡Šæ˜¯ã€ŒA type used to identify and manage memory zonesã€ï¼Œå³ç”¨æ¥è¯†åˆ«å’Œç®¡ç†å†…å­˜åŒºåŸŸçš„ç±»å‹ï¼Œä½†ç›®å‰å·²ç»åŸºæœ¬åºŸå¼ƒï¼Œæ— éœ€å…³å¿ƒï¼ˆZones are ignored on iOS and 64-bit runtime in macOS. You should not use zones in current development. - Apple Developerï¼‰ã€‚ä¸ºäº†ä¿æŒå’Œç³»ç»Ÿæä¾›ç±»è¡Œä¸ºä¸€è‡´ï¼Œçº¦å®š <code>copy</code> å°†æ€»æ˜¯è¿”å›ä¸å¯å˜ç‰ˆæœ¬ï¼Œè€Œ <code>mutableCopy</code> æ€»æ˜¯è¿”å›å¯å˜ç‰ˆæœ¬ï¼Œä¸è°ƒç”¨è€…çš„ç±»å‹æ— å…³ï¼ˆæˆ–è€…å¯æä¾›ä¸€ä¸ª <code>immutableCopy</code> çš„æ–¹æ³•åŒºåˆ†ï¼‰ã€‚</p>
<!-- raw HTML omitted -->
<p>æ— è®ºæ˜¯æµ…æ‹·è´ï¼ˆShallow Copyï¼‰è¿˜æ˜¯æ·±æ‹·è´ï¼ˆDeep Copyï¼‰ï¼Œå¯¹è±¡æœ¬èº«éƒ½ä¼šé‡æ–°åˆ›å»ºï¼Œå…¶ä¸­çš„æ ‡é‡ä¹Ÿä¼šç›´æ¥å¤åˆ¶ï¼Œè€Œé’ˆå¯¹äºä½¿ç”¨å¯¹è±¡ä¸­çš„æŒ‡é’ˆæˆ–åœ°å€æŒ‡å‘çš„ç±»å‹ï¼Œå‰è€…ä»…ä»…æ‹·è´æŒ‡å‘åœ°å€ï¼Œè€Œåè€…åˆ™æ˜¯å°†æŒ‡å‘çš„æ•°æ®ä¹Ÿæ‹·è´ä¸€ä»½è‡³æ–°çš„å†…å­˜åœ°å€ã€‚<code>Foundation</code> ä¸­çš„é›†åˆç±»å‹é»˜è®¤æ‰§è¡Œæµ…æ‹·è´ï¼ˆå› ä¸ºé›†åˆç±»å‹å†…éƒ¨çš„å±æ€§å¹¶ä¸ä¸€å®šéƒ½èƒ½æ‹·è´ï¼‰ï¼Œå› æ­¤è‡ªå®šä¹‰ç±»ä¸­æˆ‘ä»¬ä¹Ÿé»˜è®¤æ˜¯æµ…æ‹·è´ï¼Œå¿…è¦æ—¶å®šä¹‰ç±»ä¼¼ <code>deepCoby</code> æ–¹æ³•ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec"><span style="color:#66d9ef">@interface</span> <span style="color:#a6e22e">Rectangle</span> : <span style="color:#a6e22e">NSObject</span>
<span style="color:#66d9ef">@property</span> (<span style="color:#66d9ef">nonatomic</span>, <span style="color:#66d9ef">assign</span>, <span style="color:#66d9ef">readonly</span>) <span style="color:#66d9ef">double</span> width;
<span style="color:#66d9ef">@property</span> (<span style="color:#66d9ef">nonatomic</span>, <span style="color:#66d9ef">readonly</span>) <span style="color:#66d9ef">double</span> height;
<span style="color:#66d9ef">@property</span> (<span style="color:#66d9ef">nonatomic</span>, <span style="color:#66d9ef">strong</span>, <span style="color:#66d9ef">readonly</span>) NSArray<span style="color:#f92672">&lt;</span>Rectangle <span style="color:#f92672">*</span><span style="color:#f92672">&gt;</span> <span style="color:#f92672">*</span>array;

- (<span style="color:#66d9ef">void</span>)<span style="color:#a6e22e">addElement:</span>(Rectangle <span style="color:#f92672">*</span>)element;
- (<span style="color:#66d9ef">void</span>)<span style="color:#a6e22e">removeElement:</span>(Rectangle <span style="color:#f92672">*</span>)element;
<span style="color:#66d9ef">@end</span>

<span style="color:#66d9ef">@interface</span> <span style="color:#a6e22e">Rectangle</span> ()
<span style="color:#66d9ef">@property</span> (<span style="color:#66d9ef">nonatomic</span>, <span style="color:#66d9ef">assign</span>, <span style="color:#66d9ef">readwrite</span>) <span style="color:#66d9ef">double</span> width;
<span style="color:#66d9ef">@property</span> (<span style="color:#66d9ef">nonatomic</span>, <span style="color:#66d9ef">assign</span>) <span style="color:#66d9ef">double</span> height;
<span style="color:#66d9ef">@end</span>

<span style="color:#66d9ef">@implementation</span> <span style="color:#a6e22e">Rectangle</span> {
    NSMutableArray <span style="color:#f92672">*</span>_mutableArray;
}

- (NSArray <span style="color:#f92672">*</span>)<span style="color:#a6e22e">array</span> {
    <span style="color:#66d9ef">return</span> [_mutableArray <span style="color:#66d9ef">copy</span>];
}

- (<span style="color:#66d9ef">void</span>)<span style="color:#a6e22e">addElement:</span>(Rectangle <span style="color:#f92672">*</span>)element {
    [_mutableArray addObject:element];
}

- (<span style="color:#66d9ef">void</span>)<span style="color:#a6e22e">removeElement:</span>(Rectangle <span style="color:#f92672">*</span>)element {
    [_mutableArray removeObject:element];
}

- (<span style="color:#66d9ef">instancetype</span>)<span style="color:#a6e22e">initWithWidth:</span>(<span style="color:#66d9ef">double</span>)width <span style="color:#a6e22e">height:</span>(<span style="color:#66d9ef">double</span>)height {
    self <span style="color:#f92672">=</span> [super init];
    <span style="color:#66d9ef">if</span> (self) {
        _width <span style="color:#f92672">=</span> width;
        _height <span style="color:#f92672">=</span> height;
        _mutableArray <span style="color:#f92672">=</span> [NSMutableArray new];
    }
    <span style="color:#66d9ef">return</span> self;
}

- (<span style="color:#66d9ef">id</span>)<span style="color:#a6e22e">copyWithZone:</span>(nullable NSZone <span style="color:#f92672">*</span>)zone {
    Rectangle <span style="color:#f92672">*</span>rect <span style="color:#f92672">=</span> [[Rectangle allocWithZone:zone] initWithWidth:_width height:_height];
    rect<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>_mutableArray <span style="color:#f92672">=</span> [[NSMutableArray alloc] initWithArray:_mutableArray copyItems:YES]; <span style="color:#75715e">// æ·±æ‹·è´
</span><span style="color:#75715e"></span><span style="color:#75715e">//    rect-&gt;_mutableArray = [_mutableArray mutableCopy]; // æµ…æ‹·è´
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">return</span> rect;
}
<span style="color:#66d9ef">@end</span>

Rectangle <span style="color:#f92672">*</span>rect <span style="color:#f92672">=</span> [[Rectangle alloc] initWithWidth:<span style="color:#ae81ff">5.0</span> height:<span style="color:#ae81ff">5.0</span>];
Rectangle <span style="color:#f92672">*</span>rect1 <span style="color:#f92672">=</span> [[Rectangle alloc] initWithWidth:<span style="color:#ae81ff">10.0</span> height:<span style="color:#ae81ff">10.0</span>];

[rect1 addElement:rect];

rect1.height <span style="color:#f92672">=</span> <span style="color:#ae81ff">100</span>;
Rectangle <span style="color:#f92672">*</span>rect2 <span style="color:#f92672">=</span> [rect1 <span style="color:#66d9ef">copy</span>];
rect1.height <span style="color:#f92672">=</span> <span style="color:#ae81ff">200</span>;

NSLog(<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">rect1.array - %@, rect2.array - %@</span><span style="color:#e6db74">&#34;</span>, [rect1 array], [rect2 array]);
NSLog(<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">rect1.height - %f, rect2.height - %f</span><span style="color:#e6db74">&#34;</span>, rect1.height, rect2.height);
NSLog(<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">rect1 - %@, rect2 - %@</span><span style="color:#e6db74">&#34;</span>, rect1, rect2);

<span style="color:#75715e">// OUTPUT:
</span><span style="color:#75715e"></span><span style="color:#75715e">// æ·±æ‹·è´ï¼ˆé›†åˆæ˜¯æ–°çš„é›†åˆï¼Œä¸”é›†åˆå†…éƒ¨å…ƒç´ ä¸ºæ–°å…ƒç´ ï¼‰
</span><span style="color:#75715e"></span><span style="color:#75715e">// rect1.array - (
</span><span style="color:#75715e"></span><span style="color:#75715e">//     &#34;&lt;Rectangle: 0x101125d40&gt;&#34;
</span><span style="color:#75715e"></span><span style="color:#75715e">// ), rect2.array - (
</span><span style="color:#75715e"></span><span style="color:#75715e">//     &#34;&lt;Rectangle: 0x101126250&gt;&#34;
</span><span style="color:#75715e"></span><span style="color:#75715e">// )
</span><span style="color:#75715e"></span><span style="color:#75715e">// rect1.height - 200.000000, rect2.height - 100.000000
</span><span style="color:#75715e"></span><span style="color:#75715e">// rect1 - &lt;Rectangle: 0x101125e80&gt;, rect2 - &lt;Rectangle: 0x101125f70&gt;
</span><span style="color:#75715e"></span><span style="color:#75715e">// æµ…æ‹·è´ï¼ˆé›†åˆæ˜¯æ–°çš„é›†åˆï¼Œä½†é›†åˆå†…éƒ¨å…ƒç´ ä»ä¸ºåŸé›†åˆï¼‰
</span><span style="color:#75715e"></span><span style="color:#75715e">// rect1.array - (
</span><span style="color:#75715e"></span><span style="color:#75715e">//     &#34;&lt;Rectangle: 0x102a04010&gt;&#34;
</span><span style="color:#75715e"></span><span style="color:#75715e">// ), rect2.array - (
</span><span style="color:#75715e"></span><span style="color:#75715e">//     &#34;&lt;Rectangle: 0x102a04010&gt;&#34;
</span><span style="color:#75715e"></span><span style="color:#75715e">// )
</span><span style="color:#75715e"></span><span style="color:#75715e">// rect1.height - 200.000000, rect2.height - 100.000000
</span><span style="color:#75715e"></span><span style="color:#75715e">// rect1 - &lt;Rectangle: 0x102a04150&gt;, rect2 - &lt;Rectangle: 0x102a04240&gt;
</span></code></pre></div><p><img src="/img/2019/effective_obj-c_2.0_notes/3.png" alt="3"></p>
<p>ä¸Šå›¾å–è‡ªè‹¹æœå®˜æ–¹æ–‡æ¡£ä¸­ <a href="https://developer.apple.com/library/archive/documentation/General/Conceptual/DevPedia-CocoaCore/ObjectCopying.html">Object copying - Cocoa Core Competencies</a> ä¸€èŠ‚ã€‚</p>
<h2 id="heading-17">åè®®ä¸åˆ†ç±»</h2>
<h3 id="heading-18">é€šè¿‡å§”æ‰˜ä¸æ•°æ®æºåè®®è¿›è¡Œå¯¹è±¡é—´é€šä¿¡</h3>
<p>ä¸ºäº†é¿å…å¾ªç¯å¼•ç”¨ï¼ˆRetain Cycleï¼‰ï¼Œéµå®ˆä»£ç†ï¼ˆDelegateï¼‰åè®®å¯¹è±¡çš„å†…å­˜ç®¡ç†è¯­ä¹‰éœ€è®¾ç½®ä¸º <code>weak</code> æˆ– <code>unsafe_unretained</code>ï¼ˆå…³äºä¸¤è€…åŒºåˆ«è¯¦è§æœ¬æ–‡ã€Šç†è§£ã€Œå±æ€§ã€è¿™ä¸€æ¦‚å¿µã€‹ä¸€èŠ‚ï¼‰ï¼Œè€Œé <code>strong</code>ã€‚ä»£ç†åè®®ä¸­çš„æ–¹æ³•é€šå¸¸åªä¼šåœ¨ç±»å†…éƒ¨ä½¿ç”¨ï¼Œå› æ­¤å¯ä»¥åœ¨ç±»æ‰©å±•ï¼ˆæ³¨ï¼šæœ¬æ–‡ä¸­ç§°ä¹‹ä¸º Class-Continuation Categoryï¼‰ä¸­å£°æ˜å®ç°å³å¯ã€‚ä»£ç†åè®®ä¸­çš„æ–¹æ³•é€šå¸¸ä½¿ç”¨ <code>@optional</code> æ ‡è®°ä¸ºå¯é€‰ï¼Œå› ä¸ºéµå®ˆä»£ç†åè®®çš„å¯¹è±¡å¹¶éä¸€å®šå…³å¿ƒå…¶ä¸­æ‰€æœ‰çš„æ–¹æ³•ï¼Œæ‰€ä»¥åœ¨è°ƒç”¨å›ä»£ç†ä¸Šçš„æ–¹æ³•æ—¶ä¸€å®šè¦å…ˆä½¿ç”¨ç±»å‹ä¿¡æ¯æŸ¥è¯¢æ–¹æ³•è¿›è¡Œç¡®è®¤ï¼Œä¸ºäº†é¿å…é‡å¤æ€§è°ƒç”¨æŸ¥è¯¢æ–¹æ³•ï¼Œå¯ä½¿ç”¨ä½åŸŸæ¥ç¼“å­˜ç»“æœï¼Œå…³äºä½åŸŸå¯è¯¦è§ã€Š<a href="../bit_field_union_in_cpp/">C/C++ ä¸­çš„ä½åŸŸä¸å…±ç”¨ä½“</a>ã€‹ä¸€æ–‡ã€‚ä»£ç†åè®®ä¸­çš„æ–¹æ³•é€šå¸¸å°†è°ƒç”¨è€…æœ¬èº«ä½œä¸ºå‚æ•°ä¼ å›ï¼Œä»¥ä¾¿æ ¹æ®ä¸åŒçš„è°ƒç”¨è€…æ‰§è¡Œä¸åŒçš„é€»è¾‘ã€‚æ•°æ®æºï¼ˆDataSourceï¼‰ä¸­ï¼Œæ•°æ®ä»ä»£ç†å¯¹è±¡ä¸­æµå‘ç±»ï¼›è€Œè°ƒç”¨è€…ä¸­ï¼Œæ•°æ®ä»è°ƒç”¨è€…ä¸­æµå‡ºè‡³ä»£ç†å¯¹è±¡ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec"><span style="color:#75715e">#</span><span style="color:#75715e">import &#34;ViewController.h&#34;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">@class</span> <span style="color:#a6e22e">Foo</span>;
<span style="color:#66d9ef">@protocol</span> <span style="color:#a6e22e">FooDelegate</span> <span style="color:#f92672">&lt;</span>NSObject<span style="color:#f92672">&gt;</span>

<span style="color:#66d9ef">@optional</span>
<span style="color:#f92672">-</span> (<span style="color:#66d9ef">void</span>)foo:(Foo <span style="color:#f92672">*</span>)foo willLog:(NSString <span style="color:#f92672">*</span>)content;
- (<span style="color:#66d9ef">void</span>)<span style="color:#a6e22e">foo:</span>(Foo <span style="color:#f92672">*</span>)foo <span style="color:#a6e22e">didLog:</span>(NSString <span style="color:#f92672">*</span>)content;
<span style="color:#66d9ef">@end</span>

<span style="color:#66d9ef">@protocol</span> <span style="color:#a6e22e">FooDataSource</span> <span style="color:#f92672">&lt;</span>NSObject<span style="color:#f92672">&gt;</span>
<span style="color:#66d9ef">@required</span>
<span style="color:#f92672">-</span> (NSString <span style="color:#f92672">*</span>)logContent;
<span style="color:#66d9ef">@end</span>


<span style="color:#66d9ef">@interface</span> <span style="color:#a6e22e">Foo</span> : <span style="color:#a6e22e">NSObject</span> {
    <span style="color:#75715e">// ä½åŸŸ
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">struct</span> {
        <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span> willLog :<span style="color:#ae81ff">1</span>;
        <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span> didLog  :<span style="color:#ae81ff">1</span>;
    } _delegateFlags;
}
<span style="color:#75715e">// å£°æ˜ä¸º weak
</span><span style="color:#75715e"></span><span style="color:#66d9ef">@property</span> (<span style="color:#66d9ef">nonatomic</span>, <span style="color:#66d9ef">weak</span>) <span style="color:#66d9ef">id</span> <span style="color:#f92672">&lt;</span>FooDelegate<span style="color:#f92672">&gt;</span> delegate;
<span style="color:#66d9ef">@property</span> (<span style="color:#66d9ef">nonatomic</span>, <span style="color:#66d9ef">weak</span>) <span style="color:#66d9ef">id</span> <span style="color:#f92672">&lt;</span>FooDataSource<span style="color:#f92672">&gt;</span> dataSource;

- (<span style="color:#66d9ef">void</span>)<span style="color:#a6e22e">refresh</span>;
<span style="color:#66d9ef">@end</span>

<span style="color:#66d9ef">@implementation</span> <span style="color:#a6e22e">Foo</span>
- (<span style="color:#66d9ef">void</span>)<span style="color:#a6e22e">setDelegate:</span>(<span style="color:#66d9ef">id</span><span style="color:#f92672">&lt;</span>FooDelegate<span style="color:#f92672">&gt;</span>)delegate {
    _delegate <span style="color:#f92672">=</span> delegate;

    <span style="color:#75715e">// é¿å…å¤šæ¬¡è°ƒç”¨ respondsToSelector:
</span><span style="color:#75715e"></span>    _delegateFlags.willLog <span style="color:#f92672">=</span> [_delegate respondsToSelector:<span style="color:#66d9ef">@selector</span>(foo:willLog:)];
    _delegateFlags.didLog <span style="color:#f92672">=</span> [_delegate respondsToSelector:<span style="color:#66d9ef">@selector</span>(foo:didLog:)];
}

- (<span style="color:#66d9ef">void</span>)<span style="color:#a6e22e">refresh</span> {
    <span style="color:#75715e">// æ•°æ®æºï¼ˆDataSourceï¼‰ï¼šæ•°æ® -&gt; è°ƒç”¨è€…
</span><span style="color:#75715e"></span>    NSString <span style="color:#f92672">*</span>content <span style="color:#f92672">=</span> [self.dataSource logContent];

    <span style="color:#75715e">// æ£€æŸ¥ä»£ç†æ˜¯å¦å®ç°å¯é€‰åè®®
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> ([_delegate respondsToSelector:<span style="color:#66d9ef">@selector</span>(foo:willLog:)]) {
        <span style="color:#75715e">// ä»£ç†ï¼ˆDelegateï¼‰ï¼šæ•°æ® -&gt; ä»£ç†å¯¹è±¡
</span><span style="color:#75715e"></span>        [_delegate foo:self willLog:content];
    }

    NSLog(<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">--------------------</span><span style="color:#e6db74">&#34;</span>);
    NSLog(<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">%@</span><span style="color:#e6db74">&#34;</span>, content);
    NSLog(<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">--------------------</span><span style="color:#e6db74">&#34;</span>);

    <span style="color:#66d9ef">if</span> (_delegateFlags.didLog) {
        [_delegate foo:self didLog:content];
    }
}
<span style="color:#66d9ef">@end</span>

<span style="color:#66d9ef">@interface</span> <span style="color:#a6e22e">ViewController</span> () <span style="color:#f92672">&lt;</span>FooDelegate, FooDataSource<span style="color:#f92672">&gt;</span>
<span style="color:#66d9ef">@property</span> (<span style="color:#66d9ef">nonatomic</span>, <span style="color:#66d9ef">strong</span>) Foo <span style="color:#f92672">*</span>foo;
<span style="color:#66d9ef">@property</span> (<span style="color:#66d9ef">nonatomic</span>, <span style="color:#66d9ef">strong</span>) Foo <span style="color:#f92672">*</span>foo2;
<span style="color:#66d9ef">@end</span>

<span style="color:#66d9ef">@implementation</span> <span style="color:#a6e22e">ViewController</span>

- (<span style="color:#66d9ef">void</span>)<span style="color:#a6e22e">viewDidLoad</span> {
    [super viewDidLoad];
    <span style="color:#75715e">// Do any additional setup after loading the view.
</span><span style="color:#75715e"></span>
    self.foo <span style="color:#f92672">=</span> [[Foo alloc] init];
    self.foo2 <span style="color:#f92672">=</span> [[Foo alloc] init];

    self.foo.delegate <span style="color:#f92672">=</span> self;
    self.foo.dataSource <span style="color:#f92672">=</span> self;

    self.foo2.delegate <span style="color:#f92672">=</span> self;
    self.foo2.dataSource <span style="color:#f92672">=</span> self;

    [self.foo refresh];
}

- (<span style="color:#66d9ef">void</span>)<span style="color:#a6e22e">foo:</span>(Foo <span style="color:#f92672">*</span>)foo <span style="color:#a6e22e">willLog:</span>(NSString <span style="color:#f92672">*</span>)content {
    <span style="color:#66d9ef">if</span> (foo <span style="color:#f92672">=</span><span style="color:#f92672">=</span> _foo) {
        NSLog(<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">foo - willLog - [%@]</span><span style="color:#e6db74">&#34;</span>, content);
    } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (foo <span style="color:#f92672">=</span><span style="color:#f92672">=</span> _foo2) {
        NSLog(<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">foo2 - willLog - [%@]</span><span style="color:#e6db74">&#34;</span>, content);
    }
}

- (<span style="color:#66d9ef">void</span>)<span style="color:#a6e22e">foo:</span>(Foo <span style="color:#f92672">*</span>)foo <span style="color:#a6e22e">didLog:</span>(NSString <span style="color:#f92672">*</span>)content {
    NSLog(<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">willLog - [%@]</span><span style="color:#e6db74">&#34;</span>, content);
}

- (NSString <span style="color:#f92672">*</span>)<span style="color:#a6e22e">logContent</span> {
    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">https://kingcos.me</span><span style="color:#e6db74">&#34;</span>;
}

<span style="color:#66d9ef">@end</span>

<span style="color:#75715e">// OUTPUT:
</span><span style="color:#75715e"></span><span style="color:#75715e">// foo - willLog - [https://kingcos.me]
</span><span style="color:#75715e"></span><span style="color:#75715e">// --------------------
</span><span style="color:#75715e"></span><span style="color:#75715e">// https://kingcos.me
</span><span style="color:#75715e"></span><span style="color:#75715e">// --------------------
</span><span style="color:#75715e"></span><span style="color:#75715e">// willLog - [https://kingcos.me]
</span></code></pre></div><h3 id="heading-19">å°†ç±»çš„å®ç°ä»£ç åˆ†æ•£åˆ°ä¾¿äºç®¡ç†çš„æ•°ä¸ªåˆ†ç±»ä¹‹ä¸­</h3>
<p>ä½¿ç”¨åˆ†ç±»æœºåˆ¶å¯ä»¥å°†ç±»çš„å®ç°ä»£ç åˆ†æˆä¸åŒçš„åŠŸèƒ½å—ã€‚æ¯”å¦‚ <code>NSURLRequest</code> ç±»æä¾›å‘ URL è¯·æ±‚çš„åŠŸèƒ½ï¼Œä½†ä»å…¶å‘½åä¸­å¹¶ä¸å¾—çŸ¥å…¶ä½¿ç”¨çš„å…·ä½“åè®®ï¼Œè€Œ HTTP ç›¸å…³çš„æ–¹æ³•å®šä¹‰åœ¨ <code>NSURLRequest</code> çš„ <code>NSHTTPURLRequest</code> åˆ†ç±»ä¸­ã€‚<code>NSURLRequest</code> ä¸­å°è£…äº†ä¸€å¥—æ“ä½œ <code>CFURLRequest</code> æ•°æ®ç»“æ„æ‰€éœ€çš„ C å‡½æ•°ï¼Œä¸” Obj-C å¹¶ä¸æ”¯æŒæ–¹æ³•çš„è®¿é—®æ§åˆ¶ä¿®é¥°ç¬¦ï¼Œå°† <code>NSHTTPURLRequest</code> å®šä¹‰ä¸ºå­ç±»ä¹Ÿä¸ç”šæ–¹ä¾¿ã€‚å®šä¹‰åœ¨åˆ†ç±»ä¸­çš„æ–¹æ³•ç¬¦å·ä¼šå¸¦æœ‰åˆ†ç±»ä¿¡æ¯ï¼Œä¾¿äº Debugã€‚é€šå¸¸ï¼Œæˆ‘ä»¬å°†æ— éœ€æš´éœ²åœ¨å¤–ç•Œçš„æ–¹æ³•å®šä¹‰åœ¨å¸¦æœ‰ <code>Private</code> çš„åˆ†ç±»ä¸­ï¼Œè¿™æ ·å³ä½¿å‡ºç°é—®é¢˜ä¹Ÿèƒ½è¾“å‡º <code>Private</code> ç›¸å…³çš„ä¿¡æ¯ã€‚</p>
<h3 id="heading-20">æ€»æ˜¯ä¸ºç¬¬ä¸‰æ–¹çš„åˆ†ç±»åç§°åŠ å‰ç¼€</h3>
<p>å‘ç¬¬ä¸‰æ–¹åˆ†ç±»ä¸­æ·»åŠ åˆ†ç±»æ—¶ï¼Œåº”ä¸ºåˆ†ç±»åç§°åŠ ä¸Šç‰¹æœ‰å‰ç¼€ä»¥åŒºåˆ†ï¼›åˆ†ç±»ä¸­çš„æ–¹æ³•ä¹Ÿè¦åŠ ä¸Šç‰¹æœ‰å‰ç¼€ä»¥åŒºåˆ†ã€‚å…³äºåˆ†ç±»ï¼ˆCategoryï¼‰ï¼Œå¯è¯¦è§ã€Š<a href="../category_in_ios/">iOS ä¸­çš„ Category</a>ã€‹ä¸€æ–‡ã€‚</p>
<h3 id="heading-21">å‹¿åœ¨åˆ†ç±»ä¸­å£°æ˜å±æ€§</h3>
<p>åˆ†ç±»ä¸­å¯ä»¥å®šä¹‰å±æ€§ï¼Œä½†å¹¶ä¸ä¼šç”Ÿæˆæˆå‘˜å˜é‡ä»¥åŠ getter &amp; setter çš„å®ç°ï¼Œå› æ­¤å»ºè®®åœ¨ä¸»æ¥å£æˆ–ç±»æ‰©å±•ä¸­å°è£…æ‰€éœ€çš„æ‰€æœ‰å±æ€§ã€‚</p>
<h3 id="class-continuation-">ä½¿ç”¨ã€Œclass-continuation åˆ†ç±»ã€éšè—å®ç°ç»†èŠ‚</h3>
<p>class-continuation åˆ†ç±»ç°åœ¨é€šå¸¸ç§°ä¹‹ä¸ºç±»æ‰©å±•ã€‚ç±»æ‰©å±•ä¸­ä¹‹æ‰€ä»¥å¯ä»¥å®šä¹‰æ–¹æ³•å’Œå®ä¾‹å˜é‡ï¼Œè¿™æ˜¯ç”±äº ABI ç¨³å›ºçš„æœºåˆ¶ã€‚åˆ©ç”¨ç±»æ‰©å±•å¯ä»¥å°†ä¸€äº›æ¥å£å£°æ˜åœ¨å®ç°æ–‡ä»¶ä¸­ï¼Œä»¥å¯¹å¤–éšè—ã€‚å…¶ä¸­æ¯”è¾ƒä¸€ä¸ªæ¯”è¾ƒç‰¹åˆ«çš„ç”¨ä¾‹æ˜¯å°†æ‰€éœ€çš„ C++ ç±»ç­‰ä½¿ç”¨å£°æ˜åœ¨ç±»æ‰©å±•ä¸­ï¼Œè¿™æ ·æ— éœ€å£°æ˜åœ¨å¤´æ–‡ä»¶ä¸­ï¼Œå¯ä»¥é¿å…å…¶å®ƒå¼•å…¥çš„ç±»å¿…é¡»ä½¿ç”¨ Obj-C++ è¯­æ³•ï¼ˆå³ <code>.mm</code> æ–‡ä»¶ï¼‰ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#75715e">// CPPClass.hpp
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">ifndef CPPClass_hpp</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">define CPPClass_hpp</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CPPClass</span> {
    <span style="color:#66d9ef">int</span> foo;

<span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
    CPPClass(<span style="color:#66d9ef">int</span> foo);
};

<span style="color:#75715e">#</span><span style="color:#75715e">endif </span><span style="color:#75715e">/* CPPClass_hpp */</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// CPPClass.cpp
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&#34;CPPClass.hpp&#34;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
CPPClass<span style="color:#f92672">:</span><span style="color:#f92672">:</span>CPPClass(<span style="color:#66d9ef">int</span> foo) {
    <span style="color:#66d9ef">this</span><span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>foo <span style="color:#f92672">=</span> foo;
}
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec"><span style="color:#75715e">// ObjCPPClass.h
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">import &lt;Foundation</span><span style="color:#75715e">/</span><span style="color:#75715e">Foundation.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// ç›´æ¥å¼•å…¥ CPPClass çš„å£°æ˜
</span><span style="color:#75715e"></span><span style="color:#75715e">//#import &#34;CPPClass.h&#34;
</span><span style="color:#75715e"></span>
NS_ASSUME_NONNULL_BEGIN

<span style="color:#75715e">// å‘å‰å£°æ˜ï¼Œclass ä»æ˜¯ C++ çš„å…³é”®å­—
</span><span style="color:#75715e"></span><span style="color:#75715e">//class CPPClass;
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">@interface</span> <span style="color:#a6e22e">ObjCPPClass</span> : <span style="color:#a6e22e">NSObject</span>
<span style="color:#75715e">//{
</span><span style="color:#75715e"></span><span style="color:#75715e">//@private
</span><span style="color:#75715e"></span><span style="color:#75715e">//    CPPClass *_obj;
</span><span style="color:#75715e"></span><span style="color:#75715e">//}
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">@end</span>

NS_ASSUME_NONNULL_END

<span style="color:#75715e">// ObjCPPClass.mm
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">import &#34;ObjCPPClass.h&#34;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">import &#34;CPPClass.hpp&#34;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// ä½¿ç”¨ç±»æ‰©å±•å°† C++ ç±»å¼•å…¥å¹¶å£°æ˜ä½¿ç”¨
</span><span style="color:#75715e"></span><span style="color:#66d9ef">@interface</span> <span style="color:#a6e22e">ObjCPPClass</span> () {
    CPPClass <span style="color:#f92672">*</span>_obj;
}
<span style="color:#66d9ef">@end</span>

<span style="color:#66d9ef">@implementation</span> <span style="color:#a6e22e">ObjCPPClass</span>

- (<span style="color:#66d9ef">instancetype</span>)<span style="color:#a6e22e">init</span>
{
    self <span style="color:#f92672">=</span> [super init];
    <span style="color:#66d9ef">if</span> (self) {
        _obj <span style="color:#f92672">=</span> new CPPClass(<span style="color:#ae81ff">100</span>);
        <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>_obj) self <span style="color:#f92672">=</span> nil;
    }
    <span style="color:#66d9ef">return</span> self;
}

- (<span style="color:#66d9ef">void</span>)<span style="color:#a6e22e">dealloc</span>
{
    <span style="color:#75715e">// æ‰‹åŠ¨é”€æ¯ _obj
</span><span style="color:#75715e"></span>    delete _obj;
}

<span style="color:#66d9ef">@end</span>
</code></pre></div><p>ç±»æ‰©å±•ä¹Ÿå¯ä»¥å°†å¤´æ–‡ä»¶ä¸­å£°æ˜ä¸º <code>readonly</code> çš„å±æ€§é‡æ–°ä½¿ç”¨ <code>readwrite</code> å£°æ˜ï¼Œä»¥åœ¨ç±»å†…éƒ¨ä½¿ç”¨ï¼›ç±»æ‰©å±•é€šå¸¸ä¹Ÿç”¨æ¥å£°æ˜éµå¾ªå¤–ç•Œæ— éœ€çŸ¥æ™“çš„åè®®ã€‚</p>
<h3 id="heading-22">é€šè¿‡åè®®æä¾›åŒ¿åå¯¹è±¡</h3>
<p>åœ¨ã€Œé€šè¿‡å§”æ‰˜ä¸æ•°æ®æºåè®®è¿›è¡Œå¯¹è±¡é—´é€šä¿¡ã€ä¸€èŠ‚ä¸­ï¼Œ<code>Foo</code> çš„ <code>delegate</code> æ‰€å£°æ˜çš„ç±»å‹ä¸º <code>id &lt;FooDelegate&gt;</code>ï¼Œå³ä»»ä½•éµå¾ª <code>FooDeelgate</code> åè®®çš„ç±»å‹å³å¯ï¼Œè€Œéå¿…é¡»ä¸ºæŸä¸€å…·ä½“ç±»å‹ï¼Œè¿™ç§åªé™å®šåè®®çš„ç±»çš„å¯¹è±¡å°±æ˜¯ Obj-C ä¸­çš„åŒ¿åå¯¹è±¡ï¼ˆAnonymous Objectï¼‰ã€‚<code>NSDictionary</code> ä¸­çš„é”®æ˜¯ <code>id &lt;NSCopying&gt;</code> ç±»å‹ï¼ŒåŒç†åªè¦æ˜¯éµå¾ª <code>NSCopying</code> åè®®çš„ç±»çš„å¯¹è±¡å³å¯ã€‚ä½¿ç”¨åŒ¿åå¯¹è±¡ä¹Ÿå¯å¯¹å¤–éšè—ç±»å‹åç§°ã€‚</p>
<p>æœ‰æ—¶å¯¹è±¡ç±»å‹å¹¶ä¸é‡è¦ï¼Œé‡è¦çš„æ˜¯å¯¹è±¡æœ‰æ²¡æœ‰å®ç°æŸäº›æ–¹æ³•ï¼Œå³å¯ä½¿ç”¨åŒ¿åç±»å‹ï¼ˆAnonymous Typeï¼‰æ¥è¡¨è¾¾è¿™ä¸€æ¦‚å¿µã€‚å³ä¾¿å®ç°ä»£ç æ€»æ˜¯ä½¿ç”¨å›ºå®šçš„ç±»ï¼Œä½†ä»ç„¶å†™æˆéµå¾ªæŸç§åè®®çš„åŒ¿åç±»å‹ï¼Œä»¥è¡¨æ˜ç±»å‹åœ¨æ­¤å¹¶ä¸é‡è¦ã€‚</p>
<h2 id="heading-23">å†…å­˜ç®¡ç†</h2>
<h3 id="heading-24">ç†è§£å¼•ç”¨è®¡æ•°</h3>
<p>Mac OS X 10.8 å¼€å§‹ï¼Œåƒåœ¾å›æ”¶ï¼ˆGarbage Collectorï¼‰å·²ç»æ­£å¼åºŸå¼ƒï¼Œè€Œ iOS ä»æœªæ”¯æŒåƒåœ¾å›æ”¶ï¼Œä¸€ç›´ä½¿ç”¨å¼•ç”¨è®¡æ•°ï¼ˆReference Countï¼Œåˆç§° Retain Countï¼Œä¿ç•™è®¡æ•°ï¼‰ç®¡ç†å†…å­˜ã€‚åœ¨ MRC ä¸‹ï¼Œ<code>NSObject</code> åè®®ä¸­çš„ <code>retain</code>ã€<code>release</code> ä»¥åŠ <code>autorelease</code> æ–¹æ³•ç”¨æ¥æ“ä½œè®¡æ•°ã€‚å½“å¼•ç”¨è®¡æ•°å½’é›¶ï¼Œç³»ç»Ÿå°†æŠŠå¯¹è±¡å ç”¨çš„å†…å­˜æ ‡è®°ä¸ºå¯é‡ç”¨çš„ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™å¹¶ä¸ä»£è¡¨å¯¹è±¡æ‰€å ç”¨çš„å†…å­˜åœ°å€ä¸€å®šä¼šè¢«è¦†å†™ï¼Œå› æ­¤åœ¨å¼•ç”¨è®¡æ•°é™ä¸º 0 å†è°ƒç”¨æ—¶åªæ˜¯ã€Œå¯èƒ½ã€è€Œéã€Œä¸€å®šã€ä¼šå´©æºƒã€‚å› æ­¤é€šå¸¸åœ¨ <code>release</code> åå°†å¯¹è±¡ç½®ä¸º <code>nil</code> è€Œé¿å…æ‚¬æŒ‚æŒ‡é’ˆï¼ˆDangling Pointerï¼‰ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec">Foo <span style="color:#f92672">*</span>foo <span style="color:#f92672">=</span> [[Foo alloc] init];
[foo <span style="color:#66d9ef">release</span>];
foo <span style="color:#f92672">=</span> nil; <span style="color:#75715e">// å°†å†…å­˜åŒºåŸŸç½®ä¸º nilï¼Œé¿å…æ‚¬æŒ‚æŒ‡é’ˆ
</span></code></pre></div><p>å±æ€§å­˜å–æ–¹æ³•ä¸­ä¹Ÿéœ€è¦æ³¨æ„å¼•ç”¨è®¡æ•°ç›¸å…³ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec"><span style="color:#75715e">// MRC
</span><span style="color:#75715e"></span>- (<span style="color:#66d9ef">void</span>)<span style="color:#a6e22e">setFoo:</span>(<span style="color:#66d9ef">id</span>)foo {
    <span style="color:#75715e">// æ³¨æ„é¡ºåºï¼š
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// å½“å‚æ•° foo ä¸æˆå‘˜å˜é‡ _foo æ˜¯åŒä¸€å¯¹è±¡æ—¶
</span><span style="color:#75715e"></span>    [foo <span style="color:#66d9ef">retain</span>];   <span style="color:#75715e">// è¦å…ˆ retain ä½¿å¾—å¼•ç”¨è®¡æ•° +1
</span><span style="color:#75715e"></span>    [_foo <span style="color:#66d9ef">release</span>]; <span style="color:#75715e">// é˜²æ­¢å¯¹è±¡æå‰é‡Šæ”¾å¯¼è‡´å®ä¾‹å˜é‡å°†æˆä¸ºæ‚¬æŒ‚æŒ‡é’ˆ
</span><span style="color:#75715e"></span>    _foo <span style="color:#f92672">=</span> foo;
}
</code></pre></div><p>ä¸ºäº†é˜²æ­¢ç³»ç»Ÿå›æ”¶å¯¹è±¡ï¼Œä½†åˆè¦èƒ½åœ¨åˆé€‚çš„æ—¶æœºé‡Šæ”¾ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨è‡ªåŠ¨é‡Šæ”¾æ± å»¶é•¿å¯¹è±¡ç”Ÿå‘½å‘¨æœŸï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec"><span style="color:#75715e">// MRC
</span><span style="color:#75715e"></span>- (Foo <span style="color:#f92672">*</span>)<span style="color:#a6e22e">newFoo</span> {
    Foo <span style="color:#f92672">*</span>foo <span style="color:#f92672">=</span> [[Foo alloc] init];
    <span style="color:#75715e">// autorelease ä½¿å¾—è¶…è¿‡æ–¹æ³•è¾¹ç•Œä¾ç„¶å¯ä»¥å­˜æ´»ä¸€æ®µæ—¶é—´
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">return</span> [foo autorelease];
}

<span style="color:#75715e">// foo å¯ä»¥å­˜æ´»
</span><span style="color:#75715e"></span>Foo <span style="color:#f92672">*</span>foo <span style="color:#f92672">=</span> [self newFoo];
<span style="color:#75715e">// ä½†è‹¥è¦æŒæœ‰æ­¤å¯¹è±¡ï¼Œä»éœ€æ‰‹åŠ¨ä¿ç•™ã€é‡Šæ”¾
</span><span style="color:#75715e"></span>_foo <span style="color:#f92672">=</span> [[self newFoo] <span style="color:#66d9ef">retain</span>];
<span style="color:#75715e">// ...
</span><span style="color:#75715e"></span>[_foo <span style="color:#66d9ef">release</span>];
</code></pre></div><p>å¼•ç”¨è®¡æ•°çš„æ¦‚å¿µåº”å½“ç†è§£ä¸ºæ‰€æ‰§è¡Œçš„æ“ä½œå¯¹äºè®¡æ•°æœ¬èº«æ˜¯å¢åŠ äº†è¿˜æ˜¯æ¶ˆå‡äº†ï¼Œè€Œéåˆ»æ„è¿½æ±‚ä¸ºæŸä¸ªå€¼ã€‚å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒæŸ¥è¯¢å¼•ç”¨è®¡æ•°çš„æ–¹æ³• <code>retainCount</code> ä¸æ¨èä½¿ç”¨ã€‚</p>
<h2 id="-arc-">ä»¥ ARC ç®€åŒ–å¼•ç”¨è®¡æ•°</h2>
<p>ARC ä¸‹è°ƒç”¨ <code>retain</code>ã€<code>release</code>ã€<code>autorelease</code>ã€<code>dealloc</code> æ–¹æ³•æ—¶å¹¶ä¸é€šè¿‡ Obj-C çš„æ¶ˆæ¯å‘é€æœºåˆ¶ï¼Œè€Œæ˜¯ç›´æ¥è°ƒç”¨å…¶åº•å±‚çš„ C è¯­è¨€ç‰ˆæœ¬ï¼Œå› è€Œæ€§èƒ½æ›´å¥½ã€‚åœ¨ Obj-C ä¸­ï¼Œä»¥ <code>alloc</code>ã€<code>new</code>ã€<code>copy</code> å’Œ <code>mutableCopy</code> å¼€å¤´çš„æ–¹æ³•è¿”å›çš„å¯¹è±¡å½’è°ƒç”¨è€…æ‰€æœ‰ï¼Œå³è°ƒç”¨è¿™äº›æ–¹æ³•çš„ä»£ç åŒæ ·è¦è´Ÿè´£é‡Šæ”¾ï¼›åä¹‹åˆ™ä¸å½’è°ƒç”¨è€…æ‰€æœ‰ï¼Œéœ€è¦åœ¨å†…éƒ¨è‡ªå·±å¤„ç†ï¼Œå› æ­¤è¿”å›çš„å¯¹è±¡ä¼šè‡ªåŠ¨é‡Šæ”¾ï¼Œä½†å¤–ç•Œå¸Œæœ›ä¿æ´»åˆ™éœ€è¦è°ƒç”¨è€…å†æ¬¡ä¿ç•™ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec"><span style="color:#75715e">// ARC
</span><span style="color:#75715e"></span>+ (Foo <span style="color:#f92672">*</span>)<span style="color:#a6e22e">newFoo</span> {
    Foo <span style="color:#f92672">*</span>foo <span style="color:#f92672">=</span> [[Foo alloc] init];
    <span style="color:#66d9ef">return</span> foo; <span style="color:#75715e">// new å¼€å¤´ï¼Œæœ¬è´¨å³è¿”å› foo
</span><span style="color:#75715e"></span>}

+ (Foo <span style="color:#f92672">*</span>)<span style="color:#a6e22e">someFoo</span> {
    Foo <span style="color:#f92672">*</span>foo <span style="color:#f92672">=</span> [[Foo alloc] init];
    <span style="color:#66d9ef">return</span> foo; <span style="color:#75715e">// éç‰¹å®šå¼€å¤´ï¼Œæœ¬è´¨å³è¿”å› [foo autorelease]
</span><span style="color:#75715e"></span>}

- (<span style="color:#66d9ef">void</span>)<span style="color:#a6e22e">bar</span> {
    Foo <span style="color:#f92672">*</span>foo1 <span style="color:#f92672">=</span> [Foo newFoo];
    Foo <span style="color:#f92672">*</span>foo2 <span style="color:#f92672">=</span> [Foo someFoo];

    <span style="color:#75715e">// è¶…è¿‡ç‰¹å®šä½œç”¨åŸŸä¸‹ï¼Œå˜é‡å°†è¿›è¡Œé‡Šæ”¾
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// foo1 ç”± newFoo åˆ›é€ ï¼Œå› æ­¤éœ€è¦æ‰‹åŠ¨ [foo1 release];
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// foo2 ç”± someFoo åˆ›é€ ï¼Œæ— éœ€æ‰‹åŠ¨ release
</span><span style="color:#75715e"></span>}
</code></pre></div><p>ARC æœ‰æ—¶ä¼šè‡ªåŠ¨å°†åŒä¸€ä¸ªå¯¹è±¡ä¸Šçš„å¤šæ¬¡äº’ç›¸æŠµæ¶ˆçš„ <code>retain</code> å’Œ <code>release</code> æ“ä½œæˆå¯¹ç§»é™¤ï¼›ARC ä¹ŸåŒ…æ‹¬è¿è¡Œæ—¶ç»„ä»¶æ¥æ‰§è¡Œä¸€äº›ä¼˜åŒ–ï¼Œä»¥åŠéœ€è¦è€ƒè™‘å‘åå…¼å®¹æ€§ï¼Œä»¥å…¼å®¹ä½¿ç”¨ MRC çš„ä»£ç ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec"><span style="color:#75715e">// ARC ä¸‹ï¼Œ_foo æ˜¯ä¸€ä¸ªå¼ºå¼•ç”¨çš„æˆå‘˜å˜é‡ï¼Œç¼–è¯‘å™¨è®¾ç½®å…¶å€¼æ—¶ä¼šé¢å¤–æ‰§è¡Œ [foo retain]ï¼›
</span><span style="color:#75715e"></span>_foo <span style="color:#f92672">=</span> [Foo someFoo]; <span style="color:#75715e">// someFoo è¿”å›ä¸€ä¸ªæ–°çš„ Foo å¯¹è±¡ï¼Œä¸”ç”±äºéç‰¹å®šå¼€å¤´ï¼Œæœ¬è´¨å³è¿”å› [foo autorelease]
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// ä»¥ä¸Šç­‰åŒäºåœ¨ MRC ä¸‹ï¼š
</span><span style="color:#75715e"></span>Foo <span style="color:#f92672">*</span>foo <span style="color:#f92672">=</span> [Foo someFoo]; <span style="color:#75715e">// return [foo autorelease];
</span><span style="color:#75715e"></span>_foo <span style="color:#f92672">=</span> [foo <span style="color:#66d9ef">retain</span>];

<span style="color:#75715e">// ARC å¯ä»¥åœ¨è¿è¡Œæ—¶æ£€æµ‹åˆ°ä»¥ä¸Š autorelease åç´§è·Ÿ retain çš„è¿™ç§å¤šä½™æ“ä½œï¼ˆå› ä¸ºåç»­æ—¢ç„¶ retainï¼Œè¿™é‡Œå°±æ— éœ€ autoreleaseï¼‰ï¼Œ
</span><span style="color:#75715e"></span><span style="color:#75715e">// å› æ­¤åœ¨æ–¹æ³•ä¸­è¿”å›è‡ªåŠ¨é‡Šæ”¾çš„å¯¹è±¡æ—¶ï¼Œæ”¹ä¸ºæ‰§è¡Œ objc_autoreleaseReturnValue å‡½æ•°ï¼š
</span><span style="color:#75715e"></span><span style="color:#75715e">// MRCï¼š
</span><span style="color:#75715e"></span>+ (Foo <span style="color:#f92672">*</span>)<span style="color:#a6e22e">someFoo</span> {
    Foo <span style="color:#f92672">*</span>foo <span style="color:#f92672">=</span> [[Foo alloc] init];
    <span style="color:#66d9ef">return</span> objc_autoreleaseReturnValue(foo);
}

Foo <span style="color:#f92672">*</span>foo <span style="color:#f92672">=</span> [Foo someFoo]; <span style="color:#75715e">// return [foo autorelease];
</span><span style="color:#75715e"></span><span style="color:#75715e">// æ”¹ä¸ºæ‰§è¡Œ objc_retainAutoreleasedReturnValue å‡½æ•°ï¼š
</span><span style="color:#75715e"></span>_foo <span style="color:#f92672">=</span> objc_retainAutoreleasedReturnValue(foo);

<span style="color:#75715e">// ä¼ªä»£ç 
</span><span style="color:#75715e"></span><span style="color:#66d9ef">id</span> <span style="color:#a6e22e">objc_autoreleaseReturnValue</span>(<span style="color:#66d9ef">id</span> object) {
    <span style="color:#75715e">// å…·ä½“å¦‚ä½•åˆ¤æ–­éœ€æ ¹æ®å¤„ç†å™¨çš„åŸå§‹æœºå™¨ç æŒ‡ä»¤æ¥åˆ¤æ–­
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (<span style="color:#75715e">/* è‹¥åœ¨è°ƒç”¨åéœ€åœ¨è¿”å›å¯¹è±¡ä¸Šæ‰§è¡Œ retain */</span>) {
        set_flag(object); <span style="color:#75715e">// è®¾ç½®å…¨å±€æ•°æ®ç»“æ„ç¬¦å·ä½
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">return</span> object; <span style="color:#75715e">// è¿”å›å¯¹è±¡æœ¬èº«
</span><span style="color:#75715e"></span>    } <span style="color:#66d9ef">else</span> {
        <span style="color:#66d9ef">return</span> [foo autorelease];
    }
}

<span style="color:#66d9ef">id</span> <span style="color:#a6e22e">objc_retainAutoreleasedReturnValue</span>(<span style="color:#66d9ef">id</span> object) {
    <span style="color:#66d9ef">if</span> (<span style="color:#75715e">/* è®¾ç½®è¿‡å…¨å±€æ•°æ®ç»“æ„ç¬¦å·ä½ */</span>) {
        clear_flag(object); <span style="color:#75715e">// æ¸…é™¤ç¬¦å·ä½
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">return</span> object; <span style="color:#75715e">// è¿”å›å¯¹è±¡æœ¬èº«
</span><span style="color:#75715e"></span>    } <span style="color:#66d9ef">else</span> {
        <span style="color:#66d9ef">return</span> [foo <span style="color:#66d9ef">retain</span>];
    }
}

<span style="color:#75715e">// è¿™æ ·çš„å¥½å¤„æ˜¯è®¾ç½®å¹¶æ£€æµ‹æ ‡å¿—ä½çš„é€Ÿåº¦è¦æ¯”è°ƒç”¨ autorelease å’Œ retain é€Ÿåº¦æ›´å¿«
</span></code></pre></div><p>ARC ä¼šå¤„ç†å±€éƒ¨å˜é‡ä¸å®ä¾‹å˜é‡çš„å†…å­˜ç®¡ç†ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec"><span style="color:#66d9ef">@interface</span> <span style="color:#a6e22e">Foo</span> : <span style="color:#a6e22e">NSObject</span> {
    <span style="color:#66d9ef">id</span> <span style="color:#66d9ef">__strong</span> _strongObj; <span style="color:#75715e">// é»˜è®¤ï¼Œä¿ç•™å€¼
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">id</span> <span style="color:#66d9ef">__weak</span> _weakObj;     <span style="color:#75715e">// ä¸ä¿ç•™å€¼ï¼Œä½†ç³»ç»Ÿå›æ”¶å¯¹è±¡æ—¶ä¼šè‡ªåŠ¨ç½®ä¸º nil
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">id</span> __unsafe_unretained _unsafeUnretainedObj; <span style="color:#75715e">// ä¸ä¿ç•™å€¼ï¼Œä½†ç³»ç»Ÿå›æ”¶å¯¹è±¡æ—¶ä¸ä¼šè‡ªåŠ¨ç½®ä¸º nilï¼Œä¸å®‰å…¨
</span><span style="color:#75715e"></span><span style="color:#75715e">//    id __autoreleasing _autureleasingObj; // __autoreleasing ä¸èƒ½ç›´æ¥å£°æ˜æˆå‘˜å˜é‡ä½¿ç”¨
</span><span style="color:#75715e"></span>}

<span style="color:#75715e">// ä½¿å¾—å€¼å¯ä»¥åœ¨æ–¹æ³•è¿”å›åè‡ªåŠ¨é‡Šæ”¾ï¼ˆæ— éœ€åœ¨å¤–ç•Œå…³å¿ƒå…¶æ˜¯å¦é‡Šæ”¾ï¼‰
</span><span style="color:#75715e"></span>- (<span style="color:#66d9ef">void</span>)<span style="color:#a6e22e">fooWithParam:</span>(<span style="color:#66d9ef">id</span> <span style="color:#66d9ef">__autoreleasing</span> <span style="color:#f92672">*</span>)_autureleasingObj;
<span style="color:#66d9ef">@end</span>
</code></pre></div><p>ARC ä¹Ÿè´Ÿè´£å¯¹å®ä¾‹å˜é‡çš„å†…å­˜ç®¡ç†ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec"><span style="color:#75715e">// MRC ä¸‹éœ€æ‰‹åŠ¨æ¸…ç†
</span><span style="color:#75715e"></span>- (<span style="color:#66d9ef">void</span>)<span style="color:#a6e22e">dealloc</span> {
    [_foo <span style="color:#66d9ef">release</span>];  <span style="color:#75715e">// é‡Šæ”¾æ‰€æœ‰å¼ºå¼•ç”¨å˜é‡
</span><span style="color:#75715e"></span>    [super dealloc]; <span style="color:#75715e">// è°ƒç”¨çˆ¶ç±»æ–¹æ³•
</span><span style="color:#75715e"></span>}
</code></pre></div><p>ARC ä¸‹ç¼–è¯‘å™¨è‹¥å‘ç°æŸä¸ªå¯¹è±¡é‡Œå«æœ‰ C++ å¯¹è±¡ï¼Œå°±ä¼šç”Ÿæˆåä¸º <code>.cxx_destruct</code> æ–¹æ³•æ¥è°ƒç”¨æ‰€æœ‰ C++ å¯¹è±¡çš„ææ„å‡½æ•°ï¼›é Obj-C å¯¹è±¡åˆ™ä»ç„¶éœ€è¦æ¸…ç†ï¼ŒARC ä¼šè‡ªåŠ¨åœ¨ <code>.cxx_destruct</code> æ–¹æ³•ä¸­ç”Ÿæˆä»£ç å¹¶è¿è¡Œï¼Œå…¶ä¸­ä¼šè‡ªåŠ¨è°ƒç”¨çˆ¶ç±»çš„ <code>dealloc</code> æ–¹æ³•ï¼Œå› æ­¤ä¸èƒ½å†ç›´æ¥è°ƒç”¨çˆ¶ç±»çš„ <code>dealloc</code>ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec"><span style="color:#75715e">// ARC
</span><span style="color:#75715e"></span>- (<span style="color:#66d9ef">void</span>)<span style="color:#a6e22e">dealloc</span> {
    CFRelease(_coreFoundationObject); <span style="color:#75715e">// æ‰‹åŠ¨é‡Šæ”¾ CoreFoundation ä¸­çš„å¯¹è±¡
</span><span style="color:#75715e"></span>    free(_heapAllocatedMemoryBlob);   <span style="color:#75715e">// æ‰‹åŠ¨é‡Šæ”¾ malloc() åˆ†é…åœ¨å †ä¸­çš„å†…å­˜
</span><span style="color:#75715e"></span>}
</code></pre></div><p>MRC ä¸‹ä¸ºäº†å®ç°å•ä¾‹å¯ä»¥å°† <code>release</code> æ–¹æ³•æ›¿æ¢ä¸ºç©ºæ“ä½œå³å¯ï¼›ä½†åœ¨ ARC ä¸å¯è¿™æ ·æ“ä½œï¼Œå› ä¸ºè¿™å°†å¹²æ‰° ARC æœ¬èº«ã€‚</p>
<h3 id="-dealloc-">åœ¨ dealloc æ–¹æ³•ä¸­åªé‡Šæ”¾å¼•ç”¨å¹¶è§£é™¤ç›‘å¬</h3>
<p>ä¸Šä¸€èŠ‚ä¸­ä¹Ÿæåˆ°äº†ä¸€äº›åœ¨ <code>dealloc</code> æ–¹æ³•ä¸­æ‰€åº”æ‰§è¡Œçš„æ“ä½œï¼Œæœ¬èŠ‚ä¸å†èµ˜è¿°ã€‚å¦å¤–è¿˜è¦åœ¨å…¶ä¸­å°†å½“å‰å¯¹è±¡çš„ <code>NSNotificationCenter</code> è§‚å¯Ÿè€…ç§»é™¤ï¼Œå¦åˆ™åœ¨å…¶å®ƒåœ°æ–¹å‘é€é€šçŸ¥æ—¶ï¼Œæ¥æ”¶è€…å´å·²ç»é”€æ¯ï¼Œå°†å¼•å‘å´©æºƒã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>dealloc</code> ä¸­å¹¶ä¸å»ºè®®é‡Šæ”¾å¼€é”€è¾ƒå¤§çš„èµ„æºï¼Œå› ä¸ºå…¶è°ƒç”¨çš„å…·ä½“æ—¶æœºæˆ‘ä»¬æ— æ³•æŠŠæ¡ï¼Œä»è€Œå®¹æ˜“å¯¼è‡´å‡ºç°å†…å­˜æ³„æ¼ã€‚è€Œå»ºè®®æ˜¯å°†é‡Šæ”¾æ–¹æ³•ç‹¬ç«‹ï¼Œå¹¶ç”±å¼€å‘è€…ä¿è¯åœ¨ä¸ä½¿ç”¨èµ„æºæ—¶é‡Šæ”¾èµ„æºã€‚ä½†ä¸ºäº†é˜²æ­¢å¼€å‘è€…å¿˜è®°é‡Šæ”¾èµ„æºï¼Œæˆ‘ä»¬ä»å¯ä»¥åœ¨ <code>dealloc</code> ä¸­æ ¹æ®æ˜¯å¦é‡Šæ”¾è¿‡è€Œå»å…œåº•é‡Šæ”¾èµ„æºï¼Œä¹Ÿå¯æŠ›å‡ºå¼‚å¸¸ã€‚å¦å¤–ç³»ç»Ÿä¹Ÿä¸èƒ½ä¿è¯æ¯ä¸ªå¯¹è±¡çš„ <code>dealloc</code> æ–¹æ³•æœ€ç»ˆéƒ½ä¼šè¢«è°ƒç”¨ï¼Œå³ç¨‹åºç»ˆæ­¢æ—¶æŸäº›å¯¹è±¡çš„ <code>dealloc</code> æ–¹æ³•ç³»ç»Ÿå¯èƒ½å°±ä¸å†å»è°ƒç”¨äº†ï¼Œå› æ­¤å½“éœ€è¦åœ¨ç¨‹åºç»ˆæ­¢æ—¶æ¸…ç†æŸäº›å¯¹è±¡æ—¶ï¼Œå¯ä»¥åœ¨ <code>AppDelegate</code> ä¸­çš„ç›¸å…³æ–¹æ³•ä¸­æ“ä½œã€‚</p>
<p><code>dealloc</code> æ–¹æ³•è°ƒç”¨æ—¶ï¼Œå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå·²ç»æ¥è¿‘å°¾å£°ï¼Œæ­¤æ—¶ä¸åº”éšä¾¿è°ƒç”¨å…¶å®ƒæ–¹æ³•ï¼Œå°¤å…¶æ˜¯å¼‚æ­¥æ–¹æ³•ã€ç‰¹å®šçº¿ç¨‹æ–¹æ³•ã€å±æ€§ getter &amp; setterï¼š</p>
<ol>
<li>å¼‚æ­¥æ–¹æ³•ï¼šå½“å¼‚æ­¥æ–¹æ³•æ‰§è¡Œå®Œæ¯•æ—¶ï¼Œç³»ç»Ÿå·²ç»å°†å¾…å›æ”¶å¯¹è±¡å½»åº•é”€æ¯ï¼Œè¿™å°†å¯èƒ½å¯¼è‡´å¾ˆå¤šé—®é¢˜ï¼›</li>
<li>ç‰¹å®šçº¿ç¨‹æ–¹æ³•ï¼šè°ƒç”¨ <code>dealloc</code> æ–¹æ³•çš„æ‰€åœ¨çº¿ç¨‹å°†æ‰§è¡Œæœ€ç»ˆçš„é‡Šæ”¾æ“ä½œï¼Œä»¤å¯¹è±¡çš„å¼•ç”¨è®¡æ•°å½’é›¶ï¼›è€ŒæŸäº›æ–¹æ³•å¿…é¡»åœ¨ç‰¹å®šçš„çº¿ç¨‹é‡Œï¼ˆæ¯”å¦‚ä¸»çº¿ç¨‹é‡Œï¼‰è°ƒç”¨ï¼Œä½†æ­¤æ—¶å·²ç»æ— æ³•ä¿è¯å…¶ä¼šåœ¨æ­£ç¡®çš„çº¿ç¨‹ä¸Šæ­£ç¡®è¿è¡Œï¼Œå› ä¸ºå¯¹è±¡å·²ç»å¤„äºæ­£åœ¨å›æ”¶çš„çŠ¶æ€ï¼›ä¸ºæŒ‡æ˜æ­¤çŠ¶å†µï¼Œè¿è¡Œæ—¶ç³»ç»Ÿå·²ç»æ”¹åŠ¨äº†å¯¹è±¡çš„å†…éƒ¨æ•°æ®ç»“æ„ï¼›</li>
<li>å±æ€§ getter &amp; setterï¼šgetter &amp; setter æœ‰å¯èƒ½ä¼šè¢«é‡å†™ï¼Œå…¶ä¸­å¯èƒ½ä¼šåšä¸€äº›ä¸å—æ§åˆ¶çš„æ“ä½œï¼›å¦å¤–å¦‚æœå¯¹è±¡çš„å±æ€§å¤„äº KVO ä¸‹ï¼Œæ­¤æ—¶çš„æ”¹å˜å°†ä½¿ç”¨åˆ°å³å°†å›æ”¶çš„å¯¹è±¡ï¼Œè¿™å°†å¯èƒ½å¯¼è‡´å¾ˆå¤šé—®é¢˜ã€‚</li>
</ol>
<h3 id="heading-25">ç¼–å†™ã€Œå¼‚å¸¸å®‰å…¨ä»£ç æ—¶ã€ç•™æ„å†…å­˜ç®¡ç†é—®é¢˜</h3>
<p>çº¯ C ä¸­ä¸æ”¯æŒå¼‚å¸¸ï¼ˆExceptionï¼‰ï¼Œè€Œ C++ å’Œ Obj-C å‡æ”¯æŒå¼‚å¸¸ï¼Œä¸”åœ¨ Xcode ä¸­ä¸¤è€…çš„å¼‚å¸¸æ˜¯äº’ç›¸å…¼å®¹çš„ï¼ˆå¯ä»¥äº’ç›¸æ•è·ï¼‰ã€‚å¼‚å¸¸å®‰å…¨çš„ä»£ç ä½¿å¾—å¼‚å¸¸æŠ›å‡ºä½†å¹¶ä¸ä¼šå½±å“ç¨‹åºçš„ç»§ç»­è¿è¡Œï¼Œä½†è¿™é‡Œå°±ä¼šå‡ºç°å†…å­˜ç®¡ç†çš„é—®é¢˜ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec"><span style="color:#66d9ef">@interface</span> <span style="color:#a6e22e">ExceptionMaker</span> : <span style="color:#a6e22e">NSObject</span>
- (<span style="color:#66d9ef">void</span>)<span style="color:#a6e22e">generate</span>;
<span style="color:#66d9ef">@end</span>

<span style="color:#66d9ef">@implementation</span> <span style="color:#a6e22e">ExceptionMaker</span>
- (<span style="color:#66d9ef">void</span>)<span style="color:#a6e22e">generate</span> {
    <span style="color:#66d9ef">@throw</span> [NSException exceptionWithName:NSInternalInconsistencyException
                                   reason:<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">Just generate one exception!</span><span style="color:#e6db74">&#34;</span>
                                 userInfo:nil];
}
<span style="color:#66d9ef">@end</span>

<span style="color:#75715e">// MRC ä¸‹ï¼š
</span><span style="color:#75715e"></span><span style="color:#66d9ef">@try</span> {
    ExceptionMaker <span style="color:#f92672">*</span>maker <span style="color:#f92672">=</span> [ExceptionMaker new];
    [maker generate];
    [maker <span style="color:#66d9ef">release</span>]; <span style="color:#75715e">// å½“å¼‚å¸¸å‘ç”Ÿï¼Œæ­¤è¡Œä»£ç å°†ç›´æ¥è·³è¿‡ï¼Œå°†å¯¼è‡´å†…å­˜æ³„æ¼
</span><span style="color:#75715e"></span>} <span style="color:#66d9ef">@catch</span> (NSException <span style="color:#f92672">*</span>excpetion) {
    <span style="color:#75715e">// Do sth with exception
</span><span style="color:#75715e"></span>}

<span style="color:#75715e">// â¬‡ï¸
</span><span style="color:#75715e"></span>
ExceptionMaker <span style="color:#f92672">*</span>maker;
<span style="color:#66d9ef">@try</span> {
    maker <span style="color:#f92672">=</span> [ExceptionMaker new];
    [maker generate];
} <span style="color:#66d9ef">@catch</span> (NSException <span style="color:#f92672">*</span>excpetion) {
    <span style="color:#75715e">// Do sth with exception
</span><span style="color:#75715e"></span>} <span style="color:#66d9ef">@finally</span> {
    <span style="color:#75715e">// æ— è®ºå¦‚ä½•ï¼Œæœ€ç»ˆå‡æ‰§è¡Œé‡Šæ”¾
</span><span style="color:#75715e"></span>    [maker <span style="color:#66d9ef">release</span>];
}
</code></pre></div><p>ARC ä¸‹ï¼Œå†…å­˜é—®é¢˜åˆ™æ›´åŠ ä¸¥é‡ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec"><span style="color:#66d9ef">@try</span> {
    <span style="color:#75715e">// ARC ä¸‹è¿™æ ·å†™å¾ˆè‡ªç„¶ï¼Œä½† maker å®šä¹‰åœ¨å½“å‰å—å†…ï¼Œæ— æ³•åœ¨ finally ä¸­é‡Šæ”¾
</span><span style="color:#75715e"></span>    ExceptionMaker <span style="color:#f92672">*</span>maker <span style="color:#f92672">=</span> [ExceptionMaker new];
    [maker generate];
} <span style="color:#66d9ef">@catch</span> (NSException <span style="color:#f92672">*</span>excpetion) {
    <span style="color:#75715e">// Do sth with exception
</span><span style="color:#75715e"></span>}
</code></pre></div><p>ARC ä¸‹å¦‚æœè¦è‡ªåŠ¨å¤„ç†åˆ™éœ€è¦åŠ å…¥å¤§é‡æ ·æ¿ä»£ç æ¥è·Ÿè¸ªå¾…æ¸…ç†çš„å¯¹è±¡ï¼Œè¿™æ ·çš„å¼Šç«¯æ˜¯ä¼šå½±å“è¿è¡Œæ—¶æ€§èƒ½ï¼Œä¸”ä¼šæ˜æ˜¾å¢å¤§åº”ç”¨ç¨‹åºçš„å¤§å°ï¼Œå› æ­¤è¯¥è‡ªåŠ¨å¤„ç†é»˜è®¤æ˜¯å…³é—­çš„ã€‚ä½†æˆ‘ä»¬ä»ç„¶å¯ä»¥é€šè¿‡ <code>-fobjc-arc-expection</code> ç¼–è¯‘å™¨æ ‡å¿—æ¥å¼€å¯è‡ªåŠ¨å¤„ç†ã€‚å¦‚ä¸Šæ–‡ã€Œç†è§£ Objective-C é”™è¯¯æ¨¡å‹ã€ä¸€èŠ‚ä¸­æ‰€è¿°ï¼Œé»˜è®¤ä¸å¼€å¯è‡ªåŠ¨å¤„ç†çš„åŸå› æ˜¯å¼‚å¸¸é€šå¸¸æ˜¯å‘ç”Ÿä¸¥é‡é”™è¯¯ç»ˆæ­¢ç¨‹åºæ‰åº”æŠ›å‡ºï¼Œè‡ªç„¶ä¹Ÿå°±æ— éœ€å†è€ƒè™‘å†…å­˜æ³„æ¼é—®é¢˜ã€‚å¦‚æœç¨‹åºä¸­æœ‰è®¸å¤šå¼‚å¸¸æ•è·æ“ä½œæ—¶ï¼Œåº”å½“è€ƒè™‘ä½¿ç”¨ <code>NSError</code> æ¥è¿›è¡Œå–ä»£ã€‚</p>
<p>å¦å¤–åœ¨ Obj-C++ æ¨¡å¼æ—¶ï¼Œç¼–è¯‘å™¨å°†è‡ªåŠ¨æ‰“å¼€ <code>-fobjc-arc-expection</code> æ ‡å¿—ã€‚è¿™æ˜¯å› ä¸º C++ å¤„ç†å¼‚å¸¸æ‰€ç”¨çš„ä»£ç ä¸ ARC å®ç°çš„é™„åŠ ä»£ç ç±»ä¼¼ï¼Œå› æ­¤ ARC åŠ å…¥æ ·æ¿ä»£ç æ¥å®‰å…¨å¤„ç†å¼‚å¸¸æ‰€é€ æˆçš„æ€§èƒ½æŸå¤±å¯ä»¥æ¥å—ï¼Œä¸” C++/Obj-C++ å¯èƒ½éœ€è¦é¢‘ç¹ä½¿ç”¨å¼‚å¸¸ã€‚</p>
<h3 id="heading-26">ä»¥å¼±å¼•ç”¨é¿å…ä¿ç•™ç¯</h3>
<p><code>weak</code> å¼±å¼•ç”¨å¯ä»¥è‡ªåŠ¨æ¸…ç©ºï¼Œä¹Ÿå¯ä¸è‡ªåŠ¨æ¸…ç©ºã€‚è‡ªåŠ¨æ¸…ç©ºï¼ˆAutonillingï¼‰æ˜¯éšç€ ARC å¼•å…¥çš„æ–°ç‰¹æ€§ï¼Œç”±è¿è¡Œæ—¶å®ç°ã€‚</p>
<h3 id="heading-27">ä»¥ã€Œè‡ªåŠ¨é‡Šæ”¾æ± å—ã€é™ä½å†…å­˜å³°å€¼</h3>
<p>è‡ªåŠ¨é‡Šæ”¾æ± ï¼ˆAutorelease Poolï¼‰ç”¨äºå­˜æ”¾é‚£äº›éœ€è¦åœ¨ç¨åæŸä¸ªæ—¶åˆ»é‡Šæ”¾çš„å¯¹è±¡ï¼Œæ¸…ç©ºè‡ªåŠ¨é‡Šæ”¾æ± æ—¶ï¼Œç³»ç»Ÿä¼šå‘å…¶ä¸­çš„å¯¹è±¡å‘é€ <code>release</code> æ¶ˆæ¯ã€‚GCD æœºåˆ¶ä¸­çš„çº¿ç¨‹é»˜è®¤éƒ½æœ‰è‡ªåŠ¨é‡Šæ”¾æ± ï¼Œæ¯æ¬¡æ‰§è¡Œäº‹ä»¶å¾ªç¯ï¼ˆEvent Loopï¼‰æ—¶ï¼Œå°±ä¼šå°†å…¶æ¸…ç©ºï¼Œå› æ­¤è¿™é‡Œæˆ‘ä»¬ä¸éœ€è¦è‡ªå·±åˆ›å»ºï¼›é€šå¸¸åªæœ‰åœ¨ç¨‹åºçš„ <code>main</code> å‡½æ•°å…¥å£åˆ›å»ºï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec"><span style="color:#75715e">// main.m
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// Xcode 11 å‰
</span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span> argv[]) {
    <span style="color:#66d9ef">@autoreleasepool</span> {
        <span style="color:#66d9ef">return</span> UIApplicationMain(argc, argv, nil, NSStringFromClass([AppDelegate <span style="color:#66d9ef">class</span>]));
    }
    <span style="color:#75715e">// è‡ªåŠ¨é‡Šæ”¾æ± çš„æœ«å°¾å³ç¨‹åºçš„ç»ˆæ­¢å¤„ï¼Œæ­¤æ—¶æ“ä½œç³»ç»Ÿä¼šæŠŠç¨‹åºæ‰€å çš„æ‰€æœ‰å†…å­˜é‡Šæ”¾ï¼›
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// è‹¥ä¸å†™æ˜åˆ™ UIApplicationMain å‡½æ•°ä¸­æ‰€éœ€è‡ªåŠ¨é‡Šæ”¾çš„å¯¹è±¡å°±æ²¡æœ‰è‡ªåŠ¨é‡Šæ”¾æ± å®¹çº³äº†ï¼Œç³»ç»Ÿå°†æœ‰è­¦å‘Šæ¥æç¤ºï¼›
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// è¿™ä¸ªæ± å¯ä»¥ç†è§£æˆæœ€å¤–å›´å…¨éƒ¨è‡ªåŠ¨é‡Šæ”¾å¯¹è±¡æ‰€ç”¨çš„æ± ã€‚
</span><span style="color:#75715e"></span>}

<span style="color:#75715e">// Xcode 11
</span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span> argv[]) {
    NSString <span style="color:#f92672">*</span> appDelegateClassName;
    <span style="color:#66d9ef">@autoreleasepool</span> {
        <span style="color:#75715e">// Setup code that might create autoreleased objects goes here.
</span><span style="color:#75715e"></span>        appDelegateClassName <span style="color:#f92672">=</span> NSStringFromClass([AppDelegate <span style="color:#66d9ef">class</span>]);
    }
    <span style="color:#66d9ef">return</span> UIApplicationMain(argc, argv, nil, appDelegateClassName);
}
</code></pre></div><p>è‡ªåŠ¨é‡Šæ”¾æ± å¯ä»¥åµŒå¥—ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec"><span style="color:#66d9ef">@autoreleasepool</span> { <span style="color:#75715e">// A
</span><span style="color:#75715e"></span>    NSString <span style="color:#f92672">*</span>string <span style="color:#f92672">=</span> [NSString stringWithFormat:<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">kingcos.me</span><span style="color:#e6db74">&#34;</span>];
    <span style="color:#66d9ef">@autoreleasepool</span> { <span style="color:#75715e">// B
</span><span style="color:#75715e"></span>        NSNumber <span style="color:#f92672">*</span>number <span style="color:#f92672">=</span> [NSNumber numberWithInt:<span style="color:#ae81ff">1</span>];
    } <span style="color:#75715e">// B Pool è‡ªåŠ¨æ¸…ç©ºï¼Œnumber æ”¶åˆ° release æ¶ˆæ¯
</span><span style="color:#75715e"></span>} <span style="color:#75715e">// A Pool è‡ªåŠ¨æ¸…ç©ºï¼Œstring æ”¶åˆ° release æ¶ˆæ¯
</span></code></pre></div><p>è‡ªåŠ¨é‡Šæ”¾æ± å¯ä»¥ç”¨æ¥é™ä½å†…å­˜å³°å€¼ï¼ˆHigh-Memory Waterlineï¼‰ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec">NSMutableArray <span style="color:#f92672">*</span>arr <span style="color:#f92672">=</span> [NSMutableArray new];
<span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">10000000</span>; i <span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
    <span style="color:#66d9ef">@autoreleasepool</span> { <span style="color:#75715e">// å†…éƒ¨è‡ªåŠ¨é‡Šæ”¾çš„å¯¹è±¡å°†æ”¾åœ¨è¯¥æ± ä¸­ï¼Œè€Œéçº¿ç¨‹çš„ä¸»æ± ä¸­
</span><span style="color:#75715e"></span>        Foo <span style="color:#f92672">*</span>foo <span style="color:#f92672">=</span> [self generate]; <span style="color:#75715e">// è‹¥ä¸åŠ  @autoreleasepool å°†åœ¨ for å¾ªç¯ç»“æŸåé‡Šæ”¾ï¼Œå†…å­˜å ç”¨å°†æŒç»­ä¸Šæ¶¨
</span><span style="color:#75715e"></span>        [arr addObject:foo];
    }
}

<span style="color:#75715e">// MRC ä¸‹çš„ NSAutoreleasePool
</span><span style="color:#75715e"></span>NSMutableArray <span style="color:#f92672">*</span>arr <span style="color:#f92672">=</span> [NSMutableArray new];
NSAutoreleasePool <span style="color:#f92672">*</span>pool <span style="color:#f92672">=</span> [[NSAutoreleasePool alloc] init];
<span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">10000000</span>; i <span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
    Foo <span style="color:#f92672">*</span>foo <span style="color:#f92672">=</span> [self <span style="color:#66d9ef">do</span>];
    [arr addObject:foo];

    <span style="color:#75715e">// æ¯éš” 10 æ¬¡é‡Šæ”¾ä¸€æ¬¡
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (i <span style="color:#f92672">%</span> <span style="color:#ae81ff">10</span> <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>) {
        [pool drain];
    }
}
<span style="color:#75715e">// é˜²æ­¢æœªé‡Šæ”¾ï¼Œå†æ‰‹åŠ¨é‡Šæ”¾ä¸€æ¬¡
</span><span style="color:#75715e"></span>[pool drain];

<span style="color:#75715e">// @autoreleasepool è¯­æ³•è¾ƒäº NSAutoreleasePool æ›´å¥½çš„æ˜¯èŒƒå›´çš„ç¼ºç‚¹ï¼Œé¿å…äº†åœ¨è‡ªåŠ¨é‡Šæ”¾æ± æ¸…ç©ºåå†æ¬¡ä½¿ç”¨ç›¸å…³å¯¹è±¡
</span><span style="color:#75715e"></span>
- (Foo <span style="color:#f92672">*</span>)<span style="color:#a6e22e">generate</span> {
    Foo <span style="color:#f92672">*</span>foo <span style="color:#f92672">=</span> [[Foo alloc] init];
    <span style="color:#75715e">// æ”¾å…¥è‡ªåŠ¨é‡Šæ”¾æ± ä¸­
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">return</span> [foo autorelease];
}
</code></pre></div><p>è‡ªåŠ¨é‡Šæ”¾æ± æœºåˆ¶ç±»ä¼¼æ ˆï¼Œå†…éƒ¨éœ€è¦æ”¾å…¥è‡ªåŠ¨é‡Šæ”¾æ± çš„å¯¹è±¡å°†å…¥æ ˆï¼Œè€Œæ¸…ç©ºè‡ªåŠ¨é‡Šæ”¾æ± åˆ™ç›¸å½“äºå°†å…¶å‡ºæ ˆã€‚è‡ªåŠ¨é‡Šæ”¾æ± çš„å»ºç«‹ä¼šå¸¦æ¥ä¸€å®šå¼€é”€ï¼Œå…·ä½“æ˜¯å¦ç”¨æ¥ä¼˜åŒ–æ•ˆç‡ï¼Œéœ€å–å†³äºå…·ä½“æƒ…å†µã€‚</p>
<h3 id="heading-28">ç”¨ã€Œåƒµå°¸å¯¹è±¡ã€è°ƒè¯•å†…å­˜ç®¡ç†é—®é¢˜</h3>
<p>ã€Œåƒµå°¸å¯¹è±¡ã€åŠŸèƒ½æŒ‡çš„æ˜¯åœ¨è¿è¡Œæ—¶ç³»ç»Ÿä¼šå°†æ‰€æœ‰å·²å›æ”¶çš„å¯¹è±¡è½¬åŒ–ä¸ºåƒµå°¸å¯¹è±¡ï¼Œå½“å…¶å†æ¬¡æ”¶åˆ°æ¶ˆæ¯æ—¶å°†æŠ›å‡ºå¼‚å¸¸ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ Xcode - Edit Schemes - Memory Management - Zombie Objects æ¥å¼€å¯è¯¥åŠŸèƒ½ï¼š</p>
<p><img src="/img/2019/effective_obj-c_2.0_notes/2.png" alt="2"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec">Bar <span style="color:#f92672">*</span>bar <span style="color:#f92672">=</span> [[Bar alloc] init];
<span style="color:#75715e">// 1: Bar *
</span><span style="color:#75715e"></span>[bar <span style="color:#66d9ef">release</span>];
<span style="color:#75715e">// 2: _NSZombie_Bar *
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// LLDB:
</span><span style="color:#75715e"></span><span style="color:#75715e">// (lldb) p bar
</span><span style="color:#75715e"></span><span style="color:#75715e">// (Bar *) $0 = 0x00006000009dc040
</span><span style="color:#75715e"></span><span style="color:#75715e">// (lldb) p bar
</span><span style="color:#75715e"></span><span style="color:#75715e">// (_NSZombie_Bar *) $1 = 0x00006000009dc040
</span><span style="color:#75715e"></span><span style="color:#75715e">// (lldb)
</span></code></pre></div><p>åƒµå°¸ç±»æ˜¯ä»åä¸º <code>_NSZombie_</code> çš„æ¨¡ç‰ˆç±»é‡Œå¤åˆ¶å‡ºæ¥çš„ï¼Œåˆ›å»ºå¹¶å¤åˆ¶æ–°çš„åƒµå°¸ç±»åŸå› åœ¨äºï¼Œåƒµå°¸å¯¹è±¡å‘é€æ¶ˆæ¯æ—¶ï¼Œå¯ç”±æ­¤å¾—çŸ¥è¯¥å¯¹è±¡åŸæœ¬æ‰€å±çš„ç±»å‹ã€‚åˆ›å»ºç»§æ‰¿è‡ª <code>_NSZombie_</code> çš„å­ç±»ä¹Ÿå¯è¡Œï¼Œä½†æ•ˆç‡ä½äºæ‹·è´ã€‚ä¼ªä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec"><span style="color:#75715e">// ä¼ªä»£ç 
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// è¿è¡Œæ—¶è‹¥å‘ç° NSZombieEnabled ç¯å¢ƒå˜é‡å·²ç»è®¾ç½®ï¼Œå°†å¯¹å¯¹è±¡çš„ dealloc æ–¹æ³•äº¤æ¢ä¸ºä»¥ä¸‹æ–¹æ³•ï¼š
</span><span style="color:#75715e"></span>- (<span style="color:#66d9ef">void</span>)<span style="color:#a6e22e">zombieDealloc</span> {
    <span style="color:#75715e">// è·å–å°†è¦é‡Šæ”¾çš„å¯¹è±¡çš„ç±»å¯¹è±¡
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">Class</span> cls <span style="color:#f92672">=</span> object_getClass(self);
    <span style="color:#75715e">// è·å–ç±»å
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>clsName <span style="color:#f92672">=</span> class_getName(cls);
    <span style="color:#75715e">// ç”Ÿæˆæ–°ç±»å
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>zombieClsName <span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">_NSZombie_</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">+</span> clsName;
    <span style="color:#75715e">// æŸ¥æ‰¾æ˜¯å¦å­˜åœ¨è¯¥åƒµå°¸ç±»
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">Class</span> zombieCls <span style="color:#f92672">=</span> objc_lookUpClass(zombieClsName);
    <span style="color:#75715e">// è‹¥ä¸å­˜åœ¨åˆ™éœ€åˆ›å»º
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>zombieCls) {
        <span style="color:#75715e">// è·å–åƒµå°¸åŸºç±»ï¼ˆä½¿å¾—åç»­å¯å¾—çŸ¥å¯¹è±¡æ‰€å±çš„ç±»ï¼‰
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">Class</span> baseZombieCls <span style="color:#f92672">=</span> objc_lookUpClass(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">_NSZombie_</span><span style="color:#e6db74">&#34;</span>);
        <span style="color:#75715e">// å¤åˆ¶åƒµå°¸åŸºç±»ä¸ºæ–°ç±»åå³ä¿®æ”¹ isa æŒ‡é’ˆï¼ˆæ‹·è´è€Œéåˆ›å»ºå­ç±»çš„æ•ˆç‡æ›´é«˜ï¼‰
</span><span style="color:#75715e"></span>        zombieCls <span style="color:#f92672">=</span> objc_duplicateClass(baseZombieCls, zombieClsName, <span style="color:#ae81ff">0</span>)
    }
    <span style="color:#75715e">// æ‰§è¡Œæ­£å¸¸çš„é”€æ¯æ“ä½œ
</span><span style="color:#75715e"></span>    objc_destructInstance(self);
    <span style="color:#75715e">// å°†è¦é”€æ¯çš„å¯¹è±¡çš„ç±»å‹è®¾ç½®ä¸ºåƒµå°¸ç±»
</span><span style="color:#75715e"></span>    objc_setClass(self, zombieCls);

    <span style="color:#75715e">// å…³é”®ä¹‹å¤„åœ¨äºå¯¹è±¡æœ¬èº«å¹¶æœªé€šè¿‡ free() è¢«é‡Šæ”¾ï¼Œè™½ç„¶ä¼šå†…å­˜æ³„æ¼ï¼Œä½†è¯¥åŠŸèƒ½ä»…ä»…åœ¨è°ƒè¯•é˜¶æ®µå¼€å¯ï¼Œå¯ä»¥å¿½ç•¥
</span><span style="color:#75715e"></span>}
</code></pre></div><p><code>_NSZombie_</code> æ¨¡ç‰ˆç±»ä¸­å¹¶æœªå®ç°ä»»ä½•æ–¹æ³•ï¼Œä¸”æ²¡æœ‰è¶…ç±»ï¼ˆç±»ä¼¼ <code>NSObject</code>ï¼‰ï¼Œä»…æœ‰ä¸€ä¸ª <code>isa</code> æˆå‘˜å˜é‡ï¼Œå› æ­¤å‘é€ç»™è¯¥åƒµå°¸å¯¹è±¡çš„æ¶ˆæ¯éœ€ç»ç”±å®Œæ•´çš„æ¶ˆæ¯è½¬å‘æœºåˆ¶ã€‚è€Œå®Œæ•´çš„æ¶ˆæ¯è½¬å‘æœºåˆ¶ä¸­ï¼Œ<code>___forwarding___</code> æ˜¯æ ¸å¿ƒï¼Œå…¶è¦æ£€æŸ¥æ¥å—æ¶ˆæ¯çš„å¯¹è±¡æ‰€å±çš„ç±»åï¼Œè‹¥å‰ç¼€ä¸º <code>_NSZombie_</code> åˆ™æ¶ˆæ¯æ¥æ”¶è€…ä¸ºåƒµå°¸å¯¹è±¡ï¼Œéœ€ç‰¹æ®Šå¤„ç†ï¼Œå³æ‰“å°ç›¸å…³ä¿¡æ¯å¹¶ç»ˆæ­¢ç¨‹åºã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec"><span style="color:#75715e">// è·å–å°†è¦é‡Šæ”¾çš„å¯¹è±¡çš„ç±»å¯¹è±¡
</span><span style="color:#75715e"></span><span style="color:#66d9ef">Class</span> cls <span style="color:#f92672">=</span> object_getClass(self);
<span style="color:#75715e">// è·å–ç±»å
</span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>clsName <span style="color:#f92672">=</span> class_getName(cls);
<span style="color:#75715e">// ç¡®å®šæ˜¯å¦ä¸ºåƒµå°¸ç±»å‹
</span><span style="color:#75715e"></span><span style="color:#66d9ef">if</span> (string_has_prefix(clsName, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">_NSZombie_</span><span style="color:#e6db74">&#34;</span>)) {
    <span style="color:#75715e">// æˆªå–åŸå§‹ç±»å
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>originalClsName <span style="color:#f92672">=</span> substring_from(clsName, <span style="color:#ae81ff">10</span>);
    <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>selectorName <span style="color:#f92672">=</span> sel_getName(_cmd);

    <span style="color:#75715e">// æ‰“å°ç›¸å…³ä¿¡æ¯
</span><span style="color:#75715e"></span>    Log(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">*** -[%s %s]: message sent to deallocated instance %p</span><span style="color:#e6db74">&#34;</span>, originalClsName, selectorName, self);

    <span style="color:#75715e">// ç»ˆæ­¢ç¨‹åº
</span><span style="color:#75715e"></span>    abort();
}
</code></pre></div><h3 id="-retaincount">ä¸è¦ä½¿ç”¨ retainCount</h3>
<p><code>retainCount</code> æ˜¯ MRC ä¸‹çš„æ–¹æ³•ï¼Œç”¨æ¥è·å–å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ï¼Œä½†å…¶å®å¼•ç”¨è®¡æ•°çš„å…·ä½“å€¼å¼€å‘è€…ä¸åº”ç‰¹åˆ«å…³å¿ƒã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec"><span style="color:#75715e">// MRC
</span><span style="color:#75715e"></span><span style="color:#66d9ef">while</span> ([obj retainCount]) {
    [obj <span style="color:#66d9ef">release</span>];
}
</code></pre></div><p>ä»¥ä¸Šçš„å†™æ³•æ˜¯é”™è¯¯çš„ï¼š</p>
<ol>
<li><code>retainCount</code> æ–¹æ³•å¹¶ä¸ä¼šè€ƒè™‘åˆ° <code>autorelease</code> çš„æƒ…å†µï¼Œå› æ­¤å½“è·³å‡ºå¾ªç¯æ—¶å¼•ç”¨è®¡æ•°ç¡®å®å½’ 0ï¼Œä½†æ­¤æ—¶è‹¥è‡ªåŠ¨é‡Šæ”¾æ± å†æ¬¡è¿›è¡Œé‡Šæ”¾æ—¶å°†å¯¼è‡´ç¨‹åºå´©æºƒï¼›</li>
<li><code>retainCount</code> æ–¹æ³•å¯èƒ½æ°¸è¿œä¸è¿”å› <code>0</code>ï¼Œç³»ç»Ÿæœ‰æ—¶ä¼šä¼˜åŒ–å¯¹è±¡çš„é‡Šæ”¾è¡Œä¸ºï¼ˆå³ä½¿å¼•ç”¨è®¡æ•°ä¸º 1 æ—¶å°±å¯èƒ½è¢«å›æ”¶ï¼‰ï¼Œå¦‚æœå¯¹è±¡å·²ç»è¢«å›æ”¶ï¼Œä½†ä»ç„¶è¿›å…¥å¾ªç¯è¿›è¡Œé‡Šæ”¾ï¼Œå°†åŒæ ·å¯¼è‡´ç¨‹åºå´©æºƒã€‚</li>
</ol>
<p>å› æ­¤ï¼Œé‡Šæ”¾å¯¹è±¡ä¸åº”å½“é€šè¿‡å¼•ç”¨è®¡æ•°æ¥åˆ¤æ–­ï¼Œè€Œæ˜¯åº”è¯¥æ‰¾æ¸…æ¥šå“ªé‡Œä»å¯¹å¯¹è±¡è¿›è¡Œäº†æŒæœ‰ï¼Œé€šè¿‡å†…å­˜ç®¡ç†è§£å†³é—®é¢˜ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec"><span style="color:#75715e">// 64 bit macOS
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// å•ä¾‹å¯¹è±¡ï¼ˆç¼–è¯‘æœŸå¸¸é‡ï¼Œç¼–è¯‘å™¨å°†è¯¥æ•°æ®ç›´æ¥æ”¾åœ¨å¯æ‰§è¡Œæ–‡ä»¶ä¸­å³å¯æ— éœ€åˆ›å»ºå¯¹è±¡ï¼‰å¼•ç”¨è®¡æ•°ä¸ä¼šå˜
</span><span style="color:#75715e"></span>NSString <span style="color:#f92672">*</span>str1 <span style="color:#f92672">=</span> <span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">kingcos.me</span><span style="color:#e6db74">&#34;</span>;
<span style="color:#75715e">// 18446744073709551615
</span><span style="color:#75715e"></span>NSLog(<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">%lu</span><span style="color:#e6db74">&#34;</span>, (<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">long</span>)[str1 retainCount]);

<span style="color:#75715e">// å•ä¾‹å¯¹è±¡ï¼ˆæ ‡ç­¾æŒ‡é’ˆï¼Œè¿è¡Œæ—¶åœ¨æ¶ˆæ¯æ´¾å‘æœŸé—´æ£€æµ‹å¹¶æ‰§è¡Œç›¸åº”æ“ä½œï¼‰
</span><span style="color:#75715e"></span>NSNumber <span style="color:#f92672">*</span>num1 <span style="color:#f92672">=</span> <span style="color:#ae81ff">@1</span>;
<span style="color:#75715e">// 9223372036854775807
</span><span style="color:#75715e"></span>NSLog(<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">%lu</span><span style="color:#e6db74">&#34;</span>, (<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">long</span>)[num1 retainCount]);

<span style="color:#75715e">// NSNumber æµ®ç‚¹æ•°æ²¡æœ‰æ­¤ç±»ä¼˜åŒ–
</span><span style="color:#75715e"></span>NSNumber <span style="color:#f92672">*</span>num2 <span style="color:#f92672">=</span> <span style="color:#ae81ff">@3.14</span>;
<span style="color:#75715e">// 1
</span><span style="color:#75715e"></span>NSLog(<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">%lu</span><span style="color:#e6db74">&#34;</span>, (<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">long</span>)[num2 retainCount]);
</code></pre></div><p>ç»¼ä¸Šä¸å»ºè®®ä½¿ç”¨ <code>retainCount</code> æ–¹æ³•ã€‚</p>
<h2 id="heading-29">å—ä¸å¤§ä¸­æ¢æ´¾å‘</h2>
<h3 id="heading-30">ç†è§£ã€Œå—ã€è¿™ä¸€æ¦‚å¿µ</h3>
<p>ç•¥ï¼›å…³äº Blockï¼Œå¯è¯¦è§ã€Š<a href="../block_in_obj-c">Obj-C ä¸­çš„ Block</a>ã€‹ä¸€æ–‡ã€‚</p>
<h3 id="-typedef">ä¸ºå¸¸ç”¨çš„å—ç±»å‹åˆ›å»º <code>typedef</code></h3>
<p>ç•¥ï¼›å…³äº Blockï¼Œå¯è¯¦è§ã€Š<a href="../block_in_obj-c">Obj-C ä¸­çš„ Block</a>ã€‹ä¸€æ–‡ã€‚</p>
<h3 id="-handler-">ç”¨ handler å—é™ä½ä»£ç åˆ†æ•£ç¨‹åº¦</h3>
<p>ç•¥ï¼›å…³äº Blockï¼Œå¯è¯¦è§ã€Š<a href="../block_in_obj-c">Obj-C ä¸­çš„ Block</a>ã€‹ä¸€æ–‡ã€‚</p>
<h3 id="heading-31">ç”¨å—å¼•ç”¨å…¶æ‰€å±å¯¹è±¡æ—¶ä¸è¦å‡ºç°ä¿ç•™ç¯</h3>
<p>ç•¥ï¼›å…³äº Blockï¼Œå¯è¯¦è§ã€Š<a href="../block_in_obj-c">Obj-C ä¸­çš„ Block</a>ã€‹ä¸€æ–‡ã€‚</p>
<h3 id="heading-32">å¤šç”¨æ´¾å‘é˜Ÿåˆ—ï¼Œå°‘ç”¨åŒæ­¥é”</h3>
<h3 id="-gcd-performselector-">å¤šç”¨ GCDï¼Œå°‘ç”¨ performSelector ç³»åˆ—æ–¹æ³•</h3>
<h3 id="-gcd-">æŒæ¡ GCD åŠæ“ä½œé˜Ÿåˆ—çš„æ—¶æœº</h3>
<h3 id="-dispatch-group-">é€šè¿‡ Dispatch Group æœºåˆ¶ï¼Œæ ¹æ®ç³»ç»Ÿèµ„æºçŠ¶å†µæ¥æ‰§è¡Œä»»åŠ¡</h3>
<h3 id="-dispatch-once-">ä½¿ç”¨ dispatch_once æ¥æ‰§è¡Œåªéœ€è¿è¡Œä¸€æ¬¡çš„çº¿ç¨‹å®‰å…¨ä»£ç </h3>
<h3 id="-dispatch-get-current-queue">ä¸è¦ä½¿ç”¨ dispatch_get_current_queue</h3>
<h2 id="heading-33">ç³»ç»Ÿæ¡†æ¶</h2>
<h3 id="heading-34">ç†Ÿæ‚‰ç³»ç»Ÿæ¡†æ¶</h3>
<p>ç•¥ã€‚</p>
<h3 id="-for-">å¤šç”¨å—æšä¸¾ï¼Œå°‘ç”¨ for å¾ªç¯</h3>
<p>éå†é›†åˆçš„æ–¹å¼æœ‰å¦‚ä¸‹å››ç§ï¼Œä¹‹åå¯èƒ½ä¼šå°†æ­¤éƒ¨åˆ†å•ç‹¬æ€»ç»“ï¼Œæ­¤å¤„ä¸å†èµ˜è¿°ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec"><span style="color:#75715e">// 1âƒ£ï¸ FOR-LOOP
</span><span style="color:#75715e"></span>NSDictionary <span style="color:#f92672">*</span>dict <span style="color:#f92672">=</span> <span style="color:#ae81ff">@{</span><span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">A</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">:</span><span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">a</span><span style="color:#e6db74">&#34;</span>, <span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">B</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">:</span><span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;</span>, <span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">C</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">:</span><span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">c</span><span style="color:#e6db74">&#34;</span>, <span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">kingcos.me</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">:</span><span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">github.com/kingcos</span><span style="color:#e6db74">&#34;</span>,<span style="color:#ae81ff">}</span>;
NSArray <span style="color:#f92672">*</span>allKeys <span style="color:#f92672">=</span> [dict allKeys]; <span style="color:#75715e">// âš ï¸ï¼šNSDictionary &amp; NSSet çš„å…ƒç´ æ˜¯æ— åºçš„
</span><span style="color:#75715e"></span><span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> allKeys.count; i <span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
    NSLog(<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">&lt;%@, %@&gt;</span><span style="color:#e6db74">&#34;</span>, allKeys[i], dict[allKeys[i]]);
}

<span style="color:#75715e">// - å€’åº
</span><span style="color:#75715e"></span>NSArray <span style="color:#f92672">*</span>arr <span style="color:#f92672">=</span> <span style="color:#ae81ff">@[</span><span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">A</span><span style="color:#e6db74">&#34;</span>, <span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">kingcos.me</span><span style="color:#e6db74">&#34;</span>, <span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">github.com/kingcos</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">]</span>;
<span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> (<span style="color:#66d9ef">int</span>)arr.count <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>; i <span style="color:#f92672">&gt;</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">-</span><span style="color:#f92672">-</span>) {
    NSLog(<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">&lt;%@&gt;</span><span style="color:#e6db74">&#34;</span>, arr[i]);
}

<span style="color:#75715e">// 2âƒ£ï¸ ENUMERATOR
</span><span style="color:#75715e"></span>NSEnumerator <span style="color:#f92672">*</span>dictEnumerator <span style="color:#f92672">=</span> [dict keyEnumerator];
<span style="color:#66d9ef">id</span> dictNextObj;
<span style="color:#66d9ef">while</span> ((dictNextObj <span style="color:#f92672">=</span> [dictEnumerator nextObject]) <span style="color:#f92672">!</span><span style="color:#f92672">=</span> nil) {
    NSLog(<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">&lt;%@, %@&gt;</span><span style="color:#e6db74">&#34;</span>, dictNextObj, dict[dictNextObj]);
}

<span style="color:#75715e">// - å€’åº
</span><span style="color:#75715e"></span>NSEnumerator <span style="color:#f92672">*</span>arrReversedEnumerator <span style="color:#f92672">=</span> [arr reverseObjectEnumerator];
<span style="color:#66d9ef">id</span> arrNextObj;
<span style="color:#66d9ef">while</span> ((arrNextObj <span style="color:#f92672">=</span> [arrReversedEnumerator nextObject]) <span style="color:#f92672">!</span><span style="color:#f92672">=</span> nil) {
    NSLog(<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">&lt;%@&gt;</span><span style="color:#e6db74">&#34;</span>, arrNextObj);
}

<span style="color:#75715e">// 3âƒ£ï¸ FAST-ENUMERATION
</span><span style="color:#75715e"></span><span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">id</span> obj <span style="color:#66d9ef">in</span> arr) {
    NSLog(<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">&lt;%@&gt;</span><span style="color:#e6db74">&#34;</span>, obj);
}

<span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">id</span> obj <span style="color:#66d9ef">in</span> [arr reverseObjectEnumerator]) {
    NSLog(<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">&lt;%@&gt;</span><span style="color:#e6db74">&#34;</span>, obj);
}

<span style="color:#75715e">// - è‡ªå®šä¹‰ç±»å‹ä¹Ÿå¯æ”¯æŒå¿«é€Ÿéå†ï¼š
</span><span style="color:#75715e"></span><span style="color:#75715e">//   1. ç»§æ‰¿ NSEnumerator æŠ½è±¡åŸºç±»ï¼Œå¹¶å®ç° allObjects &amp; nextObject
</span><span style="color:#75715e"></span><span style="color:#75715e">//   2. éµå®ˆ NSFastEnumeration åè®®ï¼Œå¹¶å®ç° countByEnumeratingWithState:objects:count:
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// 4âƒ£ï¸ åŸºäº Block
</span><span style="color:#75715e"></span><span style="color:#75715e">// å­—å…¸é”®å€¼åŒæ—¶è¯»å–ï¼›id ç±»å‹ä½¿å¾—å¯ä»¥ä¿®æ”¹æ–¹æ³•ç­¾åï¼Œé¿å…ç±»å‹è½¬æ¢
</span><span style="color:#75715e"></span>[dict enumerateKeysAndObjectsUsingBlock:<span style="color:#f92672">^</span>(<span style="color:#66d9ef">id</span>  _Nonnull key,
                                          NSString <span style="color:#f92672">*</span> _Nonnull obj,
                                          <span style="color:#66d9ef">BOOL</span> <span style="color:#f92672">*</span> _Nonnull stop) {
    NSLog(<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">&lt;%@, %@&gt;</span><span style="color:#e6db74">&#34;</span>, key, obj);

    <span style="color:#66d9ef">if</span> ([obj isEqualToString:<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">github.com/kingcos</span><span style="color:#e6db74">&#34;</span>]) {
        <span style="color:#75715e">// å¯åœ¨å†…éƒ¨ç»ˆæ­¢
</span><span style="color:#75715e"></span>        <span style="color:#f92672">*</span>stop <span style="color:#f92672">=</span> YES;
    }
}];

<span style="color:#75715e">// NSEnumerationOptions æ˜¯æšä¸¾
</span><span style="color:#75715e"></span><span style="color:#75715e">// typedef NS_OPTIONS(NSUInteger, NSEnumerationOptions) {
</span><span style="color:#75715e"></span><span style="color:#75715e">//     NSEnumerationConcurrent = (1UL &lt;&lt; 0), // Block å¯ä»¥å¹¶è¡Œæ‰§è¡Œ
</span><span style="color:#75715e"></span><span style="color:#75715e">//     NSEnumerationReverse = (1UL &lt;&lt; 1),    // å€’åºï¼ˆä»…æ”¯æŒæœ‰åºçš„é›†åˆç»“æ„ï¼‰
</span><span style="color:#75715e"></span><span style="color:#75715e">// };
</span><span style="color:#75715e"></span>
[arr enumerateObjectsWithOptions:NSEnumerationReverse
                      usingBlock:<span style="color:#f92672">^</span>(NSString <span style="color:#f92672">*</span> _Nonnull obj,
                                   NSUInteger idx,
                                   <span style="color:#66d9ef">BOOL</span> <span style="color:#f92672">*</span> _Nonnull stop) {
    NSLog(<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">&lt;%@&gt;</span><span style="color:#e6db74">&#34;</span>, obj);
}];
</code></pre></div><!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<ul>
<li><a href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Collections/Articles/Enumerators.html">Enumeration: Traversing a Collectionâ€™s Elements - Collections Programming Topics</a></li>
<li><a href="https://www.mikeash.com/pyblog/friday-qa-2010-04-09-comparison-of-objective-c-enumeration-techniques.html">Friday Q&amp;A 2010-04-09: Comparison of Objective-C Enumeration Techniques - Mike Ash</a></li>
<li><a href="https://www.mikeash.com/pyblog/friday-qa-2010-04-16-implementing-fast-enumeration.html">Friday Q&amp;A 2010-04-16: Implementing Fast Enumeration - Mike Ash</a></li>
</ul>
<h3 id="-collection-">å¯¹è‡ªå®šä¹‰å…¶å†…å­˜ç®¡ç†è¯­ä¹‰çš„ collection ä½¿ç”¨æ— ç¼æ¡¥æ¥</h3>
<p>æ— ç¼æ¡¥æ¥ï¼ˆToll-Free Bridgingï¼‰ä½¿å¾— <code>Foundation</code> æ¡†æ¶ä¸­çš„ Obj-C ç±»å‹å¯ä»¥ä¸ <code>CoreFoundation</code> æ¡†æ¶é‡Œçš„ C è¯­è¨€æ•°æ®ç»“æ„ä¹‹é—´å¯ä»¥å¹³æ»‘è½¬æ¢ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec">NSArray <span style="color:#f92672">*</span>arr <span style="color:#f92672">=</span> <span style="color:#ae81ff">@[</span><span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">A</span><span style="color:#e6db74">&#34;</span>, <span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">kingcos.me</span><span style="color:#e6db74">&#34;</span>, <span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">github.com/kingcos</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">]</span>;

CFArrayRef cfArray1 <span style="color:#f92672">=</span> (<span style="color:#66d9ef">__bridge</span> CFArrayRef)arr;
NSLog(<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">%li</span><span style="color:#e6db74">&#34;</span>, CFArrayGetCount(cfArray1));

CFArrayRef cfArray2 <span style="color:#f92672">=</span> (__bridge_retained CFArrayRef)arr;
NSLog(<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">%li</span><span style="color:#e6db74">&#34;</span>, CFArrayGetCount(cfArray2));
CFRelease(cfArray2); <span style="color:#75715e">// é‡Šæ”¾
</span><span style="color:#75715e"></span>
CFArrayRef cfArray3 <span style="color:#f92672">=</span> (__bridge_retained CFArrayRef)arr;
NSLog(<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">%li</span><span style="color:#e6db74">&#34;</span>, CFArrayGetCount(cfArray3));
arr <span style="color:#f92672">=</span> (<span style="color:#66d9ef">__bridge_transfer</span> NSArray <span style="color:#f92672">*</span>)cfArray3;

<span style="color:#75715e">// OUTPUT:
</span><span style="color:#75715e"></span><span style="color:#75715e">// 3
</span><span style="color:#75715e"></span><span style="color:#75715e">// 3
</span><span style="color:#75715e"></span><span style="color:#75715e">// 3
</span></code></pre></div><ul>
<li>æ¡¥å¼è½¬æ¢ï¼ˆBridged Castï¼‰
<ul>
<li><code>__bridge</code>ï¼šä»…æ¡¥æ¥ï¼ŒARC ä»æ‹¥æœ‰ Obj-C å¯¹è±¡æ‰€æœ‰æƒï¼›</li>
<li><code>__bridge_retained</code>ï¼šæ¡¥æ¥ä¸”æŒæœ‰ï¼ŒARC ä¸å†æ‹¥æœ‰å¯¹è±¡æ‰€æœ‰æƒï¼Œäº¤ç”± <code>CoreFoundation</code> å¤„ç†ï¼›</li>
<li><code>__bridge_transfer</code>ï¼šæ¡¥æ¥ä¸”è½¬æ¢ï¼ŒARC å†æ¬¡æ‹¥æœ‰å¯¹è±¡æ‰€æœ‰æƒã€‚</li>
</ul>
</li>
</ul>
<p><code>Foundation</code> æ¡†æ¶ä¸ <code>CoreFoundation</code> æ¡†æ¶çš„æŸäº›åŠŸèƒ½å¯ä»¥äº’ç›¸è¡¥è¶³ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec"><span style="color:#75715e">// CFDictionary.h
</span><span style="color:#75715e"></span>CFMutableDictionaryRef <span style="color:#a6e22e">CFDictionaryCreateMutable</span>(CFAllocatorRef allocator, <span style="color:#75715e">// å†…å­˜åˆ†é…å™¨ï¼Œä¼  NULL ä¸ºé»˜è®¤å®ç°
</span><span style="color:#75715e"></span>                                                 CFIndex capacity,         <span style="color:#75715e">// åˆå§‹å®¹é‡
</span><span style="color:#75715e"></span>                                                 <span style="color:#66d9ef">const</span> CFDictionaryKeyCallBacks <span style="color:#f92672">*</span>keyCallBacks, <span style="color:#75715e">// æŒ‡å‘ç»“æ„ä½“çš„æŒ‡é’ˆ
</span><span style="color:#75715e"></span>                                                 <span style="color:#66d9ef">const</span> CFDictionaryValueCallBacks <span style="color:#f92672">*</span>valueCallBacks); <span style="color:#75715e">// åŒä¸Š
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">struct</span> {
    CFIndex                version;           <span style="color:#75715e">// ç‰ˆæœ¬å·ï¼Œé€šå¸¸è®¾ç½®ä¸º 0
</span><span style="color:#75715e"></span>    CFDictionaryRetainCallBack        <span style="color:#66d9ef">retain</span>; <span style="color:#75715e">// å½“äº‹ä»¶å‘é€ï¼Œé€šè¿‡å‡½æ•°æŒ‡é’ˆè°ƒç”¨ï¼Œä¸‹åŒ
</span><span style="color:#75715e"></span>    CFDictionaryReleaseCallBack        <span style="color:#66d9ef">release</span>;
    CFDictionaryCopyDescriptionCallBack    copyDescription;
    CFDictionaryEqualCallBack        equal;
    CFDictionaryHashCallBack        hash;
} CFDictionaryKeyCallBacks;

<span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">struct</span> {
    CFIndex                version;
    CFDictionaryRetainCallBack        <span style="color:#66d9ef">retain</span>;
    CFDictionaryReleaseCallBack        <span style="color:#66d9ef">release</span>;
    CFDictionaryCopyDescriptionCallBack    copyDescription;
    CFDictionaryEqualCallBack        equal;
} CFDictionaryValueCallBacks;

<span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>    (<span style="color:#f92672">*</span>CFDictionaryRetainCallBack)(CFAllocatorRef allocator, <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>value);
<span style="color:#66d9ef">typedef</span> <span style="color:#a6e22e">void</span>        (<span style="color:#f92672">*</span>CFDictionaryReleaseCallBack)(CFAllocatorRef allocator, <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>value);
<span style="color:#66d9ef">typedef</span> <span style="color:#a6e22e">CFStringRef</span>    (<span style="color:#f92672">*</span>CFDictionaryCopyDescriptionCallBack)(<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>value);
<span style="color:#66d9ef">typedef</span> <span style="color:#a6e22e">Boolean</span>        (<span style="color:#f92672">*</span>CFDictionaryEqualCallBack)(<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>value1, <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>value2);
<span style="color:#66d9ef">typedef</span> <span style="color:#a6e22e">CFHashCode</span>    (<span style="color:#f92672">*</span>CFDictionaryHashCallBack)(<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>value);
</code></pre></div><p>æ¯”å¦‚ <code>Foundation</code> ä¸­çš„å­—å…¸å¯¹è±¡çš„é”®å†…å­˜ç®¡ç†è¯­ä¹‰ä¸ºæ‹·è´ï¼Œå€¼å†…å­˜ç®¡ç†è¯­ä¹‰ä¸ºä¿ç•™ï¼Œé‚£ä¹ˆåœ¨é”®å¦‚æœæ˜¯è‡ªå®šä¹‰å¯¹è±¡åˆ™éœ€è¦éµå®ˆ <code>NSCopying</code> åè®®ã€‚ä½†æˆ‘ä»¬å¯ä»¥åœ¨ <code>CoreFoundation</code> å±‚åˆ›å»ºå¹¶ä¿®æ”¹å†…å­˜ç®¡ç†è¯­ä¹‰ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec"><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">DictRetainCallBack</span>(CFAllocatorRef allocator, <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>value) {
    <span style="color:#66d9ef">return</span> CFRetain(value);
}

<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">DictReleaseCallBack</span>(CFAllocatorRef allocator, <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>value) {
    CFRelease(value);
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span> argv[]) {
    <span style="color:#66d9ef">@autoreleasepool</span> {
        CFDictionaryKeyCallBacks keyCallbacks <span style="color:#f92672">=</span> {
            <span style="color:#ae81ff">0</span>,                   <span style="color:#75715e">// version
</span><span style="color:#75715e"></span>            DictRetainCallBack,  <span style="color:#75715e">// retain
</span><span style="color:#75715e"></span>            DictReleaseCallBack, <span style="color:#75715e">// release
</span><span style="color:#75715e"></span>            NULL,                <span style="color:#75715e">// copyDescriptionï¼Œä¼  NULL ä¸ºé»˜è®¤å®ç°
</span><span style="color:#75715e"></span>            CFEqual,             <span style="color:#75715e">// equalï¼ŒCFEqual ä¸é»˜è®¤å®ç°ç›¸åŒï¼Œæœ€ç»ˆè°ƒç”¨ NSObject çš„ isEqual:
</span><span style="color:#75715e"></span>            CFHash               <span style="color:#75715e">// hashï¼ŒCFHash ä¸é»˜è®¤å®ç°ç›¸åŒï¼Œæœ€ç»ˆè°ƒç”¨ NSObject çš„ hash
</span><span style="color:#75715e"></span>        };

        CFDictionaryValueCallBacks valueCallbacks <span style="color:#f92672">=</span> {
            <span style="color:#ae81ff">0</span>,                   <span style="color:#75715e">// version
</span><span style="color:#75715e"></span>            DictRetainCallBack,  <span style="color:#75715e">// retain
</span><span style="color:#75715e"></span>            DictReleaseCallBack, <span style="color:#75715e">// release
</span><span style="color:#75715e"></span>            NULL,                <span style="color:#75715e">// copyDescription
</span><span style="color:#75715e"></span>            CFEqual,             <span style="color:#75715e">// equal
</span><span style="color:#75715e"></span>        };

        CFMutableDictionaryRef cfDict <span style="color:#f92672">=</span> CFDictionaryCreateMutable(NULL, <span style="color:#ae81ff">0</span>, <span style="color:#f92672">&amp;</span>keyCallbacks, <span style="color:#f92672">&amp;</span>valueCallbacks);
        NSMutableDictionary <span style="color:#f92672">*</span>dict <span style="color:#f92672">=</span> (<span style="color:#66d9ef">__bridge_transfer</span> NSMutableDictionary <span style="color:#f92672">*</span>)cfDict;

        Foo <span style="color:#f92672">*</span>foo <span style="color:#f92672">=</span> [[Foo alloc] init];
        <span style="color:#75715e">// dict[foo] = @&#34;foo&#34;; // CRASH: &#39;-[Foo copyWithZone:]: unrecognized selector sent to instance 0x100500670&#39;
</span><span style="color:#75715e"></span>        CFDictionaryAddValue(cfDict, (<span style="color:#66d9ef">__bridge</span> <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>)(foo), CFSTR(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">foo</span><span style="color:#e6db74">&#34;</span>));

        NSLog(<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">%@</span><span style="color:#e6db74">&#34;</span>, dict);
    }
}

<span style="color:#75715e">// OUTPUT:
</span><span style="color:#75715e"></span><span style="color:#75715e">// {
</span><span style="color:#75715e"></span><span style="color:#75715e">//    &#34;&lt;Foo: 0x10059b3c0&gt;&#34; = foo;
</span><span style="color:#75715e"></span><span style="color:#75715e">// }
</span></code></pre></div><h3 id="-nscache--nsdictionary">æ„å»ºç¼“å­˜æ—¶é€‰ç”¨ NSCache è€Œé NSDictionary</h3>
<p>å½“ç½‘ç»œæ•°æ®è¿‡å¤§æˆ–è€…å…¶å®ƒæŸäº›æƒ…å†µï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦ä½¿ç”¨åˆ°æ•°æ®ç»“æ„æ¥åšç¼“å­˜ä»¥ä¼˜åŒ–ç”¨æˆ·ä½“éªŒï¼Œæ­¤æ—¶ <code>NSCache</code> è¦æ¯” <code>NSDictionary</code> å¥½ï¼Œé¦–å…ˆå½“ç³»ç»Ÿèµ„æºå³å°†è€—å°½æ—¶ï¼Œå‰è€…å¯ä»¥æŒ‰æœ€ä¹…æœªä½¿ç”¨ï¼ˆLease Recently Usedï¼ŒLRUï¼‰ç®—æ³•è‡ªåŠ¨åˆ å‡ç¼“å­˜ï¼›å…¶æ¬¡ <code>NSCache</code> å¯¹é”®ä¸ä¼šåšç±»ä¼¼ <code>NSDictionary</code> é»˜è®¤çš„æ‹·è´æ“ä½œï¼Œè€Œæ˜¯ä¿ç•™æ“ä½œï¼›è€Œä¸” <code>NSCache</code> æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œ<code>NSDictionary</code> åˆ™æ— æ­¤ä¼˜åŠ¿ã€‚</p>
<p>å¼€å‘è€…å¯ä»¥æ§åˆ¶ç¼“å­˜åˆ å‡å…¶å†…å®¹çš„æ—¶æœºï¼Œå…¶ä¸­æœ‰ä¸¤ä¸ªå°ºåº¦å¯ä¾›è°ƒæ•´ï¼Œå…¶ä¸€æ˜¯ç¼“å­˜ä¸­çš„å¯¹è±¡æ€»æ•°ï¼Œå…¶äºŒæ˜¯æ‰€æœ‰å¯¹è±¡çš„æ€»å¼€é”€ã€‚ç¼“å­˜çš„ä½¿ç”¨ç›®çš„å³æ˜¯ä¸ºäº†æ›´å¿«åœ°å“åº”ç”¨æˆ·æ“ä½œï¼Œè€Œå¦‚æœå¼€é”€å€¼è®¡ç®—æ˜¯è€—æ—¶æ“ä½œå°±æ˜¾å¾—æœ¬æœ«å€’ç½®äº†ï¼Œé™¤éæ˜¯å·²çŸ¥æ•°æ®å¤§å°çš„ <code>NSData</code> å¯¹è±¡ã€‚å¦å¤–æ§åˆ¶å°ºåº¦å¹¶éå®Œå…¨ä¸¥æ ¼ï¼Œå…¶ä»…å¯¹ <code>NSCache</code> èµ·æŒ‡å¯¼ä½œç”¨ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec"><span style="color:#66d9ef">typedef</span> <span style="color:#a6e22e">void</span>(<span style="color:#f92672">^</span>HandlerBlock)(NSData <span style="color:#f92672">*</span>data);

<span style="color:#66d9ef">@interface</span> <span style="color:#a6e22e">Foo</span> : <span style="color:#a6e22e">NSObject</span>
- (<span style="color:#66d9ef">instancetype</span>)<span style="color:#a6e22e">initWithURL:</span>(NSURL <span style="color:#f92672">*</span>)url;

<span style="color:#66d9ef">@end</span>

<span style="color:#66d9ef">@implementation</span> <span style="color:#a6e22e">Foo</span> {
    NSURL <span style="color:#f92672">*</span>_url;
}

- (<span style="color:#66d9ef">instancetype</span>)<span style="color:#a6e22e">initWithURL:</span>(NSURL <span style="color:#f92672">*</span>)url {
    self <span style="color:#f92672">=</span> [super init];
    <span style="color:#66d9ef">if</span> (self) {
        _url <span style="color:#f92672">=</span> url;
    }
    <span style="color:#66d9ef">return</span> self;
}

- (<span style="color:#66d9ef">void</span>)<span style="color:#a6e22e">doWithHandler:</span>(HandlerBlock)handler {
    NSData <span style="color:#f92672">*</span>data <span style="color:#f92672">=</span> [_url.absoluteString dataUsingEncoding:NSUTF8StringEncoding];
    handler(data);
}

- (<span style="color:#66d9ef">void</span>)<span style="color:#a6e22e">dealloc</span>
{
    NSLog(<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">dealloc</span><span style="color:#e6db74">&#34;</span>);
}

<span style="color:#66d9ef">@end</span>

<span style="color:#66d9ef">@interface</span> <span style="color:#a6e22e">Bar</span> : <span style="color:#a6e22e">NSObject</span>
<span style="color:#66d9ef">@end</span>

<span style="color:#66d9ef">@implementation</span> <span style="color:#a6e22e">Bar</span> {
    NSCache <span style="color:#f92672">*</span>_cache;
}

- (<span style="color:#66d9ef">instancetype</span>)<span style="color:#a6e22e">init</span> {
    self <span style="color:#f92672">=</span> [super init];
    <span style="color:#66d9ef">if</span> (self) {
        _cache <span style="color:#f92672">=</span> [NSCache new];

        <span style="color:#75715e">// ç¼“å­˜å¯¹è±¡æ€»æ•°ä¸Šé™
</span><span style="color:#75715e"></span>        _cache.countLimit <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>;
        <span style="color:#75715e">// ç¼“å­˜æ€»å¼€é”€ä¸Šé™ï¼ˆå•ä½ä¸ºå­—èŠ‚ Bï¼‰
</span><span style="color:#75715e"></span>        _cache.totalCostLimit <span style="color:#f92672">=</span> <span style="color:#ae81ff">1024</span>;
    }
    <span style="color:#66d9ef">return</span> self;
}

- (<span style="color:#66d9ef">void</span>)<span style="color:#a6e22e">fetchFromURL:</span>(NSURL <span style="color:#f92672">*</span>)url {
    NSData <span style="color:#f92672">*</span>cachedData <span style="color:#f92672">=</span> [_cache objectForKey:url];
    <span style="color:#66d9ef">if</span> (cachedData) {
        NSLog(<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">å‘½ä¸­ç¼“å­˜</span><span style="color:#e6db74">&#34;</span>);

        [self dealWithData:cachedData];
    } <span style="color:#66d9ef">else</span> {
        NSLog(<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">æœªå‘½ä¸­ç¼“å­˜</span><span style="color:#e6db74">&#34;</span>);

        Foo <span style="color:#f92672">*</span>foo <span style="color:#f92672">=</span> [[Foo alloc] initWithURL:url];

        <span style="color:#66d9ef">__weak</span> <span style="color:#66d9ef">typeof</span>(self) weakSelf <span style="color:#f92672">=</span> self;
        [foo doWithHandler:<span style="color:#f92672">^</span>(NSData <span style="color:#f92672">*</span>data) {
            <span style="color:#75715e">// é˜²æ­¢å¾ªç¯å¼•ç”¨
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">__strong</span> <span style="color:#66d9ef">typeof</span>(weakSelf) strongSelf <span style="color:#f92672">=</span> weakSelf;

            <span style="color:#75715e">// ç¼“å­˜ï¼ˆNSData é•¿åº¦è¯»å–ä¸è€—æ—¶ï¼‰
</span><span style="color:#75715e"></span>            [strongSelf<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>_cache setObject:data forKey:url cost:data.length];

            [strongSelf dealWithData:data];
        }];
    }
}

- (<span style="color:#66d9ef">void</span>)<span style="color:#a6e22e">fetchFromURL_2:</span>(NSURL <span style="color:#f92672">*</span>)url {
    <span style="color:#75715e">// NSPurgeableData ç»§æ‰¿è‡ª NSMutableData ä¸”å®ç°äº† NSDiscardableContent åè®®
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// å½“ç³»ç»Ÿèµ„æºç´§å¼ æ—¶ï¼Œå¯ä»¥æŠŠä¿å­˜ NSPurgeableData å¯¹è±¡çš„é‚£å—å†…å­˜é‡Šæ”¾
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// NSDiscardableContent åè®®ï¼š
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// - isContentDiscardedï¼šå¯ç”¨æ¥æŸ¥è¯¢ç›¸å…³å†…å­˜æ˜¯å¦å·²ç»é‡Šæ”¾
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// - beginContentAccessï¼šå¯ç”¨æ¥å‘ŠçŸ¥æ­¤æ—¶ä¸åº”ä¸¢å¼ƒå æ®çš„å†…å­˜ï¼ˆç±»ä¼¼æŸä¸ªè®¡æ•° + 1ï¼‰
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// - endContentAccessï¼šå¯ç”¨æ¥å‘ŠçŸ¥å¿…è¦æ—¶å¯ä»¥ä¸¢å¼ƒå æ®çš„å†…å­˜ï¼ˆç±»ä¼¼æŸä¸ªè®¡æ•° - 1ï¼Œåªæœ‰ä¸º 0 æ—¶æ‰å¯ä¸¢å¼ƒï¼‰
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// NSPurgeableData å¯¹è±¡è‹¥åŠ å…¥äº† NSCacheï¼Œé‚£ä¹ˆè‹¥å…¶å†…å­˜è¢«ç³»ç»Ÿä¸¢å¼ƒï¼Œé»˜è®¤ä¹Ÿä¼šè‡ªåŠ¨ç¼“å­˜ä¸­ç§»é™¤
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// NSCache ä¸­çš„ evictsObjectsWithDiscardedContent ç”¨æ¥æ§åˆ¶æ­¤åŠŸèƒ½å¼€å…³
</span><span style="color:#75715e"></span>    NSPurgeableData <span style="color:#f92672">*</span>cachedData <span style="color:#f92672">=</span> [_cache objectForKey:url];
    <span style="color:#66d9ef">if</span> (cachedData) {
        NSLog(<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">å‘½ä¸­ç¼“å­˜</span><span style="color:#e6db74">&#34;</span>);

        <span style="color:#75715e">// åé¢è¦ä½¿ç”¨ï¼Œæ­¤æ—¶ + 1
</span><span style="color:#75715e"></span>        [cachedData beginContentAccess];

        [self dealWithData:cachedData];

        <span style="color:#75715e">// ä½¿ç”¨å®Œæ¯•ï¼Œæ­¤æ—¶ - 1
</span><span style="color:#75715e"></span>        [cachedData endContentAccess];
    } <span style="color:#66d9ef">else</span> {
        NSLog(<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">æœªå‘½ä¸­ç¼“å­˜</span><span style="color:#e6db74">&#34;</span>);

        Foo <span style="color:#f92672">*</span>foo <span style="color:#f92672">=</span> [[Foo alloc] initWithURL:url];

        <span style="color:#66d9ef">__weak</span> <span style="color:#66d9ef">typeof</span>(self) weakSelf <span style="color:#f92672">=</span> self;
        [foo doWithHandler:<span style="color:#f92672">^</span>(NSData <span style="color:#f92672">*</span>data) {
            <span style="color:#75715e">// é˜²æ­¢å¾ªç¯å¼•ç”¨
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">__strong</span> <span style="color:#66d9ef">typeof</span>(weakSelf) strongSelf <span style="color:#f92672">=</span> weakSelf;

            <span style="color:#75715e">// æ ¹æ® NSData è·å– NSPurgeableData å¯¹è±¡ï¼ˆåˆ›å»ºæ—¶æ— éœ€ beginContentAccess è®¡æ•°ä¼šé»˜è®¤ + 1ï¼‰
</span><span style="color:#75715e"></span>            NSPurgeableData <span style="color:#f92672">*</span>purgeableData <span style="color:#f92672">=</span> [NSPurgeableData dataWithData:data];

            <span style="color:#75715e">// ç¼“å­˜ NSPurgeableData å¯¹è±¡
</span><span style="color:#75715e"></span>            [strongSelf<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>_cache setObject:purgeableData forKey:url cost:purgeableData.length];

            [strongSelf dealWithData:data];

            <span style="color:#75715e">// æ ‡è®° NSPurgeableData å¯¹è±¡å¯ä¸¢å¼ƒï¼ˆè®¡æ•° - 1ï¼‰
</span><span style="color:#75715e"></span>            [purgeableData endContentAccess];
        }];
    }
}

- (<span style="color:#66d9ef">void</span>)<span style="color:#a6e22e">dealWithData:</span>(NSData <span style="color:#f92672">*</span>)data {

    NSLog(<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">%@</span><span style="color:#e6db74">&#34;</span>, [[NSString alloc] initWithData:data encoding:NSUTF8StringEncoding]);
}

<span style="color:#66d9ef">@end</span>


<span style="color:#66d9ef">int</span> main(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span> argv[]) {
    <span style="color:#66d9ef">@autoreleasepool</span> {
        Bar <span style="color:#f92672">*</span>bar <span style="color:#f92672">=</span> [[Bar alloc] init];

        [bar fetchFromURL:[NSURL URLWithString:<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">https://kingcos.me</span><span style="color:#e6db74">&#34;</span>]];
        [bar fetchFromURL:[NSURL URLWithString:<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">https://github.com/kingcos</span><span style="color:#e6db74">&#34;</span>]];
        [bar fetchFromURL:[NSURL URLWithString:<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">https://kingcos.me</span><span style="color:#e6db74">&#34;</span>]];

        NSLog(<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">---</span><span style="color:#e6db74">&#34;</span>);

        <span style="color:#75715e">// âš ï¸ URL ä¸è¦å’Œä¸Šé¢å®Œå…¨ä¸€è‡´ï¼Œå¦åˆ™ç¼“å­˜å’Œå®é™…ç±»å‹æœ‰å‡ºå…¥
</span><span style="color:#75715e"></span>        [bar fetchFromURL_2:[NSURL URLWithString:<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">https://kingcos.me/</span><span style="color:#e6db74">&#34;</span>]];
        [bar fetchFromURL_2:[NSURL URLWithString:<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">https://github.com/kingcos/</span><span style="color:#e6db74">&#34;</span>]];
        [bar fetchFromURL_2:[NSURL URLWithString:<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">https://kingcos.me/</span><span style="color:#e6db74">&#34;</span>]];
    }
}

<span style="color:#75715e">// 1024 B = 1 KB ç¼“å­˜ &amp;&amp; countLimit ä¸º 100 æ—¶ï¼š
</span><span style="color:#75715e"></span><span style="color:#75715e">// æœªå‘½ä¸­ç¼“å­˜
</span><span style="color:#75715e"></span><span style="color:#75715e">// https://kingcos.me
</span><span style="color:#75715e"></span><span style="color:#75715e">// dealloc
</span><span style="color:#75715e"></span><span style="color:#75715e">// æœªå‘½ä¸­ç¼“å­˜
</span><span style="color:#75715e"></span><span style="color:#75715e">// https://github.com/kingcos
</span><span style="color:#75715e"></span><span style="color:#75715e">// dealloc
</span><span style="color:#75715e"></span><span style="color:#75715e">// å‘½ä¸­ç¼“å­˜
</span><span style="color:#75715e"></span><span style="color:#75715e">// https://kingcos.me
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// 1 B ç¼“å­˜ || countLimit ä¸º 1 æ—¶ï¼š
</span><span style="color:#75715e"></span><span style="color:#75715e">// æœªå‘½ä¸­ç¼“å­˜
</span><span style="color:#75715e"></span><span style="color:#75715e">// https://kingcos.me
</span><span style="color:#75715e"></span><span style="color:#75715e">// dealloc
</span><span style="color:#75715e"></span><span style="color:#75715e">// æœªå‘½ä¸­ç¼“å­˜
</span><span style="color:#75715e"></span><span style="color:#75715e">// https://github.com/kingcos
</span><span style="color:#75715e"></span><span style="color:#75715e">// dealloc
</span><span style="color:#75715e"></span><span style="color:#75715e">// æœªå‘½ä¸­ç¼“å­˜
</span><span style="color:#75715e"></span><span style="color:#75715e">// https://kingcos.me
</span><span style="color:#75715e"></span><span style="color:#75715e">// dealloc
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// NSPurgeableDataï¼ˆ1024 B = 1 KB ç¼“å­˜ &amp;&amp; countLimit ä¸º 100 æ—¶ï¼‰ï¼š
</span><span style="color:#75715e"></span><span style="color:#75715e">// ---
</span><span style="color:#75715e"></span><span style="color:#75715e">// æœªå‘½ä¸­ç¼“å­˜
</span><span style="color:#75715e"></span><span style="color:#75715e">// https://kingcos.me/
</span><span style="color:#75715e"></span><span style="color:#75715e">// dealloc
</span><span style="color:#75715e"></span><span style="color:#75715e">// æœªå‘½ä¸­ç¼“å­˜
</span><span style="color:#75715e"></span><span style="color:#75715e">// https://github.com/kingcos/
</span><span style="color:#75715e"></span><span style="color:#75715e">// dealloc
</span><span style="color:#75715e"></span><span style="color:#75715e">// å‘½ä¸­ç¼“å­˜
</span><span style="color:#75715e"></span><span style="color:#75715e">// https://kingcos.me/
</span></code></pre></div><!-- raw HTML omitted -->
<h3 id="-initialize--load-">ç²¾ç®€ initialize ä¸ load å®ç°ä»£ç </h3>
<p>ç•¥ï¼›å…³äº +loadï¼Œå¯è¯¦è§ã€Š<a href="../block_in_obj-c">iOS ä¸­çš„ +load æ–¹æ³•</a>ã€‹ä¸€æ–‡ï¼›å…³äº +initializeï¼Œå¯è¯¦è§ã€Š<a href="../block_in_obj-c">iOS ä¸­çš„ +initialize æ–¹æ³•</a>ã€‹ä¸€æ–‡ã€‚</p>
<h3 id="-nsimer-">åˆ«å¿˜äº† NSimer ä¼šä¿ç•™å…¶ç›®æ ‡å¯¹è±¡</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec"><span style="color:#66d9ef">@interface</span> <span style="color:#a6e22e">NSTimer</span> (BlockCategory)
+ (NSTimer <span style="color:#f92672">*</span>)<span style="color:#a6e22e">bc_scheduledTimerWithTimeInterval:</span>(NSTimeInterval)interval
                                       <span style="color:#a6e22e">repeats:</span>(<span style="color:#66d9ef">BOOL</span>)repeats
                                         <span style="color:#a6e22e">block:</span>(<span style="color:#66d9ef">void</span>(<span style="color:#f92672">^</span>)(<span style="color:#66d9ef">void</span>))block;
<span style="color:#66d9ef">@end</span>

<span style="color:#66d9ef">@implementation</span> <span style="color:#a6e22e">NSTimer</span> (BlockCategory)
+ (NSTimer <span style="color:#f92672">*</span>)<span style="color:#a6e22e">bc_scheduledTimerWithTimeInterval:</span>(NSTimeInterval)interval
                                       <span style="color:#a6e22e">repeats:</span>(<span style="color:#66d9ef">BOOL</span>)repeats
                                         <span style="color:#a6e22e">block:</span>(<span style="color:#66d9ef">void</span> (<span style="color:#f92672">^</span>)(<span style="color:#66d9ef">void</span>))block {
    <span style="color:#66d9ef">return</span> [self scheduledTimerWithTimeInterval:interval
                                         target:self <span style="color:#75715e">// target ä¸º selfï¼Œè€Œè¿™é‡Œçš„ self æ˜¯ç±»å¯¹è±¡ï¼Œä½†ç±»å¯¹è±¡æœ¬èº«å³ä¸éœ€è¦é‡Šæ”¾
</span><span style="color:#75715e"></span>                                       selector:<span style="color:#66d9ef">@selector</span>(bc_timerBlockInvoked:)
                                       userInfo:[block <span style="color:#66d9ef">copy</span>] <span style="color:#75715e">// å°† Block æ‹·è´åˆ°å †ï¼Œå¹¶ä¿å­˜åœ¨ userInfo ä¸­
</span><span style="color:#75715e"></span>                                        repeats:repeats];
}

+ (<span style="color:#66d9ef">void</span>)<span style="color:#a6e22e">bc_timerBlockInvoked:</span>(NSTimer <span style="color:#f92672">*</span>)timer {
    <span style="color:#66d9ef">void</span> (<span style="color:#f92672">^</span>block)(<span style="color:#66d9ef">void</span>) <span style="color:#f92672">=</span> timer.userInfo;
    <span style="color:#66d9ef">if</span> (block) {
        block();
    }
}

<span style="color:#66d9ef">@end</span>

<span style="color:#66d9ef">@interface</span> <span style="color:#a6e22e">Foo</span> : <span style="color:#a6e22e">NSObject</span>
- (<span style="color:#66d9ef">void</span>)<span style="color:#a6e22e">start:</span>(NSUInteger)index;
- (<span style="color:#66d9ef">void</span>)<span style="color:#a6e22e">stop</span>;
<span style="color:#66d9ef">@end</span>

<span style="color:#66d9ef">@implementation</span> <span style="color:#a6e22e">Foo</span> {
    <span style="color:#75715e">// å½“å‰å¯¹è±¡å¼ºå¼•ç”¨ _timer
</span><span style="color:#75715e"></span>    NSTimer <span style="color:#f92672">*</span>_timer0;
    NSTimer <span style="color:#f92672">*</span>_timer1;
    NSTimer <span style="color:#f92672">*</span>_timer2;

    NSUInteger _currentIndex;
}

- (<span style="color:#66d9ef">instancetype</span>)<span style="color:#a6e22e">init</span>
{
    <span style="color:#66d9ef">return</span> [super init];
}

- (<span style="color:#66d9ef">void</span>)<span style="color:#a6e22e">dealloc</span>
{
    [_timer0 invalidate];
    [_timer1 invalidate];
    [_timer2 invalidate];

    NSLog(<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">Timer %lu dealloc</span><span style="color:#e6db74">&#34;</span>, _currentIndex);
}

- (<span style="color:#66d9ef">void</span>)<span style="color:#a6e22e">start:</span>(NSUInteger)index {
    _currentIndex <span style="color:#f92672">=</span> index;

    <span style="color:#66d9ef">switch</span> (index) {
        <span style="color:#66d9ef">case</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">:</span> {
            <span style="color:#75715e">// _timer çš„ target ä¸º selfï¼Œå› è€Œå¼ºå¼•ç”¨ selfï¼Œäº§ç”Ÿäº†å¾ªç¯å¼•ç”¨
</span><span style="color:#75715e"></span>            _timer0 <span style="color:#f92672">=</span> [NSTimer scheduledTimerWithTimeInterval:<span style="color:#ae81ff">5.0</span>
                                                       target:self
                                                     selector:<span style="color:#66d9ef">@selector</span>(timerInvoked)
                                                     userInfo:nil
                                                      repeats:YES];
        }

            <span style="color:#66d9ef">break</span>;

        <span style="color:#66d9ef">case</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span> {
            <span style="color:#66d9ef">__weak</span> <span style="color:#66d9ef">typeof</span>(self) weakSelf <span style="color:#f92672">=</span> self;
            _timer1 <span style="color:#f92672">=</span> [NSTimer bc_scheduledTimerWithTimeInterval:<span style="color:#ae81ff">5.0</span>
                                                         repeats:YES
                                                           block:<span style="color:#f92672">^</span>{
                <span style="color:#66d9ef">__strong</span> <span style="color:#66d9ef">typeof</span>(weakSelf) strongSelf <span style="color:#f92672">=</span> weakSelf;

                NSLog(<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">--- kingcos.me ---</span><span style="color:#e6db74">&#34;</span>);
                NSLog(<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">%@</span><span style="color:#e6db74">&#34;</span>, strongSelf);
            } ];
        }

            <span style="color:#66d9ef">break</span>;

        <span style="color:#66d9ef">case</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">:</span> {
            <span style="color:#66d9ef">__weak</span> <span style="color:#66d9ef">typeof</span>(self) weakSelf <span style="color:#f92672">=</span> self;
            _timer2 <span style="color:#f92672">=</span> [NSTimer scheduledTimerWithTimeInterval:<span style="color:#ae81ff">5.0</span>
                                                      repeats:YES
                                                        block:<span style="color:#f92672">^</span>(NSTimer <span style="color:#f92672">*</span> _Nonnull timer) {
                <span style="color:#66d9ef">__strong</span> <span style="color:#66d9ef">typeof</span>(weakSelf) strongSelf <span style="color:#f92672">=</span> weakSelf;

                NSLog(<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">--- kingcos.me ---</span><span style="color:#e6db74">&#34;</span>);
                NSLog(<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">%@</span><span style="color:#e6db74">&#34;</span>, strongSelf);
            }];
        }

            <span style="color:#66d9ef">break</span>;

        <span style="color:#66d9ef">default</span><span style="color:#f92672">:</span>
            <span style="color:#66d9ef">break</span>;
    }
}

- (<span style="color:#66d9ef">void</span>)<span style="color:#a6e22e">timerInvoked</span> {
    NSLog(<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">--- kingcos.me ---</span><span style="color:#e6db74">&#34;</span>);
}

- (<span style="color:#66d9ef">void</span>)<span style="color:#a6e22e">stop</span> {
    [_timer0 invalidate]; <span style="color:#75715e">// æ­¤æ—¶ _timer1 æ‰æ‰“ç ´å¼•ç”¨å¾ªç¯
</span><span style="color:#75715e"></span>    [_timer1 invalidate];
    [_timer2 invalidate];

    _timer0 <span style="color:#f92672">=</span> nil;
    _timer1 <span style="color:#f92672">=</span> nil;
    _timer2 <span style="color:#f92672">=</span> nil;
}

<span style="color:#66d9ef">@end</span>

<span style="color:#66d9ef">int</span> main(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span> argv[]) {
    <span style="color:#66d9ef">@autoreleasepool</span> {
        [[[Foo alloc] init] start:<span style="color:#ae81ff">0</span>]; <span style="color:#75715e">// è‹¥ä¸è°ƒç”¨ stopï¼Œ_timer1 åˆ™å‘ç”Ÿå¾ªç¯å¼•ç”¨
</span><span style="color:#75715e"></span>        [[[Foo alloc] init] start:<span style="color:#ae81ff">1</span>]; <span style="color:#75715e">// é€šè¿‡è‡ªå·±åŠ åˆ†ç±»å¤„ç†
</span><span style="color:#75715e"></span>        [[[Foo alloc] init] start:<span style="color:#ae81ff">2</span>]; <span style="color:#75715e">// iOS 10 ä¹‹åå¯ç”¨
</span><span style="color:#75715e"></span>    }
}

<span style="color:#75715e">// OUTPUT:
</span><span style="color:#75715e"></span><span style="color:#75715e">// Timer 1 dealloc
</span><span style="color:#75715e"></span><span style="color:#75715e">// Timer 2 dealloc
</span></code></pre></div><h2 id="reference">Reference</h2>
<ul>
<li><a href="../ivar_access_control_in_obj-c/">Obj-C ä¸­å®ä¾‹å˜é‡å’Œç±»çš„è®¿é—®æ§åˆ¶ - kingcos</a></li>
<li><a href="https://stackoverflow.com/questions/17668018/when-to-use-uikit-extern-vs-just-extern">When to use UIKIT_EXTERN vs just extern - StackOverflow</a></li>
<li><a href="../objc_msgsend">æµ…å° objc_msgSend - kingcos</a></li>
<li><a href="../objects_in_obj-c/">Obj-C ä¸­çš„å¯¹è±¡ - kingcos</a></li>
<li><a href="../type_introspection_and_reflection/">Obj-C &amp; Swift çš„ç±»å‹å†…çœä¸åå°„ - kingcos</a></li>
<li><a href="https://developer.apple.com/documentation/foundation/nszone?language=objc">NSZone - Apple Developer</a></li>
<li><a href="../bit_field_union_in_cpp/">C/C++ ä¸­çš„ä½åŸŸä¸å…±ç”¨ä½“ - kingcos</a></li>
<li><a href="../category_in_ios/">iOS ä¸­çš„ Category - kingcos</a></li>
<li><a href="../block_in_obj-c/">Obj-C ä¸­çš„ Block - kingcos</a></li>
</ul>

    </div>
    
      <div class="pagination">
        <div class="pagination__title">
          <span class="pagination__title-h">Read other posts</span>
          <hr />
        </div>
        <div class="pagination__buttons">
          
            <span class="button previous">
              <a href="/posts/2019/block_in_obj-c/">
                <span class="button__icon">â†</span>
                <span class="button__text">Obj-C ä¸­çš„ Block</span>
              </a>
            </span>
          
          
            <span class="button next">
              <a href="/posts/2019/shopping_1111/">
                <span class="button__text">åŒ 11 ä¹°ä¹°ä¹° - å¼€å§‹æŠ¢è´­å•¦ ğŸ’°</span>
                <span class="button__icon">â†’</span>
              </a>
            </span>
          
        </div>
      </div>
    

    

    
    
    <div>
      <div id="github-comment">
      </div>

      <script type="text/javascript">
        function getUtterances(isDark) {
          var utterances = document.createElement('script');
          utterances.type = 'text/javascript';
          utterances.async = true;
          utterances.setAttribute('issue-term', "pathname")
          utterances.setAttribute('repo', "kingcos\/kingcos.github.io")
          utterances.setAttribute('label', "comments")
          isDark ? utterances.setAttribute('theme', "github-dark") : utterances.setAttribute('theme', "github-light")
          utterances.crossorigin = 'anonymous';
          utterances.src = 'https://utteranc.es/client.js';

          return utterances
        }

        var themeToggle = document.querySelector(".theme-toggle")
        themeToggle.addEventListener("click", function () {
          var getTheme = window.localStorage && window.localStorage.getItem("theme")
          var divNode = document.getElementById('github-comment')
          while(divNode.hasChildNodes()) {
            divNode.removeChild(divNode.firstChild);
          }
          
          
          

          
          
          
          
          
          
          document.getElementById('github-comment').appendChild(getUtterances(getTheme !== "dark"))
        })

        var getTheme = window.localStorage && window.localStorage.getItem("theme")
        document.getElementById('github-comment').appendChild(getUtterances(getTheme === "dark"))
      </script>
    </div>
    

    </div>

      </div>

      
        <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright copyright--user">All rights reserved by kingcos.me</div>
    
  </div>
</footer>

<script src="/assets/main.js"></script>
<script src="/assets/prism.js"></script>


      
    </div>

    
      
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-138311951-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

    
  </body>
</html>
