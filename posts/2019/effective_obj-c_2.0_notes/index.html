<!DOCTYPE html>
<html lang="en">
  <head>
    
      <title>ã€Šç¼–å†™é«˜è´¨é‡ iOS ä¸ OS X ä»£ç çš„ 52 ä¸ªæœ‰æ•ˆæ–¹æ³•ã€‹é˜…è¯»ç¬”è®° :: iBlog</title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content="Book ISBN Notes     ã€Šç¼–å†™é«˜è´¨é‡ iOS ä¸ OS X ä»£ç çš„ 52 ä¸ªæœ‰æ•ˆæ–¹æ³•ã€‹ 9787111451297 ã€ŠEffective Objective-C 2.0ã€‹   Date Num. Xcode   2019-05 1-3 10.2.1   2019-06 4 10.2.1   2019-07 5-12 10.2.1   2019-10 13-30 11.1 &amp;amp; 11.2    ç†Ÿæ‚‰ Objective-C äº†è§£ Objective-C è¯­è¨€çš„èµ·æº æ¶ˆæ¯ç»“æ„ï¼ˆMessage Structureï¼‰çš„è¯­è¨€ï¼Œè¿è¡Œæ—¶æ‰§è¡Œçš„ä»£ç ç”±è¿è¡Œç¯å¢ƒå†³å®šï¼›å‡½æ•°è°ƒç”¨ï¼ˆFunction Callingï¼‰çš„è¯­è¨€ï¼Œè¿è¡Œæ—¶æ‰€æ‰§è¡Œçš„ä»£ç ç”±ç¼–è¯‘å™¨å†³å®šï¼Œå¯¹äºå¤šæ€ï¼Œåˆ™æŒ‰ç…§è™šå‡½æ•°è¡¨ï¼ˆVirtual Method Tableï¼‰å¯»æ‰¾ã€‚
è¿è¡Œæ—¶ç»„ä»¶ï¼ˆRuntime Componentï¼‰ æœ¬è´¨ä¸Šæ˜¯ä¸€ç§ä¸å¼€å‘è€…æ‰€ç¼–å†™ä»£ç ç›¸é“¾æ¥çš„ã€ŒåŠ¨æ€åº“ï¼ˆDynamic Libraryï¼‰ï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯åªéœ€è¦æ›´æ–°è¿è¡Œæ—¶ç»„ä»¶ï¼ˆæ— éœ€é‡æ–°ç¼–è¯‘ï¼‰å³å¯æå‡ç¨‹åºæ€§èƒ½ã€‚
Obj-C æ˜¯ C çš„è¶…é›†ï¼›Obj-C ä¸­çš„å¯¹è±¡æ‰€å å†…å­˜æ€»æ˜¯åˆ†é…åœ¨å †ç©ºé—´ï¼ˆHeap Spaceï¼‰ï¼›è€ŒæŒ‡å‘å¯¹è±¡çš„æŒ‡é’ˆæ‰€å å†…å­˜æ€»æ˜¯åˆ†é…åœ¨æ ˆå¸§ï¼ˆStack Frameï¼‰ä¸­ï¼›å †ä¸­çš„å†…å­˜éœ€è¦ç¨‹åºå‘˜è‡ªå·±ç®¡ç†ï¼Œæ ˆä¸­çš„å†…å­˜ä¼šåœ¨å…¶æ ˆå¸§å¼¹å‡ºï¼ˆPopï¼‰æ—¶è‡ªåŠ¨æ¸…ç†ï¼›åˆ›å»ºå¯¹è±¡ç›¸æ¯”åˆ›å»ºç»“æ„ä½“ï¼ˆC ç»“æ„ä½“ï¼‰éœ€è¦é¢å¤–å¼€é”€ï¼Œä¾‹å¦‚åˆ†é…å’Œé‡Šæ”¾å †å†…å­˜ç­‰ã€‚"/>
<meta name="keywords" content="kingcos.me,maimieng.comios,swift,objective-c,obj-c,objc,oc,geek,python,ruby,golang,go,apple,mac"/>
<meta name="robots" content="noodp"/>
<link rel="canonical" href="/posts/2019/effective_obj-c_2.0_notes/" />





<link rel="stylesheet" href="/assets/style.css">


<link rel="stylesheet" href="/style.css">


<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/img/apple-touch-icon-144-precomposed.png">
<link rel="shortcut icon" href="/img/favicon.png">


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="ã€Šç¼–å†™é«˜è´¨é‡ iOS ä¸ OS X ä»£ç çš„ 52 ä¸ªæœ‰æ•ˆæ–¹æ³•ã€‹é˜…è¯»ç¬”è®°"/>
<meta name="twitter:description" content="Standing on the shoulders of giants."/>



<meta property="og:title" content="ã€Šç¼–å†™é«˜è´¨é‡ iOS ä¸ OS X ä»£ç çš„ 52 ä¸ªæœ‰æ•ˆæ–¹æ³•ã€‹é˜…è¯»ç¬”è®°" />
<meta property="og:description" content="Standing on the shoulders of giants." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/2019/effective_obj-c_2.0_notes/" />
<meta property="article:published_time" content="2019-10-21T00:00:00+00:00" />
<meta property="article:modified_time" content="2019-10-21T00:00:00+00:00" /><meta property="og:site_name" content="iBlog" />






  </head>
  <body class="dark-theme">
    <div class="container">
      <header class="header">
  <span class="header__inner">
    <a href="/" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367"/>
</svg>
</span>
    <span class="logo__text">kingcos.me</span>
    <span class="logo__cursor"></span>
  
</a>

    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/about">About</a></li>
        
      
        
          <li><a href="/links">Links</a></li>
        
      
        
          <li><a href="/perspective">Perspective</a></li>
        
      
        
          <li><a href="/words">Words</a></li>
        
      
      
    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/about">About</a></li>
      
    
      
        <li><a href="/links">Links</a></li>
      
    
      
        <li><a href="/perspective">Perspective</a></li>
      
    
      
        <li><a href="/words">Words</a></li>
      
    
  </ul>
</nav>

        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none"/>
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
          </svg>
        </span>
      
      <span class="theme-toggle">
        <svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>

      </span>
    </span>
  </span>
</header>


      <div class="content">
        
  <div class="post">
    <h2 class="post-title"><a href="/posts/2019/effective_obj-c_2.0_notes/">ã€Šç¼–å†™é«˜è´¨é‡ iOS ä¸ OS X ä»£ç çš„ 52 ä¸ªæœ‰æ•ˆæ–¹æ³•ã€‹é˜…è¯»ç¬”è®°</a></h2>
    <div class="post-meta">
      
        <span class="post-date">
            2019-10-21
        </span>
      
      
      
        <span class="post-read-time">â€” 15 min read</span>
      
    </div>

    
      <span class="post-tags">
        
          #<a href="/tags/read/">Read</a>&nbsp;
        
          #<a href="/tags/ios/">iOS</a>&nbsp;
        
          #<a href="/tags/obj-c/">Obj-C</a>&nbsp;
        
          #<a href="/tags//">ğŸš§</a>&nbsp;
        
      </span>
    

    

    <div class="post-content">
      

<table>
<thead>
<tr>
<th align="center">Book</th>
<th align="center">ISBN</th>
<th align="center">Notes</th>
</tr>
</thead>

<tbody>
<tr>
<td align="center">ã€Šç¼–å†™é«˜è´¨é‡ iOS ä¸ OS X ä»£ç çš„ 52 ä¸ªæœ‰æ•ˆæ–¹æ³•ã€‹</td>
<td align="center">9787111451297</td>
<td align="center">ã€ŠEffective Objective-C 2.0ã€‹</td>
</tr>

<tr>
<td align="center"><strong>Date</strong></td>
<td align="center"><strong>Num.</strong></td>
<td align="center"><strong>Xcode</strong></td>
</tr>

<tr>
<td align="center">2019-05</td>
<td align="center">1-3</td>
<td align="center">10.2.1</td>
</tr>

<tr>
<td align="center">2019-06</td>
<td align="center">4</td>
<td align="center">10.2.1</td>
</tr>

<tr>
<td align="center">2019-07</td>
<td align="center">5-12</td>
<td align="center">10.2.1</td>
</tr>

<tr>
<td align="center">2019-10</td>
<td align="center">13-30</td>
<td align="center">11.1 &amp; 11.2</td>
</tr>
</tbody>
</table>

<h2 id="ç†Ÿæ‚‰-objective-c">ç†Ÿæ‚‰ Objective-C</h2>

<h3 id="äº†è§£-objective-c-è¯­è¨€çš„èµ·æº">äº†è§£ Objective-C è¯­è¨€çš„èµ·æº</h3>

<p>æ¶ˆæ¯ç»“æ„ï¼ˆMessage Structureï¼‰çš„è¯­è¨€ï¼Œè¿è¡Œæ—¶æ‰§è¡Œçš„ä»£ç ç”±è¿è¡Œç¯å¢ƒå†³å®šï¼›å‡½æ•°è°ƒç”¨ï¼ˆFunction Callingï¼‰çš„è¯­è¨€ï¼Œè¿è¡Œæ—¶æ‰€æ‰§è¡Œçš„ä»£ç ç”±ç¼–è¯‘å™¨å†³å®šï¼Œå¯¹äºå¤šæ€ï¼Œåˆ™æŒ‰ç…§è™šå‡½æ•°è¡¨ï¼ˆVirtual Method Tableï¼‰å¯»æ‰¾ã€‚</p>

<p>è¿è¡Œæ—¶ç»„ä»¶ï¼ˆRuntime Componentï¼‰ æœ¬è´¨ä¸Šæ˜¯ä¸€ç§ä¸å¼€å‘è€…æ‰€ç¼–å†™ä»£ç ç›¸é“¾æ¥çš„ã€ŒåŠ¨æ€åº“ï¼ˆDynamic Libraryï¼‰ï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯åªéœ€è¦æ›´æ–°è¿è¡Œæ—¶ç»„ä»¶ï¼ˆæ— éœ€é‡æ–°ç¼–è¯‘ï¼‰å³å¯æå‡ç¨‹åºæ€§èƒ½ã€‚</p>

<p>Obj-C æ˜¯ C çš„è¶…é›†ï¼›Obj-C ä¸­çš„å¯¹è±¡æ‰€å å†…å­˜æ€»æ˜¯åˆ†é…åœ¨å †ç©ºé—´ï¼ˆHeap Spaceï¼‰ï¼›è€ŒæŒ‡å‘å¯¹è±¡çš„æŒ‡é’ˆæ‰€å å†…å­˜æ€»æ˜¯åˆ†é…åœ¨æ ˆå¸§ï¼ˆStack Frameï¼‰ä¸­ï¼›å †ä¸­çš„å†…å­˜éœ€è¦ç¨‹åºå‘˜è‡ªå·±ç®¡ç†ï¼Œæ ˆä¸­çš„å†…å­˜ä¼šåœ¨å…¶æ ˆå¸§å¼¹å‡ºï¼ˆPopï¼‰æ—¶è‡ªåŠ¨æ¸…ç†ï¼›åˆ›å»ºå¯¹è±¡ç›¸æ¯”åˆ›å»ºç»“æ„ä½“ï¼ˆC ç»“æ„ä½“ï¼‰éœ€è¦é¢å¤–å¼€é”€ï¼Œä¾‹å¦‚åˆ†é…å’Œé‡Šæ”¾å †å†…å­˜ç­‰ã€‚</p>

<p><img src="/img/2019/effective_obj-c_2.0_notes/1.png" alt="1" /></p>

<pre><code class="language-objectivec">// âš ï¸ ç”±äº Obj-C ä¸­çš„å­—ç¬¦ä¸²ï¼ˆNSStringï¼‰ç•¥æœ‰ç‰¹æ®Šï¼Œæ­¤å¤„å¹¶æœªä½¿ç”¨ä¹¦ä¸­çš„ NSString ä½œä¸ºèŒƒä¾‹
// å¯¹è±¡æœ¬èº«è¢«åˆ†é…åœ¨å †ä¸Šï¼›obj1 &amp; obj2 è¢«åˆ†é…åœ¨æ ˆä¸Š
NSObject *obj1 = [[NSObject alloc] init];
NSObject *obj2 = obj1;

// (lldb) p obj1
// (NSObject *) $0 = 0x00000001005092b0
// (lldb) p obj2
// (NSObject *) $1 = 0x00000001005092b0
// (lldb) p &amp;obj1
// (NSObject **) $2 = 0x00007ffeefbff508
// (lldb) p &amp;obj2
// (NSObject **) $3 = 0x00007ffeefbff500
</code></pre>

<h3 id="åœ¨ç±»çš„å¤´æ–‡ä»¶ä¸­å°½é‡å°‘å¼•å…¥å…¶ä»–å¤´æ–‡ä»¶">åœ¨ç±»çš„å¤´æ–‡ä»¶ä¸­å°½é‡å°‘å¼•å…¥å…¶ä»–å¤´æ–‡ä»¶</h3>

<p>å½“éœ€è¦çŸ¥é“æœ‰ä¸€ä¸ªç±»çš„å­˜åœ¨æ—¶ï¼Œè€Œä¸å…³å¿ƒå…¶å†…éƒ¨ç»†èŠ‚æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å‘å‰å£°æ˜ï¼ˆForward Declaringï¼‰å‘ŠçŸ¥ç¼–è¯‘å™¨ï¼Œå³å¯ä»¥åœ¨ .hï¼ˆå¤´æ–‡ä»¶ï¼‰ä¸­ <code>@class SomeClass</code>ï¼›è€Œåœ¨ .mï¼ˆå®ç°æ–‡ä»¶ï¼‰ä¸­å¼•å…¥å®é™…çš„ .hï¼›å½“åœ¨ä¸¤ä¸ªå¤´æ–‡ä»¶ä¸­äº’ç›¸å¼•å…¥å¯¹æ–¹ï¼Œåˆ™ä¼šå¯¼è‡´ã€Œå¾ªç¯å¼•ç”¨ï¼ˆChicken-Egg Situationï¼‰ã€ï¼Œæ— æ³•é€šè¿‡ç¼–è¯‘ã€‚</p>

<p>å°†å¼•å…¥å¤´æ–‡ä»¶çš„æ—¶æœºå°½é‡å»¶åï¼Œåªæœ‰åœ¨ç¡®å®šæœ‰éœ€è¦æ—¶æ‰å¼•å…¥ï¼Œå¦åˆ™ä¼šå¢åŠ è€¦åˆåº¦ã€æ‹‰é•¿ç¼–è¯‘æ—¶é—´ã€äº§ç”Ÿç›¸äº’ä¾èµ–ç­‰é—®é¢˜ã€‚</p>

<p>ç»§æ‰¿çˆ¶ç±»å’Œéµå¾ªåè®®åˆ™ä¸èƒ½ä½¿ç”¨å‘å‰å£°æ˜ï¼Œå¿…é¡»å¼•å…¥ç›¸åº”çš„å¤´æ–‡ä»¶ï¼Œå› æ­¤åè®®æœ€å¥½å£°æ˜åœ¨å•ç‹¬çš„å¤´æ–‡ä»¶ä¸­ï¼›ç”±äºä»£ç†åè®®ï¼ˆDelegate Protocolï¼‰å’Œéµå®ˆåè®®ä»£ç†çš„ç±»å£°æ˜åœ¨ä¸€èµ·æ—¶æ‰æœ‰æ„ä¹‰ï¼Œæœ€å¥½åœ¨å®ç°æ–‡ä»¶ä¸­å£°æ˜ç±»éµå®ˆäº†è¯¥ä»£ç†åè®®ï¼Œå¹¶å°†å®ç°ä»£ç æ”¾åœ¨ Class-Continuation åˆ†ç±»ï¼ˆClass-Continuation Categoryï¼‰ä¸­ï¼›å› æ­¤åªéœ€è¦åœ¨å®ç°æ–‡ä»¶ä¸­å¼•å…¥åŒ…å«ä»£ç†åè®®çš„å¤´æ–‡ä»¶å³å¯ï¼Œè€Œä¸éœ€è¦å°†å…¶æ”¾åœ¨å…¬å…±å¤´æ–‡ä»¶ï¼ˆPublic Header Fileï¼‰ä¸­ã€‚</p>

<h3 id="å¤šç”¨å­—é¢é‡è¯­æ³•-å°‘ç”¨ä¸ä¹‹ç­‰ä»·çš„æ–¹æ³•">å¤šç”¨å­—é¢é‡è¯­æ³•ï¼Œå°‘ç”¨ä¸ä¹‹ç­‰ä»·çš„æ–¹æ³•</h3>

<p>å­—é¢é‡ï¼ˆLiteralï¼‰è¯­æ³•ç®€åŒ–äº† Obj-C çš„éƒ¨åˆ† APIï¼š</p>

<pre><code class="language-objectivec">NSString *strValue = @&quot;str&quot;;
NSNumber *intValue = @1;
NSNumber *doubleValue = @3.14;
NSArray *arrValue = @[@&quot;a&quot;, @&quot;b&quot;, @&quot;c&quot;];
NSString *firstValueForArr = arrValue[0];
// âš ï¸ å­—é¢é‡åˆ›å»ºçš„æ•°ç»„ã€å­—å…¸éƒ½æ˜¯ä¸å¯å˜çš„
NSMutableArray *mutableArrValue = [@[@&quot;a&quot;, @&quot;b&quot;, @&quot;c&quot;] mutableCopy];
mutableArrValue[0] = @&quot;kingcos.me&quot;;
NSDictionary *dictValue = @{@&quot;key&quot; : @100};
NSNumber *valueForDictByKey  = dictValue[@&quot;key&quot;];
NSMutableDictionary *mutableDictValue = [@{@&quot;key&quot; : @100} mutableCopy];
mutableDictValue[@&quot;key&quot;] = @200;
</code></pre>

<p>å­—é¢é‡è¯­æ³•åœ¨ <code>NSArray</code>ã€<code>NSDictionary</code> ç­‰ç±»ä¸­æ’å…¥ <code>nil</code> å¯¹è±¡æ—¶ä¼šç›´æ¥å´©æºƒï¼Œè€Œç›´æ¥ä½¿ç”¨ API åˆ™ä¼šå‘ç”Ÿã€Œæˆªæ–­ã€ï¼Œå¯¹äºè¿™ä¸¤ä¸ªç”¨æ³•å·®å¼‚åŠ¡å¿…è¦æ³¨æ„ï¼š</p>

<pre><code class="language-objectivec">id nilObj = nil;
// *** -[__NSPlaceholderArray initWithObjects:count:]: attempt to insert nil object from objects[3]
NSArray *arrWithNilObject1 = @[@0, nilObj, @2];
// (0)
NSArray *arrWithNilObject2 = [NSArray arrayWithObjects:@0, nil, @2, nil];
// *** -[__NSPlaceholderDictionary initWithObjects:forKeys:count:]: attempt to insert nil object from objects[0]
NSDictionary *dictWithNilObject1 = @{@&quot;a&quot; : @&quot;A&quot;, @&quot;b&quot; : nilObj, @&quot;c&quot; : @&quot;C&quot;};
// { a = A; }
NSDictionary *dictWithNilObject2 = [NSDictionary dictionaryWithObjectsAndKeys:@&quot;A&quot;, @&quot;a&quot;, nilObj, @&quot;b&quot;, @&quot;C&quot;, @&quot;c&quot;, nil];
</code></pre>

<p>é™¤äº†å­—ç¬¦ä¸²ï¼Œå­—é¢é‡è¯­æ³•ä»…é€‚ç”¨äº Foundation æ¡†æ¶ä¸­ï¼Œå³æˆ‘ä»¬è‡ªå®šä¹‰ç»§æ‰¿è‡ªä¸Šè¿°æ”¯æŒå­—é¢é‡çš„ç±»æ—¶ï¼Œå°†ä¸å†æ”¯æŒä½¿ç”¨å­—é¢é‡ã€‚</p>

<h3 id="å¤šç”¨ç±»å‹å¸¸é‡-å°‘ç”¨-define-é¢„å¤„ç†æŒ‡ä»¤">å¤šç”¨ç±»å‹å¸¸é‡ï¼Œå°‘ç”¨ #define é¢„å¤„ç†æŒ‡ä»¤</h3>

<p><code>#define</code> é¢„å¤„ç†æŒ‡ä»¤æ²¡æœ‰ç±»å‹ä¿¡æ¯ï¼Œä¸”ä¼šåœ¨å¼•ç”¨åˆ°åŒ…å«è¯¥æŒ‡ä»¤çš„æ‰€æœ‰æ–‡ä»¶ä¸­è¿›è¡Œæ›¿æ¢ï¼Œå› æ­¤æ›´åŠ æ¨èä½¿ç”¨ç±»å‹å¸¸é‡ï¼š</p>

<pre><code class="language-objectivec">// é¢„å¤„ç†æŒ‡ä»¤ï¼ˆç¼–è¯‘å‰è¿›è¡Œç›´æ¥æ›¿æ¢ï¼‰
#define ANIMATION_DURATION 0.3

// Some.m

// ç±»å‹å¸¸é‡
// const å†³å®šäº†å…¶ä¸ºå¸¸é‡ï¼Œä¸å¯è¢«å†æ¬¡æ”¹å˜
// static å†³å®šäº†å…¶ä½œç”¨åŸŸï¼Œå³å½“å‰æ–‡ä»¶ï¼ˆå› æ­¤å¦‚æœå°†å…¶å®šä¹‰åœ¨ *.h ä¸­ï¼Œå…¶ä»–å¼•å…¥è¯¥å¤´æ–‡ä»¶çš„æ–‡ä»¶ä¹Ÿå¯ä»¥è®¿é—®åˆ°ï¼‰
static const NSTimeInterval kAnimationDuration = 0.3;

// å¦‚æœä¸ä½¿ç”¨ static ä¿®é¥°ï¼Œç¼–è¯‘å™¨ä¼šåˆ›å»ºä¸€ä¸ªå¤–éƒ¨ç¬¦å·ï¼ˆExternal Symbolsï¼‰
const NSTimeInterval SomeAnimationDuration = 0.3;
// æ­¤æ—¶å¦‚æœåœ¨å…¶ä»–æ–‡ä»¶å†…å£°æ˜åŒåå¸¸é‡ï¼Œåˆ™ä¼šæŠ¥é”™ã€Œduplicate symbolã€
// Another.m
const NSTimeInterval SomeAnimationDuration = 0.5;

// ---

// main.m
// å£°æ˜ä¸º `static` å’Œ `const` çš„å˜é‡ï¼Œç¼–è¯‘å™¨ä¸ä¼šä¸ºå…¶å†åˆ›å»ºç¬¦å·
#import &lt;Foundation/Foundation.h&gt;

int foo = 1;

// static const + int
static const int k1 = 1;
// static const + int *
// å¯¹äºæŒ‡é’ˆï¼Œæ—¢è¦ä½¿å…¶æœ¬èº«çš„å†…å®¹ä¸èƒ½æ”¹å˜ï¼Œä¹Ÿä¸èƒ½æ”¹å˜å…¶æŒ‡å‘çš„å†…å­˜åœ°å€ï¼Œå¦åˆ™è¿™ä¸ªæŒ‡é’ˆè¿˜æ˜¯æœ‰å¯èƒ½æ”¹å˜çš„
static int const * const k2 = &amp;foo;
// static const + NSString *
static NSString * const k3 = @&quot;&quot;;
static NSString const * const k4 = @&quot;&quot;;

// const
const int k5 = 3;
// static
static int k6 = 4;

int main(int argc, const char * argv[]) {
    @autoreleasepool {
        // ä¸ºäº†é˜²æ­¢ç¼–è¯‘å™¨ä¼˜åŒ–æœªç”¨åˆ°çš„ç¬¦å·ï¼Œæˆ‘ä»¬è¿™é‡Œç®€å•è¾“å‡ºä»¥ä¸Šå®šä¹‰çš„å˜é‡
        NSLog(@&quot;%d&quot;, k1);
        NSLog(@&quot;%d&quot;, *k2);
        NSLog(@&quot;%@&quot;, k3);
        NSLog(@&quot;%@&quot;, k4);
        NSLog(@&quot;%d&quot;, k5);
        NSLog(@&quot;%d&quot;, k6);
    }
    return 0;
}

// è¾“å‡ºæ‰€æœ‰ç¬¦å·
// âœ  Debug nm -C Demo
// é€šè¿‡ä»¥ä¸‹è¾“å‡ºå¯ä»¥å¾—å‡ºç”± static å’Œ const ä¿®é¥°çš„ k1ï¼Œk2 ç¼–è¯‘å™¨éƒ½æ²¡æœ‰ä¸ºå…¶äº§ç”Ÿç¬¦å·
// ä½† NSString * æ˜¯ä¸ªä¾‹å¤–ï¼ˆWhy? çŒœæµ‹æ˜¯ç¼–è¯‘å™¨è®¤ä¸ºè¯¥å¸¸é‡åç»­è¿˜è¦è¢«ä¿®æ”¹çš„å¯èƒ½ï¼Œå› æ­¤éœ€è¦ä¿ç•™å…¶ç¬¦å·ï¼‰
//                  U _NSLog
//                  U ___CFConstantStringClassReference
// 0000000100000000 T __mh_execute_header
// 00000001000010a0 D _foo
// 0000000100001028 s _k3
// 0000000100001030 s _k4
// 0000000100000fb4 S _k5
// 00000001000010a4 d _k6
// 0000000100000eb0 T _main
//                  U _objc_autoreleasePoolPop
//                  U _objc_autoreleasePoolPush
//                  U dyld_stub_binder

// ä»…è¾“å‡ºå¤–éƒ¨ç¬¦å·
// âœ  Debug nm -gC Demo
// æ‰€æœ‰ä½¿ç”¨ static ä¿®é¥°çš„å˜é‡å‡ä¸åœ¨å¤–éƒ¨ç¬¦å·ä¸­ï¼Œè¯´æ˜ static å°†è¿™äº›ç¬¦å·çš„ä½œç”¨åŸŸé™åˆ¶åœ¨å½“å‰æ–‡ä»¶ä¸­
//                  U _NSLog
//                  U ___CFConstantStringClassReference
// 0000000100000000 T __mh_execute_header
// 00000001000010a0 D _foo
// 0000000100000fb4 S _k5
// 0000000100000eb0 T _main
//                  U _objc_autoreleasePoolPop
//                  U _objc_autoreleasePoolPush
//                  U dyld_stub_binder
</code></pre>

<p>ç±»å‹å¸¸é‡çš„å‘½åè§„åˆ™ï¼š</p>

<ul>
<li>è‹¥å¸¸é‡å±€é™äºæŸä¸ªç¼–è¯‘å•å…ƒï¼ˆTranslation Unitï¼Œå³å®ç°æ–‡ä»¶ <code>*.m</code>ï¼‰ï¼Œåˆ™éœ€è¦ä»¥å°å†™å­—æ¯ <code>k</code> å¼€å¤´ï¼›</li>
<li>è‹¥å¸¸é‡åœ¨ç±»ä¹‹å¤–ä¹Ÿå¯è§ï¼Œåˆ™é€šå¸¸éœ€è¦ä»¥ç±»åå¼€å¤´ã€‚</li>
</ul>

<p>å…³äº <code>nm</code> å‘½ä»¤çš„åŸºæœ¬ä½¿ç”¨ï¼Œå¯ä»¥å‚è€ƒ <a href="../ivar_access_control_in_obj-c/">Obj-C ä¸­å®ä¾‹å˜é‡å’Œç±»çš„è®¿é—®æ§åˆ¶</a>ä¸€æ–‡ã€‚</p>

<pre><code class="language-objectivec">// Some.h
// extern å‘ŠçŸ¥ç¼–è¯‘å™¨å…¨å±€ç¬¦å·è¡¨ä¸­å­˜åœ¨è¯¥ç¬¦å·ï¼Œå…è®¸å¤–ç•Œä½¿ç”¨
extern NSString * const SomeConstant;

// Some.m
// å¤–ç•Œéœ€è¦è®¿é—®åˆ™ä¸èƒ½å£°æ˜ä¸º staticï¼›å¤–ç•Œä¸å¯å˜æ›´ï¼Œå› æ­¤å£°æ˜ä¸º const
// è¿™é‡Œçš„ const ä¿®é¥°çš„æ˜¯ NSString *ï¼ˆå³ const ä»å³å‘å·¦åŸåˆ™ï¼‰ï¼ŒSomeConstant ä¿å­˜çš„å†…å­˜åœ°å€ä¸èƒ½å†æ”¹å˜ï¼ˆå³ä¸èƒ½æŒ‡å‘å¦å¤–ä¸€ä¸ª NSString å¯¹è±¡ï¼‰
// ç¼–è¯‘å™¨ä¼šåœ¨æ•°æ®æ®µï¼ˆData Sectionï¼‰ä¸ºå­—ç¬¦ä¸²åˆ†é…å­˜å‚¨ç©ºé—´ï¼Œé“¾æ¥å™¨ä¼šå°†ç›®æ ‡æ–‡ä»¶ç›¸äº’é“¾æ¥ï¼Œç”Ÿæˆæœ€ç»ˆçš„å¯æ‰§è¡Œæ–‡ä»¶
// å…¨å±€ç¬¦å·å‘½åè§„åˆ™ï¼šèŒƒå›´ï¼ˆé€šå¸¸ä½¿ç”¨ç±»åï¼‰+ åç§°
NSString * const SomeConstant = @&quot;SomeConstant&quot;;

// åœ¨ Obj-C ä¸­ï¼Œé™¤äº† C ä¸­åŸæœ‰çš„ extern è¿˜å­˜åœ¨ä»¥ä¸‹ç›¸å…³çš„å®å®šä¹‰
// FOUNDATION_EXTERNã€FOUNDATION_EXPORTã€FOUNDATION_IMPORTã€UIKIT_EXTERN

// NSObjCRuntime.h
#if defined(__cplusplus)
// C++ ä¸‹å…¼å®¹ C++ çš„ extern
#define FOUNDATION_EXTERN extern &quot;C&quot;
#else
#define FOUNDATION_EXTERN extern
#endif


    #define FOUNDATION_EXPORT  FOUNDATION_EXTERN
    #define FOUNDATION_IMPORT FOUNDATION_EXTERN

// UIKitDefines.h
// UIKIT_EXTERN è¿˜å£°æ˜äº†ç¬¦å·çš„å¯è§èŒƒå›´
#ifdef __cplusplus
#define UIKIT_EXTERN		extern &quot;C&quot; __attribute__((visibility (&quot;default&quot;)))
#else
#define UIKIT_EXTERN	        extern __attribute__((visibility (&quot;default&quot;)))
#endif
</code></pre>

<p>å¯¹äºé€‰æ‹© <code>extern</code> è¿˜æ˜¯ä»¥ä¸Š <code>SOME_EXTERN</code>ï¼Œå¾—å‡ºä»¥ä¸‹çš„ç»“è®ºï¼š</p>

<ul>
<li>å¯¹äºè¿™äº›å›ºå®šå‰ç¼€çš„ <code>extern</code> åº”å½“åœ¨å…¶èŒƒå›´ä¸‹ä½¿ç”¨ï¼Œå³ <code>FOUNDATION_*</code> åœ¨ Foundation æ¡†æ¶å†…éƒ¨ä½¿ç”¨ï¼Œ<code>UIKIT_*</code> åœ¨ <code>UIKit</code> å†…éƒ¨ä½¿ç”¨ï¼Œåœ¨æˆ‘ä»¬è‡ªå·±çš„åº“å†…åº”å½“æ¨èè‡ªå®šä¹‰ <code>SOME_*</code> æ¥ä½¿ç”¨ï¼Œè€Œä¸æ˜¯ç›´æ¥å¥—ç”¨å…¶ä»–åº“å†…çš„å®å®šä¹‰ï¼›</li>
<li>é»˜è®¤çš„ <code>extern</code> ç”±äºå¯èƒ½ä¸å…¼å®¹ C++ï¼Œé‚£ä¹ˆåœ¨åº“ä¸­éœ€è¦å…¼å®¹ C++ æ—¶åº”å½“ä½¿ç”¨ <code>extern &quot;C&quot;</code>ã€‚</li>
</ul>

<h3 id="ç”¨æšä¸¾è¡¨ç¤ºçŠ¶æ€-é€‰é¡¹-çŠ¶æ€ç ">ç”¨æšä¸¾è¡¨ç¤ºçŠ¶æ€ã€é€‰é¡¹ã€çŠ¶æ€ç </h3>

<p>Obj-C ä¸­çš„æšä¸¾ï¼ˆ<code>enum</code>ï¼‰æ¥è‡ª C è¯­è¨€ï¼Œè€Œ C++11 æ ‡å‡†ä½¿å¾—æšä¸¾å¯ä»¥å®šä¹‰å…¶åº•å±‚æ•°æ®ç±»å‹ï¼ˆUnderlying Typeï¼‰ã€‚</p>

<pre><code class="language-objectivec">// å®ç°æšä¸¾æ‰€ç”¨çš„æ•°æ®ç±»å‹å–å†³äºç¼–è¯‘å™¨
// æšä¸¾çš„åº•å±‚æ•°æ®ç±»å‹ä¸æ˜¯å›ºå®šçš„ï¼Œå…¶äºŒè¿›åˆ¶ä½ï¼ˆbitï¼‰çš„ä¸ªæ•°å¿…é¡»èƒ½å®Œå…¨è¡¨ç¤ºä¸‹æšä¸¾ç¼–å·
// æ¯”å¦‚ ImageSourceType å¯ä»¥ä½¿ç”¨ char ç±»å‹ï¼ˆä½†åœ¨ Xcode é‡Œå…¶åº•å±‚æ•°æ®ç±»å‹æ˜¯ç¬¬ä¸€é¡¹é»˜è®¤ä¸º 0 çš„ int ç±»å‹ï¼‰
enum ImageSourceType {
    ImageSourceTypeCamera,
    ImageSourceTypeGallery
};

enum ImageSourceType type1 = ImageSourceTypeCamera;

// typedef å¯ä»¥ç®€åŒ–æšä¸¾ç±»å‹å£°æ˜
typedef enum ImageSourceType ImageSourceType;
ImageSourceType type2 = ImageSourceTypeGallery;

// C++ 11 æ ‡å‡†ï¼Œæ˜¾å¼å£°æ˜æšä¸¾åº•å±‚æ•°æ®ç±»å‹
enum NetworkType: NSInteger {
    NetworkTypeUnknown = -1, // æ˜¾å¼ä¸ºä» -1 å¼€å§‹
    NetworkTypeWiFi   // 0 é€’å¢
    NetworkCellular   // 1
};

// æšä¸¾çš„å‘å‰å£°æ˜ï¼ˆåœ¨ .m ä¸­å¼•å…¥æˆ–å®ç°å³å¯ï¼‰
// Some.h
enum NetworkType: NSInteger;
</code></pre>

<p>æšä¸¾ä¸­ä½¿ç”¨æŒ‰ä½æˆ–æ“ä½œç¬¦ï¼ˆBitwise OR Operatorï¼‰å¯ä»¥ä½¿å¾—æšä¸¾çš„æ¯ä¸ªé€‰é¡¹å‡å¯å¯ç”¨æˆ–ç¦ç”¨ï¼š</p>

<pre><code class="language-objectivec">// UIViewAutoresizingNone æ˜¯æ— æ³•ä¸å…¶ä»–é¡¹ç›®åŒæ—¶å­˜åœ¨ï¼Œå› æ­¤ä¸º 0

// UIView.h
typedef NS_OPTIONS(NSUInteger, UIViewAutoresizing) {
    UIViewAutoresizingNone                 = 0,
    UIViewAutoresizingFlexibleLeftMargin   = 1 &lt;&lt; 0,
    UIViewAutoresizingFlexibleWidth        = 1 &lt;&lt; 1,
    UIViewAutoresizingFlexibleRightMargin  = 1 &lt;&lt; 2,
    UIViewAutoresizingFlexibleTopMargin    = 1 &lt;&lt; 3,
    UIViewAutoresizingFlexibleHeight       = 1 &lt;&lt; 4,
    UIViewAutoresizingFlexibleBottomMargin = 1 &lt;&lt; 5
};

// ä½¿ç”¨æ—¶å¯ä»¥ä½¿ç”¨æŒ‰ä½æˆ–æ¥ç»„åˆå¤šä¸ªé€‰é¡¹ï¼š
UIViewAutoresizing resize = UIViewAutoresizingFlexibleWidth | UIViewAutoresizingFlexibleHeight;

// åˆ¤æ–­æ—¶ä½¿ç”¨æŒ‰ä½ä¸ï¼ˆBitwise AND Operatorï¼‰å³å¯
if (resize &amp; UIViewAutoresizingFlexibleWidth) {
    NSLog(@&quot;UIViewAutoresizingFlexibleWidth&quot;);
}
if (resize &amp; UIViewAutoresizingFlexibleHeight) {
    NSLog(@&quot;UIViewAutoresizingFlexibleHeight&quot;);
}

// OUTPUT:
// UIViewAutoresizingFlexibleWidth
// UIViewAutoresizingFlexibleHeight
</code></pre>

<pre><code class="language-objectivec">/* NS_ENUM supports the use of one or two arguments. The first argument is always the integer type used for the values of the enum. The second argument is an optional type name for the macro. When specifying a type name, you must precede the macro with 'typedef' like so:

typedef NS_ENUM(NSInteger, NSComparisonResult) {
    ...
};

If you do not specify a type name, do not use 'typedef'. For example:

NS_ENUM(NSInteger) {
    ...
};
*/
#define NS_ENUM(...) CF_ENUM(__VA_ARGS__)
#define NS_OPTIONS(_type, _name) CF_OPTIONS(_type, _name)

// CFAvailability.h
#define CF_ENUM(...) __CF_ENUM_GET_MACRO(__VA_ARGS__, __CF_NAMED_ENUM, __CF_ANON_ENUM, )(__VA_ARGS__)
// æ ¹æ®æ˜¯å¦æŒ‰ç…§ C++ æ¨¡å¼ç¼–è¯‘è€Œä¸åŒ
#define __CF_ENUM_GET_MACRO(_1, _2, NAME, ...) NAME
#if (__cplusplus &amp;&amp; __cplusplus &gt;= 201103L &amp;&amp; (__has_extension(cxx_strong_enums) || __has_feature(objc_fixed_enum))) || (!__cplusplus &amp;&amp; __has_feature(objc_fixed_enum))
    #define __CF_NAMED_ENUM(_type, _name)     enum __CF_ENUM_ATTRIBUTES _name : _type _name; enum _name : _type
    #define __CF_ANON_ENUM(_type)             enum __CF_ENUM_ATTRIBUTES : _type
    #define CF_CLOSED_ENUM(_type, _name)      enum __CF_CLOSED_ENUM_ATTRIBUTES _name : _type _name; enum _name : _type
    #if (__cplusplus)
        #define CF_OPTIONS(_type, _name) _type _name; enum __CF_OPTIONS_ATTRIBUTES : _type
    #else
        #define CF_OPTIONS(_type, _name) enum __CF_OPTIONS_ATTRIBUTES _name : _type _name; enum _name : _type
    #endif
#else
    #define __CF_NAMED_ENUM(_type, _name) _type _name; enum
    #define __CF_ANON_ENUM(_type) enum
    #define CF_CLOSED_ENUM(_type, _name) _type _name; enum
    #define CF_OPTIONS(_type, _name) _type _name; enum
#endif

// Some.mm
typedef enum Direction: int FooDirection;
enum Direction: int {
    Up      = 1 &lt;&lt; 0,
    Down    = 1 &lt;&lt; 1,
    Left    = 1 &lt;&lt; 2,
    Right   = 1 &lt;&lt; 3
};

// åœ¨ä½¿ç”¨æˆ–è¿ç®—æ“ä½œä¸¤ä¸ªæšä¸¾å€¼æ—¶ï¼ŒC++ è®¤ä¸ºè¿ç®—ç»“æœçš„æ•°æ®ç±»å‹åº”å½“æ˜¯æšä¸¾çš„åº•å±‚æ•°æ®ç±»å‹ï¼Œå³ `NSUInteger`ï¼Œä¸” C++ ä¸æ”¯æŒå°†åº•å±‚æ•°æ®ç±»å‹éšå¼è½¬æ¢ä¸ºæšä¸¾ç±»å‹æœ¬èº«
// ERROR: Cannot initialize a variable of type 'FooDirection' (aka 'Direction') with an rvalue of type 'int'
// FooDirection direct = Up | Left;
</code></pre>

<p>Foundation æ¡†æ¶ä¸­æšä¸¾çš„è¾…åŠ©å®å…·å¤‡å‘åå…¼å®¹ï¼ˆBackward Compatibilityï¼‰èƒ½åŠ›ï¼Œå³æ ¹æ®ç›®æ ‡å¹³å°å†³å®šç›¸åº”çš„è¯­æ³•ï¼›å‡¡æ˜¯éœ€è¦æŒ‰ä½æˆ–æ“ä½œæ¥ç»„åˆçš„æšä¸¾éƒ½åº”å½“ä½¿ç”¨ <code>NS_OPTIONS</code> æ¥å®šä¹‰ï¼›å¦åˆ™ä½¿ç”¨ <code>NS_ENUM</code>ã€‚</p>

<h2 id="å¯¹è±¡-æ¶ˆæ¯-è¿è¡ŒæœŸ">å¯¹è±¡ã€æ¶ˆæ¯ã€è¿è¡ŒæœŸ</h2>

<h3 id="ç†è§£-å±æ€§-è¿™ä¸€æ¦‚å¿µ">ç†è§£ã€Œå±æ€§ã€è¿™ä¸€æ¦‚å¿µ</h3>

<p>åº”ç”¨ç¨‹åºäºŒè¿›åˆ¶æ¥å£ï¼ˆApplication Binary Interfaceï¼Œå³ ABIï¼‰å®šä¹‰äº†å¾ˆå¤šå†…å®¹ï¼Œå…¶ä¸­æœ‰ç”Ÿæˆä»£ç æ—¶æ‰€åº”éµå¾ªçš„è§„èŒƒã€‚Obj-C ä¸­å®ä¾‹å˜é‡ï¼ˆivarï¼‰çš„å†…å­˜å¸ƒå±€åœ¨ç¼–è¯‘æ—¶åˆ»å›ºå®šï¼Œå› æ­¤è®¿é—®å®ä¾‹å˜é‡æ—¶ï¼Œç¼–è¯‘å™¨ä¼šå°†å…¶æ›¿æ¢ä¸ºåç§»é‡ï¼ˆOffsetï¼‰ï¼Œè€Œåç§»é‡æ˜¯ç¡¬ç¼–ç ï¼Œè¡¨ç¤ºå…¶è·ç¦»å†…å­˜èµ·å§‹åœ°å€çš„é•¿åº¦ï¼›å¦‚æœä»£ç ä½¿ç”¨äº†ç¼–è¯‘æ—¶åˆ»è®¡ç®—çš„åç§»é‡ï¼Œé‚£ä¹ˆåœ¨ä¿®æ”¹ç±»å®šä¹‰ä¹‹åå¿…é¡»é‡æ–°ç¼–è¯‘ï¼Œå³é‡æ–°è®¡ç®—åç§»é‡ï¼›</p>

<p>å¯¹äºæ—§çš„ç±»å®šä¹‰é“¾æ¥äº†æ–°çš„ç±»å®šä¹‰ä¼šå‡ºç°ä¸å…¼å®¹æƒ…å†µï¼ŒObj-C çš„åšæ³•å¦‚ä¸‹ï¼š</p>

<ul>
<li>å°†å®ä¾‹å˜é‡å½“ä½œä¸€ç§å­˜å‚¨åç§»é‡æ‰€ç”¨çš„ç‰¹æ®Šå˜é‡ï¼Œäº¤ç”±ç±»å¯¹è±¡ä¿ç®¡ï¼Œåç§»é‡å°†åœ¨è¿è¡Œæ—¶æŸ¥æ‰¾ï¼Œè¿™æ ·å³ä½¿ç±»å®šä¹‰å˜åŒ–äº†ï¼Œä¹Ÿèƒ½æ‰¾åˆ°æ­£ç¡®çš„åç§»é‡ï¼Œç”šè‡³å¯ä»¥åœ¨è¿è¡Œæ—¶æ–°å¢å®ä¾‹å˜é‡ï¼›</li>
<li>å°½é‡ä¸è¦ç›´æ¥è®¿é—®å®ä¾‹å˜é‡ï¼Œè€Œæ˜¯é€šè¿‡ getter &amp; setterï¼ŒObj-C ä¸­å¯ä»¥ä½¿ç”¨ <code>@property</code> è¯­æ³•ï¼›</li>
</ul>

<p>è‡ªåŠ¨åˆæˆï¼ˆAutosynthesisï¼‰ï¼šç¼–è¯‘å™¨ä¼šè‡ªåŠ¨ä¸º Obj-C ä¸­çš„å±æ€§ä¾¿æºå…¶æ‰€éœ€çš„æ–¹æ³•ï¼Œè¯¥è¿‡ç¨‹ç”±ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶åˆ»æ‰§è¡Œï¼›ç¼–è¯‘å™¨è¿˜ä¼šè‡ªåŠ¨ä¸º Obj-C ä¸­çš„å±æ€§æ·»åŠ é€‚å½“ç±»å‹çš„å®ä¾‹å˜é‡ï¼Œå¹¶åœ¨å±æ€§åå‰åŠ  <code>_</code> å‰ç¼€ä½œä¸ºå®ä¾‹å˜é‡åã€‚</p>

<pre><code class="language-objectivec">// Some.h
@property NSString *foo;
@property NSString *bar;

// Some.m
// @dynamic å°†ä¸ä¼šè‡ªåŠ¨åˆæˆï¼Œä¹Ÿä¸ä¼šåˆ›å»ºå®ä¾‹å˜é‡
// ä½†ä½¿ç”¨ getter &amp; setter å¯ä»¥ç¼–è¯‘ï¼Œå› ä¸ºå…¶ç›¸ä¿¡ä¼šåœ¨è¿è¡Œæ—¶æ‰¾åˆ°è¿™äº›æ–¹æ³•
@dynamic bar;

// @synthesize æŒ‡å®šäº†å±æ€§çš„å®ä¾‹å˜é‡å
@synthesize foo = _foooo;

self-&gt;_foooo = @&quot;Foo&quot;;
NSLog(@&quot;%@&quot;, [self foo]);
</code></pre>

<p>åŸå­æ€§</p>

<ul>
<li>åœ¨åŒ–å­¦ä¸­ï¼ŒåŸå­æ˜¯ä¸å¯åˆ†å‰²çš„æœ€å°ç²’å­ï¼Œå› æ­¤å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªåŸå­æ“ä½œæ˜¯ä¸ä¼šè¢«ä¸­æ–­çš„ï¼Œå³çº¿ç¨‹å®‰å…¨çš„ï¼ˆä½†è¿™å¹¶ä¸ä»£è¡¨ <code>atomic</code> çš„å±æ€§æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼‰ï¼›</li>
<li>é»˜è®¤æƒ…å†µä¸‹ï¼ˆå³ä¸æ˜ç¡®æŒ‡å®šåŸå­æ€§æ—¶ï¼‰ï¼Œç”±ç¼–è¯‘å™¨æ‰€åˆæˆçš„æ–¹æ³•ï¼ˆå³ getter &amp; setterï¼‰ä¼šé€šè¿‡é”å®šæœºåˆ¶ç¡®ä¿å…¶åŸå­æ€§ï¼ˆAtomicityï¼‰ï¼›</li>
<li>è‡ªå·±å®ç°çš„ getter &amp; setter éœ€è¦è‡ªå·±æ¥ä¿è¯ç›¸åº”çš„åŸå­æ€§ï¼ˆå³è‡ªå·±å®ç°æ—¶ä¸å£°æ˜çš„åŸå­æ€§æ²¡æœ‰å…³ç³»ï¼‰ï¼›</li>
<li>è‹¥å±æ€§ä¸º <code>nonatomic</code> åˆ™ä¸ä½¿ç”¨åŒæ­¥é”ï¼ŒiOS ä¸­ä½¿ç”¨åŒæ­¥é”å¼€é”€è¾ƒå¤§ï¼Œå¯èƒ½å¸¦æ¥æ€§èƒ½é—®é¢˜ï¼Œå› æ­¤ <code>nonatomic</code> æ€§èƒ½ä¼šå¥½ç‚¹ä¸” <code>atomic</code> å¹¶ä¸èƒ½ä¿è¯æ“ä½œæ˜¯åŸå­çš„ï¼Œå› æ­¤é€šå¸¸éƒ½ä½¿ç”¨ <code>nonatomic</code>ã€‚</li>
</ul>

<p>è¯»å†™æƒé™</p>

<ul>
<li><code>readwrite</code> å³æ‹¥æœ‰ getter &amp; setterï¼Œ<code>readonly</code> å³ä»…æ‹¥æœ‰ <code>getter</code>ï¼›</li>
<li><code>readwrite</code> å¯ä»¥ç”¨åœ¨ <code>.h</code> å£°æ˜ä¸º <code>readonly</code> ä½†å†…éƒ¨ç±»æ‰©å±•ä¸­å£°æ˜ä¸º <code>readwrite</code> æ¥å…è®¸å†…éƒ¨è®¾ç½®çš„æƒ…å†µã€‚</li>
</ul>

<p>å†…å­˜ç®¡ç†è¯­ä¹‰</p>

<ul>
<li><code>assign</code>ï¼šsetter åªä¼šé’ˆå¯¹çº¯é‡ç±»å‹ï¼ˆScalar Typeï¼‰ä¾‹å¦‚ <code>CGFloat</code>ã€<code>NSInteger</code> ç­‰çš„ç®€å•èµ‹å€¼æ“ä½œï¼›</li>
<li><code>strong</code>ï¼šå®šä¹‰ä¸€ç§æ‹¥æœ‰å…³ç³»ï¼Œä¸ºè¿™ç§å±æ€§è®¾ç½®æ–°å€¼æ—¶ï¼Œsetter ä¼šå…ˆä¿ç•™æ–°å€¼ï¼Œå¹¶é‡Šæ”¾æ—§å€¼ï¼Œç„¶åå†å°†æ–°å€¼è®¾ç½®ä¸Šå»ï¼›</li>
<li><code>weak</code>ï¼šå®šä¹‰ä¸€ç§éæ‹¥æœ‰å…³ç³»ï¼Œä¸ºè¿™ç§å±æ€§è®¾ç½®æ–°å€¼æ—¶ï¼Œsetter æ—¢ä¸ä¿ç•™æ–°å€¼ï¼Œä¹Ÿä¸é‡Šæ”¾æ—§å€¼ï¼Œç±»ä¼¼ <code>assign</code>ï¼Œä½†å½“å±æ€§æ‰€æŒ‡å‘çš„å¯¹è±¡é”€æ¯æ—¶ï¼Œå±æ€§å€¼ä¹Ÿä¼šç½®ä¸º <code>nil</code>ï¼›</li>
<li><code>unsafe_unretained</code>ï¼šå†…å­˜è¯­ä¹‰ä¸ <code>assign</code> ç›¸åŒï¼Œä½†é€‚ç”¨äºå¯¹è±¡ç±»å‹ï¼Œå®šä¹‰ä¸€ç§éæ‹¥æœ‰ï¼ˆä¸ä¿ç•™ï¼‰å…³ç³»ï¼Œä½†å½“å±æ€§æ‰€æŒ‡å‘çš„å¯¹è±¡é”€æ¯æ—¶ï¼Œå±æ€§å€¼<strong>ä¸ä¼š</strong>è‡ªåŠ¨ç½®ä¸º <code>nil</code>ï¼ˆAutonilingï¼Œä¸ <code>weak</code> çš„å·®å¼‚ï¼‰ï¼›</li>
<li><code>copy</code>ï¼šç±»ä¼¼ <code>strong</code>ï¼Œä½† setter ä¸ä¿ç•™æ–°å€¼ï¼Œè€Œæ˜¯å°†å…¶æ‹·è´ï¼›å½“å±æ€§ç±»å‹ä¸º <code>NSString *</code> æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ <code>copy</code> ä¿æŠ¤å…¶å°è£…æ€§ï¼Œå› ä¸º setter æ¥æ”¶çš„æ–°å€¼æœ‰å¯èƒ½æ˜¯æŒ‡å‘ <code>NSMutableString</code> çš„å®ä¾‹ï¼Œè‹¥ä¸æ‹·è´åˆ™å¯èƒ½ä¼šè¢«å¤–ç•Œéšæ—¶æ›´æ”¹ï¼Œå› æ­¤éœ€è¦æ‹·è´ä¸ºä¸å¯å˜çš„æƒ…å†µï¼›</li>
</ul>

<p>æ–¹æ³•å</p>

<ul>
<li><code>getter=&lt;name&gt;</code> å¯ä»¥æŒ‡å®š getter åç§°ï¼›</li>
<li><code>setter=&lt;name&gt;</code> å¯ä»¥æŒ‡å®š setter åç§°ï¼›</li>
</ul>

<p>å±æ€§ç‰¹æ€§ï¼ˆAttributeï¼‰åªåœ¨è‡ªåŠ¨ç”Ÿæˆæ—¶æœ‰æ•ˆï¼Œè‡ªå·±å®ç°çš„ getter &amp; setter è¦ä¿è¯å…¶å…·å¤‡ç›¸åº”çš„å±æ€§ç‰¹æ€§ã€‚</p>

<pre><code class="language-objectivec">@interface Foo : NSObject
// å³ä½¿ readonly ä¹Ÿè¦æ³¨æ˜ copyï¼Œå› ä¸ºåœ¨ init ä¸­è¿›è¡Œäº† copy
@property (copy, readonly) NSString *bar;
@end

@implementation Foo

- (instancetype)initWithBar:(NSString *)bar
{
    self = [super init];
    if (self) {
        // è¦ä¿è¯å±æ€§çš„å†…å­˜è¯­ä¹‰
        _bar = [bar copy];
    }
    return self;
}

@end
</code></pre>

<h3 id="åœ¨å¯¹è±¡å†…éƒ¨å°½é‡ç›´æ¥è®¿é—®å®ä¾‹å˜é‡">åœ¨å¯¹è±¡å†…éƒ¨å°½é‡ç›´æ¥è®¿é—®å®ä¾‹å˜é‡</h3>

<p>ç›´æ¥è®¿é—®å®ä¾‹å˜é‡ï¼ˆivarï¼‰ä¸é€šè¿‡å±æ€§ï¼ˆgetter &amp; setterï¼‰è®¿é—®çš„åŒºåˆ«ï¼š</p>

<ul>
<li>ç›´æ¥è®¿é—®ä¸ç»è¿‡æ–¹æ³•æ´¾å‘ï¼Œé€Ÿåº¦æ›´å¿«ï¼›</li>
<li>ç›´æ¥è®¿é—®ä¸ç»è¿‡æ‰€å®šä¹‰çš„å†…å­˜ç®¡ç†è¯­ä¹‰ï¼ˆä¾‹å¦‚ <code>copy</code>ï¼‰ï¼›</li>
<li>ç›´æ¥è®¿é—®ä¸ç»è¿‡ KVOï¼›</li>
<li>é€šè¿‡å±æ€§è®¿é—®ä¾¿äº Debugï¼ˆå¯ä»¥æ‰“æ–­ç‚¹ï¼‰ã€‚</li>
</ul>

<p>å› æ­¤å»ºè®®è¯»å–æ—¶ç›´æ¥è®¿é—®ï¼Œå†™å…¥æ—¶é€šè¿‡å±æ€§ï¼Œå½“ç„¶å…·ä½“é—®é¢˜è§ä»è§æ™ºã€‚</p>

<pre><code class="language-objectivec">// æ‡’åŠ è½½çš„å±æ€§å¿…é¡»è¦é€šè¿‡ getter è®¿é—®
- (NSObject *)foo {
    if (!_foo) {
        _foo = [NSObject new];
        return _foo;
    }
}
</code></pre>

<h3 id="ç†è§£-å¯¹è±¡ç­‰åŒæ€§-è¿™ä¸€æ¦‚å¿µ">ç†è§£ã€Œå¯¹è±¡ç­‰åŒæ€§ã€è¿™ä¸€æ¦‚å¿µ</h3>

<p>å¯¹äº Obj-C ä¸­çš„å¯¹è±¡ç±»å‹ï¼Œ<code>==</code> æ¯”è¾ƒçš„æ˜¯ä¸¤ä¸ªæŒ‡é’ˆæœ¬èº«çš„å€¼ï¼ˆå³å­˜å‚¨çš„åœ°å€ï¼‰æ˜¯å¦ä¸€è‡´ã€‚NSString ç±»ä¸­çš„ <code>isEqualToString:</code> æ¯” <code>isEqual:</code> æ–¹æ³•é€Ÿåº¦æ›´å¿«ï¼ˆä½†å…¶å®å·®åˆ«ä¸å¤§ï¼‰ã€‚</p>

<pre><code class="language-objectivec">- (BOOL)isEqual:(id)object {
    // åœ°å€ä¸€è‡´ï¼Œåˆ™å¿…ç„¶ä¸€æ ·
    if (self == object) return YES;
    // å¦‚æœéåŒç±»ï¼Œåˆ™ä¸ç›¸ç­‰ï¼ˆå­çˆ¶ç±»ä¹‹é—´æ¯”è¾ƒè§†æƒ…å†µè€Œå®šï¼‰
    if ([self class] != [object class]) return NO;

    Foo *foo = (Foo *)object;
    if (![_bar isEqualToString:foo.bar])
        return NO;

    if (_baz != foo.baz)
        return NO;

    return YES;
}
</code></pre>

<p>è‹¥ä¸¤ä¸ªå¯¹è±¡ç›¸ç­‰ï¼Œ<code>hash</code> ä¹Ÿç›¸ç­‰ï¼›<code>hash</code> ç›¸ç­‰ï¼Œä½†ä¸¤ä¸ªå¯¹è±¡å¹¶ä¸ä¸€å®šç›¸ç­‰ã€‚å®ç° <code>hash</code> æ–¹æ³•è¦åœ¨å‡å°‘ç¢°æ’ä¸é™ä½è¿ç®—å¤æ‚ç¨‹åº¦ï¼ˆæ€§èƒ½å½±å“ï¼‰ä¹‹é—´æƒè¡¡ï¼š</p>

<pre><code class="language-objectivec">// è¿”å›å›ºå®šå€¼
// å¯è¡Œï¼Œä½†åœ¨ collection ä¸­ä½¿ç”¨è¯¥ç±»å‹å¯¹è±¡å°†äº§ç”Ÿæ€§èƒ½é—®é¢˜ï¼Œå› ä¸º collection æ£€ç´¢å“ˆå¸Œè¡¨ï¼ˆHash Tableï¼‰æ—¶ï¼Œä¼šç”¨å¯¹è±¡çš„å“ˆå¸Œç ï¼ˆHash Codeï¼‰åšç´¢å¼•ã€‚
// å‡å¦‚æŸä¸ª collection æ˜¯ç”¨ set å®ç°çš„ï¼Œå…¶å¯èƒ½ä¼šæ ¹æ®å“ˆå¸Œç æŠŠå¯¹è±¡åˆ†è£…åˆ°ä¸åŒçš„æ•°ç»„ä¸­ã€‚
// è‹¥æ¯ä¸ªå¯¹è±¡éƒ½è¿”å›ç›¸åŒçš„å“ˆå¸Œç ï¼Œåˆ™éœ€è¦å°†æ‰€æœ‰å¯¹è±¡å…¨éƒ¨æ‰«æã€‚
- (NSUInteger)hash {
    return 1024;
}

// å±æ€§æ‹¼æ¥å­—ç¬¦ä¸²å¹¶ hash
// ä½†éœ€æ‰¿æ‹…åˆ›å»ºå­—ç¬¦ä¸²çš„å¼€é”€ï¼›æ·»åŠ åˆ° collection ä¸­ç”±äºå¿…é¡»è®¡ç®—å“ˆå¸Œç ä¹Ÿä¼šäº§ç”Ÿæ€§èƒ½é—®é¢˜
- (NSUInteger)hash {
    NSString *str = [NSString stringWithFormat:@&quot;%@:%i&quot;, _bar, _baz];
    return [str hash];
}

// æ•ˆç‡é«˜ï¼ŒèŒƒå›´ç¡®å®š
// è™½ç„¶ä¼šç¢°æ’ï¼Œä½†å…è®¸
- (NSUInteger)hash {
    NSUInteger bar = [_bar hash];
    NSUInteger baz = _baz;
    return bar ^ baz;
}
</code></pre>

<p>ç¼–å†™ç‰¹å®šç±»çš„ç­‰åŒæ€§åˆ¤å®šæ–¹æ³•ï¼ˆæ¯”å¦‚ <code>isEqualToString:</code>ï¼‰æ—¶ï¼Œåº”ä¸€å¹¶é‡å†™ <code>isEqual:</code> æ–¹æ³•ï¼š</p>

<pre><code class="language-objectivec">- (BOOL)isEqualToFoo:(Foo *)foo {
    if (self == object) return YES;

    if (![_bar isEqualToString:foo.bar])
        return NO;

    if (_baz != foo.baz)
        return NO;

    return YES;
}

- (BOOL)isEqual:(id)object {
    // ç›¸åŒç±»åˆ™è‡ªå·±åˆ¤æ–­
    if ([self class] == [object class]) {
        return [self isEqualToFoo:(Foo *)object];
    }

    // ä¸åŒç±»åˆ™äº¤ç»™çˆ¶ç±»
    return [super isEqual:object];
}
</code></pre>

<p>ç­‰åŒæ€§åˆ¤å®šçš„æ‰§è¡Œæ·±åº¦å–å†³äºå—æµ‹å¯¹è±¡ï¼Œå³è‹¥æœ‰æŸä¸ª ID å­—æ®µåˆ™å¯ä»¥ç›´æ¥æ ¹æ®è¯¥ ID æ¥åˆ¤å®šã€‚</p>

<pre><code class="language-objectivec">// å°†å¯¹è±¡æ”¾å…¥ collection ä¸­ï¼Œä¸åº”å†æ”¹å˜å…¶å“ˆå¸Œç ï¼Œå³éœ€è¦ç¡®ä¿å“ˆå¸Œç å¹¶éæ ¹æ®å¯¹è±¡çš„å¯å˜éƒ¨åˆ†è®¡ç®—å¾—å‡º
NSMutableSet *set = [NSMutableSet new];
NSMutableArray *arr1 = [@[@1] mutableCopy];
NSMutableArray *arr2 = [@[@1, @2] mutableCopy];

[set addObject:arr1];
[set addObject:arr2];

// {((1), (1,2))}
NSLog(@&quot;%@&quot;, set);

// Set ä¸­å­˜åœ¨äº†ä¸¤ä¸ªå®Œå…¨ç›¸åŒçš„ç»“æ„
// {((1,2), (1,2))}
[arr1 addObject:@2];
NSLog(@&quot;%@&quot;, set);
</code></pre>

<h3 id="ä»¥-ç±»æ—æ¨¡å¼-éšè—å®ç°ç»†èŠ‚">ä»¥ã€Œç±»æ—æ¨¡å¼ã€éšè—å®ç°ç»†èŠ‚</h3>

<p>ç±»æ—ï¼ˆClass Clusterï¼Œåˆç§°ç±»ç°‡ï¼‰æ˜¯ä¸€ç§éšè—æŠ½è±¡åŸºç±»èƒŒåçš„å®ç°ç»†èŠ‚çš„æ¨¡å¼ï¼ˆä¾‹å¦‚ <code>UIButton</code> çš„ <code>buttonWithType:</code> ç±»æ–¹æ³•ï¼‰ã€‚</p>

<pre><code class="language-swift">// æ¨¡å¼æ˜¯ä¸é™å®šäºè¯­è¨€çš„ï¼Œå› æ­¤è¿™é‡Œä½¿ç”¨äº† Swift æ¥ç®€å•å®ç°

enum FooType {
    case first
    case second
}

class Foo {
    static func build(_ type: FooType) -&gt; Foo {
        switch type {
        case .first: return FooFirst()
        case .second: return FooSecond()
        }
    }

    func bar() {
        fatalError(&quot;bar should be implemented in subclasses.&quot;)
    }
}

class FooFirst: Foo {
    override func bar() {
        print(#function)
    }
}

class FooSecond: Foo {
    override func bar() {
        print(#function)
    }
}

// ç±»æ—æ¨¡å¼ç›®çš„æ˜¯éšè—å†…éƒ¨å®ç°çš„ç»†èŠ‚ï¼Œå› æ­¤å¤–ç•Œåˆ›å»ºçš„å˜é‡è™½ç„¶æ˜¯å·¥å‚ç±»çš„ç±»å‹ï¼Œä½†å®é™…ä¸Šå…¶å®æ˜¯å†…éƒ¨å­ç±»çš„ç±»å‹ã€‚
// å› æ­¤åœ¨ Obj-C ä¸­ä½¿ç”¨ isMemberOfClass åˆ¤æ–­ç±»æ˜¯å¦ä¸ºå·¥å‚ç±»æœ¬èº«ï¼Œåˆ™ä¼šè¿”å› NOã€‚
// foo åœ¨ Swift ä¸­è¢«æ¨æ–­ä¸º Foo
let foo = Foo.build(.first)

print(foo is Foo)
print(foo is FooFirst)
print(foo is FooSecond)

// OUTPUT:
// true
// true
// false
</code></pre>

<p>ç³»ç»Ÿæ¡†æ¶ä¸­æœ‰è®¸å¤šç±»æ—ï¼Œæ¯”å¦‚å¤§éƒ¨åˆ†çš„ collection ç±»ï¼ˆæ¯”å¦‚ <code>NSArray</code>ï¼‰ï¼›ç”±äº <code>NSArray</code> æ˜¯ç±»æ—ï¼Œå› æ­¤ <code>[fooArr class] == [NSArray class]</code> å°†ä¸€ç›´è¿”å› <code>false</code>ï¼Œä½†å¯ä½¿ç”¨ <code>[fooArr isKindOfClass:[NSArray class]]</code>ã€‚</p>

<p>å‘ç±»æ—ä¸­æ–°å¢å®ä½“å­ç±»éœ€è¦éµå®ˆä»¥ä¸‹è§„åˆ™ï¼š</p>

<ul>
<li>å­ç±»åº”è¯¥ç»§æ‰¿è‡ªç±»æ—ä¸­çš„æŠ½è±¡åŸºç±»ï¼›</li>
<li>å­ç±»åº”è¯¥å®šä¹‰è‡ªå·±çš„æ•°æ®å­˜å‚¨æ–¹å¼ï¼šç±»æ—åªæ˜¯å®šä¹‰äº†é€šç”¨çš„æ¥å£ï¼Œå®é™…å­˜å‚¨çš„æ–¹å¼åˆ™ç”±èƒŒåå…·ä½“çš„å®ä½“å­ç±»æ‰¿æ‹…ï¼›</li>
<li>å­ç±»åº”å½“è¦†å†™è¶…ç±»æ–‡æ¡£ä¸­æŒ‡æ˜éœ€è¦è¦†å†™çš„æ–¹æ³•ï¼šç±»æ—ä¸­çš„é€šç”¨æ¥å£éœ€è¦å­ç±»å®ç°ã€‚</li>
</ul>

<h3 id="åœ¨æ—¢æœ‰ç±»ä¸­ä½¿ç”¨å…³è”å¯¹è±¡å­˜æ”¾è‡ªå®šä¹‰æ•°æ®">åœ¨æ—¢æœ‰ç±»ä¸­ä½¿ç”¨å…³è”å¯¹è±¡å­˜æ”¾è‡ªå®šä¹‰æ•°æ®</h3>

<p>ç•¥ï¼›å…³äºå…³è”å¯¹è±¡ï¼Œå¯è¯¦è§<a href="../associated_objects_in_ios">ã€ŠiOS ä¸­çš„å…³è”å¯¹è±¡ã€‹</a>ä¸€æ–‡ã€‚</p>

<h3 id="ç†è§£-objc-msgsend-çš„ä½œç”¨">ç†è§£ objc_msgSend çš„ä½œç”¨</h3>

<p>ç•¥ï¼›å…³äº objc_msgSendï¼Œå¯è¯¦è§<a href="../objc_msgsend">ã€Šæµ…å° objc_msgSendã€‹</a>ä¸€æ–‡ã€‚</p>

<h3 id="ç†è§£æ¶ˆæ¯è½¬å‘æœºåˆ¶">ç†è§£æ¶ˆæ¯è½¬å‘æœºåˆ¶</h3>

<p>ç•¥ï¼›å…³äºæ¶ˆæ¯è½¬å‘æœºåˆ¶ï¼Œå¯è¯¦è§<a href="../objc_msgsend">ã€Šæµ…å° objc_msgSendã€‹</a>ä¸€æ–‡ã€‚</p>

<h3 id="ç”¨-æ–¹æ³•è°ƒé…æŠ€æœ¯-è°ƒè¯•-é»‘ç›’æ–¹æ³•">ç”¨ã€Œæ–¹æ³•è°ƒé…æŠ€æœ¯ã€è°ƒè¯•ã€Œé»‘ç›’æ–¹æ³•ã€</h3>

<p>ã€Œæ–¹æ³•è°ƒé…æŠ€æœ¯ã€å³ Method Swizzlingï¼Œç°åœ¨æ™®éç§°ä¹‹ä¸ºæ–¹æ³•äº¤æ¢ã€‚å¦‚ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥å°† <code>Foo</code> ä¸­çš„æ–¹æ³•åœ¨å…¶ <code>Swizzle</code> åˆ†ç±»çš„ <code>+load</code> ä¸­è¿›è¡Œäº¤æ¢ï¼š</p>

<pre><code class="language-objectivec">#import &lt;objc/runtime.h&gt;

@interface Foo : NSObject
- (void)foo;
@end

@implementation Foo
- (void)foo {
    NSLog(@&quot;foo&quot;);
}
@end

@interface Foo (Swizzle)
- (void)newFoo;
@end

@implementation Foo (Swizzle)
+ (void)load {
    // ä¿è¯åªäº¤æ¢ä¸€æ¬¡
    static dispatch_once_t onceToken;
    dispatch_once(&amp;onceToken, ^{
        Method m1 = class_getInstanceMethod([self class], @selector(foo));
        Method m2 = class_getInstanceMethod([self class], @selector(newFoo));

        method_exchangeImplementations(m1, m2);
    });
}

- (void)newFoo {
    NSLog(@&quot;newFoo&quot;);
}
@end

[[[Foo alloc] init] foo];
[[[Foo alloc] init] newFoo];

// OUTPUT:
// newFoo
// foo
</code></pre>

<p>é€šå¸¸ï¼Œæˆ‘ä»¬å¹¶ä¸ä¼šäº¤æ¢æ—¢æœ‰çš„æ–¹æ³•ï¼Œè€Œæ˜¯å½“æˆ‘ä»¬æ— æ³•ä¿®æ”¹æŸäº›ç¬¬ä¸‰æ–¹åº“ä¸­çš„æ–¹æ³•æ—¶ï¼Œå¯ä»¥å°†å…¶äº¤æ¢å‡ºï¼Œå¹¶æ‰§è¡Œç›¸åº”çš„åŠ¨ä½œå†è°ƒç”¨å›åŸæ¥çš„æ–¹æ³•ã€‚å°†è¦äº¤æ¢çš„æ–¹æ³•é€šå¸¸æ”¾åœ¨åˆ†ç±»ä¸­ï¼Œä¸‹é¢åˆ™æ˜¯ä¸€ä¸ªåä¾‹ï¼š</p>

<pre><code class="language-objectivec">@interface Foo : NSObject
- (void)foo;
@end

@implementation Foo
- (void)foo {
    NSLog(@&quot;foo&quot;);
}
@end

@interface Bar : NSObject
- (void)more_foo;
@end

@implementation Bar
+ (void)load {
    static dispatch_once_t onceToken;
    dispatch_once(&amp;onceToken, ^{
        Method m1 = class_getInstanceMethod([Foo class], @selector(foo));
        Method m2 = class_getInstanceMethod([Bar class], @selector(more_foo));

        method_exchangeImplementations(m1, m2);
    });
}

- (void)more_foo {
    NSLog(@&quot;Do sth more...&quot;);

//    [self performSelector:@selector(foo)]; // æ­»å¾ªç¯
    [self more_foo]; // å´©æºƒ
}
@end

[[[Foo alloc] init] foo];
</code></pre>

<p>å‡è®¾ <code>Foo</code> ä¸­çš„ <code>foo</code> æ–¹æ³•æˆ‘ä»¬æ— æ³•ç›´æ¥å¯¹å…¶è¿›è¡Œä¿®æ”¹ï¼Œäºæ˜¯é€‰æ‹©åœ¨ <code>Bar</code> çš„ <code>+load</code> ä¸­äº¤æ¢ <code>foo</code> ä¸ <code>more_foo</code>ã€‚å› æ­¤äº¤æ¢åè°ƒç”¨ <code>foo</code> æ—¶ï¼Œå³è°ƒç”¨äº† <code>more_foo</code>ï¼Œå› æ­¤æˆ‘ä»¬ç†æ‰€å½“ç„¶è®¤ä¸ºè°ƒç”¨ <code>more_foo</code> å³è°ƒç”¨äº† <code>foo</code>ï¼Œä½†å®é™…æƒ…å†µæ˜¯ä¼šå‘ç”Ÿå´©æºƒï¼š<code>-[Foo more_foo]: unrecognized selector sent to instance 0x6000025a4460</code>ã€‚è¿™æ˜¯å› ä¸ºåœ¨ <code>more_foo</code> ä¸­çš„éšå«å‚æ•° <code>self</code> æœ¬è´¨å…¶å®è¿˜æ˜¯ <code>Foo</code> ç±»å‹çš„å®ä¾‹å¯¹è±¡ï¼Œè€Œ <code>more_foo</code> æ ¹æœ¬ä¸åœ¨ <code>Foo</code> ä¸­ï¼›è€Œå¦‚æœæ­¤æ—¶æ‰§è¡Œ <code>foo</code> åˆ™å›  <code>IMP</code> äº¤æ¢åˆ™ä¼šä¸€ç›´é™·å…¥ <code>more_foo</code> ä¸­è€Œæ­»å¾ªç¯ã€‚æ‰€ä»¥æˆ‘ä»¬å°†äº¤æ¢çš„æ–¹æ³•å®šä¹‰åœ¨åˆ†ç±»ä¸­æ—¶ï¼Œ<code>self</code> èƒ½å¤ŸåŒæ—¶è°ƒç”¨åˆ°æœ¬ç±»å’Œåˆ†ç±»ä¸­çš„æ–¹æ³•ã€‚</p>

<h3 id="ç†è§£-ç±»å¯¹è±¡-çš„ç”¨æ„">ç†è§£ã€Œç±»å¯¹è±¡ã€çš„ç”¨æ„</h3>

<p>ç•¥ï¼›å…³äºç±»å¯¹è±¡ï¼Œå¯è¯¦è§<a href="../objects_in_obj-c/">ã€ŠObj-C ä¸­çš„å¯¹è±¡ã€‹</a>ä¸€æ–‡ï¼›å…³äºå†…çœï¼Œå¯è¯¦è§<a href="../type_introspection_and_reflection/">ã€ŠObj-C &amp; Swift çš„ç±»å‹å†…çœä¸åå°„ã€‹</a>ä¸€æ–‡ï¼›</p>

<h2 id="æ¥å£ä¸-api-è®¾è®¡">æ¥å£ä¸ API è®¾è®¡</h2>

<h3 id="ç”¨å‰ç¼€é¿å…å‘½åç©ºé—´å†²çª">ç”¨å‰ç¼€é¿å…å‘½åç©ºé—´å†²çª</h3>

<p>Objective-C æ²¡æœ‰å‘½åç©ºé—´ï¼ˆNamespaceï¼‰æœºåˆ¶ï¼›å› æ­¤ä¸ºäº†é¿å…é‡å¤ç¬¦å·ï¼ˆDuplicate Symbolï¼‰é”™è¯¯ï¼Œéœ€åœ¨ç±»åå‰åŠ å…¥å‰ç¼€ä»¥åŒºåˆ†ã€‚</p>

<h3 id="æä¾›-å…¨èƒ½åˆå§‹åŒ–æ–¹æ³•">æä¾›ã€Œå…¨èƒ½åˆå§‹åŒ–æ–¹æ³•ã€</h3>

<p>å…¨èƒ½åˆå§‹åŒ–æ–¹æ³•ï¼ˆDesignated Initializerï¼Œåˆç§°æŒ‡å®šåˆå§‹åŒ–æ–¹æ³•ï¼‰æŒ‡çš„æ˜¯ä¸ºå¯¹è±¡æä¾›å¿…è¦ä¿¡æ¯ä»¥ä¾¿å…¶èƒ½å®Œæˆå·¥ä½œçš„åˆå§‹åŒ–æ–¹æ³•ã€‚ä¸€ä¸ªç±»å¯èƒ½ä¸æ­¢æœ‰ä¸€ä¸ªåˆå§‹åŒ–æ–¹æ³•ï¼Œä½†é€šå¸¸å°†é€‰æ‹©å…¶ä¸­ä¹‹ä¸€ä½œä¸ºå…¨èƒ½åˆå§‹åŒ–æ–¹æ³•ï¼Œè€Œå…¶å®ƒåˆå§‹åŒ–æ–¹æ³•é—´æ¥ä¾èµ–å®ƒï¼Œè¿™æ ·å¯ä»¥ä¿è¯åˆå§‹åŒ–é€»è¾‘çš„ç»Ÿä¸€ã€‚</p>

<pre><code class="language-objectivec">@interface Rectangle : NSObject
@property (nonatomic, assign, readonly) double width;
@property (nonatomic, assign, readonly) double height;

- (instancetype)initWithWidth:(double)width height:(double)height;
@end

@implementation Rectangle
- (instancetype)initWithWidth:(double)width height:(double)height {
    self = [super init];
    if (self) {
        _width = width;
        _height = height;
    }
    return self;
}

- (instancetype)init {
    // è°ƒç”¨å…¨èƒ½åˆå§‹åŒ–æ–¹æ³•ä»¥æ„é€ 
    return [self initWithWidth:0.0 height:0.0];
    // ä¹Ÿå¯æŠ›å‡ºå¼‚å¸¸ï¼Œé¿å…å¤–ç•Œé€šè¿‡ init æ„é€ 
//    @throw [NSException exceptionWithName:NSInternalInconsistencyException
//                                   reason:@&quot;Must use initWithWidth:height: instead.&quot;
//                                 userInfo:nil];
}

// å¦ä¸€ä¸ªå…¨èƒ½æ„é€ æ–¹æ³•
- (instancetype)initWithCoder:(NSCoder *)coder {
    self = [super init];
    if (self) {
        _width = [coder decodeDoubleForKey:@&quot;width&quot;];
        _height = [coder decodeDoubleForKey:@&quot;height&quot;];
    }
    return self;
}
@end

@interface Square : Rectangle
- (instancetype)initWithDimension:(double)dimension;
@end

@implementation Square
- (instancetype)initWithDimension:(double)dimension {
    // è°ƒç”¨çˆ¶ç±»å…¨èƒ½åˆå§‹åŒ–æ–¹æ³•ä»¥æ„é€ 
    return [super initWithWidth:dimension height:dimension];
}

- (instancetype)initWithWidth:(double)width height:(double)height {
    // å­ç±»å…¨èƒ½åˆå§‹åŒ–æ–¹æ³•ä¸åŒï¼Œéœ€é‡å†™çˆ¶ç±»å…¨èƒ½åˆå§‹åŒ–æ–¹æ³•
//    return [self initWithDimension:MAX(width, height)];
    // æˆ–å¯æŠ›å‡ºå¼‚å¸¸ï¼Œé¿å…å¤–ç•Œé€šè¿‡çˆ¶ç±»å…¨èƒ½åˆå§‹åŒ–æ–¹æ³•æ„é€ 
    @throw [NSException exceptionWithName:NSInternalInconsistencyException
                                   reason:@&quot;Must use initWithDimension: instead.&quot;
                                 userInfo:nil];
}

- (instancetype)init {
    // ä¹Ÿéœ€é‡å†™çˆ¶ç±» init æ–¹æ³•ï¼Œä½¿ç”¨å­ç±»å…¨èƒ½æ„é€ æ–¹æ³•
    return [self initWithDimension:0.0];
}

- (instancetype)initWithCoder:(NSCoder *)coder {
    // å…ˆè°ƒç”¨çˆ¶ç±» initWithCoder: å…¨èƒ½æ„é€ æ–¹æ³•
    self = [super initWithCoder:coder];
    if (self) {
        // ...
    }
    return self;
}
@end
</code></pre>

<h3 id="å®ç°-description-æ–¹æ³•">å®ç° description æ–¹æ³•</h3>

<p>NSObject å­ç±»å¯ä»¥é‡å†™ <code>description</code> æ–¹æ³•æ¥æè¿°å®ä¾‹ï¼Œåœ¨æ‰“å°ï¼ˆ<code>NSLog</code>ï¼‰å®ä¾‹ä¿¡æ¯æ—¶å³å¯è¾“å‡ºï¼›ä¹Ÿå¯é‡å†™ <code>debugDescription</code> ç”¨æ¥åœ¨æ§åˆ¶å°ä½¿ç”¨ LLDB <code>po</code> å‘½ä»¤è¾“å‡ºï¼š</p>

<pre><code class="language-objectivec">// ...
@implementation Rectangle
// ...

- (NSString *)description {
    return [NSString stringWithFormat:@&quot;&lt;%lf, %lf&gt;&quot;, _width, _height];
}

- (NSString *)debugDescription {
    return [NSString stringWithFormat:@&quot;&lt;%@: %p&gt; &lt;%lf, %lf&gt;&quot;, [self class], self, _width, _height];
}
@end

Rectangle *rect = [[Rectangle alloc] initWithWidth:30 height:50];
NSLog(@&quot;%@&quot;, rect);

// OUTPUT:
// &lt;30.000000, 50.000000&gt;
// (lldb) po rect
// &lt;Rectangle: 0x6000037887e0&gt; &lt;30.000000, 50.000000&gt;
</code></pre>

<h3 id="å°½é‡ä½¿ç”¨ä¸å¯å˜å¯¹è±¡">å°½é‡ä½¿ç”¨ä¸å¯å˜å¯¹è±¡</h3>

<p>å°½é‡å°†å¤–ç•Œä¸èƒ½æ”¹å˜çš„å±æ€§å¯¹å¤–å£°æ˜ä¸º <code>readonly</code>ï¼Œæ­¤æ—¶å°†åªå­˜åœ¨ getter è€Œä¸å­˜åœ¨ setterã€‚æˆ‘ä»¬å¯ä»¥åœ¨å®ç°æ–‡ä»¶ä¸­ç›´æ¥é€šè¿‡è®¿é—®æˆå‘˜å˜é‡æ¥æ›´æ”¹ï¼Œä¹Ÿå¯å°†å±æ€§å†æ¬¡å£°æ˜åœ¨ç±»æ‰©å±•ä¸­ä»¥é€šè¿‡ setter æ›´æ”¹ã€‚</p>

<p>ç”±äºå†…å­˜ç®¡ç†è¯­ä¹‰ä»…é’ˆå¯¹ setterï¼Œå› æ­¤å£°æ˜ä¸º <code>readonly</code> æ—¶ä¹Ÿå¯ä½¿ç”¨é»˜è®¤çš„å†…å­˜ç®¡ç†è¯­ä¹‰ã€‚<code>readonly</code> å¹¶éæ˜¯å®Œå…¨å®‰å…¨çš„ï¼Œå¤–éƒ¨ä»ç„¶å¯ä»¥é€šè¿‡ KVCã€æˆ–è€…æ ¹æ®å†…å­˜å¸ƒå±€çš„åç§»é‡ç›´æ¥è®¿é—®ä¿®æ”¹ã€‚å¯¹äºé›†åˆç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¸å¯å˜å±æ€§æœ¬èº«ä½œä¸º <code>readonly</code> æš´éœ²åœ¨å¤–ï¼Œå¹¶é€šè¿‡é¢å¤–æ–¹æ³•ä½¿å¾—å¤–ç•Œå¯ä»¥æ·»åŠ æˆ–åˆ é™¤ç­‰æ“ä½œé›†åˆï¼›åœ¨å†…éƒ¨åˆ™é€šè¿‡å¦å¤–çš„å¯å˜ç±»å‹å±æ€§ä½œä¸ºå…·ä½“å®ç°ï¼Œä»è€Œé¿å…ä»åº•å±‚ç›´æ¥ä¿®æ”¹å¯¹è±¡ä¸­çš„æ•°æ®ï¼š</p>

<pre><code class="language-objectivec">@interface Rectangle : NSObject
@property (nonatomic, assign, readonly) double width;
@property (nonatomic, readonly) double height;
@property (nonatomic, strong, readonly) NSArray&lt;Rectangle *&gt; *array;

- (void)addElement:(Rectangle *)element;
- (void)removeElement:(Rectangle *)element;
@end

@interface Rectangle ()
@property (nonatomic, assign, readwrite) double width;
@property (nonatomic, assign) double height;
@end

@implementation Rectangle {
    NSMutableArray *_mutableArray;
}

- (NSArray *)array {
    return [_mutableArray copy];
}

- (void)addElement:(Rectangle *)element {
    [_mutableArray addObject:element];
}

- (void)removeElement:(Rectangle *)element {
    [_mutableArray removeObject:element];
}

- (instancetype)initWithWidth:(double)width height:(double)height {
    self = [super init];
    if (self) {
        _width = width;
        _height = height;
        _mutableArray = [NSMutableArray new];
    }
    return self;
}
@end

Rectangle *rect1 = [[Rectangle alloc] initWithWidth:10 height:20];
Rectangle *rect2 = [[Rectangle alloc] initWithWidth:10 height:20];
[rect1 addElement:rect2];
</code></pre>

<h3 id="ä½¿ç”¨æ¸…æ™°è€Œåè°ƒçš„å‘½åæ–¹å¼">ä½¿ç”¨æ¸…æ™°è€Œåè°ƒçš„å‘½åæ–¹å¼</h3>

<p>ä¸€äº› Obj-C çš„æ–¹æ³•åååˆ†å†—é•¿ï¼Œä½†å´è¯­ä¹‰åŒ–æ›´åŠ ï¼Œè¿™ç‚¹ Swift ä¹Ÿç»§æ‰¿äº†å…¶ä¼˜ç‚¹ï¼Œå¹¶é€‚å½“ç²¾ç®€æ–¹æ³•åã€‚æ–¹æ³•çš„å‘½åè§„åˆ™ï¼š</p>

<ul>
<li>è‹¥è¿”å›å€¼æ˜¯æ–°åˆ›å»ºçš„ï¼Œé‚£ä¹ˆæ–¹æ³•ååº”å½“ä»¥è¿”å›å€¼ç±»å‹å¼€å§‹ï¼Œä¹Ÿå¯åŠ å…¥å¯¹å…¶ä¿®é¥°ï¼›</li>
<li>è¡¨ç¤ºå‚æ•°ç±»å‹çš„åè¯åº”å½“ç½®äºå‚æ•°ä¹‹å‰ï¼›</li>
<li>æ–¹æ³•å†…çš„è¡Œä¸ºè¦æ“ä½œå½“å‰å¯¹è±¡ï¼Œé‚£ä¹ˆåº”å½“åŒ…å«åŠ¨è¯ï¼›è‹¥æ‰§è¡Œæ—¶éœ€è¦å‚æ•°ï¼Œåˆ™åº”å½“åœ¨åŠ¨è¯ä¹‹ååŠ ä¸Šä¸€ä¸ªæˆ–å¤šä¸ªåè¯ï¼›</li>
<li>ä½¿ç”¨ <code>string</code> å…¨ç§°è€Œé <code>str</code> ç®€ç§°ï¼›</li>
<li><code>Boolean</code> å±æ€§åº”å½“åŠ  <code>is</code> å‰ç¼€ï¼›æ ¹æ®åŠŸèƒ½å°†è¿”å› <code>Boolean</code> ç±»å‹çš„æ–¹æ³•åé€‰æ‹© <code>has</code> æˆ– <code>is</code> å‰ç¼€ï¼›</li>
<li>ä½¿ç”¨è¾“å‡ºå‚æ•°ï¼ˆOut Parameterï¼‰ä¿å­˜è¿”å›å€¼çš„æ–¹æ³•å¯ä»¥ä½¿ç”¨ <code>get</code> å‰ç¼€ã€‚</li>
</ul>

<p>ç±»ä¸åè®®çš„åç§°å°½é‡è¦åŠ ä¸Šå‰ç¼€ï¼Œä»¥é¿å…å‘½åç©ºé—´å†²çªã€‚å‘½åç¬¬ä¸€è¦åŠ¡æ˜¯ç¡®ä¿å…¶é£æ ¼ä¸ä»£ç æ¡†æ¶ç›¸ç¬¦åˆã€‚</p>

<h3 id="ä¸ºç§æœ‰æ–¹æ³•ååŠ å‰ç¼€">ä¸ºç§æœ‰æ–¹æ³•ååŠ å‰ç¼€</h3>

<p>ç§æœ‰æ–¹æ³•é™¤äº†ä¸åº”å¯¹å¤–å£°æ˜ï¼Œä¹Ÿåº”åŠ ä¸Šå‰ç¼€ä¸ä»¥åŒºåˆ†ã€‚ä½†ä¸æ¨èå•ç”¨ä¸€ä¸ªä¸‹åˆ’çº¿ <code>_</code> ä½œä¸ºå‰ç¼€ï¼Œå› ä¸ºç³»ç»Ÿåº“ä¸­æœ‰å¾ˆå¤šç§æœ‰æ–¹æ³•å³æ˜¯ä»¥ <code>_</code> ä¸ºå‰ç¼€çš„ã€‚</p>

<h3 id="ç†è§£-objective-c-é”™è¯¯æ¨¡å‹">ç†è§£ Objective-C é”™è¯¯æ¨¡å‹</h3>

<p>å¼‚å¸¸ï¼ˆExceptionï¼‰ä¸é”™è¯¯ï¼ˆErrorï¼‰åœ¨è®¡ç®—æœºä¸­ä»£è¡¨ç€å®Œå…¨ä¸åŒçš„ä¸¤ç§æ„ä¹‰ã€‚</p>

<p>å¼‚å¸¸å®‰å…¨ï¼ˆException Safeï¼‰æŒ‡çš„æ˜¯å½“æŠ›å‡ºå¼‚å¸¸æ—¶ï¼Œéœ€è¦é‡Šæ”¾çš„èµ„æºæˆ–å¯¹è±¡ä¹Ÿèƒ½å¾—åˆ°å®‰å…¨åœ°é‡Šæ”¾ã€‚è‡ªåŠ¨å¼•ç”¨è®¡æ•°é»˜è®¤æ˜¯éå¼‚å¸¸å®‰å…¨çš„ï¼Œä½†å¯ä»¥é€šè¿‡ <code>-fobjc-arc-exceptions</code> è®¾ç½®ç¼–è¯‘å™¨ä»¥è¾¾åˆ°å¼‚å¸¸å®‰å…¨ã€‚ç”±äºå¼‚å¸¸å®‰å…¨å¾ˆéš¾å¾—åˆ°ä¿è¯ï¼Œå› æ­¤æ¨èåªåœ¨å¿…è¦æ—¶ï¼ˆå¦‚é‡å¤§é”™è¯¯ï¼‰æŠ›å‡ºå¼‚å¸¸ï¼Œå¹¶ç»ˆæ­¢ç¨‹åºï¼Œè€Œä¸å†è€ƒè™‘å¼‚å¸¸å®‰å…¨ã€‚</p>

<pre><code class="language-objectivec">@throw [NSException exceptionWithName:NSInternalInconsistencyException reason:@&quot;Some reason.&quot; userInfo:nil];
</code></pre>

<p>éè‡´å‘½é”™è¯¯ï¼ˆNon-fatal Errorï¼‰å¯ä»¥ä»¤æ–¹æ³•è¿”å› <code>nil</code> / <code>0</code> æˆ– <code>NSError</code>ï¼Œä»¥è¡¨æ˜æœ‰é”™è¯¯å‘ç”Ÿã€‚å¯¹äº NSErrorï¼š</p>

<ul>
<li>Error Domainï¼ˆ<code>NSErrorDomain</code> æœ¬è´¨ä¸º <code>NSString</code>ï¼‰ï¼šé”™è¯¯èŒƒå›´è¡¨æ˜äº†é”™è¯¯æ ¹æºï¼Œeg. <code>NSURLErrorDomain</code>ã€<code>NSCocoaErrorDomain</code> ç­‰ï¼›</li>
<li>Error Codeï¼ˆ<code>NSInteger</code>ï¼‰ï¼šé”™è¯¯ä»£ç è¡¨æ˜äº†å…·ä½“çš„ç‹¬æœ‰é”™è¯¯ï¼Œå¯ä½¿ç”¨æšä¸¾å®šä¹‰ï¼›</li>
<li>User Infoï¼ˆ<code>NSDictionary&lt;NSErrorUserInfoKey,id&gt;</code>ï¼Œ<code>NSErrorUserInfoKey</code> æœ¬è´¨ä¸º <code>NSString</code>ï¼‰ï¼šç”¨æˆ·ä¿¡æ¯è¡¨æ˜äº†å…³äºé”™è¯¯çš„é¢å¤–ä¿¡æ¯ï¼Œæ¯”å¦‚æœ¬åœ°åŒ–çš„é”™è¯¯æè¿°ã€‚</li>
</ul>

<p><code>NSError</code> å¸¸è§ç”¨æ³•ä¸€æ˜¯é€šè¿‡ä»£ç†åè®®ï¼ˆDelegate Protocolsï¼‰ä¼ é€’ã€‚å½“é”™è¯¯å‘ç”Ÿæ—¶ï¼Œå°†é€šè¿‡è°ƒç”¨ä»£ç†å¯¹è±¡çš„æŸä¸ªåè®®æ–¹æ³•æ¥å‘ŠçŸ¥ä»£ç†æœ¬èº«ï¼›äºŒæ˜¯é€šè¿‡æ–¹æ³•çš„è¾“å‡ºå‚æ•°è¿”å›ç»™è°ƒç”¨è€…ã€‚</p>

<pre><code class="language-objectivec">// NSURLConnection.h
@protocol NSURLConnectionDelegate &lt;NSObject&gt;
@optional
- (void)connection:(NSURLConnection *)connection didFailWithError:(NSError *)error;
@end

// âŒ é”™è¯¯å‘ç”Ÿ
[self.delegate connection:someConnection didFailWithError:someError];

// ---

extern NSString *const VErrorDomain;

typedef NS_ENUM(NSUInteger, VError) {
    VErrorUnknown = -1,
    VErrorFirst   = 100,
    VErrorSecond  = 200
};

NSString *const VErrorDomain = @&quot;VErrorDomain&quot;;

- (BOOL)doSomething:(NSError **)error {
    // ...

    // å¦‚æœé”™è¯¯å‘ç”Ÿ
    if (errorOccured) {
        // å¦‚æœå¤–ç•Œå…³å¿ƒé”™è¯¯
        if (error) {
            // è§£å¼•ç”¨ï¼ˆDereferenceï¼‰å‰è¦ä¿è¯ error ä¸ä¸º nil
            // å¦åˆ™å¯¹ç©ºæŒ‡é’ˆè§£å¼•ç”¨ä¼šå¯¼è‡´æ®µé”™è¯¯ï¼ˆSegmentation Faultï¼‰å¹¶å´©æºƒï¼ˆEXC_BAD_ACCESSï¼‰
            *error = [NSError errorWithDomain:VErrorDomain code:VErrorFirst userInfo:nil];
        }

        return NO;
    } else {
        return YES;
    }
}
// âŒ é”™è¯¯å‘ç”Ÿ
NSError *error = nil;
BOOL result = [obj doSomething:&amp;error];
if (error) {
    NSLog(@&quot;Error occurred!&quot;);
}
</code></pre>

<p>ARC ä¸‹ï¼Œç¼–è¯‘å™¨å°†æŠŠç¬¬äºŒç§æ–¹æ³•ç­¾åä¸­çš„ <code>NSError **</code> è½¬æ¢ä¸º <code>NSError *__autoreleasing *</code>ï¼Œå³æŒ‡é’ˆæ‰€æŒ‡å‘çš„å¯¹è±¡å°†åœ¨æ–¹æ³•æ‰§è¡Œå®Œæ¯•åè‡ªåŠ¨é‡Šæ”¾ï¼Œå› ä¸ºè¯¥æ–¹æ³•ä¸èƒ½ä¿è¯è°ƒç”¨è€…å°†å…¶ä¸­åˆ›å»ºçš„ <code>NSError</code> é‡Šæ”¾ï¼Œç”±æ­¤ä¿è¯ä¸å¤§éƒ¨åˆ†æ–¹æ³•ï¼ˆé™¤ <code>new</code> / <code>alloc</code> / <code>copy</code> / <code>mutableCopy</code> å¼€å¤´çš„æ–¹æ³•ï¼‰è¿”å›å€¼æ‰€å…·å¤‡çš„è¯­ä¹‰ç›¸åŒã€‚</p>

<!-- - [éšè—\_\_autoreleasing å±æ€§å˜é‡(NSError \*\*)å¼•èµ·çš„ EXC_BAD_ACCESS å´©æºƒ](https://www.jianshu.com/p/b16f36e98baf) -->

<h3 id="ç†è§£-nscopying-åè®®">ç†è§£ NSCopying åè®®</h3>

<pre><code class="language-objectivec">@protocol NSCopying
- (id)copyWithZone:(nullable NSZone *)zone;
@end

@protocol NSMutableCopying
- (id)mutableCopyWithZone:(nullable NSZone *)zone;
@end
</code></pre>

<p>å½“æˆ‘ä»¬è°ƒç”¨ä¸€ä¸ªå¯¹è±¡çš„ <code>copy</code> / <code>mutableCopy</code> æ–¹æ³•æ—¶ï¼Œè¯¥ç±»å¿…é¡»å®ç° <code>NSCopying</code> / <code>NSMutableCopying</code> åè®®ä¸­çš„å”¯ä¸€æ–¹æ³•ï¼ŒæŒ‡å®šè¯¥ç±»å®ä¾‹å¯¹è±¡çš„æ‹·è´é€»è¾‘ï¼Œè€Œ <code>copy</code> / <code>mutableCopy</code> æœ¬èº«ç”± <code>NSObject</code> å®ç°ã€‚è¿™é‡Œçš„ <code>NSZone</code> å®˜æ–¹è§£é‡Šæ˜¯ã€ŒA type used to identify and manage memory zonesã€ï¼Œå³ç”¨æ¥è¯†åˆ«å’Œç®¡ç†å†…å­˜åŒºåŸŸçš„ç±»å‹ï¼Œä½†ç›®å‰å·²ç»åŸºæœ¬åºŸå¼ƒï¼Œæ— éœ€å…³å¿ƒï¼ˆZones are ignored on iOS and 64-bit runtime in macOS. You should not use zones in current development. - Apple Developerï¼‰ã€‚ä¸ºäº†ä¿æŒå’Œç³»ç»Ÿæä¾›ç±»è¡Œä¸ºä¸€è‡´ï¼Œçº¦å®š <code>copy</code> å°†æ€»æ˜¯è¿”å›ä¸å¯å˜ç‰ˆæœ¬ï¼Œè€Œ <code>mutableCopy</code> æ€»æ˜¯è¿”å›å¯å˜ç‰ˆæœ¬ï¼Œä¸è°ƒç”¨è€…çš„ç±»å‹æ— å…³ï¼ˆæˆ–è€…å¯æä¾›ä¸€ä¸ª <code>immutableCopy</code> çš„æ–¹æ³•åŒºåˆ†ï¼‰ã€‚</p>

<!-- http://cocoadev.com/wiki/NSZone -->

<p>æµ…æ‹·è´ï¼ˆShallow Copyï¼‰å’Œæ·±æ‹·è´ï¼ˆDeep Copyï¼‰é’ˆå¯¹äºä½¿ç”¨æŒ‡é’ˆæˆ–åœ°å€æŒ‡å‘çš„ç±»å‹ï¼Œå‰è€…ä»…ä»…æ‹·è´æŒ‡å‘åœ°å€ï¼Œè€Œåè€…åˆ™æ˜¯å°†æŒ‡å‘çš„æ•°æ®ä¹Ÿæ‹·è´ä¸€ä»½è‡³æ–°çš„å†…å­˜åœ°å€ã€‚<code>Foundation</code> ä¸­çš„é›†åˆç±»å‹é»˜è®¤æ‰§è¡Œæµ…æ‹·è´ï¼ˆå› ä¸ºé›†åˆç±»å‹å†…éƒ¨çš„å±æ€§å¹¶ä¸ä¸€å®šéƒ½èƒ½æ‹·è´ï¼‰ï¼Œå› æ­¤è‡ªå®šä¹‰ç±»ä¸­æˆ‘ä»¬ä¹Ÿé»˜è®¤æ˜¯æµ…æ‹·è´ï¼Œå¿…è¦æ—¶å®šä¹‰ç±»ä¼¼ <code>deepCoby</code> æ–¹æ³•ã€‚</p>

<pre><code class="language-objectivec">@interface Rectangle : NSObject
@property (nonatomic, assign, readonly) double width;
@property (nonatomic, readonly) double height;
@property (nonatomic, strong, readonly) NSArray&lt;Rectangle *&gt; *array;

- (void)addElement:(Rectangle *)element;
- (void)removeElement:(Rectangle *)element;
@end

@interface Rectangle ()
@property (nonatomic, assign, readwrite) double width;
@property (nonatomic, assign) double height;
@property (nonatomic, strong) NSString *rect;
@end

@implementation Rectangle {
    NSMutableArray *_mutableArray;
}

- (NSArray *)array {
    return [_mutableArray copy];
}

- (void)addElement:(Rectangle *)element {
    [_mutableArray addObject:element];
}

- (void)removeElement:(Rectangle *)element {
    [_mutableArray removeObject:element];
}

- (instancetype)initWithWidth:(double)width height:(double)height {
    self = [super init];
    if (self) {
        _width = width;
        _height = height;
        _mutableArray = [NSMutableArray new];
    }
    return self;
}

- (id)copyWithZone:(nullable NSZone *)zone {
    Rectangle *rect = [[Rectangle allocWithZone:zone] initWithWidth:_width height:_height];
    rect-&gt;_mutableArray = [[NSMutableArray alloc] initWithArray:_mutableArray copyItems:YES];
//    rect-&gt;_mutableArray = [_mutableArray mutableCopy];
    return rect;
}
@end

Rectangle *rect = [[Rectangle alloc] initWithWidth:5.0 height:5.0];
Rectangle *rect1 = [[Rectangle alloc] initWithWidth:10.0 height:10.0];

[rect1 addElement:rect];

Rectangle *rect2 = [rect1 copy];

NSLog(@&quot;%@&quot;, [rect1 array]);
NSLog(@&quot;%@&quot;, [rect2 array]);

// OUTPUT:
// æ·±æ‹·è´ï¼ˆé›†åˆå†…éƒ¨å…ƒç´ ä¸ºæ–°å…ƒç´ ï¼‰
// (
//     &quot;&lt;Rectangle: 0x6000022f9c20&gt;&quot;
// )
// (
//     &quot;&lt;Rectangle: 0x6000022f9ad0&gt;&quot;
// )
// æµ…æ‹·è´ï¼ˆé›†åˆå†…éƒ¨å…ƒç´ ä»ä¸ºåŸé›†åˆï¼‰
// (
//     &quot;&lt;Rectangle: 0x600000328ff0&gt;&quot;
// )
// (
//     &quot;&lt;Rectangle: 0x600000328ff0&gt;&quot;
// )
</code></pre>

<h2 id="åè®®ä¸åˆ†ç±»">åè®®ä¸åˆ†ç±»</h2>

<h3 id="é€šè¿‡å§”æ‰˜ä¸æ•°æ®æºåè®®è¿›è¡Œå¯¹è±¡é—´é€šä¿¡">é€šè¿‡å§”æ‰˜ä¸æ•°æ®æºåè®®è¿›è¡Œå¯¹è±¡é—´é€šä¿¡</h3>

<p>ä¸ºäº†é¿å…å¾ªç¯å¼•ç”¨ï¼ˆRetain Cycleï¼‰ï¼Œéµå®ˆä»£ç†ï¼ˆDelegateï¼‰åè®®å¯¹è±¡çš„å†…å­˜ç®¡ç†è¯­ä¹‰éœ€è®¾ç½®ä¸º <code>weak</code> æˆ– <code>unsafe_unretained</code>ï¼ˆå…³äºä¸¤è€…åŒºåˆ«è¯¦è§æœ¬æ–‡ã€Šç†è§£ã€Œå±æ€§ã€è¿™ä¸€æ¦‚å¿µã€‹ä¸€èŠ‚ï¼‰ï¼Œè€Œé <code>strong</code>ã€‚ä»£ç†åè®®ä¸­çš„æ–¹æ³•é€šå¸¸åªä¼šåœ¨ç±»å†…éƒ¨ä½¿ç”¨ï¼Œå› æ­¤å¯ä»¥åœ¨ Class-Continuation åˆ†ç±»ï¼ˆClass-Continuation Categoryï¼‰å£°æ˜å®ç°å³å¯ã€‚ä»£ç†åè®®ä¸­çš„æ–¹æ³•é€šå¸¸ä½¿ç”¨ <code>@optional</code> æ ‡è®°ä¸ºå¯é€‰ï¼Œå› ä¸ºéµå®ˆä»£ç†åè®®çš„å¯¹è±¡å¹¶éä¸€å®šå…³å¿ƒå…¶ä¸­æ‰€æœ‰çš„æ–¹æ³•ï¼Œæ‰€ä»¥åœ¨è°ƒç”¨å›ä»£ç†ä¸Šçš„æ–¹æ³•æ—¶ä¸€å®šè¦å…ˆä½¿ç”¨ç±»å‹ä¿¡æ¯æŸ¥è¯¢æ–¹æ³•è¿›è¡Œç¡®è®¤ï¼Œä¸ºäº†é¿å…é‡å¤æ€§è°ƒç”¨æŸ¥è¯¢æ–¹æ³•ï¼Œå¯ä½¿ç”¨ä½åŸŸæ¥ç¼“å­˜ç»“æœï¼Œå…³äºä½åŸŸå¯è¯¦è§<a href="../bit_field_union_in_cpp/">ã€ŠC/C++ ä¸­çš„ä½åŸŸä¸å…±ç”¨ä½“ã€‹</a>ä¸€æ–‡ã€‚ä»£ç†åè®®ä¸­çš„æ–¹æ³•é€šå¸¸å°†è°ƒç”¨è€…æœ¬èº«ä½œä¸ºå‚æ•°ä¼ å›ï¼Œä»¥ä¾¿æ ¹æ®ä¸åŒçš„è°ƒç”¨è€…æ‰§è¡Œä¸åŒçš„é€»è¾‘ã€‚æ•°æ®æºï¼ˆDataSourceï¼‰ä¸­ï¼Œæ•°æ®ä»ä»£ç†å¯¹è±¡ä¸­æµå‘ç±»ï¼›è€Œè°ƒç”¨è€…ä¸­ï¼Œæ•°æ®ä»è°ƒç”¨è€…ä¸­æµå‡ºè‡³ä»£ç†å¯¹è±¡ï¼š</p>

<pre><code class="language-objectivec">#import &quot;ViewController.h&quot;

@class Foo;
@protocol FooDelegate &lt;NSObject&gt;

@optional
- (void)foo:(Foo *)foo willLog:(NSString *)content;
- (void)foo:(Foo *)foo didLog:(NSString *)content;
@end

@protocol FooDataSource &lt;NSObject&gt;
@required
- (NSString *)logContent;
@end


@interface Foo : NSObject {
    // ä½åŸŸ
    struct {
        unsigned int willLog :1;
        unsigned int didLog  :1;
    } _delegateFlags;
}
// å£°æ˜ä¸º weak
@property (nonatomic, weak) id &lt;FooDelegate&gt; delegate;
@property (nonatomic, weak) id &lt;FooDataSource&gt; dataSource;

- (void)refresh;
@end

@implementation Foo
- (void)setDelegate:(id&lt;FooDelegate&gt;)delegate {
    _delegate = delegate;

    // é¿å…å¤šæ¬¡è°ƒç”¨ respondsToSelector:
    _delegateFlags.willLog = [_delegate respondsToSelector:@selector(foo:willLog:)];
    _delegateFlags.didLog = [_delegate respondsToSelector:@selector(foo:didLog:)];
}

- (void)refresh {
    // æ•°æ®æºï¼ˆDataSourceï¼‰ï¼šæ•°æ® -&gt; è°ƒç”¨è€…
    NSString *content = [self.dataSource logContent];

    // æ£€æŸ¥ä»£ç†æ˜¯å¦å®ç°å¯é€‰åè®®
    if ([_delegate respondsToSelector:@selector(foo:willLog:)]) {
        // ä»£ç†ï¼ˆDelegateï¼‰ï¼šæ•°æ® -&gt; ä»£ç†å¯¹è±¡
        [_delegate foo:self willLog:content];
    }

    NSLog(@&quot;--------------------&quot;);
    NSLog(@&quot;%@&quot;, content);
    NSLog(@&quot;--------------------&quot;);

    if (_delegateFlags.didLog) {
        [_delegate foo:self didLog:content];
    }
}
@end

@interface ViewController () &lt;FooDelegate, FooDataSource&gt;
@property (nonatomic, strong) Foo *foo;
@property (nonatomic, strong) Foo *foo2;
@end

@implementation ViewController

- (void)viewDidLoad {
    [super viewDidLoad];
    // Do any additional setup after loading the view.

    self.foo = [[Foo alloc] init];
    self.foo2 = [[Foo alloc] init];

    self.foo.delegate = self;
    self.foo.dataSource = self;

    self.foo2.delegate = self;
    self.foo2.dataSource = self;

    [self.foo refresh];
}

- (void)foo:(Foo *)foo willLog:(NSString *)content {
    if (foo == _foo) {
        NSLog(@&quot;foo - willLog - [%@]&quot;, content);
    } else if (foo == _foo2) {
        NSLog(@&quot;foo2 - willLog - [%@]&quot;, content);
    }
}

- (void)foo:(Foo *)foo didLog:(NSString *)content {
    NSLog(@&quot;willLog - [%@]&quot;, content);
}

- (NSString *)logContent {
    return @&quot;https://kingcos.me&quot;;
}

@end

// OUTPUT:
// foo - willLog - [https://kingcos.me]
// --------------------
// https://kingcos.me
// --------------------
// willLog - [https://kingcos.me]
</code></pre>

<h3 id="å°†ç±»çš„å®ç°ä»£ç åˆ†æ•£åˆ°ä¾¿äºç®¡ç†çš„æ•°ä¸ªåˆ†ç±»ä¹‹ä¸­">å°†ç±»çš„å®ç°ä»£ç åˆ†æ•£åˆ°ä¾¿äºç®¡ç†çš„æ•°ä¸ªåˆ†ç±»ä¹‹ä¸­</h3>

<p>ä½¿ç”¨åˆ†ç±»æœºåˆ¶å¯ä»¥å°†ç±»çš„å®ç°ä»£ç åˆ†æˆä¸åŒçš„åŠŸèƒ½å—ã€‚æ¯”å¦‚ <code>NSURLRequest</code> ç±»æä¾›å‘ URL è¯·æ±‚çš„åŠŸèƒ½ï¼Œä½†ä»å…¶å‘½åä¸­å¹¶ä¸å¾—çŸ¥å…¶ä½¿ç”¨çš„å…·ä½“åè®®ï¼Œè€Œ HTTP ç›¸å…³çš„æ–¹æ³•å®šä¹‰åœ¨ <code>NSURLRequest</code> çš„ <code>NSHTTPURLRequest</code> åˆ†ç±»ä¸­ã€‚<code>NSURLRequest</code> ä¸­å°è£…äº†ä¸€å¥—æ“ä½œ <code>CFURLRequest</code> æ•°æ®ç»“æ„æ‰€éœ€çš„ C å‡½æ•°ï¼Œä¸” Obj-C å¹¶ä¸æ”¯æŒæ–¹æ³•çš„è®¿é—®æ§åˆ¶ä¿®é¥°ç¬¦ï¼Œå°† <code>NSHTTPURLRequest</code> å®šä¹‰ä¸ºå­ç±»ä¹Ÿä¸ç”šæ–¹ä¾¿ã€‚å®šä¹‰åœ¨åˆ†ç±»ä¸­çš„æ–¹æ³•ç¬¦å·ä¼šå¸¦æœ‰åˆ†ç±»ä¿¡æ¯ï¼Œä¾¿äº Debugã€‚é€šå¸¸ï¼Œæˆ‘ä»¬å°†æ— éœ€æš´éœ²åœ¨å¤–ç•Œçš„æ–¹æ³•å®šä¹‰åœ¨å¸¦æœ‰ <code>Private</code> çš„åˆ†ç±»ä¸­ï¼Œè¿™æ ·å³ä½¿å‡ºç°é—®é¢˜ä¹Ÿèƒ½è¾“å‡º <code>Private</code> ç›¸å…³çš„ä¿¡æ¯ã€‚</p>

<h3 id="æ€»æ˜¯ä¸ºç¬¬ä¸‰æ–¹çš„åˆ†ç±»åç§°åŠ å‰ç¼€">æ€»æ˜¯ä¸ºç¬¬ä¸‰æ–¹çš„åˆ†ç±»åç§°åŠ å‰ç¼€</h3>

<h2 id="reference">Reference</h2>

<ul>
<li><a href="../ivar_access_control_in_obj-c/">Obj-C ä¸­å®ä¾‹å˜é‡å’Œç±»çš„è®¿é—®æ§åˆ¶ - kingcos</a></li>
<li><a href="https://stackoverflow.com/questions/17668018/when-to-use-uikit-extern-vs-just-extern">When to use UIKIT_EXTERN vs just extern - StackOverflow</a></li>
<li><a href="../objc_msgsend">æµ…å° objc_msgSend - kingcos</a></li>
<li><a href="../objects_in_obj-c/">Obj-C ä¸­çš„å¯¹è±¡ - kingcos</a></li>
<li><a href="../type_introspection_and_reflection/">Obj-C &amp; Swift çš„ç±»å‹å†…çœä¸åå°„ - kingcos</a></li>
<li><a href="https://developer.apple.com/documentation/foundation/nszone?language=objc">NSZone - Apple Developer</a></li>
<li><a href="../bit_field_union_in_cpp/">C/C++ ä¸­çš„ä½åŸŸä¸å…±ç”¨ä½“ - kingcos</a></li>
</ul>

    </div>
    
      <div class="pagination">
        <div class="pagination__title">
          <span class="pagination__title-h">Read other posts</span>
          <hr />
        </div>
        <div class="pagination__buttons">
          
            <span class="button previous">
              <a href="/posts/2019/category_in_ios/">
                <span class="button__icon">â†</span>
                <span class="button__text">iOS ä¸­çš„ Category</span>
              </a>
            </span>
          
          
            <span class="button next">
              <a href="/posts/2019/objc_msgsend/">
                <span class="button__text">æµ…å° objc_msgSend</span>
                <span class="button__icon">â†’</span>
              </a>
            </span>
          
        </div>
      </div>
    

    

    
    
    <div>
      <div id="github-comment">
      </div>

      <script type="text/javascript">
        function getUtterances(isDark) {
          var utterances = document.createElement('script');
          utterances.type = 'text/javascript';
          utterances.async = true;
          utterances.setAttribute('issue-term', "pathname")
          utterances.setAttribute('repo', "kingcos\/kingcos.github.io")
          utterances.setAttribute('label', "comments")
          isDark ? utterances.setAttribute('theme', "github-dark") : utterances.setAttribute('theme', "github-light")
          utterances.crossorigin = 'anonymous';
          utterances.src = 'https://utteranc.es/client.js';

          return utterances
        }

        var themeToggle = document.querySelector(".theme-toggle")
        themeToggle.addEventListener("click", function () {
          var getTheme = window.localStorage && window.localStorage.getItem("theme")
          var divNode = document.getElementById('github-comment')
          while(divNode.hasChildNodes()) {
            divNode.removeChild(divNode.firstChild);
          }
          
          
          

          
          
          
          
          
          
          document.getElementById('github-comment').appendChild(getUtterances(getTheme !== "dark"))
        })

        var getTheme = window.localStorage && window.localStorage.getItem("theme")
        document.getElementById('github-comment').appendChild(getUtterances(getTheme === "dark"))
      </script>
    </div>
    

    </div>

      </div>

      
        <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright copyright--user">All rights reserved by kingcos.me</div>
    
  </div>
</footer>

<script src="/assets/main.js"></script>
<script src="/assets/prism.js"></script>


      
    </div>

    
      
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-138311951-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

    
  </body>
</html>
