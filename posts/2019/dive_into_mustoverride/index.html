<!DOCTYPE html>
<html lang="en">
  <head>
    
      <title>MustOverride æºç è§£è¯» :: iBlog</title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content="Date Notes Source Code Commit / Tag     2019-12-07 é¦–æ¬¡æäº¤ nicklockwood/MustOverride c63007e / 1.1    Preface MustOverride æ˜¯ nicklockwood å¤šå¹´å‰å¼€æºçš„ä¸€ä¸ª Obj-C åº“ã€‚å…¶ä½œç”¨æ­£å¦‚å…¶åã€ŒMustOverrideã€å³å¯ä»¥ä½¿å¾—å­ç±»å¿…é¡»é‡å†™çˆ¶ç±»ä¸­çš„æŸäº›æ–¹æ³•ï¼Œé˜²æ­¢å­ç±»å› æœªå®ç°çˆ¶ç±»çš„æŸäº›æ–¹æ³•è€Œå‡ºç°ä¸å¯é¢„çŸ¥çš„é”™è¯¯ã€‚
How è¿™ä¸ªåº“çš„ä½¿ç”¨éå¸¸ç®€å•ï¼Œå¦‚æœæ˜¯ CocoaPods ç®¡ç†ä¾èµ–çš„é¡¹ç›®ï¼Œç›´æ¥é€šè¿‡ pod &#39;MustOverride&#39; å³å¯å¼•å…¥ï¼›ä¹‹åå¼•å…¥ MustOverride.h å¤´æ–‡ä»¶å¹¶åœ¨éœ€è¦å¿…é¡»å­ç±»é‡å†™çš„çˆ¶ç±»ï¼ˆæˆ–çˆ¶ç±»çš„åˆ†ç±»ï¼‰æ–¹æ³•ä¸­æ”¾å…¥ SUBCLASS_MUST_OVERRIDE; å®å³å¯ï¼š
// Foo.m  #import &amp;#34;Foo.h&amp;#34;#import &amp;#34;MustOverride.h&amp;#34; @implementation Foo - (void)foo { SUBCLASS_MUST_OVERRIDE; } @end // Foo&#43;Ext.m  #import &amp;#34;Foo&#43;Ext.h&amp;#34;#import &amp;#34;MustOverride.h&amp;#34; @implementation Foo (Ext) - (void)fooExt { SUBCLASS_MUST_OVERRIDE; } @end è¿™æ ·ï¼Œå³ä½¿ Foo çˆ¶ç±»åŠ SubFoo å­ç±»çš„æ–¹æ³•æ²¡æœ‰è¢«è°ƒç”¨åˆ°ï¼Œåªè¦å­ç±»æ²¡æœ‰å®ç°ç›¸åº”çš„æ–¹æ³•ï¼Œç¨‹åºä¹Ÿä¼šåœ¨å¯åŠ¨æ—¶ç«‹åˆ»å´©æºƒï¼Œä¾¿äºç¬¬ä¸€æ—¶é—´å‘ç°é—®é¢˜ï¼š"/>
<meta name="keywords" content="kingcos.me,maimieng.comios,swift,objective-c,obj-c,objc,oc,geek,python,ruby,golang,go,apple,mac"/>
<meta name="robots" content="noodp"/>
<link rel="canonical" href="/posts/2019/dive_into_mustoverride/" />





<link rel="stylesheet" href="/assets/style.css">


<link rel="stylesheet" href="/style.css">


<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/img/apple-touch-icon-144-precomposed.png">
<link rel="shortcut icon" href="/img/favicon.png">


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="MustOverride æºç è§£è¯»"/>
<meta name="twitter:description" content="[MustOverride](https://github.com/nicklockwood/MustOverride) æ˜¯ [nicklockwood](https://github.com/nicklockwood) å¤šå¹´å‰å¼€æºçš„ä¸€ä¸ª Obj-C åº“ã€‚å…¶ä½œç”¨æ­£å¦‚å…¶åã€ŒMustOverrideã€å³å¯ä»¥ä½¿å¾—å­ç±»å¿…é¡»é‡å†™çˆ¶ç±»ä¸­çš„æŸäº›æ–¹æ³•ï¼Œé˜²æ­¢å­ç±»å› æœªå®ç°çˆ¶ç±»çš„æŸäº›æ–¹æ³•è€Œå‡ºç°ä¸å¯é¢„çŸ¥çš„é”™è¯¯ã€‚"/>



<meta property="og:title" content="MustOverride æºç è§£è¯»" />
<meta property="og:description" content="[MustOverride](https://github.com/nicklockwood/MustOverride) æ˜¯ [nicklockwood](https://github.com/nicklockwood) å¤šå¹´å‰å¼€æºçš„ä¸€ä¸ª Obj-C åº“ã€‚å…¶ä½œç”¨æ­£å¦‚å…¶åã€ŒMustOverrideã€å³å¯ä»¥ä½¿å¾—å­ç±»å¿…é¡»é‡å†™çˆ¶ç±»ä¸­çš„æŸäº›æ–¹æ³•ï¼Œé˜²æ­¢å­ç±»å› æœªå®ç°çˆ¶ç±»çš„æŸäº›æ–¹æ³•è€Œå‡ºç°ä¸å¯é¢„çŸ¥çš„é”™è¯¯ã€‚" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/2019/dive_into_mustoverride/" />
<meta property="article:published_time" content="2019-12-07T00:00:00+00:00" />
<meta property="article:modified_time" content="2019-12-07T00:00:00+00:00" /><meta property="og:site_name" content="iBlog" />




<script data-ad-client="ca-pub-9925978992661955" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

  </head>
  <body class="dark-theme">
    <div class="container">
      <header class="header">
  <span class="header__inner">
    <a href="/" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367"/>
</svg>
</span>
    <span class="logo__text">kingcos.me</span>
    <span class="logo__cursor"></span>
  
</a>

    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/about">About</a></li>
        
      
        
          <li><a href="/links">Links</a></li>
        
      
        
          <li><a href="/perspective">Perspective</a></li>
        
      
        
          <li><a href="/words">Words</a></li>
        
      
      
    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/about">About</a></li>
      
    
      
        <li><a href="/links">Links</a></li>
      
    
      
        <li><a href="/perspective">Perspective</a></li>
      
    
      
        <li><a href="/words">Words</a></li>
      
    
  </ul>
</nav>

        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none"/>
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
          </svg>
        </span>
      
      <span class="theme-toggle">
        <svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>

      </span>
    </span>
  </span>
</header>


      <div class="content">
        
  <div class="post">
    <h2 class="post-title"><a href="/posts/2019/dive_into_mustoverride/">MustOverride æºç è§£è¯»</a></h2>
    <div class="post-meta">
      
        <span class="post-date">
            2019-12-07
        </span>
      
      
      
        <span class="post-read-time">â€” 9 min read</span>
      
    </div>

    
      <span class="post-tags">
        
          #<a href="/tags/focus/">Focus</a>&nbsp;
        
          #<a href="/tags/obj-c/">Obj-C</a>&nbsp;
        
          #<a href="/tags/c/c&#43;&#43;/">C/C&#43;&#43;</a>&nbsp;
        
          #<a href="/tags//">ğŸŒŸ</a>&nbsp;
        
      </span>
    

    

    <div class="post-content">
      <table>
<thead>
<tr>
<th align="center">Date</th>
<th align="center">Notes</th>
<th align="center">Source Code</th>
<th align="center">Commit / Tag</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">2019-12-07</td>
<td align="center">é¦–æ¬¡æäº¤</td>
<td align="center"><a href="https://github.com/nicklockwood/MustOverride">nicklockwood/MustOverride</a></td>
<td align="center">c63007e / 1.1</td>
</tr>
</tbody>
</table>
<p><img src="/img/2019/dive_into_mustoverride/0.png" alt="0"></p>
<h2 id="preface">Preface</h2>
<p><a href="https://github.com/nicklockwood/MustOverride">MustOverride</a> æ˜¯ <a href="https://github.com/nicklockwood">nicklockwood</a> å¤šå¹´å‰å¼€æºçš„ä¸€ä¸ª Obj-C åº“ã€‚å…¶ä½œç”¨æ­£å¦‚å…¶åã€ŒMustOverrideã€å³å¯ä»¥ä½¿å¾—å­ç±»å¿…é¡»é‡å†™çˆ¶ç±»ä¸­çš„æŸäº›æ–¹æ³•ï¼Œé˜²æ­¢å­ç±»å› æœªå®ç°çˆ¶ç±»çš„æŸäº›æ–¹æ³•è€Œå‡ºç°ä¸å¯é¢„çŸ¥çš„é”™è¯¯ã€‚</p>
<h2 id="how">How</h2>
<p>è¿™ä¸ªåº“çš„ä½¿ç”¨éå¸¸ç®€å•ï¼Œå¦‚æœæ˜¯ CocoaPods ç®¡ç†ä¾èµ–çš„é¡¹ç›®ï¼Œç›´æ¥é€šè¿‡ <code>pod 'MustOverride'</code> å³å¯å¼•å…¥ï¼›ä¹‹åå¼•å…¥ <code>MustOverride.h</code> å¤´æ–‡ä»¶å¹¶åœ¨éœ€è¦å¿…é¡»å­ç±»é‡å†™çš„çˆ¶ç±»ï¼ˆæˆ–çˆ¶ç±»çš„åˆ†ç±»ï¼‰æ–¹æ³•ä¸­æ”¾å…¥ <code>SUBCLASS_MUST_OVERRIDE;</code> å®å³å¯ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec"><span style="color:#75715e">// Foo.m
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#</span><span style="color:#75715e">import &#34;Foo.h&#34;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">import &#34;MustOverride.h&#34;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">@implementation</span> <span style="color:#a6e22e">Foo</span>
- (<span style="color:#66d9ef">void</span>)<span style="color:#a6e22e">foo</span> {
    SUBCLASS_MUST_OVERRIDE;
}
<span style="color:#66d9ef">@end</span>

<span style="color:#75715e">// Foo+Ext.m
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#</span><span style="color:#75715e">import &#34;Foo+Ext.h&#34;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">import &#34;MustOverride.h&#34;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">@implementation</span> <span style="color:#a6e22e">Foo</span> (Ext)
- (<span style="color:#66d9ef">void</span>)<span style="color:#a6e22e">fooExt</span> {
    SUBCLASS_MUST_OVERRIDE;
}
<span style="color:#66d9ef">@end</span>
</code></pre></div><p>è¿™æ ·ï¼Œå³ä½¿ <code>Foo</code> çˆ¶ç±»åŠ <code>SubFoo</code> å­ç±»çš„æ–¹æ³•æ²¡æœ‰è¢«è°ƒç”¨åˆ°ï¼Œåªè¦å­ç±»æ²¡æœ‰å®ç°ç›¸åº”çš„æ–¹æ³•ï¼Œç¨‹åºä¹Ÿä¼šåœ¨å¯åŠ¨æ—¶ç«‹åˆ»å´©æºƒï¼Œä¾¿äºç¬¬ä¸€æ—¶é—´å‘ç°é—®é¢˜ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">*** Terminating app due to uncaught exception <span style="color:#e6db74">&#39;NSInternalInconsistencyException&#39;</span>, reason: <span style="color:#e6db74">&#39;2 method override errors:
</span><span style="color:#e6db74">SubFoo does not implement required method -fooExt
</span><span style="color:#e6db74">SubFoo does not implement required method -foo&#39;</span>
</code></pre></div><h2 id="why">Why</h2>
<h3 id="heading">ç»“æ„</h3>
<p>ã€ŒMustOverrideã€åº“çš„ç»“æ„å¾ˆç®€å•ï¼Œåªæœ‰ä»¥ä¸‹ä¸¤ä¸ªæ–‡ä»¶ä»¥åŠä¸è¶…è¿‡ 200 è¡Œçš„ä»£ç ï¼Œå¾ˆå®¹æ˜“ç€æ‰‹ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">âœ  MustOverride tree
.
â”œâ”€â”€ MustOverride.h
â””â”€â”€ MustOverride.m

<span style="color:#ae81ff">0</span> directories, <span style="color:#ae81ff">2</span> files
</code></pre></div><h3 id="mustoverrideh">MustOverride.h</h3>
<p>æˆ‘ä»¬å…ˆä» <code>MustOverride.h</code> å¼€å§‹ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec"><span style="color:#75715e">// MustOverride.h
</span><span style="color:#75715e"></span>
<span style="color:#75715e">/**
</span><span style="color:#75715e"> * Include this macro inside any class or instance method that MUST be overridden
</span><span style="color:#75715e"> * by its subclass(es). The app will then crash immediately on launch with an
</span><span style="color:#75715e"> * assertion if the method is not overridden (even if it is never called).
</span><span style="color:#75715e"> */</span>
<span style="color:#75715e">#</span><span style="color:#75715e">define SUBCLASS_MUST_OVERRIDE __attribute__((used, section(&#34;__DATA,MustOverride&#34; \</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">))) static const char *__must_override_entry__ = __func__</span><span style="color:#75715e">
</span></code></pre></div><p>å…¶ä¸­å®šä¹‰äº†æˆ‘ä»¬å‰é¢ç¤ºä¾‹ä¸­æ‰€ç”¨åˆ°çš„ <code>SUBCLASS_MUST_OVERRIDE</code> å®ï¼Œå³ç®€åŒ–äº†åé¢çš„æŒ‡ä»¤ <code>__attribute__((used, section(&quot;__DATA,MustOverride&quot;))) static const char *__must_override_entry__ = __func__</code>ï¼Œä¸‹é¢æˆ‘ä»¬æ¥ä»”ç»†åˆ†æä¸‹è¿™æ¡æŒ‡ä»¤ã€‚</p>
<h4 id="--attribute--">__attribute__</h4>
<p><code>__attribute__</code> æ˜¯ä¸€ä¸ªç”¨äº GCC æˆ–å…¼å®¹ GCC çš„ç¼–è¯‘å™¨æŒ‡ä»¤ï¼Œå¯ä»¥è®©å¼€å‘è€…å¯¹ç¼–è¯‘å™¨çš„ä¸€äº›å±æ€§è¿›è¡Œè®¾ç½®ï¼Œä½¿å¾—ç¼–è¯‘å™¨èƒ½å¤Ÿæ”¯æŒæ›´å¤šçš„é”™è¯¯æ£€æŸ¥æˆ–é«˜çº§ä¼˜åŒ–ç­‰æ“ä½œã€‚æ­£å¦‚å…¶åï¼Œ<code>__attribute__</code> å³å±æ€§ï¼Œå…¶æ ¹æ®ä¿®é¥°å¯¹è±¡çš„ä¸åŒåˆ†ä¸ºå‡½æ•°å±æ€§ã€å˜é‡å±æ€§ã€ç±»å‹å±æ€§ç­‰ã€‚å½“å¤šä¸ªå±æ€§åŒæ—¶ä½¿ç”¨æ—¶ï¼Œå¯ä»¥é€šè¿‡ <code>__attribute__ ((attribute-list))</code> è¯­æ³•åµŒå¥—ä½¿ç”¨ã€‚</p>
<p>ç›®å‰ Xcode ä½¿ç”¨ <code>clang</code> ç¼–è¯‘å™¨æ¥ç¼–è¯‘ C/C++/Obj-C/Obj-C++ ä»£ç ï¼Œè€Œ <code>clang</code> ä¹Ÿæ”¯æŒäº† <code>__attribute__</code> è¯­æ³•ï¼Œç”šè‡³è¿˜æœ‰ä¸€å°éƒ¨åˆ†çš„ç‰¹æœ‰å±æ€§ï¼Œå…³äºè¿™äº›ç‰¹æœ‰å±æ€§å¯ä»¥è¯¦è§æ–‡æœ« Reference ä¸­çš„ã€ŠAttributes in Clang - LLVMã€‹æ–‡æ¡£ã€‚è€Œè¿™é‡Œçš„ <code>__attribute__((used, section(&quot;__DATA,MustOverride&quot;)))</code> åŒæ—¶ä½¿ç”¨äº† <code>used</code> å’Œ <code>section</code> è¿™ä¸¤ä¸ªå¸¸è§çš„å˜é‡å±æ€§ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ GNU å®˜æ–¹æ–‡æ¡£ä¸­æŸ¥åˆ°ä¸¤è€…çš„å†…å®¹ï¼š</p>
<blockquote>
<p><code>used</code></p>
<p>This attribute, attached to a variable with static storage, means that the variable must be emitted even if it appears that the variable is not referenced.</p>
<p>When applied to a static data member of a C++ class template, the attribute also means that the member is instantiated if the class itself is instantiated.</p>
</blockquote>
<p>åœ¨ã€Š<a href="https://kingcos.me/posts/2019/const_static_extern_in_cpp/">C/C++ ä¸­çš„ constã€static &amp; extern</a>ã€‹ä¸€æ–‡ä¸­ï¼Œæˆ‘ä»¬æ›¾ç»è¯´è¿‡é™æ€å˜é‡åªåœ¨å…¶ç¼–è¯‘å•å…ƒå†…å¯è§ï¼Œæœ€ç»ˆå¯æ‰§è¡Œæ–‡ä»¶ä¸­çš„å¤–éƒ¨ç¬¦å·é‡Œå¹¶ä¸ä¼šå­˜åœ¨é™æ€å˜é‡çš„ç¬¦å·ï¼Œè€Œå…¶å®å¦‚æœç¼–è¯‘å•å…ƒå†…æ ¹æœ¬æ²¡æœ‰ä½¿ç”¨åˆ°æŸä¸€é™æ€å˜é‡ï¼Œç¼–è¯‘å™¨é»˜è®¤ä¼šæç¤ºè­¦å‘Šå¹¶å°†è¯¥é™æ€å˜é‡è¿›è¡Œä¼˜åŒ–ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec"><span style="color:#75715e">#</span><span style="color:#75715e">import &lt;Foundation</span><span style="color:#75715e">/</span><span style="color:#75715e">Foundation.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// WARNING: Unused variable &#39;var1&#39;
</span><span style="color:#75715e"></span><span style="color:#66d9ef">static</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>var1 <span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">kingcos.me</span><span style="color:#e6db74">&#34;</span>;

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span> argv[]) {
    <span style="color:#66d9ef">@autoreleasepool</span> {
        <span style="color:#75715e">// printf(&#34;%s\n&#34;, var1);
</span><span style="color:#75715e"></span>    }
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
}
</code></pre></div><p>æ¯”å¦‚æ­¤æ—¶çš„ <code>var1</code> ä»…å£°æ˜å¹¶å®šä¹‰ä½†å¹¶æ²¡æœ‰ä»£ç ä½¿ç”¨åˆ°ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>nm PATH/TO/MustOverrideDemo | grep var</code> å‘½ä»¤å‘ç°å¯æ‰§è¡Œæ–‡ä»¶ä¸å­˜åœ¨è¯¥é™æ€å˜é‡çš„ç¬¦å·ã€‚è€Œå¦‚æœæˆ‘ä»¬å°† <code>main</code> å‡½æ•°ä¸­çš„æ³¨é‡Šæ‰“å¼€ï¼Œæ­¤æ—¶å¯æ‰§è¡Œæ–‡ä»¶ä¸­æ‰ä¼šå«æœ‰è¯¥ç¬¦å·ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">âœ  MustOverride nm PATH/TO/MustOverrideDemo | grep var
00000001000036e8 d _var1
</code></pre></div><p>è€Œ <code>__attribute__((used))</code> å˜é‡å±æ€§æ­£æ˜¯å¯ä»¥å°†ç¼–è¯‘å™¨å¯¹äºæœªä½¿ç”¨çš„é™æ€å˜é‡çš„ä¼˜åŒ–å…³é—­ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec"><span style="color:#75715e">#</span><span style="color:#75715e">import &lt;Foundation</span><span style="color:#75715e">/</span><span style="color:#75715e">Foundation.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">static</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>var1 <span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">kingcos.me</span><span style="color:#e6db74">&#34;</span>;
__attribute__((used)) <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>var2 <span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">kingcos.me</span><span style="color:#e6db74">&#34;</span>;
<span style="color:#66d9ef">static</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>var3 <span style="color:#a6e22e">__attribute__</span>((used)) <span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">kingcos.me</span><span style="color:#e6db74">&#34;</span> ;

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span> argv[]) {
    <span style="color:#66d9ef">@autoreleasepool</span> {
        <span style="color:#75715e">// printf(&#34;%s\n&#34;, var1);
</span><span style="color:#75715e"></span>    }
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
}

<span style="color:#75715e">// SHELL OUTPUT:
</span><span style="color:#75715e"></span><span style="color:#75715e">// âœ  MustOverride nm PATH/TO/MustOverrideDemo | grep var
</span><span style="color:#75715e"></span><span style="color:#75715e">// 00000001000036d8 d _var2
</span><span style="color:#75715e"></span><span style="color:#75715e">// 00000001000036e0 d _var3
</span></code></pre></div><p>å› æ­¤ <code>__attribute__((used)) static const char *__must_override_entry__ = __func__</code> å³å£°æ˜ä¸€ä¸ªé™æ€å¸¸é‡ <code>__must_override_entry__</code> ä¸º <code>__func__</code>ï¼ˆç¼–è¯‘å™¨çš„é¢„å®šä¹‰ç¬¦ï¼Œå³å‡½æ•°åï¼‰ï¼Œå¹¶ä¿è¯å…¶ä¸ä¼šè¢«ç¼–è¯‘å™¨ä¼˜åŒ–ã€‚</p>
<blockquote>
<p><code>section (&quot;section-name&quot;)</code></p>
<p>Normally, the compiler places the objects it generates in sections like <code>data</code> and <code>bss</code>. Sometimes, however, you need additional sections, or you need certain particular variables to appear in special sections, for example to map to special hardware. The section attribute specifies that a variable (or function) lives in a particular section. For example, this small program uses several specific section names:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#66d9ef">struct</span> duart a <span style="color:#a6e22e">__attribute__</span> ((section (<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">DUART_A</span><span style="color:#e6db74">&#34;</span>))) <span style="color:#f92672">=</span> { <span style="color:#ae81ff">0</span> };
<span style="color:#66d9ef">struct</span> duart b <span style="color:#a6e22e">__attribute__</span> ((section (<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">DUART_B</span><span style="color:#e6db74">&#34;</span>))) <span style="color:#f92672">=</span> { <span style="color:#ae81ff">0</span> };
<span style="color:#66d9ef">char</span> stack[<span style="color:#ae81ff">10000</span>] __attribute__ ((section (<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">STACK</span><span style="color:#e6db74">&#34;</span>))) <span style="color:#f92672">=</span> { <span style="color:#ae81ff">0</span> };
<span style="color:#66d9ef">int</span> init_data <span style="color:#a6e22e">__attribute__</span> ((section (<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">INITDATA</span><span style="color:#e6db74">&#34;</span>)));

main()
{
  <span style="color:#75715e">/* Initialize stack pointer */</span>
  init_sp (stack <span style="color:#f92672">+</span> <span style="color:#66d9ef">sizeof</span> (stack));

  <span style="color:#75715e">/* Initialize initialized data */</span>
  memcpy (<span style="color:#f92672">&amp;</span>init_data, <span style="color:#f92672">&amp;</span>data, <span style="color:#f92672">&amp;</span>edata <span style="color:#f92672">-</span> <span style="color:#f92672">&amp;</span>data);

  <span style="color:#75715e">/* Turn on the serial ports */</span>
  init_duart (<span style="color:#f92672">&amp;</span>a);
  init_duart (<span style="color:#f92672">&amp;</span>b);
}
</code></pre></div><p>Use the <code>section</code> attribute with <em>global</em> variables and not <em>local</em> variables, as shown in the example.</p>
<p>You may use the <code>section</code> attribute with initialized or uninitialized global variables but the linker requires each object be defined once, with the exception that uninitialized variables tentatively go in the <code>common</code> (or <code>bss</code>) section and can be multiply â€œdefinedâ€. Using the <code>section</code> attribute changes what section the variable goes into and may cause the linker to issue an error if an uninitialized variable has multiple definitions. You can force a variable to be initialized with the <code>-fno-common</code> flag or the <code>nocommon</code> attribute.</p>
<p>Some file formats do not support arbitrary sections so the <code>section</code> attribute is not available on all platforms. If you need to map the entire contents of a module to a particular section, consider using the facilities of the linker instead.</p>
</blockquote>
<p>ç¼–è¯‘å™¨é€šå¸¸ä¼šå°†ä¸åŒç±»å‹ï¼ˆæ³¨ï¼šæ­¤å¤„çš„ç±»å‹æŒ‡éç‹­ä¹‰çš„æ•°æ®ç»“æ„ç±»å‹ï¼‰çš„å˜é‡æ”¾ç½®åœ¨å¯æ‰§è¡Œæ–‡ä»¶å†…ä¸åŒä½†ç‰¹å®šçš„åŒºåŸŸä¸­ã€‚å¯¹äº iOS/macOS é¡¹ç›®çš„å¯æ‰§è¡Œæ–‡ä»¶ Mach-O å³æ”¾ç½®åœ¨ä¸åŒçš„æ®µï¼ˆSegmentï¼‰å’ŒèŠ‚ï¼ˆSectionï¼‰ä¸­ï¼Œæ¯”å¦‚å…¨å±€å˜é‡é€šå¸¸æ˜¯åœ¨æ•°æ®æ®µä¸­ã€‚è€Œ <code>__attribute__((section(&quot;name&quot;)))</code> ä½¿å¾—å¼€å‘è€…å¯ä»¥å°†ç‰¹å®šçš„å˜é‡å­˜å‚¨åœ¨è‡ªå®šä¹‰çš„æ®µå’ŒèŠ‚å†…ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec">__attribute__((section(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">__DATA,kingcos.me</span><span style="color:#e6db74">&#34;</span>))) <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>var4 <span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">kingcos.me</span><span style="color:#e6db74">&#34;</span>;
__attribute__((section(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">__DATA,maimieng.com</span><span style="color:#e6db74">&#34;</span>))) <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>var5 <span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">maimieng.com</span><span style="color:#e6db74">&#34;</span>;

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span> argv[]) {
    <span style="color:#66d9ef">@autoreleasepool</span> {
        printf(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#34;</span>, var4);
    }
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
}
</code></pre></div><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ MachOView æ¥æŸ¥çœ‹ Mach-O æ–‡ä»¶ä¸­çš„ä¿¡æ¯ï¼š</p>
<p><img src="/img/2019/dive_into_mustoverride/1.png" alt="1"></p>
<p>å…¶ä¸­ç¡®å®å­˜åœ¨äº† <code>__DATA</code> æ®µçš„ <code>kingcos.me</code> èŠ‚ï¼Œè€Œè¿™é‡Œ <code>var5</code> çš„èŠ‚å¹¶æ²¡æœ‰å­˜åœ¨ï¼Œè¿™æ˜¯å› ä¸ºç¼–è¯‘å™¨å·²ç»å°†è¯¥æœªä½¿ç”¨çš„é™æ€å˜é‡è¿›è¡Œäº†ä¼˜åŒ–ã€‚</p>
<p>å› æ­¤ <code>MustOverride.h</code> ä¸­å®šä¹‰äº† <code>SUBCLASS_MUST_OVERRIDE</code> å®ï¼Œå¹¶ç»“åˆäº†ä¸¤ä¸ªç¼–è¯‘å™¨çš„å˜é‡å±æ€§ï¼Œå°†ä½¿ç”¨åˆ°è¯¥å®çš„æ–¹æ³•åå­˜å‚¨åœ¨ <code>__must_override_entry__</code> é™æ€å¸¸é‡ä¸­ï¼Œå¹¶å°†è¯¥å¸¸é‡æœ€ç»ˆå­˜å‚¨åœ¨å¯æ‰§è¡Œæ–‡ä»¶çš„æ•°æ®æ®µ <code>MustOverride</code> èŠ‚ï¼Œå³ä¸º <code>#define SUBCLASS_MUST_OVERRIDE static const char *__must_override_entry__ __attribute__((used, section(&quot;__DATA,MustOverride&quot;))) = __func__;</code>ã€‚</p>
<p><img src="/img/2019/dive_into_mustoverride/2.png" alt="2"></p>
<h3 id="mustoverridem">MustOverride.m</h3>
<p>é‚£ä¹ˆå°†æ–¹æ³•åç‹¬ç«‹å­˜å‚¨åœ¨å¯æ‰§è¡Œæ–‡ä»¶çš„æ•°æ®æ®µ <code>MustOverride</code> èŠ‚æœ‰ä»€ä¹ˆæ„ä¹‰å‘¢ï¼Ÿè¿™å°±éœ€è¦ä» <code>MustOverride.m</code> å¼€å§‹ç€æ‰‹ã€‚</p>
<p><code>MustOverride.m</code> ä¸­å®šä¹‰äº† <code>MustOverride</code> ç±»ï¼Œä½†å…¶å®ç›®çš„åªæ˜¯ä¸ºäº†ä½¿ç”¨åˆ° <code>+load</code> æ–¹æ³•ï¼Œä½¿å¾—ç¨‹åºå¯åŠ¨æ—¶å¯ä»¥æ‰§è¡Œå…¶å®ƒå‡½æ•°ï¼Œæ˜¯è¯¥åº“çš„å…¥å£ï¼›å…¶ä¸­å…³äº <code>+load</code> æ–¹æ³•ï¼Œå¯è¯¦è§ã€Š<a href="../+load_in_ios/">iOS ä¸­çš„ +load æ–¹æ³•</a>ã€‹ä¸€æ–‡ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec"><span style="color:#75715e">// MustOverride.m
</span><span style="color:#75715e"></span>
+ (<span style="color:#66d9ef">void</span>)<span style="color:#a6e22e">load</span>
{
    CheckOverrides();
}
</code></pre></div><p>åœ¨ <code>MustOverride</code> çš„ <code>+load</code> æ–¹æ³•ä¸­è°ƒç”¨äº† <code>CheckOverrides()</code> C è¯­è¨€é™æ€å‡½æ•°ã€‚ä¸è¿‡åœ¨å…·ä½“è¯´æ˜è¯¥å…¥å£å‡½æ•°ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹å¦å¤–ä¸¤ä¸ªåœ¨ <code>CheckOverrides()</code> ä¸­ä½¿ç”¨åˆ°çš„è¾…åŠ©å‡½æ•°ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec"><span style="color:#75715e">// MustOverride.m
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// è¯¥ç±»æ˜¯å¦é‡å†™æŸä¸ªæ–¹æ³•ï¼ˆè¯¥ç±»æ˜¯å¦å®ç°æŸä¸ªæ–¹æ³•ï¼‰
</span><span style="color:#75715e"></span><span style="color:#66d9ef">static</span> <span style="color:#66d9ef">BOOL</span> <span style="color:#a6e22e">ClassOverridesMethod</span>(<span style="color:#66d9ef">Class</span> cls, <span style="color:#66d9ef">SEL</span> selector)
{
    <span style="color:#75715e">// å£°æ˜å­˜å‚¨æ–¹æ³•æ€»æ•°çš„å˜é‡
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span> numberOfMethods;
    <span style="color:#75715e">// è·å–è¯¥ç±»çš„æ–¹æ³•åˆ—è¡¨ï¼Œå¹¶è®¾ç½®æ–¹æ³•æ€»æ•°
</span><span style="color:#75715e"></span>    Method <span style="color:#f92672">*</span>methods <span style="color:#f92672">=</span> class_copyMethodList(cls, <span style="color:#f92672">&amp;</span>numberOfMethods);
    <span style="color:#75715e">// éå†è¯¥ç±»çš„æ‰€æœ‰æ–¹æ³•
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> numberOfMethods; i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>)
    {
        <span style="color:#75715e">// è‹¥æœ‰æ–¹æ³•ä¸å‚æ•°çš„æŸä¸ªæ–¹æ³•ä¸€è‡´ï¼Œåˆ™ä»£è¡¨è¯¥ç±»å®ç°äº†è¯¥æ–¹æ³•
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> (method_getName(methods[i]) <span style="color:#f92672">=</span><span style="color:#f92672">=</span> selector)
        {
            <span style="color:#75715e">// é‡Šæ”¾
</span><span style="color:#75715e"></span>            free(methods);
            <span style="color:#66d9ef">return</span> YES;
        }
    }
    <span style="color:#75715e">// é‡Šæ”¾
</span><span style="color:#75715e"></span>    free(methods);
    <span style="color:#66d9ef">return</span> NO;
}

<span style="color:#75715e">// è·å–æŸä¸ªç±»çš„æ‰€æœ‰å­ç±»
</span><span style="color:#75715e"></span><span style="color:#66d9ef">static</span> NSArray <span style="color:#f92672">*</span><span style="color:#a6e22e">SubclassesOfClass</span>(<span style="color:#66d9ef">Class</span> baseClass)
{
    <span style="color:#75715e">// å£°æ˜å­˜å‚¨ç¬¬ä¸€ä¸ªç±»çš„æŒ‡é’ˆ
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">Class</span> <span style="color:#f92672">*</span>classes;
    <span style="color:#75715e">// å£°æ˜å­˜å‚¨ç±»æ€»æ•°çš„å˜é‡
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span> classCount;
    <span style="color:#75715e">// ä¿è¯ç±»åˆ—è¡¨çš„è·å–åªéœ€ä¸€æ¬¡ï¼ˆåœ¨ä¸€ä¸ªç¨‹åºä¸­è¯¥åˆ—è¡¨åº”å½“æ˜¯ä¸å˜çš„ï¼‰
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">static</span> dispatch_once_t onceToken;
    dispatch_once(<span style="color:#f92672">&amp;</span>onceToken, <span style="color:#f92672">^</span>{
      <span style="color:#75715e">// æ‹·è´ç±»åˆ—è¡¨
</span><span style="color:#75715e"></span>      classes <span style="color:#f92672">=</span> objc_copyClassList(<span style="color:#f92672">&amp;</span>classCount);
    });

    <span style="color:#75715e">// å£°æ˜å­˜å‚¨å­ç±»çš„å¯å˜æ•°ç»„
</span><span style="color:#75715e"></span>    NSMutableArray <span style="color:#f92672">*</span>subclasses <span style="color:#f92672">=</span> [NSMutableArray array];
    <span style="color:#75715e">// éå†æ‰€æœ‰ç±»
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> classCount; i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>)
    {
        <span style="color:#75715e">// å­˜å‚¨å½“å‰éå†åˆ°çš„ç±»
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">Class</span> cls <span style="color:#f92672">=</span> classes[i];
        <span style="color:#66d9ef">Class</span> superclass <span style="color:#f92672">=</span> cls;
        <span style="color:#75715e">// å½“çˆ¶ç±»å­˜åœ¨æ—¶
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">while</span> (superclass)
        {
            <span style="color:#75715e">// å¦‚æœçˆ¶ç±»ä¸å‚æ•°ä¸€è‡´ï¼Œè¯´æ˜ cls æ˜¯ baseClass å­ç±»é“¾ä¹‹ä¸€
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">if</span> (superclass <span style="color:#f92672">=</span><span style="color:#f92672">=</span> baseClass)
            {
                <span style="color:#75715e">// å­˜åœ¨å­ç±»æ•°ç»„ä¸­
</span><span style="color:#75715e"></span>                [subclasses addObject:cls];
                <span style="color:#75715e">// å»éå†ä¸‹ä¸ªç±»
</span><span style="color:#75715e"></span>                <span style="color:#66d9ef">break</span>;
            }
            <span style="color:#75715e">// æ‰¾ä¸Šä¸€çº§çˆ¶ç±»ï¼ˆæ‰¾åˆ° NSObject çš„çˆ¶ç±» nil ä¸ºæ­¢ï¼‰
</span><span style="color:#75715e"></span>            superclass <span style="color:#f92672">=</span> class_getSuperclass(superclass);
        }
    }
    <span style="color:#75715e">// æ‰«æå®Œæ‰€æœ‰ç±»ï¼Œè¿”å›ç»“æœ
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">return</span> subclasses;
}
</code></pre></div><p><code>ClassOverridesMethod()</code> ä¸ <code>SubclassesOfClass()</code> ä¸¤ä¸ªç‹¬ç«‹å°è£…çš„è¾…åŠ©å‡½æ•°ä½¿å¾— <code>CheckOverrides()</code> å‡½æ•°å¯ä»¥è®¾è®¡å¾—ä¸ä¼šè¿‡é•¿ä¸”åŠŸèƒ½ç‹¬ç«‹ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec"><span style="color:#75715e">// MustOverride.m
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">CheckOverrides</span>(<span style="color:#66d9ef">void</span>)
{
    <span style="color:#75715e">// å£°æ˜ Dl_info ç»“æ„ä½“
</span><span style="color:#75715e"></span>    Dl_info info;
    <span style="color:#75715e">// è·å–å½“å‰å‡½æ•°åœ°å€å¤„çš„é•œåƒä¿¡æ¯å¹¶ä¿å­˜åœ¨ info ä¸­
</span><span style="color:#75715e"></span>    dladdr((<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>)<span style="color:#f92672">&amp;</span>CheckOverrides, <span style="color:#f92672">&amp;</span>info);

    <span style="color:#75715e">// è·å– Mach-O å¤´ï¼ˆåŸºåœ°å€ï¼‰
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> MustOverrideValue mach_header <span style="color:#f92672">=</span> (MustOverrideValue)info.dli_fbase;
    <span style="color:#75715e">// è·å– Mach-O ä¸­ç›¸åº”çš„èŠ‚ä¿¡æ¯
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> MustOverrideSection <span style="color:#f92672">*</span>section <span style="color:#f92672">=</span> GetSectByNameFromHeader((<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>)mach_header, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">__DATA</span><span style="color:#e6db74">&#34;</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">MustOverride</span><span style="color:#e6db74">&#34;</span>);
    <span style="color:#75715e">// å¦‚æœæœªè·å–åˆ°åˆ™è¿”å›
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (section <span style="color:#f92672">=</span><span style="color:#f92672">=</span> NULL) <span style="color:#66d9ef">return</span>;

    <span style="color:#75715e">// å£°æ˜å­˜å‚¨é”™è¯¯ä¿¡æ¯çš„å¯å˜æ•°ç»„
</span><span style="color:#75715e"></span>    NSMutableArray <span style="color:#f92672">*</span>failures <span style="color:#f92672">=</span> [NSMutableArray array];
    <span style="color:#75715e">// ä» section-&gt;offset åç§»å¼€å§‹ï¼Œæ¯æ¬¡å¾ªç¯è·¨è¶ŠæŒ‡å‘å­—ç¬¦æ•°ç»„æŒ‡é’ˆå¤§å°çš„èŒƒå›´ï¼Œæœ€ç»ˆä¸è¶…è¿‡åç§»åœ°å€ä¸èŠ‚å¤§å°ä¹‹å’Œï¼Œå³å¯éå†èŠ‚ä¸­å­˜å‚¨çš„ä¿¡æ¯
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">for</span> (MustOverrideValue addr <span style="color:#f92672">=</span> section<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>offset; addr <span style="color:#f92672">&lt;</span> section<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>offset <span style="color:#f92672">+</span> section<span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span>size; addr <span style="color:#f92672">+</span><span style="color:#f92672">=</span> <span style="color:#66d9ef">sizeof</span>(<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#f92672">*</span>))
    {
        <span style="color:#75715e">// å–å­˜å‚¨çš„ __func__ ä¿¡æ¯å¹¶è½¬æ¢ä¸º NSStringï¼Œeg: @&#34;-[Foo(Ext) fooExt]&#34;
</span><span style="color:#75715e"></span>        NSString <span style="color:#f92672">*</span>entry <span style="color:#f92672">=</span> <span style="color:#ae81ff">@(</span><span style="color:#f92672">*</span>(<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span><span style="color:#f92672">*</span>)(mach_header <span style="color:#f92672">+</span> addr)<span style="color:#ae81ff">)</span>;
        <span style="color:#75715e">// åˆ†å‰²æ–¹æ³•åï¼Œeg: [@&#34;Foo(Ext)&#34;, @&#34;fooExt&#34;]
</span><span style="color:#75715e"></span>        NSArray <span style="color:#f92672">*</span>parts <span style="color:#f92672">=</span> [[entry substringWithRange:NSMakeRange(<span style="color:#ae81ff">2</span>, entry.length <span style="color:#f92672">-</span> <span style="color:#ae81ff">3</span>)] componentsSeparatedByString:<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74"> </span><span style="color:#e6db74">&#34;</span>];
        <span style="color:#75715e">// å–å‡ºç±»å
</span><span style="color:#75715e"></span>        NSString <span style="color:#f92672">*</span>className <span style="color:#f92672">=</span> parts[<span style="color:#ae81ff">0</span>];
        <span style="color:#75715e">// é’ˆå¯¹åˆ†ç±»ç‰¹æ®Šå¤„ç†
</span><span style="color:#75715e"></span>        NSRange categoryRange <span style="color:#f92672">=</span> [className rangeOfString:<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">(</span><span style="color:#e6db74">&#34;</span>];
        <span style="color:#66d9ef">if</span> (categoryRange.length)
        {
            <span style="color:#75715e">// å–å‡ºç±»åï¼Œeg: @&#34;Foo&#34;
</span><span style="color:#75715e"></span>            className <span style="color:#f92672">=</span> [className substringToIndex:categoryRange.location];
        }

        <span style="color:#75715e">// åˆ¤æ–­æ˜¯å¦ä¸ºç±»æ–¹æ³•ï¼ˆæ˜¯å¦ä»¥ + å¼€å¤´ï¼‰
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">BOOL</span> isClassMethod <span style="color:#f92672">=</span> [entry characterAtIndex:<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">+</span><span style="color:#e6db74">&#39;</span>;
        <span style="color:#75715e">// æ ¹æ®ç±»åæ„é€  Class
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">Class</span> cls <span style="color:#f92672">=</span> NSClassFromString(className);
        <span style="color:#75715e">// æ ¹æ®æ–¹æ³•åæ„é€  SEL
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">SEL</span> selector <span style="color:#f92672">=</span> NSSelectorFromString(parts[<span style="color:#ae81ff">1</span>]);

        <span style="color:#75715e">// éå†è¯¥ç±»çš„æ‰€æœ‰å­ç±»
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">Class</span> subclass <span style="color:#66d9ef">in</span> SubclassesOfClass(cls))
        {
            <span style="color:#75715e">// åˆ¤æ–­ç±»ä¸­æ˜¯å¦æœ‰é‡å†™çš„æ–¹æ³•ï¼ˆå¦‚æœæ˜¯ç±»æ–¹æ³•ï¼Œå…¶å­˜å‚¨åœ¨å…ƒç±»çš„æ–¹æ³•åˆ—è¡¨ä¸­ï¼Œåˆ™ä¼ å…¥å…ƒç±»å¯¹è±¡ï¼›å¦åˆ™ä¼ å…¥ç±»å¯¹è±¡ï¼‰
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>ClassOverridesMethod(isClassMethod <span style="color:#f92672">?</span> object_getClass(subclass) <span style="color:#f92672">:</span> subclass, selector))
            {
                <span style="color:#75715e">// æ·»åŠ æœªé‡å†™çš„å­ç±»å’Œæ–¹æ³•ä¿¡æ¯
</span><span style="color:#75715e"></span>                [failures addObject:[NSString stringWithFormat:<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">%@ does not implement method %c%@ required by %@</span><span style="color:#e6db74">&#34;</span>,
                                     subclass, isClassMethod <span style="color:#f92672">?</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">+</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">:</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">-</span><span style="color:#e6db74">&#39;</span>, parts[<span style="color:#ae81ff">1</span>], className]];
            }
        }
    }

    <span style="color:#75715e">// è‹¥é”™è¯¯å­˜åœ¨åˆ™è§¦å‘æ–­è¨€ï¼Œä½¿ç¨‹åºç»ˆæ­¢
</span><span style="color:#75715e"></span>    NSCAssert(failures.count <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, <span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">%@%@</span><span style="color:#e6db74">&#34;</span>,
              failures.count <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">?</span> [NSString stringWithFormat:<span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">%zd method override errors:</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, failures.count] <span style="color:#f92672">:</span> <span style="color:#e6db74">@&#34;</span><span style="color:#e6db74">&#34;</span>,
              [failures componentsJoinedByString:<span style="color:#e6db74">@&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>]);
}

</code></pre></div><p><code>DL_info</code> æ˜¯å®šä¹‰åœ¨ <code>dlfcn.h</code> ä¸­çš„ç»“æ„ä½“ç±»å‹ï¼Œç”± <code>dladdr()</code> å‡½æ•°å¡«å……ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#75715e">// dlfcn.h
</span><span style="color:#75715e"></span>
<span style="color:#75715e">/*
</span><span style="color:#75715e"> * Structure filled in by dladdr().
</span><span style="color:#75715e"> */</span>
<span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">dl_info</span> {
        <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span>      <span style="color:#f92672">*</span>dli_fname;     <span style="color:#75715e">/* Pathname of shared object */</span>
        <span style="color:#66d9ef">void</span>            <span style="color:#f92672">*</span>dli_fbase;     <span style="color:#75715e">/* Base address of shared object */</span>
        <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span>      <span style="color:#f92672">*</span>dli_sname;     <span style="color:#75715e">/* Name of nearest symbol */</span>
        <span style="color:#66d9ef">void</span>            <span style="color:#f92672">*</span>dli_saddr;     <span style="color:#75715e">/* Address of nearest symbol */</span>
} Dl_info;

<span style="color:#66d9ef">extern</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">dladdr</span>(<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>, Dl_info <span style="color:#f92672">*</span>);
</code></pre></div><p>è€Œå…³äº <code>dladdr()</code> å‡½æ•°æˆ‘ä»¬å¯ä»¥åœ¨ Terminal é€šè¿‡ <code>man dladdr</code> æŸ¥é˜… Manual æ‰‹å†Œï¼ˆå¦‚ä¸‹ï¼‰ã€‚è¯¥å‡½æ•°å°†é€šè¿‡ <code>dyld</code>ï¼ˆåŠ¨æ€é“¾æ¥å™¨ï¼‰æŸ¥è¯¢ä¼ å…¥åœ°å€æ‰€åœ¨çš„é•œåƒä¿¡æ¯ï¼Œå¹¶å°†å…¶å¡«å……è‡³ <code>DL_info</code> ç»“æ„ä½“ï¼Œå…¶ä¸­ <code>dli_fbase</code> ä¸ºé•œåƒçš„åŸºåœ°å€ï¼Œå³ Mach-O å¤´éƒ¨ï¼ˆ<code>mach_header</code>ï¼‰ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">DLADDR(3)                BSD Library Functions Manual                DLADDR(3)

NAME
     dladdr -- find the image containing a given address

SYNOPSIS
     #include &lt;dlfcn.h&gt;

     int
     dladdr(const void* addr, Dl_info* info);

DESCRIPTION
     The dladdr() function queries dyld (the dynamic linker) for information
     about the image containing the address addr.  The information is returned
     in the structure specified by info.  The structure contains at least the
     following members:

     const char* dli_fname     The pathname of the shared object containing
                               the address.

     void* dli_fbase           The base address (mach_header) at which the
                               image is mapped into the address space of the
                               calling process.

     const char* dli_sname     The name of the nearest run-time symbol with a
                               value less than or equal to addr.

     void* dli_saddr           The value of the symbol returned in dli_sname.

     The dladdr() function is available only in dynamically linked programs.

ERRORS
     If an image containing addr cannot be found, dladdr() returns 0.  On suc-cess, success,
     cess, a non-zero value is returned.

     If the image containing addr is found, but no nearest symbol was found,
     the dli_sname and dli_saddr fields are set to NULL.

SEE ALSO
     dyld(3), dlopen(3)

HISTORY
     The dladdr() function first appeared in the Solaris operating system.

AUTHORS
     Mac OS X 10.3 incorporated the dlcompat package written by Jorge Acereda
     &lt;jacereda@users.sourceforge.net&gt; and Peter O&#39;Gorman &lt;ogor-
     man@users.sourceforge.net&gt;.

     In Mac OS X 10.4, dlopen was rewritten to be a native part of dyld.

     This man page was borrowed from FreeBSD and modified.

BUGS
     This implementation is almost bug-compatible with the Solaris implementa-tion. implementation.
     tion.  The following bugs are present:

     oo   Returning 0 as an indication of failure goes against long-standing
         Unix tradition.

BSD                           September 24, 2004                           BSD
</code></pre></div><p>é€šè¿‡ <code>mach_header</code> å’Œå…·ä½“çš„æ®µå’ŒèŠ‚ä¿¡æ¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥è¯»å–åˆ°å…¶ä¸­çš„å†…å®¹ï¼Œä½†è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ä¸åŒæ¶æ„çš„è®¾å¤‡ä¸Šï¼Œç›¸åº”çš„å‡½æ•°å’Œç±»å‹å¯èƒ½ç•¥æœ‰ä¸åŒï¼Œæˆ‘ä»¬è¿™é‡Œä»¥ç›®å‰æ›´ä¸ºæ™®åŠçš„ 64 ä½ç³»ç»Ÿä¸ºä¾‹ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objectivec" data-lang="objectivec"><span style="color:#75715e">// MustOverride.m
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#</span><span style="color:#75715e">ifdef __LP64__</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#66d9ef">typedef</span> uint64_t MustOverrideValue;
<span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">struct</span> section_64 MustOverrideSection;
<span style="color:#75715e">#</span><span style="color:#75715e">define GetSectByNameFromHeader getsectbynamefromheader_64</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">else</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#66d9ef">typedef</span> uint32_t MustOverrideValue;
<span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">struct</span> section MustOverrideSection;
<span style="color:#75715e">#</span><span style="color:#75715e">define GetSectByNameFromHeader getsectbynamefromheader</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">endif</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// mach-o/getsect.h
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// æ ¹æ® Mach-O å¤´åœ°å€å’Œæ®µã€èŠ‚åè·å–èŠ‚ä¿¡æ¯
</span><span style="color:#75715e"></span><span style="color:#75715e">// getsectbyname,  getsectdata - get the section information for the named section
</span><span style="color:#75715e"></span><span style="color:#66d9ef">extern</span> <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">struct</span> section_64 <span style="color:#f92672">*</span><span style="color:#a6e22e">getsectbynamefromheader_64</span>(
    <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">struct</span> mach_header_64 <span style="color:#f92672">*</span>mhp,
    <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>segname,
    <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>sectname);
</code></pre></div><p>èŠ‚ä¿¡æ¯å­˜å‚¨åœ¨ <code>section_64</code> ç»“æ„ä½“ä¸­ï¼Œé€šè¿‡ <code>offset</code> åç§»å’Œ <code>mach_header</code> å¯ä»¥å–å‡ºå…¶ä¸­ç¬¬ä¸€ä¸ªå†…å®¹ï¼›ç”±äºæˆ‘ä»¬åœ¨èŠ‚ä¸­å­˜å‚¨çš„å®é™…ä¸Šæ˜¯æŒ‡å‘å­—ç¬¦æ•°ç»„çš„æŒ‡é’ˆï¼ŒæŒ‡é’ˆåœ¨å†…å­˜ä¸­å ç”¨çš„ç©ºé—´æ˜¯å›ºå®šçš„ï¼Œå³å¯é¡ºä½ç»§ç»­å–å‡ºåç»­çš„å†…å®¹ï¼›èŠ‚ä¸­å†…å®¹çš„æ€»é•¿åº¦åˆ™å¯ä»¥ç”± <code>size</code> å¾—å‡ºï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#75715e">// mach-o/loader.h
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">section_64</span> { <span style="color:#75715e">/* for 64-bit architectures */</span>
	<span style="color:#66d9ef">char</span>		sectname[<span style="color:#ae81ff">16</span>];	<span style="color:#75715e">/* name of this section */</span>
	<span style="color:#66d9ef">char</span>		segname[<span style="color:#ae81ff">16</span>];	<span style="color:#75715e">/* segment this section goes in */</span>
	<span style="color:#66d9ef">uint64_t</span>	addr;		<span style="color:#75715e">/* memory address of this section */</span>
	<span style="color:#66d9ef">uint64_t</span>	size;		<span style="color:#75715e">/* size in bytes of this section */</span>
	<span style="color:#66d9ef">uint32_t</span>	offset;		<span style="color:#75715e">/* file offset of this section */</span>
	<span style="color:#66d9ef">uint32_t</span>	align;		<span style="color:#75715e">/* section alignment (power of 2) */</span>
	<span style="color:#66d9ef">uint32_t</span>	reloff;		<span style="color:#75715e">/* file offset of relocation entries */</span>
	<span style="color:#66d9ef">uint32_t</span>	nreloc;		<span style="color:#75715e">/* number of relocation entries */</span>
	<span style="color:#66d9ef">uint32_t</span>	flags;		<span style="color:#75715e">/* flags (section type and attributes)*/</span>
	<span style="color:#66d9ef">uint32_t</span>	reserved1;	<span style="color:#75715e">/* reserved (for offset or index) */</span>
	<span style="color:#66d9ef">uint32_t</span>	reserved2;	<span style="color:#75715e">/* reserved (for count or sizeof) */</span>
	<span style="color:#66d9ef">uint32_t</span>	reserved3;	<span style="color:#75715e">/* reserved */</span>
};
</code></pre></div><p>è¿™æ ·ç»¼ä¸Šï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨ç¨‹åºå¯åŠ¨æ—¶è¯»å–åˆ°ç¼–è¯‘æ—¶å·²ç»å­˜å‚¨åœ¨ Mach-O ä¸­ <code>__DATA</code> æ®µ <code>MustOverride</code> èŠ‚çš„æ–¹æ³•ä¿¡æ¯ï¼Œå¹¶é€šè¿‡æŸ¥è¯¢ç›¸åº”çš„æ–¹æ³•æ˜¯å¦è¢«å­ç±»å®ç°ï¼Œåœ¨ç¬¬ä¸€æ—¶é—´è§¦å‘æ–­è¨€ç»ˆæ­¢ app è¿è¡Œã€‚æœ€åéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>MustOverride.m</code> å…¶ä¸­çš„ä»£ç å—å‡ ä¹æ•´ä½“è¢« <code>#if DEBUG</code> å’Œ <code>#endif</code> å®åŒ…è£¹ï¼Œè¿™æ„å‘³ç€è¯¥åº“ä»…é€‚ç”¨äº Debug æ¨¡å¼ï¼Œå¯èƒ½ä¼šé€ æˆæŸäº›å´©æºƒç­‰å½±å“ï¼Œå› æ­¤åˆ‡å¿Œ Release æ¨¡å¼ä¸‹ä½¿ç”¨ã€‚</p>
<h2 id="extension">Extension</h2>
<p>ç»è¿‡ä»¥ä¸Šçš„åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ã€ŒMustOverrideã€è¿™ä¸ªåº“å…¶å®å¹¶ä¸å¤æ‚ï¼Œä½†å¸¦ç»™äº†æˆ‘ä»¬ä¸€äº›æ€è·¯ã€‚æ¯”å¦‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>__attribute__</code> åœ¨ç¼–è¯‘æ—¶åˆ»å†™å…¥ Mach-O ä¸­ä¸€äº›å†…å®¹ï¼Œå¹¶åœ¨ app å¯åŠ¨æˆ–è¿è¡Œæ—¶è¯»å–ï¼Œè¿›è€Œåšä¸€äº›æ“ä½œã€‚</p>
<h2 id="reference">Reference</h2>
<ul>
<li><a href="https://nshipster.com/__attribute__/"><code>__attribute__</code> - NSHipster</a></li>
<li><a href="https://gcc.gnu.org/onlinedocs/gcc/Attribute-Syntax.html">Attribute Syntax - GNU</a></li>
<li><a href="http://releases.llvm.org/9.0.0/tools/clang/docs/AttributeReference.html">Attributes in Clang - LLVM</a></li>
<li><a href="../const_static_extern_in_cpp/">C/C++ ä¸­çš„ constã€static &amp; extern - kingcos</a></li>
<li><a href="https://blog.sunnyxx.com/2016/05/14/clang-attributes/">Clang Attributes é»‘é­”æ³•å°è®° - sunnyxx</a></li>
<li><a href="../+load_in_ios/">iOS ä¸­çš„ +load æ–¹æ³• - kingcos</a></li>
<li><a href="https://developer.apple.com/library/archive/documentation/System/Conceptual/ManPages_iPhoneOS/man3/dladdr.3.html">dladdr - iOS Manual Pages</a></li>
<li><a href="http://infocenter.arm.com/help/index.jsp?topic=/com.arm.doc.dui0491c/Caccache.html"><code>__attribute__((section(&quot;name&quot;))) variable attribute</code> - ARM</a></li>
<li><a href="http://infocenter.arm.com/help/index.jsp?topic=/com.arm.doc.dui0491c/BABCJJID.html"><code>__attribute__((used)) variable attribute</code> - ARM</a></li>
<li><a href="https://tech.meituan.com/2018/12/06/waimai-ios-optimizing-startup.html">ç¾å›¢å¤–å– iOS App å†·å¯åŠ¨æ²»ç† - ç¾å›¢æŠ€æœ¯å›¢é˜Ÿ</a></li>
<li><a href="https://developer.apple.com/library/archive/documentation/System/Conceptual/ManPages_iPhoneOS/man3/dladdr.3.html">dladdr - iOS Manual Pages</a></li>
</ul>

    </div>
    
      <div class="pagination">
        <div class="pagination__title">
          <span class="pagination__title-h">Read other posts</span>
          <hr />
        </div>
        <div class="pagination__buttons">
          
            <span class="button previous">
              <a href="/posts/2019/multithreading_techs_in_ios-1/">
                <span class="button__icon">â†</span>
                <span class="button__text">iOS å¤šçº¿ç¨‹æŠ€æœ¯å®è·µä¹‹ pthreadsï¼ˆä¸€ï¼‰</span>
              </a>
            </span>
          
          
            <span class="button next">
              <a href="/posts/2019/obj-c_to_c&#43;&#43;/">
                <span class="button__text">å°† Obj-C ä»£ç ç¿»è¯‘ä¸º C/C&#43;&#43; ä»£ç </span>
                <span class="button__icon">â†’</span>
              </a>
            </span>
          
        </div>
      </div>
    

    

    
    
    <div>
      <div id="github-comment">
      </div>

      <script type="text/javascript">
        function getUtterances(isDark) {
          var utterances = document.createElement('script');
          utterances.type = 'text/javascript';
          utterances.async = true;
          utterances.setAttribute('issue-term', "pathname")
          utterances.setAttribute('repo', "kingcos\/kingcos.github.io")
          utterances.setAttribute('label', "comments")
          isDark ? utterances.setAttribute('theme', "github-dark") : utterances.setAttribute('theme', "github-light")
          utterances.crossorigin = 'anonymous';
          utterances.src = 'https://utteranc.es/client.js';

          return utterances
        }

        var themeToggle = document.querySelector(".theme-toggle")
        themeToggle.addEventListener("click", function () {
          var getTheme = window.localStorage && window.localStorage.getItem("theme")
          var divNode = document.getElementById('github-comment')
          while(divNode.hasChildNodes()) {
            divNode.removeChild(divNode.firstChild);
          }
          
          
          

          
          
          
          
          
          
          document.getElementById('github-comment').appendChild(getUtterances(getTheme !== "dark"))
        })

        var getTheme = window.localStorage && window.localStorage.getItem("theme")
        document.getElementById('github-comment').appendChild(getUtterances(getTheme === "dark"))
      </script>
    </div>
    

    </div>

      </div>

      
        <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright copyright--user">All rights reserved by kingcos.me</div>
    
  </div>
</footer>

<script src="/assets/main.js"></script>
<script src="/assets/prism.js"></script>


      
    </div>

    
      
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-138311951-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

    
  </body>
</html>
