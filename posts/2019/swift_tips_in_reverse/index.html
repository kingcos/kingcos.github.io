<!DOCTYPE html>
<html lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="kingcos" />
	
	
	
	<title>SwiftTips in Reverse ï½œ kingcos</title>
	
    
    
    <meta name="description" content="[SwiftTips](https://github.com/johnsundell/swifttips) æ˜¯ [John Sundell](https://github.com/johnsundell) åœ¨ GitHub å¼€æºçš„ Swift å°æŠ€å·§åˆ—è¡¨ã€‚éšç€ Swift 5 çš„å‘å¸ƒä»¥åŠ ABI ç¨³å®šï¼Œæ˜¯æ—¶å€™å†å­¦ä¹ ä¸€é Swift å•¦ã€‚æœ¬æ–‡å°†æ˜¯è¯¥åˆ—è¡¨çš„å®è·µç‰ˆæœ¬ï¼Œå¹¶ä¿è¯æ–‡ä¸­ä»£ç çš„å¯è¿è¡Œæ€§ï¼Œä¸”å°½å¯èƒ½åšåˆ°å€’åº~~æ—¥æ›´~~ã€‚ï¼ˆBut why in reverse? ğŸ¤«ï¼‰" />
    

    
    
    <meta name="keywords" content="Hugo, theme, zozo" />
    

	
    
    <link rel="shortcut icon" href="https://kingcos.me/images/favicon.png" />

    <link rel="stylesheet" type="text/css" media="screen" href="https://kingcos.me/css/normalize.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.0/animate.min.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="https://kingcos.me/css/zozo.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://cdn.jsdelivr.net/npm/remixicon@2.5.0/fonts/remixicon.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="https://kingcos.me/css/highlight.css" />

    
    
</head>

<script data-ad-client="ca-pub-9925978992661955" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<body>
    <div class="main animate__animated animate__fadeInDown">
        <div class="nav_container animated fadeInDown">
    <div class="site_nav" id="site_nav">
        <ul>
            
            <li>
                <a href="/">Home</a>
            </li>
            
            <li>
                <a href="/posts/">Archive</a>
            </li>
            
            <li>
                <a href="/tags/">Tags</a>
            </li>
            
            <li>
                <a href="/about/">About</a>
            </li>
            
        </ul>
    </div>
    <div class="menu_icon">
        <a id="menu_icon"><i class="ri-menu-line"></i></a>
    </div>
</div>


<link rel="stylesheet" href="https://kingcos.me/scss/main.min.7b6e5090dd63f35c42913c169ca8464a3ba4c70a9de89e9ca3535ce45de13d3d.css" integrity="sha256-e25QkN1j81xCkTwWnKhGSjukxwqd6J6co1Nc5F3hPT0=" media="screen">

<style>
.nav_container {
  height: 1rem;
}
 
table {
    width: 100%;
    table-layout: fixed;
}

 
.markdown code {
    white-space: normal;
    word-wrap: break-word;
     
}

 
.menu_icon a {
    font-size: 20px;
}

 

 
body {
    font-family: 'Hiragino Sans GB', 'SFMono', 'Lato', '-apple-system';
    -webkit-font-smoothing: 'antialiased';
}

 
.markdown strong, .markdown b, .markdown em {
    font-weight: bold;
}

 
.markdown img {
     
    margin: 0 auto;
    display: block;
}

 
.ri-stack-line {
    vertical-align: middle;
}

 
.ri-map-pin-time-line {
    vertical-align: middle;
}

 

 
.markdown .book-hint::before {
    content: none;
}

.markdown .book-hint {
    margin: 1rem 0;
    padding: 0.5rem 1rem 0.5rem 0.75rem;

    border-inline-start: 0.25rem solid #e9ecef;
    border-radius: 0.25rem;

    font-style: normal;
     
}

.book-hint strong {
    background-color: transparent;
}

.markdown .book-hint.info {
    border-left-color:#6bf;
    background-color:rgba(102,187,255,.1);
}

.markdown .book-hint.warning {
    border-left-color:#fd6;
    background-color:rgba(255,221,102,.1);
}

.markdown .book-hint.danger {
    border-left-color:#f66;
    background-color:rgba(255,102,102,.1);
}

</style>

        <div class="header animated fadeInDown">
    <div class="site_title_container">
        <div class="site_title">
            <h1>
                <a href="https://kingcos.me/">
                    <span>kingcos</span>
                </a>
            </h1>
        </div>
        <div class="description">
            <p class="sub_title">ä¸“æ³¨ã€åšæŒ</p>
            <div class="my_socials">
                
                
                <a href="https://github.com/kingcos" title="github" target="_blank"><i class="ri-github-fill"></i></a>
                
                
                
                <a href="https://www.instagram.com/kingcos_v/" title="instagram" target="_blank"><i class="ri-instagram-fill"></i></a>
                
                
                
                <a href="https://twitter.com/kingcos_v" title="twitter" target="_blank"><i class="ri-twitter-fill"></i></a>
                
                
                
                <a href="https://weibo.com/u/1798410923" title="weibo" target="_blank"><i class="ri-weibo-fill"></i></a>
                
                
                
            </div>
        </div>
    </div>
</div>
        <div class="content">
            <div class="post_page">
                <div class="post animate__animated animate__fadeInDown">
                    <div class="post_title post_detail_title">
                        <h2><a href='/posts/2019/swift_tips_in_reverse/'>SwiftTips in Reverse</a></h2>
                        <span class="date">2019.08.27</span>
                        <span>by kingcos</span>
                    </div>
                    <div class="post_content markdown"><h2 id="preface">Preface</h2>
<p><a href="https://github.com/johnsundell/swifttips">SwiftTips</a> æ˜¯ <a href="https://github.com/johnsundell">John Sundell</a> åœ¨ GitHub å¼€æºçš„ Swift å°æŠ€å·§åˆ—è¡¨ã€‚éšç€ Swift 5 çš„å‘å¸ƒä»¥åŠ ABI ç¨³å®šï¼Œæ˜¯æ—¶å€™å†å­¦ä¹ ä¸€é Swift å•¦ã€‚æœ¬æ–‡å°†æ˜¯è¯¥åˆ—è¡¨çš„å®è·µç‰ˆæœ¬ï¼Œå¹¶ä¿è¯æ–‡ä¸­ä»£ç çš„<strong>å¯è¿è¡Œæ€§</strong>ï¼Œä¸”å°½å¯èƒ½åšåˆ°å€’åº<del>æ—¥æ›´</del>ã€‚ï¼ˆBut why in reverse? ğŸ¤«ï¼‰</p>
<p>å…³äºæœ¬æ–‡çš„ä»£ç ï¼Œéƒ½å¯ä»¥åœ¨ <a href="https://github.com/kingcos/swift-tips-in-practice">swift-tips-in-practice</a> ä¸‹è½½å¹¶å®é™…è¿è¡Œã€‚</p>
<table>
<thead>
<tr>
<th style="text-align:center">Date</th>
<th style="text-align:center">Update</th>
<th style="text-align:center">Date</th>
<th style="text-align:center">Update</th>
<th style="text-align:center">Date</th>
<th style="text-align:center">Update</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">2019.08.22</td>
<td style="text-align:center">#102</td>
<td style="text-align:center">2019.08.23</td>
<td style="text-align:center">#100</td>
<td style="text-align:center">2019.08.27</td>
<td style="text-align:center">#99</td>
</tr>
</tbody>
</table>
<h2 id="102-è®©å¼‚æ­¥æµ‹è¯•æ‰§è¡Œæ›´å¿«æ›´ç¨³å®š">#102 è®©å¼‚æ­¥æµ‹è¯•æ‰§è¡Œæ›´å¿«æ›´ç¨³å®š</h2>
<p>å¼‚æ­¥ä»£ç ä¼¼ä¹æ€»æ˜¯å¾ˆéš¾å»ç¼–å†™å•å…ƒæµ‹è¯•ï¼Œå› ä¸ºæˆ‘ä»¬ä¸æ¸…æ¥šä»€ä¹ˆæ—¶å€™è¯·æ±‚æ‰èƒ½å›æ¥ã€‚ç°åœ¨åœ¨ Swift ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>expectation</code>ï¼ˆé¢„æ–™ï¼‰ç®€å•è®¾å®šè¶…æ—¶æ—¶é—´ï¼Œå¹¶åœ¨ Closure å›è°ƒæ—¶è°ƒç”¨ <code>fulfill()</code> å³å¯è½»æ¾å®ç°ã€‚</p>
<p>Talk is cheap, show me the code!</p>
<div class="highlight"><pre class="chroma"><code class="language-swift" data-lang="swift"><span class="kd">import</span> <span class="nc">XCTest</span>
<span class="p">@</span><span class="n">testable</span> <span class="kd">import</span> <span class="nc">TestUnitTest</span>

<span class="kd">class</span> <span class="nc">TestUnitTestTests</span><span class="p">:</span> <span class="n">XCTestCase</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">fetchFromNetwork</span><span class="p">(</span><span class="kc">_</span> <span class="n">completion</span><span class="p">:</span> <span class="p">@</span><span class="n">escaping</span> <span class="p">(</span><span class="nb">String</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="nb">Void</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">DispatchQueue</span><span class="p">.</span><span class="n">main</span><span class="p">.</span><span class="n">asyncAfter</span><span class="p">(</span><span class="n">deadline</span><span class="p">:</span> <span class="n">DispatchTime</span><span class="p">.</span><span class="n">now</span><span class="p">()</span> <span class="o">+</span> <span class="mf">1.5</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">let</span> <span class="nv">response</span> <span class="p">=</span> <span class="s">&#34;Foo&#34;</span>
            <span class="n">completion</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// ğŸ™… Not good</span>
    <span class="kd">func</span> <span class="nf">testAsyncOperationsWithSleep</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">fetchFromNetwork</span> <span class="p">{</span> <span class="n">res</span> <span class="k">in</span>
            <span class="n">XCTAssert</span><span class="p">(</span><span class="n">res</span> <span class="p">==</span> <span class="s">&#34;Foo&#34;</span><span class="p">,</span> <span class="s">&#34;Response should be &#39;Foo&#39;.&#34;</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="c1">// ğŸš© Preferred</span>
    <span class="kd">func</span> <span class="nf">testAsyncOperationsWithoutSleep</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// å£°æ˜ exp</span>
        <span class="kd">let</span> <span class="nv">exp</span> <span class="p">=</span> <span class="n">expectation</span><span class="p">(</span><span class="n">description</span><span class="p">:</span> <span class="s">&#34;Async Test&#34;</span><span class="p">)</span>

        <span class="kd">var</span> <span class="nv">result</span> <span class="p">=</span> <span class="s">&#34;&#34;</span>
        <span class="n">fetchFromNetwork</span> <span class="p">{</span> <span class="n">res</span> <span class="k">in</span>
            <span class="n">result</span> <span class="p">=</span> <span class="n">res</span>

            <span class="c1">// Closure æ‰§è¡Œå®Œæ¯•</span>
            <span class="n">exp</span><span class="p">.</span><span class="n">fulfill</span><span class="p">()</span>
        <span class="p">}</span>

        <span class="c1">// ç­‰å¾… expï¼Œè¶…æ—¶æ—¶é—´ 2 ç§’</span>
        <span class="n">wait</span><span class="p">(</span><span class="k">for</span><span class="p">:</span> <span class="p">[</span><span class="n">exp</span><span class="p">],</span> <span class="n">timeout</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">)</span>
        <span class="n">XCTAssert</span><span class="p">(</span><span class="n">result</span> <span class="p">==</span> <span class="s">&#34;Foo&#34;</span><span class="p">,</span> <span class="s">&#34;Response should be &#39;Foo&#39;.&#34;</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>å¯¹äºå•å…ƒæµ‹è¯•ï¼Œåœ¨ iOS é¡¹ç›®ä¸­ä½¿ç”¨ã€Œ<a href="https://github.com/Quick/Quick">Quick</a>ã€&amp;ã€Œ<a href="https://github.com/Quick/Nimble">Nimble</a>ã€ã€åœ¨ Swift Package Management é¡¹ç›®ä¸­ä½¿ç”¨ã€Œ<a href="https://github.com/kylef/Spectre">Spectre</a>ã€å¯ä»¥ç¼–å†™æ›´åŠ ç¬¦åˆ BDDï¼ˆBehavior Driven Design å³è¡Œä¸ºé©±åŠ¨è®¾è®¡ï¼‰çš„æµ‹è¯•ç”¨ä¾‹ã€‚åè€…æˆ‘æ›¾åœ¨å¼€æºé¡¹ç›® <a href="https://github.com/kingcos/WWDCHelper">WWDCHelper</a> ä¸­ä½¿ç”¨è¿‡ï¼Œé…åˆ CI å³å¯æŒç»­ä¿éšœä»£ç è¦†ç›–ç‡ã€‚</p>
<h3 id="reference">Reference</h3>
<ul>
<li><a href="https://www.swiftbysundell.com/posts/unit-testing-asynchronous-swift-code">Unit testing asynchronous Swift code</a></li>
</ul>
<h2 id="101-æ”¯æŒ-apple-pencil-åŒå‡»">#101 æ”¯æŒ Apple Pencil åŒå‡»</h2>
<ul>
<li>è¿«äºæ²¡æœ‰è®¾å¤‡ï¼Œè·³è¿‡è¯¥èŠ‚ã€‚</li>
</ul>
<h2 id="100-å‡½æ•°ç»‘å®šå€¼">#100 å‡½æ•°ç»‘å®šå€¼</h2>
<p>å°†å€¼å’Œå‡½æ•°ä½¿ç”¨é¢å¤–çš„ <code>combine</code> å‡½æ•°ç»‘å®šèµ·æ¥ï¼Œå¯æ— éœ€åœ¨é—­åŒ…ï¼ˆClosureï¼‰ä¸­æ•è· <code>self</code>ï¼Œç›¸å½“äºåªå°†æœ€ç»ˆéœ€è¦æ£€æŸ¥çš„æ‰§è¡Œè€…ä¸å‚æ•°å‘ŠçŸ¥å³å¯ã€‚å¯¹äº <code>combine</code> å‡½æ•°æ˜¯æ”¯æŒæ³›å‹çš„ï¼Œå³å…¶æ— éœ€å…³å¿ƒå…·ä½“çš„ä¸šåŠ¡å†…å®¹ï¼Œå®ƒåªè´Ÿè´£å°†å‚æ•°ä¸é—­åŒ…ç»„è£…å¹¶æ‰§è¡Œï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-swift" data-lang="swift"><span class="kd">import</span> <span class="nc">UIKit</span>

<span class="c1">// ç±»å‹åˆ«å</span>
<span class="kd">typealias</span> <span class="n">Handler</span> <span class="p">=</span> <span class="p">()</span> <span class="p">-&gt;</span> <span class="nb">Void</span>

<span class="c1">// é—­åŒ…åŒ…è£¹å™¨ï¼Œå¦åˆ™æ— æ³•å­˜å‚¨åœ¨å…³è”å¯¹è±¡å†…</span>
<span class="n">fileprivate</span> <span class="kd">class</span> <span class="nc">ClosureWrapper</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nv">handler</span><span class="p">:</span> <span class="n">Handler</span><span class="p">?</span>

    <span class="kd">init</span><span class="p">(</span><span class="kc">_</span> <span class="n">closure</span><span class="p">:</span> <span class="n">Handler</span><span class="p">?)</span> <span class="p">{</span>
        <span class="n">handler</span> <span class="p">=</span> <span class="n">closure</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="nc">UIButton</span> <span class="p">{</span>
    <span class="c1">// å…³è”é”®</span>
    <span class="kd">private</span> <span class="kd">struct</span> <span class="nc">AssociatedKeys</span> <span class="p">{</span>
        <span class="kd">static</span> <span class="kd">var</span> <span class="nv">touchUpInside</span> <span class="p">=</span> <span class="s">&#34;touchUpInside&#34;</span>
    <span class="p">}</span>

    <span class="c1">// å¤„ç†æ–¹æ³•</span>
    <span class="kd">var</span> <span class="nv">handler</span><span class="p">:</span> <span class="n">Handler</span><span class="p">?</span> <span class="p">{</span>
        <span class="kr">get</span> <span class="p">{</span>
            <span class="k">if</span> <span class="kd">let</span> <span class="nv">wrapper</span> <span class="p">=</span> <span class="n">objc_getAssociatedObject</span><span class="p">(</span><span class="kc">self</span><span class="p">,</span>
                                                      <span class="p">&amp;</span><span class="n">AssociatedKeys</span><span class="p">.</span><span class="n">touchUpInside</span><span class="p">)</span> <span class="k">as</span><span class="p">?</span> <span class="n">ClosureWrapper</span><span class="p">,</span>
                <span class="kd">let</span> <span class="nv">handler</span> <span class="p">=</span> <span class="n">wrapper</span><span class="p">.</span><span class="n">handler</span> <span class="p">{</span>
                <span class="k">return</span> <span class="n">handler</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="kc">nil</span>
        <span class="p">}</span>

        <span class="kr">set</span> <span class="p">{</span>
            <span class="k">if</span> <span class="kd">let</span> <span class="nv">newValue</span> <span class="p">=</span> <span class="n">newValue</span> <span class="p">{</span>
                <span class="n">objc_setAssociatedObject</span><span class="p">(</span><span class="kc">self</span><span class="p">,</span>
                                         <span class="p">&amp;</span><span class="n">AssociatedKeys</span><span class="p">.</span><span class="n">touchUpInside</span><span class="p">,</span>
                                         <span class="n">ClosureWrapper</span><span class="p">(</span><span class="n">newValue</span><span class="p">),</span>
                                         <span class="p">.</span><span class="n">OBJC_ASSOCIATION_RETAIN_NONATOMIC</span><span class="p">)</span>

                <span class="n">addTarget</span><span class="p">(</span><span class="kc">self</span><span class="p">,</span> <span class="n">action</span><span class="p">:</span> <span class="k">#selector</span><span class="p">(</span><span class="n">runHandler</span><span class="p">),</span> <span class="k">for</span><span class="p">:</span> <span class="p">.</span><span class="n">touchUpInside</span><span class="p">)</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">removeTarget</span><span class="p">(</span><span class="kc">self</span><span class="p">,</span> <span class="n">action</span><span class="p">:</span> <span class="k">#selector</span><span class="p">(</span><span class="n">runHandler</span><span class="p">),</span> <span class="k">for</span><span class="p">:</span> <span class="p">.</span><span class="n">touchUpInside</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kr">@objc</span> <span class="kd">func</span> <span class="nf">runHandler</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">handler</span><span class="p">?()</span>
    <span class="p">}</span>
<span class="p">}</span>


<span class="kd">struct</span> <span class="nc">Product</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nv">bar</span><span class="p">:</span> <span class="nb">Int</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="nc">ProductManager</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">startCheckout</span><span class="p">(</span><span class="k">for</span> <span class="n">product</span><span class="p">:</span> <span class="n">Product</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">switch</span> <span class="n">product</span><span class="p">.</span><span class="n">bar</span> <span class="p">{</span>
        <span class="k">case</span> <span class="mf">0.</span><span class="p">.&lt;</span><span class="mi">60</span><span class="p">:</span>
            <span class="bp">print</span><span class="p">(</span><span class="s">&#34;ä¸åˆæ ¼&#34;</span><span class="p">)</span>
        <span class="k">case</span> <span class="mf">60.</span><span class="p">..</span><span class="mi">100</span><span class="p">:</span>
            <span class="bp">print</span><span class="p">(</span><span class="s">&#34;åˆæ ¼&#34;</span><span class="p">)</span>
        <span class="k">default</span><span class="p">:</span>
            <span class="bp">fatalError</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// æ³›å‹ A B</span>
<span class="kd">func</span> <span class="nf">combine</span><span class="p">&lt;</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">&gt;(</span><span class="kc">_</span> <span class="n">value</span><span class="p">:</span> <span class="n">A</span><span class="p">,</span>
                   <span class="n">with</span> <span class="n">closure</span><span class="p">:</span> <span class="p">@</span><span class="n">escaping</span> <span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">B</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="p">()</span> <span class="p">-&gt;</span> <span class="n">B</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span> <span class="n">closure</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">Demo100ViewController</span><span class="p">:</span> <span class="n">UIViewController</span> <span class="p">{</span>
    <span class="kr">lazy</span> <span class="kd">var</span> <span class="nv">fooButton</span><span class="p">:</span> <span class="n">UIButton</span><span class="p">!</span> <span class="p">=</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nv">button</span> <span class="p">=</span> <span class="n">UIButton</span><span class="p">(</span><span class="n">type</span><span class="p">:</span> <span class="p">.</span><span class="n">system</span><span class="p">)</span>

        <span class="n">button</span><span class="p">.</span><span class="n">frame</span> <span class="p">=</span> <span class="n">CGRect</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="mf">100.0</span><span class="p">,</span> <span class="n">width</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="n">height</span><span class="p">:</span> <span class="mi">50</span><span class="p">)</span>
        <span class="n">button</span><span class="p">.</span><span class="n">setTitle</span><span class="p">(</span><span class="s">&#34;Foo&#34;</span><span class="p">,</span> <span class="k">for</span><span class="p">:</span> <span class="p">.</span><span class="n">normal</span><span class="p">)</span>

        <span class="n">view</span><span class="p">.</span><span class="n">addSubview</span><span class="p">(</span><span class="n">button</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">button</span>
    <span class="p">}()</span>

    <span class="kd">var</span> <span class="nv">product</span> <span class="p">=</span> <span class="n">Product</span><span class="p">(</span><span class="n">bar</span><span class="p">:</span> <span class="mi">89</span><span class="p">)</span>
    <span class="kd">var</span> <span class="nv">productManager</span> <span class="p">=</span> <span class="n">ProductManager</span><span class="p">()</span>

    <span class="kr">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
        <span class="kc">super</span><span class="p">.</span><span class="n">viewDidLoad</span><span class="p">()</span>

        <span class="n">title</span> <span class="p">=</span> <span class="s">&#34;100&#34;</span>
        <span class="n">view</span><span class="p">.</span><span class="n">backgroundColor</span> <span class="p">=</span> <span class="p">.</span><span class="n">white</span>

        <span class="c1">// ğŸ™…â€â™‚ï¸ Not good</span>
        <span class="n">fooButton</span><span class="p">.</span><span class="n">handler</span> <span class="p">=</span> <span class="p">{</span> <span class="p">[</span><span class="kr">weak</span> <span class="kc">self</span><span class="p">]</span> <span class="k">in</span>
            <span class="k">guard</span> <span class="kd">let</span> <span class="nv">self</span> <span class="p">=</span> <span class="kc">self</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="p">}</span>

            <span class="kc">self</span><span class="p">.</span><span class="n">productManager</span><span class="p">.</span><span class="n">startCheckout</span><span class="p">(</span><span class="k">for</span><span class="p">:</span> <span class="kc">self</span><span class="p">.</span><span class="n">product</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="c1">// ğŸš© Preferred</span>
        <span class="n">fooButton</span><span class="p">.</span><span class="n">handler</span> <span class="p">=</span> <span class="n">combine</span><span class="p">(</span><span class="kc">self</span><span class="p">.</span><span class="n">product</span><span class="p">,</span> <span class="n">with</span><span class="p">:</span> <span class="n">productManager</span><span class="p">.</span><span class="n">startCheckout</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>ç„¶è€Œåœ¨çœŸæ­£å®ç°è¿™ä¸€æ®µçš„ <code>handler</code> æ—¶ï¼Œå´èŠ±è´¹äº†ä¸€äº›å‘¨æŠ˜ã€‚<code>UIButton</code> åœ¨å®˜æ–¹çš„è®¾è®¡æ¨¡å¼æ˜¯ Target Actionï¼Œè€Œæˆ‘ä»¬éœ€è¦æ”¹ä¸ºé—­åŒ…å›è°ƒçš„å½¢å¼ã€‚ç”±äº Swift çš„ <code>extension</code> å¹¶ä¸æ”¯æŒå­˜å‚¨å±æ€§ï¼Œç±»ä¼¼ Obj-C çš„ Category ä¸æ”¯æŒå®ä¾‹å˜é‡ï¼Œè¿™é‡Œä»ç„¶ä½¿ç”¨äº†å…³è”å¯¹è±¡æ¥å°†é—­åŒ…å…³è”åœ¨å¯¹è±¡ä¸Šã€‚åˆç”±äºé—­åŒ…æ— æ³•ç›´æ¥è¢«å…³è”ï¼Œä»ç„¶éœ€è¦åŒ…è£¹åœ¨ç±»ä¸­æ‰å¾—ä»¥å®ç°ã€‚</p>
<h2 id="99-ä½¿ç”¨å‡½æ•°è¿›è¡Œä¾èµ–æ³¨å…¥">#99 ä½¿ç”¨å‡½æ•°è¿›è¡Œä¾èµ–æ³¨å…¥</h2>
<p>åœ¨å¼€å§‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥è®¤è¯†ä¸€ä¸‹ä»€ä¹ˆæ˜¯<strong>ä¾èµ–æ³¨å…¥ï¼ˆDependency Injectionï¼‰</strong>ã€‚</p>
<p>ä¾èµ–æ³¨å…¥åˆç§°æ§åˆ¶åè½¬ï¼ˆInversion of Controlï¼ŒIoCï¼‰ã€‚ç®€å•æ¥è¯´ï¼Œä¾èµ–æ³¨å…¥çš„é‡ç‚¹åœ¨äºæ³¨å…¥ï¼Œå³å°†ä¾èµ–ä»¥<strong>æ³¨å…¥</strong>çš„æ–¹å¼å¼•å…¥ï¼Œè€Œéç›´æ¥åœ¨ä¾èµ–å†…åˆ›å»ºï¼Œä»¥é¿å…è€¦åˆã€‚ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-swift" data-lang="swift"><span class="kd">struct</span> <span class="nc">Foo</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nv">bar</span><span class="p">:</span> <span class="nb">String</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="nc">FooFactory</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="kd">func</span> <span class="nf">generate</span><span class="p">(</span><span class="kc">_</span> <span class="n">bar</span><span class="p">:</span> <span class="nb">String</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">Foo</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">Foo</span><span class="p">(</span><span class="n">bar</span><span class="p">:</span> <span class="n">bar</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="nc">Bar</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nv">foo</span><span class="p">:</span> <span class="n">Foo</span>

    <span class="c1">// ğŸ™… Not good</span>
    <span class="kd">init</span><span class="p">(</span><span class="kc">_</span> <span class="n">bar</span><span class="p">:</span> <span class="nb">String</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">foo</span> <span class="p">=</span> <span class="n">Foo</span><span class="p">(</span><span class="n">bar</span><span class="p">:</span> <span class="n">bar</span><span class="p">)</span>
        <span class="c1">// foo = FooFactory.generate(bar)</span>
    <span class="p">}</span>

    <span class="c1">// ğŸš© Preferred</span>
    <span class="kd">init</span><span class="p">(</span><span class="kc">_</span> <span class="n">foo</span><span class="p">:</span> <span class="n">Foo</span><span class="p">)</span> <span class="p">{</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">foo</span> <span class="p">=</span> <span class="n">foo</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>è®¾è®¡æ¨¡å¼ä¸Šæ›´åŠ æ¨èå°† <code>foo</code> ç›´æ¥æ³¨å…¥åˆ° <code>Bar</code> ä¸­ï¼Œæ˜¾è€Œæ˜“è§çš„å¥½å¤„æ˜¯è¿™æ ·å¯ä»¥ä¾¿äºå•å…ƒæµ‹è¯•ï¼Œå› ä¸ºæˆ‘ä»¬å°† <code>Foo</code> çš„æ„é€ æš´éœ²äº†åœ¨å¤–éƒ¨ï¼Œé¿å…å¢åŠ äº† <code>Bar</code> çš„è€¦åˆåº¦ã€‚è¿™ä¹Ÿæ­£ç¬¦åˆå…¶å¦ä¸€ä¸ªåç§°æ§åˆ¶åè½¬ï¼Œå³å°†æ§åˆ¶æƒäº¤ç”±å¤–ç•Œï¼Œ<code>Bar</code> æ— éœ€å…³å¿ƒ <code>foo</code> æ˜¯å¦‚ä½•åˆ›å»ºçš„ï¼ˆé€šè¿‡æ„é€ å™¨ï¼ŒæŠ‘æˆ–å·¥å‚æ–¹æ³•ç­‰ï¼‰ï¼Œå…¶åªéœ€è¦ç›´æ¥ä½¿ç”¨å³å¯ã€‚</p>
<p>åœ¨ Swift ä¸­ï¼Œå‡½æ•°æ˜¯ä¸€ç±»å…¬æ°‘ï¼Œå³å¯ä»¥ä½œä¸ºä¸€ç§ç±»å‹ã€‚å› æ­¤å‡½æ•°çš„æ³¨å…¥ä¹Ÿä½¿å¾—å†…éƒ¨æ— éœ€å…³å¿ƒå‡½æ•°å…·ä½“çš„å®šä¹‰ï¼Œåªéœ€è¦å®šä¹‰å¥½å‚æ•°å’Œè¿”å›å€¼å³å¯ã€‚æ¯”å¦‚åœ¨ç½‘ç»œè¯·æ±‚ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ— éœ€å…³å¿ƒç½‘ç»œå±‚åˆ°åº•æ˜¯é€šè¿‡ <code>URLSession</code> è¿˜æ˜¯ <code>Alamofire</code> è¿™æ ·å°è£…å¥½çš„ç½‘ç»œåº“æ¥æ„é€ çš„ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-swift" data-lang="swift">
</code></pre></div><h3 id="reference-1">Reference</h3>
<ul>
<li><a href="https://www.swiftbysundell.com/posts/simple-swift-dependency-injection-with-functions">Simple Swift dependency injection with functions</a></li>
<li><a href="https://www.swiftbysundell.com/posts/under-the-hood-of-futures-and-promises-in-swift">Under the hood of Futures &amp; Promises in Swift</a></li>
</ul>
<h2 id="98-ä½¿ç”¨è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†å™¨">#98 ä½¿ç”¨è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†å™¨</h2>
<hr>
<p><strong><em>All rights reserved by <a href="https://github.com/johnsundell/swifttips">JohnSundell/SwiftTips</a>.</em></strong></p>
</div>
                    <div class="post_footer">
                        
                        <div class="meta">
                            <div class="info">
                                <span class="field tags">
                                    <i class="ri-stack-line"></i>
                                    
                                    <a href="https://kingcos.me/tags/practice/">Practice</a>
                                    
                                    <a href="https://kingcos.me/tags/ios/">iOS</a>
                                    
                                    <a href="https://kingcos.me/tags/swift/">Swift</a>
                                    
                                </span>
                            </div>
                        </div>
                        
                    </div>
                </div>
                <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<table style="border: 0;">
  <tr>
  <td style="border: 0; width: 30%;">
    <img width='100%' src='/img/about/1.jpg'>
  </td>
  <td style="border: 0; width: 50%;">
    <ins class="adsbygoogle"
     style="display:block;width:100%;"
     data-ad-client="ca-pub-9925978992661955"
     data-ad-slot="3213735320"
     data-ad-format="rectangle"
     data-full-width-responsive="false"></ins>
  </td>
  </tr>
</table>

<hr>

<script>
    (adsbygoogle = window.adsbygoogle || []).push({});
</script>
                
                
                <div class="doc_comments"><div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "kingcos" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a></div>
                
            </div>
        </div>
    </div>
    <a id="back_to_top" href="#" class="back_to_top"><i class="ri-arrow-up-s-line"></i></a>
    <footer class="footer">
    <div class="powered_by">
        <a href="https://kingcos.me">Powered by kingcos with love.</a>
    </div>

    <div class="footer_slogan">
        <span>â¤ï¸</span>
    </div>
</footer>
    <script src="https://kingcos.me/js/jquery-3.5.1.min.js"></script>
<link href="https://kingcos.me/css/fancybox.min.css" rel="stylesheet">
<script src="https://kingcos.me/js/fancybox.min.js"></script>
<script src="https://kingcos.me/js/zozo.js"></script>


<script type="text/javascript" async
    src="https://cdn.bootcss.com/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
        MathJax.Hub.Config({
            tex2jax: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\[\[', '\]\]']],
                processEscapes: true,
                processEnvironments: true,
                skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
                TeX: {
                    equationNumbers: { autoNumber: "AMS" },
                    extensions: ["AMSmath.js", "AMSsymbols.js"]
                }
            }
        });

        MathJax.Hub.Queue(function () {
            
            
            
            var all = MathJax.Hub.getAllJax(), i;
            for (i = 0; i < all.length; i += 1) {
                all[i].SourceElement().parentNode.className += ' has-jax';
            }
        });
    </script>

<style>
    code.has-jax {
        font: inherit;
        font-size: 100%;
        background: inherit;
        border: inherit;
        color: #515151;
    }
</style>



<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-138311951-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</body>

</html>