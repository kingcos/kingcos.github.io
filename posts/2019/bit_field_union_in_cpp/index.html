<!DOCTYPE html>
<html lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="kingcos" />
	
	
	
	<title>C/C&#43;&#43; ä¸­çš„ä½åŸŸä¸å…±ç”¨ä½“ ï½œ kingcos</title>
	
    
    
    <meta name="description" content="C/C&#43;&#43; ä¸­æœ‰è®¸å¤šã€Œå¥‡æŠ€æ·«å·§ã€æ¥è®©å¼€å‘è€…èƒ½å¤Ÿä»¥æ•ˆç‡æ›´é«˜çš„æ–¹å¼ä½¿ç”¨å†…å­˜ï¼Œè¿™ä¹Ÿæ˜¯ä¸€äº›é«˜çº§è¯­è¨€ç€åŠ›å»é¿è®³çš„ä¸€ç‚¹ï¼Œä½†è¿™ç§èƒ½å¤Ÿç›´é¢å†…å­˜ç»†èŠ‚çš„ã€Œè¸å®æ„Ÿã€è®©æˆ‘ä¸ªäººè§‰å¾—éå¸¸å®‰å¿ƒã€‚æœ¬æ–‡å°†ç®€å•æ¶‰åŠ C/C&#43;&#43; ä¸­çš„ä½åŸŸä¸å…±ç”¨ä½“çš„æ¦‚å¿µã€‚" />
    

    
    
    <meta name="keywords" content="Hugo, theme, zozo" />
    

	
    
    <link rel="shortcut icon" href="https://kingcos.me/images/favicon.png" />

    <link rel="stylesheet" type="text/css" media="screen" href="https://kingcos.me/css/normalize.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.0/animate.min.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="https://kingcos.me/css/zozo.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://cdn.jsdelivr.net/npm/remixicon@2.5.0/fonts/remixicon.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="https://kingcos.me/css/highlight.css" />

    
    
</head>

<script data-ad-client="ca-pub-9925978992661955" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<body>
    <div class="main animate__animated animate__fadeInDown">
        <div class="nav_container animated fadeInDown">
    <div class="site_nav" id="site_nav">
        <ul>
            
            <li>
                <a href="/">Home</a>
            </li>
            
            <li>
                <a href="/posts/">Archive</a>
            </li>
            
            <li>
                <a href="/tags/">Tags</a>
            </li>
            
            <li>
                <a href="/about/">About</a>
            </li>
            
        </ul>
    </div>
    <div class="menu_icon">
        <a id="menu_icon"><i class="ri-menu-line"></i></a>
    </div>
</div>


<link rel="stylesheet" href="https://kingcos.me/scss/main.min.75b49085bfb07b1bf150a1d59b4773d857e0452a747e37243805218b528a4045.css" integrity="sha256-dbSQhb&#43;wexvxUKHVm0dz2FfgRSp0fjckOAUhi1KKQEU=" media="screen">

<style>
.nav_container {
  height: 1rem;
}
 
table {
    width: 100%;
    table-layout: fixed;
}

 
.markdown code {
    white-space: normal;
    word-wrap: break-word;
    word-break: break-word;
    line-height: 1.5em;
    font-size: 0.85em;
    font-weight: bold;
    display: inline-block;
     
}

 
.menu_icon a {
    font-size: 16px;
}

 
body {
    font-family: 'Hiragino Sans GB', 'SFMono', 'Lato', '-apple-system';
    -webkit-font-smoothing: 'antialiased';
}

 
.markdown strong, .markdown b, .markdown em {
    font-weight: bold;
}

.post .post_content p {
     

    line-height: 1.75em;
}

 
.markdown img {
    max-width: 100%;
    margin: 0 auto;
    display: block;
    border-radius: 0.25rem;
}

 
.ri-stack-line {
    vertical-align: middle;
}

 
.ri-map-pin-time-line {
    vertical-align: middle;
}

 
.chroma .lntd:nth-child(2) {
    width: 100%;
}

 

 
.markdown .book-hint::before {
    content: none;
}

.markdown .book-hint {
    margin: 1rem 0;
    padding: 0.5rem 1rem 0.5rem 0.75rem;

    border-inline-start: 0.25rem solid #e9ecef;
    border-radius: 0.25rem;

    font-style: normal;
     
}

.book-hint strong {
    background-color: transparent;
}

.markdown .book-hint.info {
    border-left-color:#6bf;
    background-color:rgba(102,187,255,.1);
}

.markdown .book-hint.warning {
    border-left-color:#fd6;
    background-color:rgba(255,221,102,.1);
}

.markdown .book-hint.danger {
    border-left-color:#f66;
    background-color:rgba(255,102,102,.1);
}

</style>

        <div class="header animated fadeInDown">
    <div class="site_title_container">
        <div class="site_title">
            
                <a href="https://kingcos.me/">
                    
                    <img class="kingcos" style="margin-top: -20px; margin-left: -10px;" src="/title.svg" width="150px">
                </a>
            
        </div>
        <div class="description">
            <p class="sub_title">ä¸“æ³¨ã€åšæŒ</p>
            <div class="my_socials">
                
                
                <a href="https://github.com/kingcos" title="github" target="_blank"><i class="ri-github-fill"></i></a>
                
                
                
                <a href="https://www.instagram.com/kingcos_v/" title="instagram" target="_blank"><i class="ri-instagram-fill"></i></a>
                
                
                
                <a href="https://twitter.com/kingcos_v" title="twitter" target="_blank"><i class="ri-twitter-fill"></i></a>
                
                
                
                <a href="https://weibo.com/u/1798410923" title="weibo" target="_blank"><i class="ri-weibo-fill"></i></a>
                
                
                
            </div>
        </div>
    </div>
</div>
        <div class="content">
            <div class="post_page">
                <div class="post animate__animated animate__fadeInDown">
                    <div class="post_title post_detail_title">
                        <h2><a href='/posts/2019/bit_field_union_in_cpp/'>C/C&#43;&#43; ä¸­çš„ä½åŸŸä¸å…±ç”¨ä½“</a></h2>
                        <span class="date">2019.08.17</span>
                        <span>by kingcos</span>
                        
                        
                        
                        
                    </div>
                    <div class="post_content markdown"><table>
<thead>
<tr>
<th style="text-align:center">Date</th>
<th style="text-align:center">Notes</th>
<th style="text-align:center">Env</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">2019-08-17</td>
<td style="text-align:center">é¦–æ¬¡æäº¤</td>
<td style="text-align:center"><code>clang++</code>ã€macOS 10.14.4</td>
</tr>
</tbody>
</table>
<p><img src="/img/2019/bit_field_union_in_cpp/0.png" alt="0"></p>
<h2 id="preface">Preface</h2>
<p>C/C++ ä¸­æœ‰è®¸å¤šã€Œå¥‡æŠ€æ·«å·§ã€æ¥è®©å¼€å‘è€…èƒ½å¤Ÿä»¥æ•ˆç‡æ›´é«˜çš„æ–¹å¼ä½¿ç”¨å†…å­˜ï¼Œè¿™ä¹Ÿæ˜¯ä¸€äº›é«˜çº§è¯­è¨€ç€åŠ›å»é¿è®³çš„ä¸€ç‚¹ï¼Œä½†è¿™ç§èƒ½å¤Ÿç›´é¢å†…å­˜ç»†èŠ‚çš„ã€Œè¸å®æ„Ÿã€è®©æˆ‘ä¸ªäººè§‰å¾—éå¸¸å®‰å¿ƒã€‚æœ¬æ–‡å°†ç®€å•æ¶‰åŠ C/C++ ä¸­çš„ä½åŸŸï¼ˆBit Fieldï¼‰ä¸å…±ç”¨ä½“ï¼ˆUnionï¼‰çš„æ¦‚å¿µã€‚</p>
<h2 id="ä½åŸŸ">ä½åŸŸ</h2>
<h3 id="å¸ƒå°”ç±»å‹">å¸ƒå°”ç±»å‹</h3>
<p>å¯¹äºå¸ƒå°”ï¼ˆBooleanï¼‰ç±»å‹ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“å…¶åªæœ‰ä¸¤ç§å€¼ï¼šé€»è¾‘çœŸæˆ–é€»è¾‘å‡ã€‚åœ¨ C è¯­è¨€ä¸­ï¼Œå…¶å®å¹¶æ²¡æœ‰ä¸¥æ ¼æ„ä¹‰ä¸Šçš„å¸ƒå°”ç±»å‹ï¼›è€Œåœ¨ C++ ä¸­ï¼Œåˆ™è¯ç”Ÿäº†ä¸“ç”¨çš„ <code>bool</code> ç±»å‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">bool</span> <span class="n">foo</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">bar</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">foo</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span> <span class="c1">// 1
</span><span class="c1"></span>    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">bar</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span> <span class="c1">// 0
</span><span class="c1"></span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span> <span class="c1">// 1
</span><span class="c1"></span>    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">bar</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span> <span class="c1">// 1
</span><span class="c1"></span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>å¦‚ä¸Šï¼Œåœ¨ C++ ä¸­ï¼Œ<code>true</code> å’Œé <code>0</code> ä»£è¡¨å¸ƒå°”ç±»å‹ä¸­çš„é€»è¾‘çœŸï¼Œ<code>false</code> å’Œ <code>0</code> ä»£è¡¨é€»è¾‘å‡ã€‚<code>bool</code> ç±»å‹çš„å€¼é€šå¸¸åœ¨ C++ ä¸­å ç”¨ä¸€ä¸ªå­—èŠ‚é•¿åº¦ï¼ˆã€Œé€šå¸¸ã€ä»£è¡¨å¯¹äºä¸åŒçš„ç¼–è¯‘å™¨ç»“æœå¯èƒ½å¹¶éå®Œå…¨ä¸€è‡´ï¼‰ã€‚</p>
<h3 id="why">Why</h3>
<p>ç†Ÿæ‚‰è®¡ç®—æœºå­˜å‚¨å•ä½çš„åŒå­¦éƒ½åº”è¯¥çŸ¥é“ï¼Œ<code>bit</code> æ­£æ˜¯å­˜å‚¨ <code>0</code> æˆ– <code>1</code> çš„å•ä½ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆ <code>bool</code> è¦å ç”¨ä¸€å­—èŠ‚è€Œä¸æ˜¯ä¸€ä½çš„å†…å­˜ç©ºé—´å‘¢ï¼Ÿ</p>
<blockquote>
<p>Because the CPU can&rsquo;t address anything smaller than a byte.</p>
<p>&ndash; Paul Tomblin, StackOverflow</p>
</blockquote>
<p>åŸå› æ˜¯ï¼š<strong>å­—èŠ‚æ˜¯ CPU å¯å¤„ç†çš„æœ€å°å•ä½</strong>ã€‚è€Œä¸€ä¸ªå­—èŠ‚ä¸º 8 ä½ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨åˆ°å¤šä¸ªç›¸å…³çš„ <code>bool</code> ç±»å‹æ—¶ï¼Œæœ‰æ²¡æœ‰æ–¹æ³•å¯ä»¥ä¼˜åŒ–å†…å­˜çš„å ç”¨å‘¢ï¼Ÿ</p>
<h3 id="what">What</h3>
<p>ä½åŸŸï¼ˆä¹Ÿç§°ä½æ®µï¼‰ï¼Œæ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼Œå³å¯ä»¥å°†æ•°æ®ä»¥ä½ä¸ºå•ä½å­˜å‚¨ï¼ŒèŠ‚çœå†…å­˜ç©ºé—´ã€‚</p>
<p>æˆ‘ä»¬å°è¯•å®šä¹‰ä¸€ä¸ª <code>FooBarBaz</code> ä½åŸŸç»“æ„ï¼Œå…¶ä¸­ <code>foo</code> &amp; <code>bar</code> å„å ç”¨ 1 ä½ï¼Œ<code>baz</code> å ç”¨ 2 ä½ã€‚ç”±äºä½æ•°ä¹‹å’Œå¹¶æ²¡æœ‰å æ»¡ 8 ä½ï¼Œæ•´ä¸ªç»“æ„çš„å¤§å°ä½¿ç”¨ä¸€ä¸ªå­—èŠ‚å°±è¶³å¤Ÿäº†ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">struct</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="nl">foo</span> <span class="p">:</span> <span class="mi">1</span><span class="p">;</span>
    <span class="kt">char</span> <span class="nl">bar</span> <span class="p">:</span> <span class="mi">1</span><span class="p">;</span>
    <span class="kt">char</span> <span class="nl">baz</span> <span class="p">:</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span> <span class="n">FooBarBaz</span><span class="p">;</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">FooBarBaz</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span> <span class="c1">// 1
</span><span class="c1"></span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ä¸Šè¿°çš„ä½åŸŸç»“æ„é‡Œï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº† <code>char</code> ç±»å‹ã€‚åœ¨ C99 æ ‡å‡†ä¸­ï¼Œä½åŸŸè¢«è§£é‡Šä¸ºç‰¹å®šä½æ•°çš„æœ‰ç¬¦å·æˆ–æ— ç¬¦å·æ•´å‹ï¼Œæˆ–è€…ä¸€äº›å…¶å®ƒç”±å®ç°å®šä¹‰çš„ç±»å‹ã€‚<strong>å› æ­¤å…¶å®è¿™é‡Œçš„ç±»å‹å¤šæ˜¯ç”¨ä½œæè¿°æ•´ä¸ªä½åŸŸç»“æ„çš„å¤§å°ï¼Œè€Œéå®šä¹‰ä½ä¸­å­˜å‚¨çš„æ•°æ®ç±»å‹ã€‚</strong></p>
<p>æ‰€ä»¥åœ¨å°ç«¯æ¨¡å¼çš„æœºå™¨ä¸Šï¼Œ<code>char</code> ç±»å‹çš„ä¸€ä¸ªå­—èŠ‚ä¸­ï¼Œå‡è®¾ä¸º <code>0b 0000 0110</code>ï¼Œ<code>foo</code> ä¸º <code>0</code>ï¼Œ<code>bar</code> ä¸º <code>1</code>ï¼Œ<code>baz</code> ä¸º <code>01</code>ï¼ˆä»å³å¾€å·¦ï¼‰ã€‚</p>
<h3 id="how">How</h3>
<p>é‚£ä¹ˆåˆ°åº•å¦‚ä½•ä½¿ç”¨ä½åŸŸæ¥å­˜å‚¨å¤šä¸ª <code>bool</code> å€¼å‘¢ï¼Ÿ</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">class</span> <span class="nc">Demo</span>
<span class="p">{</span>
    <span class="k">struct</span>
    <span class="p">{</span>
        <span class="kt">char</span> <span class="nl">foo</span> <span class="p">:</span> <span class="mi">1</span><span class="p">;</span>
        <span class="kt">char</span> <span class="nl">bar</span> <span class="p">:</span> <span class="mi">1</span><span class="p">;</span>
        <span class="kt">char</span> <span class="nl">baz</span> <span class="p">:</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span> <span class="n">fooBarBaz</span><span class="p">;</span>

<span class="k">public</span><span class="o">:</span>
    <span class="kt">void</span> <span class="n">setFoo</span><span class="p">(</span><span class="kt">bool</span> <span class="n">foo</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">fooBarBaz</span><span class="p">.</span><span class="n">foo</span> <span class="o">=</span> <span class="n">foo</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">bool</span> <span class="nf">getFoo</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">fooBarBaz</span><span class="p">.</span><span class="n">foo</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="nf">setBar</span><span class="p">(</span><span class="kt">bool</span> <span class="n">bar</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">fooBarBaz</span><span class="p">.</span><span class="n">bar</span> <span class="o">=</span> <span class="n">bar</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">bool</span> <span class="nf">getBar</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">fooBarBaz</span><span class="p">.</span><span class="n">bar</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="nf">setBaz</span><span class="p">(</span><span class="kt">bool</span> <span class="n">baz</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">fooBarBaz</span><span class="p">.</span><span class="n">baz</span> <span class="o">=</span> <span class="n">baz</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">bool</span> <span class="nf">getBaz</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">fooBarBaz</span><span class="p">.</span><span class="n">baz</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">Demo</span> <span class="n">d</span> <span class="o">=</span> <span class="n">Demo</span><span class="p">();</span>
    <span class="n">d</span><span class="p">.</span><span class="n">setFoo</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
    <span class="n">d</span><span class="p">.</span><span class="n">setBar</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
    <span class="n">d</span><span class="p">.</span><span class="n">setBaz</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">d</span><span class="p">.</span><span class="n">getFoo</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span> <span class="c1">// 1
</span><span class="c1"></span>    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">d</span><span class="p">.</span><span class="n">getBar</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span> <span class="c1">// 0
</span><span class="c1"></span>    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">d</span><span class="p">.</span><span class="n">getBaz</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span> <span class="c1">// 1
</span><span class="c1"></span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// LLDB:
</span><span class="c1">// (lldb) p/t true
</span><span class="c1">// (bool) $0 = 0b00000001
</span><span class="c1">// (lldb) p/t false
</span><span class="c1">// (bool) $1 = 0b00000000
</span><span class="c1">// (lldb) p/t d.fooBarBaz
</span><span class="c1">// (Demo::(anonymous struct)) $2 = (foo = 0b0, bar = 0b0, baz = 0b0)
</span><span class="c1">// (lldb) p/t d.fooBarBaz
</span><span class="c1">// (Demo::(anonymous struct)) $3 = (foo = 0b1, bar = 0b0, baz = 0b1)
</span><span class="c1">// (lldb) p 0b00000001 == 0b1
</span><span class="c1">// (bool) $4 = true
</span><span class="c1">// (lldb) p 0b00000000 == 0b0
</span><span class="c1">// (bool) $5 = true
</span></code></pre></div><p>åœ¨ C++ ä¸­ <code>true</code> å’Œ <code>false</code> æ˜¯æ•´å‹åè¿›åˆ¶ä¸­çš„ <code>1</code> å’Œ <code>0</code>ï¼Œæ•´å‹åœ¨å†…å­˜ä¸­å ç”¨ä¸€ä¸ªå­—èŠ‚ï¼Œå³ 8 ä½ï¼Œæ¢ç®—ä¸ºäºŒè¿›åˆ¶ä¸º <code>0b 0000 0001</code>ï¼ˆå³ <code>0b1</code>ï¼‰å’Œ <code>0b 0000 0000</code>ï¼ˆå³ <code>0b0</code>ï¼‰ï¼Œè€Œ <code>foo</code>ã€<code>bar</code>ã€<code>baz</code> å„å ä¸€ä½ï¼Œå› æ­¤å½“èµ‹å€¼ <code>true</code> å’Œ <code>false</code> æ—¶ï¼Œå°†å…¶å„è‡ªçš„ä½ç½®ä¸º <code>1</code> æˆ– <code>0</code>ï¼Œä¹Ÿå°±è¾¾åˆ°äº†ä½¿ç”¨ä¸€ä½æ¥å­˜å‚¨å¸ƒå°”ç±»å‹çš„ç›®çš„ã€‚</p>
<h2 id="å…±ç”¨ä½“">å…±ç”¨ä½“</h2>
<p>åœ¨ C/C++ ç­‰å…¶å®ƒè¯­è¨€ä¸­éƒ½æœ‰ç»“æ„ä½“è¿™ç§æ•°æ®ç»“æ„ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šå®šä¹‰ç»“æ„ä½“ç±»å‹æ¥å­˜å‚¨å¤šä¸ªç›¸å…³å˜é‡ï¼Œåœ¨å†…å­˜ä¸­å˜é‡ä¾æ¬¡å æ®è¿ç»­çš„å†…å­˜ç©ºé—´ã€‚è€Œ C/C++ ä¸­çš„å…±ç”¨ä½“ä¸­ä¹Ÿå¯ä»¥å­˜å‚¨å¤šä¸ªç›¸å…³å˜é‡ï¼Œä¸åŒçš„æ˜¯<strong>å˜é‡åœ¨å†…å­˜ä¸­å ç”¨åŒä¸€èµ·ç‚¹çš„å†…å­˜ç©ºé—´</strong>ã€‚</p>
<p>æˆ‘ä»¬å®šä¹‰ä¸€ä¸ª <code>FooBar</code> å…±åŒä½“ï¼Œå…¶ä¸­æœ‰ä¸¤ä¸ªç±»å‹ä¸åŒçš„å˜é‡ï¼Œ<code>int</code> ç±»å‹çš„ <code>foo</code> å’Œ <code>char</code> ç±»å‹çš„ <code>bar</code>ã€‚æ•´ä¸ªå…±ç”¨ä½“ç»“æ„çš„å¤§å°ä¸ºå…¶ä¸­æœ€å¤§å…ƒç´ çš„å¤§å°ï¼Œå³ <code>int</code> çš„ 4 ä¸ªå­—èŠ‚ã€‚ç”±äºå…±ç”¨ç”¨ä¸€å—å†…å­˜ç©ºé—´ï¼Œå½“æˆ‘ä»¬ä¸º <code>foo</code> èµ‹å€¼ <code>65</code> æ—¶ï¼Œ<code>bar</code> æ‰€å ç”¨çš„ä¸€ä¸ªå­—èŠ‚ä¹Ÿè¢«èµ‹å€¼äº†ï¼Œå› æ­¤æœ€ç»ˆè¾“å‡ºäº† <code>A</code>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">union</span> <span class="nc">FooBar</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">foo</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">bar</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">FooBar</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span> <span class="c1">// 4
</span><span class="c1"></span>
    <span class="n">FooBar</span> <span class="n">fbb</span><span class="p">;</span>
    <span class="n">fbb</span><span class="p">.</span><span class="n">foo</span> <span class="o">=</span> <span class="mi">65</span><span class="p">;</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">fbb</span><span class="p">.</span><span class="n">foo</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span> <span class="c1">// 65
</span><span class="c1"></span>    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">fbb</span><span class="p">.</span><span class="n">bar</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span> <span class="c1">// A
</span><span class="c1"></span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><h2 id="ä½åŸŸä¸å…±ç”¨ä½“">ä½åŸŸä¸å…±ç”¨ä½“</h2>
<p>ä¸Šé¢æˆ‘ä»¬ç®€å•è®¤è¯†äº†ä½åŸŸä¸å…±ç”¨ä½“å„è‡ªçš„ä½œç”¨ï¼Œä½†ä½åŸŸåªèƒ½æŒ‰ä½èµ‹å€¼ï¼Œå…±ç”¨ä½“ä¸­å„è‡ªå˜é‡å†…å­˜é‡å ç”¨å¤„ä¹Ÿä¼¼ä¹æœ‰å±€é™ã€‚é‚£ä¸ºä½•ä¸å°†å¤šä¸ªä½å…±ç”¨ä¸€ä¸ªå˜é‡å¤§å°çš„å†…å­˜ç©ºé—´å‘¢ï¼Ÿ</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">union</span> <span class="nc">FooBar</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="n">bits</span><span class="p">;</span>

    <span class="k">struct</span>
    <span class="p">{</span>
        <span class="kt">char</span> <span class="nl">foo</span> <span class="p">:</span> <span class="mi">1</span><span class="p">;</span>
        <span class="kt">char</span> <span class="nl">bar</span> <span class="p">:</span> <span class="mi">1</span><span class="p">;</span>
        <span class="kt">char</span> <span class="nl">baz</span> <span class="p">:</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span> <span class="n">fooBarBaz</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div><p>è¿™é‡Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª <code>FooBar</code> å…±ç”¨ä½“ï¼Œè™½ç„¶å…¶ä¸­æœ‰ä¸¤ä¸ªå˜é‡ï¼Œä½†æ ¹æ®å…±ç”¨ä½“çš„å®šä¹‰ï¼Œ<code>bits</code> å°†å’Œä½åŸŸ <code>fooBarBaz</code> å…±äº«åŒä¸€ä¸ªå­—èŠ‚çš„å†…å­˜ç©ºé—´ï¼›è€Œæ ¹æ®ä½åŸŸçš„æè¿°ï¼Œè¿™ä¸€ä¸ªå­—èŠ‚çš„ 8 ä½ä¸­ï¼Œ<code>foo</code>ã€<code>bar</code>ã€<code>baz</code> å„è‡ªå ç”¨ä¸€ä½ã€‚è¿™æ ·çš„å¥½å¤„æ˜¯ï¼Œæ¯”å•ä¸€ä½¿ç”¨å…±ç”¨ä½“æ›´åŠ ç›´è§‚ï¼Œå¤–ç•Œæ“ä½œæ—¶å´åªéœ€è¦è®¿é—® <code>bits</code> å³å¯ã€‚</p>
<p>é‚£ä¹ˆå¦‚ä½•åªè®¿é—® <code>bits</code> å°±å¯ä»¥æ“ä½œä¸‰ä¸ªä¸åŒçš„å˜é‡å‘¢ï¼Ÿæˆ‘ä»¬è¦é¦–å…ˆäº†è§£ä¸€ä¸‹ <code>&amp;</code> å’Œ <code>|</code> å³æŒ‰ä½ä¸ã€æŒ‰ä½æˆ–è¿ç®—ç¬¦ã€‚<code>&amp;</code> æŒ‰ä½ä¸ï¼Œå³æŒ‰ä½è®¡ç®—ï¼Œåªæœ‰åŒæ—¶ä¸º <code>1</code> æ—¶è¯¥ä½ç»“æœæ‰ä¸º <code>1</code>ï¼›<code>|</code> æŒ‰ä½æˆ–ï¼Œå³æŒ‰ä½è®¡ç®—ï¼Œåªæœ‰åŒæ—¶ä¸º <code>0</code> æ—¶è¯¥ä½ç»“æœæ‰ä¸º <code>0</code>ï¼›å¦å¤–è¿˜è¦çŸ¥é“å·¦ç§» <code>&lt;&lt;</code>ã€å³ç§» <code>&gt;&gt;</code>ã€å–åç  <code>~</code> è¿ç®—ç¬¦ï¼Œå·¦ç§»å³å°†äºŒè¿›åˆ¶ä½æ•´ä½“å‘å·¦ç§»åŠ¨ï¼Œå³ç§»åä¹‹ï¼Œå–åç åˆ™æ ¹æ® <code>0</code> å’Œ <code>1</code> å¯¹ç«‹äº’å–å³å¯ã€‚</p>
<p>é€šè¿‡ä½åŸŸä¸å…±ç”¨ä½“ï¼Œä»¥åŠä¸Šè¿°è¿ç®—ç¬¦æˆ‘ä»¬å°±å¯ä»¥å®ç°äº†ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="cp">#define FooMask (1 &lt;&lt; 0) </span><span class="c1">// 0b 0000 0001
</span><span class="c1"></span><span class="cp">#define BarMask (1 &lt;&lt; 1) </span><span class="c1">// 0b 0000 0010
</span><span class="c1"></span><span class="cp">#define BazMask (1 &lt;&lt; 2) </span><span class="c1">// 0b 0000 0100
</span><span class="c1"></span>
<span class="k">class</span> <span class="nc">Demo</span>
<span class="p">{</span>
    <span class="n">FooBar</span> <span class="n">fooBar</span><span class="p">;</span>

<span class="k">public</span><span class="o">:</span>
    <span class="kt">void</span> <span class="n">setFoo</span><span class="p">(</span><span class="kt">bool</span> <span class="n">foo</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">foo</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">fooBar</span><span class="p">.</span><span class="n">bits</span> <span class="o">|=</span> <span class="n">FooMask</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="n">fooBar</span><span class="p">.</span><span class="n">bits</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">FooMask</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kt">bool</span> <span class="nf">getFoo</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">fooBar</span><span class="p">.</span><span class="n">bits</span> <span class="o">&amp;</span> <span class="n">FooMask</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="nf">setBar</span><span class="p">(</span><span class="kt">bool</span> <span class="n">bar</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">bar</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">fooBar</span><span class="p">.</span><span class="n">bits</span> <span class="o">|=</span> <span class="n">BarMask</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="n">fooBar</span><span class="p">.</span><span class="n">bits</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">BarMask</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kt">bool</span> <span class="nf">getBar</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">fooBar</span><span class="p">.</span><span class="n">bits</span> <span class="o">&amp;</span> <span class="n">BarMask</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="nf">setBaz</span><span class="p">(</span><span class="kt">bool</span> <span class="n">baz</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">baz</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">fooBar</span><span class="p">.</span><span class="n">bits</span> <span class="o">|=</span> <span class="n">BazMask</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="n">fooBar</span><span class="p">.</span><span class="n">bits</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">BazMask</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kt">bool</span> <span class="nf">getBaz</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">fooBar</span><span class="p">.</span><span class="n">bits</span> <span class="o">&amp;</span> <span class="n">BazMask</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>


<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">FooBar</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span> <span class="c1">// 1
</span><span class="c1"></span>
    <span class="n">Demo</span> <span class="n">d</span> <span class="o">=</span> <span class="n">Demo</span><span class="p">();</span>
    <span class="n">d</span><span class="p">.</span><span class="n">setFoo</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
    <span class="n">d</span><span class="p">.</span><span class="n">setBar</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
    <span class="n">d</span><span class="p">.</span><span class="n">setBaz</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">d</span><span class="p">.</span><span class="n">getFoo</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span> <span class="c1">// 1
</span><span class="c1"></span>    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">d</span><span class="p">.</span><span class="n">getBar</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span> <span class="c1">// 0
</span><span class="c1"></span>    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">d</span><span class="p">.</span><span class="n">getBaz</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span> <span class="c1">// 1
</span><span class="c1"></span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>å½“ç„¶ï¼Œç¬¬ä¸€æ¬¡ä½¿ç”¨å¯èƒ½æ¯”è¾ƒæŠ½è±¡ï¼Œæˆ‘ä»¬ä»¥ä¸€å¯¹ getter &amp; setter ä¸ºä¾‹è¯´æ˜ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="kt">void</span> <span class="nf">setFoo</span><span class="p">(</span><span class="kt">bool</span> <span class="n">foo</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">foo</span><span class="p">)</span> <span class="c1">// å½“ foo ä¸ºçœŸæ—¶ï¼Œæˆ‘ä»¬éœ€è¦å°† foo çš„äºŒè¿›åˆ¶ä½ç½®ä¸º 1
</span><span class="c1"></span>    <span class="p">{</span>
        <span class="c1">// FooMask æ˜¯ foo çš„æ©ç ï¼Œå³ 1 &lt;&lt; 0ï¼Œ0b 0000 0001
</span><span class="c1"></span>
        <span class="c1">// æ­¤æ—¶æˆ‘ä»¬éœ€è¦ä»…å°† bits çš„æœ€åä¸€ä½ç½®ä¸º 1ï¼Œè€Œä¸èƒ½æ›´æ”¹å…¶å®ƒä½
</span><span class="c1"></span>        <span class="c1">// å› æ­¤è¿™é‡Œé€‰æ‹©éœ€è¦ä¸æ©ç é€»è¾‘æˆ–ï¼Œä¿è¯å…¶å®ƒä½å’Œ 0 è¿ç®—éƒ½èƒ½å¾—åˆ°å…¶åŸå…ˆå€¼å¹¶å°† foo ç½®ä¸º 1
</span><span class="c1"></span>        <span class="n">fooBar</span><span class="p">.</span><span class="n">bits</span> <span class="o">|=</span> <span class="n">FooMask</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="c1">// å½“ foo ä¸ºå‡æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å°† foo çš„äºŒè¿›åˆ¶ä½ç½®ä¸º 0
</span><span class="c1"></span>    <span class="p">{</span>
        <span class="c1">// æ­¤æ—¶æˆ‘ä»¬éœ€è¦ä»…å°† bits çš„æœ€åä¸€ä½ç½®ä¸º 0ï¼Œè€Œä¸èƒ½æ›´æ”¹å…¶å®ƒä½
</span><span class="c1"></span>        <span class="c1">// å› æ­¤é¦–å…ˆéœ€è¦å–æ©ç çš„åç ï¼Œå¹¶è¿›è¡Œé€»è¾‘ä¸ï¼Œä¿è¯å…¶å®ƒä½ä¸å˜å¹¶å°† foo ç½®ä¸º 0
</span><span class="c1"></span>        <span class="n">fooBar</span><span class="p">.</span><span class="n">bits</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">FooMask</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="nf">getFoo</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// è·å–å€¼æ—¶ï¼Œæˆ‘ä»¬ä»…éœ€è¦ç‰¹å®šä½å³å¯ï¼Œå› æ­¤ä¸æ©ç é€»è¾‘ä¸å¯å°†å…¶å®ƒä½ç½®ä¸º 0ï¼Œå¹¶å°†éœ€è¦çš„ä½å–å‡º
</span><span class="c1"></span>    <span class="k">return</span> <span class="n">fooBar</span><span class="p">.</span><span class="n">bits</span> <span class="o">&amp;</span> <span class="n">FooMask</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><h2 id="reference">Reference</h2>
<ul>
<li><a href="https://stackoverflow.com/questions/4626815/why-is-a-boolean-1-byte-and-not-1-bit-of-size">Why is a boolean 1 byte and not 1 bit of size? - StackOverflow</a></li>
<li><a href="https://stackoverflow.com/questions/3971085/how-does-a-bit-field-work-with-character-types">How does a bit field work with character types? - StackOverflow</a></li>
<li><a href="https://zh.wikipedia.org/wiki/%E4%BD%8D%E6%AE%B5">ä½æ®µ - WikiPedia</a></li>
</ul>
</div>
                    <div class="post_footer">
                        
                        <div class="meta">
                            <div class="info">
                                <span class="field tags">
                                    <i class="ri-stack-line"></i>
                                    
                                    <a href="https://kingcos.me/tags/focus/">Focus</a>
                                    
                                    <a href="https://kingcos.me/tags/c/c&#43;&#43;/">C/C&#43;&#43;</a>
                                    
                                    <a href="https://kingcos.me/tags//">â˜…</a>
                                    
                                </span>
                            </div>
                        </div>
                        
                    </div>
                </div>
                <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<table style="border: 0;">
  <tr>
  <td style="border: 0; width: 30%;">
    <img width='100%' src='/img/about/1.jpg'>
  </td>
  <td style="border: 0; width: 50%;">
    <center>â† å†™å¾—å¦‚ä½•ï¼Ÿè€ƒè™‘<strong>èµèµ</strong>ä¸€ä¸‹ï¼ŸğŸŒš</center>
    
  </td>
  </tr>
</table>

<hr>

<script>
    (adsbygoogle = window.adsbygoogle || []).push({});
</script>
                
                
                







    
    
    
    <div>
        <div id="github-comment">
        </div>

        <script type="text/javascript">
        function getUtterances(isDark) {
            var utterances = document.createElement('script');
            utterances.type = 'text/javascript';
            utterances.async = true;
            utterances.setAttribute('issue-term', "pathname")
            utterances.setAttribute('repo', "kingcos\/kingcos.github.io")
            utterances.setAttribute('label', "comments")
            isDark ? utterances.setAttribute('theme', "github-dark") : utterances.setAttribute('theme', "github-light")
            utterances.crossorigin = 'anonymous';
            utterances.src = 'https://utteranc.es/client.js';

            return utterances
        }
        document.getElementById('github-comment').appendChild(getUtterances(false))
        </script>
    </div>
    




                
            </div>
        </div>
    </div>
    <a id="back_to_top" href="#" class="back_to_top"><i class="ri-arrow-up-s-line"></i></a>
    <footer class="footer">
    <div class="powered_by">
        <a href="https://kingcos.me">Powered by kingcos with love.</a>
    </div>

    <div class="footer_slogan">
        <span>â¤ï¸</span>
    </div>
</footer>
    <script src="https://kingcos.me/js/jquery-3.5.1.min.js"></script>
<link href="https://kingcos.me/css/fancybox.min.css" rel="stylesheet">
<script src="https://kingcos.me/js/fancybox.min.js"></script>
<script src="https://kingcos.me/js/zozo.js"></script>


<script type="text/javascript" async
    src="https://cdn.bootcss.com/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
        MathJax.Hub.Config({
            tex2jax: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\[\[', '\]\]']],
                processEscapes: true,
                processEnvironments: true,
                skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
                TeX: {
                    equationNumbers: { autoNumber: "AMS" },
                    extensions: ["AMSmath.js", "AMSsymbols.js"]
                }
            }
        });

        MathJax.Hub.Queue(function () {
            
            
            
            var all = MathJax.Hub.getAllJax(), i;
            for (i = 0; i < all.length; i += 1) {
                all[i].SourceElement().parentNode.className += ' has-jax';
            }
        });
    </script>

<style>
    code.has-jax {
        font: inherit;
        font-size: 100%;
        background: inherit;
        border: inherit;
        color: #515151;
    }
</style>



<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-138311951-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</body>

</html>