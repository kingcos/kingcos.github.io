<!DOCTYPE html>
<html lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="kingcos" />
	
	
	
	<title>Obj-C ä¸­å®ä¾‹å˜é‡å’Œç±»çš„è®¿é—®æ§åˆ¶ ï½œ kingcos</title>
	
    
    
    <meta name="description" content="Obj-C ä¸­çš„å®ä¾‹å˜é‡ï¼Œå³ Instance Variablesï¼Œç®€ç§°ä¸º ivarã€‚åœ¨é¢å‘å¯¹è±¡çš„æ¦‚å¿µä¸­ï¼Œä¸€ä¸ªç±»çš„å¯¹å¤–æš´éœ²å†³å®šäº†å…¶æ‰€æä¾›çš„èƒ½åŠ›ï¼Œå¯¹å­ç±»åˆ™éœ€è¦æä¾›ä¸€å®šçš„æ‰©å±•æ€§ï¼Œä½†æœ‰äº›æ—¶å€™æˆ‘ä»¬ä¸å¸Œæœ›å¤–ç•Œç”šè‡³å­ç±»çŸ¥é“ä¸€äº›ç»†èŠ‚ï¼Œè¿™æ—¶å°±ç”¨åˆ°äº†è®¿é—®æ§åˆ¶ï¼ˆAccess Controlï¼‰ã€‚åœ¨ C&#43;&#43;ã€Javaã€Swift ç­‰å¤§å¤šæ•°é«˜çº§è¯­è¨€ä¸­éƒ½æœ‰è¿™æ ·çš„æ¦‚å¿µï¼Œé‚£ä¹ˆè¿™æ¬¡å°±æ¥è°ˆè°ˆ Obj-C ä¸­å®ä¾‹å˜é‡å’Œç±»çš„è®¿é—®æ§åˆ¶ã€‚" />
    

    
    
    <meta name="keywords" content="Hugo, theme, zozo" />
    

	
    
    <link rel="shortcut icon" href="https://kingcos.me/images/favicon.png" />

    <link rel="stylesheet" type="text/css" media="screen" href="https://kingcos.me/css/normalize.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.0/animate.min.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="https://kingcos.me/css/zozo.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://cdn.jsdelivr.net/npm/remixicon@2.5.0/fonts/remixicon.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="https://kingcos.me/css/highlight.css" />

    
    
</head>

<script data-ad-client="ca-pub-9925978992661955" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<body>
    <div class="main animate__animated animate__fadeInDown">
        <div class="nav_container animated fadeInDown">
    <div class="site_nav" id="site_nav">
        <ul>
            
            <li>
                <a href="/">Home</a>
            </li>
            
            <li>
                <a href="/posts/">Archive</a>
            </li>
            
            <li>
                <a href="/tags/">Tags</a>
            </li>
            
            <li>
                <a href="/about/">About</a>
            </li>
            
        </ul>
    </div>
    <div class="menu_icon">
        <a id="menu_icon"><i class="ri-menu-line"></i></a>
    </div>
</div>


<link rel="stylesheet" href="https://kingcos.me/scss/main.min.75b49085bfb07b1bf150a1d59b4773d857e0452a747e37243805218b528a4045.css" integrity="sha256-dbSQhb&#43;wexvxUKHVm0dz2FfgRSp0fjckOAUhi1KKQEU=" media="screen">

<style>
.nav_container {
  height: 1rem;
}
 
table {
    width: 100%;
    table-layout: fixed;
}

 
.markdown code {
    white-space: normal;
    word-wrap: break-word;
    word-break: break-word;
    line-height: 1.5em;
    font-size: 0.85em;
    font-weight: bold;
    display: inline-block;
     
}

 
.menu_icon a {
    font-size: 16px;
}

 
body {
    font-family: 'Hiragino Sans GB', 'SFMono', 'Lato', '-apple-system';
    -webkit-font-smoothing: 'antialiased';
}

 
.markdown strong, .markdown b, .markdown em {
    font-weight: bold;
}

.post .post_content p {
     

    line-height: 1.75em;
}

 
.markdown img {
    max-width: 100%;
    margin: 0 auto;
    display: block;
    border-radius: 0.25rem;
}

 
.ri-stack-line {
    vertical-align: middle;
}

 
.ri-map-pin-time-line {
    vertical-align: middle;
}

 
.chroma .lntd:nth-child(2) {
    width: 100%;
}

 

 
.markdown .book-hint::before {
    content: none;
}

.markdown .book-hint {
    margin: 1rem 0;
    padding: 0.5rem 1rem 0.5rem 0.75rem;

    border-inline-start: 0.25rem solid #e9ecef;
    border-radius: 0.25rem;

    font-style: normal;
     
}

.book-hint strong {
    background-color: transparent;
}

.markdown .book-hint.info {
    border-left-color:#6bf;
    background-color:rgba(102,187,255,.1);
}

.markdown .book-hint.warning {
    border-left-color:#fd6;
    background-color:rgba(255,221,102,.1);
}

.markdown .book-hint.danger {
    border-left-color:#f66;
    background-color:rgba(255,102,102,.1);
}

</style>

        <div class="header animated fadeInDown">
    <div class="site_title_container">
        <div class="site_title">
            
                <a href="https://kingcos.me/">
                    
                    <img class="kingcos" style="margin-top: -20px; margin-left: -10px;" src="/title.svg" width="150px">
                </a>
            
        </div>
        <div class="description">
            <p class="sub_title">ä¸“æ³¨ã€åšæŒ</p>
            <div class="my_socials">
                
                
                <a href="https://github.com/kingcos" title="github" target="_blank"><i class="ri-github-fill"></i></a>
                
                
                
                <a href="https://www.instagram.com/kingcos_v/" title="instagram" target="_blank"><i class="ri-instagram-fill"></i></a>
                
                
                
                <a href="https://twitter.com/kingcos_v" title="twitter" target="_blank"><i class="ri-twitter-fill"></i></a>
                
                
                
                <a href="https://weibo.com/u/1798410923" title="weibo" target="_blank"><i class="ri-weibo-fill"></i></a>
                
                
                
            </div>
        </div>
    </div>
</div>
        <div class="content">
            <div class="post_page">
                <div class="post animate__animated animate__fadeInDown">
                    <div class="post_title post_detail_title">
                        <h2><a href='/posts/2019/ivar_access_control_in_obj-c/'>Obj-C ä¸­å®ä¾‹å˜é‡å’Œç±»çš„è®¿é—®æ§åˆ¶</a></h2>
                        <span class="date">2020.01.17</span>
                        <span>by kingcos</span>
                        
                        
                        
                        
                    </div>
                    <div class="post_content markdown"><table>
<thead>
<tr>
<th style="text-align:center">Date</th>
<th style="text-align:center">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">2019-06-14</td>
<td style="text-align:center">å¢åŠ  <code>man nm</code> æˆªå›¾</td>
</tr>
<tr>
<td style="text-align:center">2019-04-29</td>
<td style="text-align:center">å®Œå–„ <code>@package</code></td>
</tr>
<tr>
<td style="text-align:center">2019-03-30</td>
<td style="text-align:center">gcc, clang; macOS 10.14.2</td>
</tr>
<tr>
<td style="text-align:center">2020-01-17</td>
<td style="text-align:center">å‹˜è¯¯ï¼Œéƒ¨åˆ†ç»†èŠ‚è°ƒæ•´</td>
</tr>
</tbody>
</table>
<h2 id="preface">Preface</h2>
<p>Obj-C ä¸­çš„å®ä¾‹å˜é‡ï¼Œå³ Instance Variablesï¼Œç®€ç§°ä¸º ivarã€‚åœ¨é¢å‘å¯¹è±¡çš„æ¦‚å¿µä¸­ï¼Œä¸€ä¸ªç±»çš„å¯¹å¤–æš´éœ²å†³å®šäº†å…¶æ‰€æä¾›çš„èƒ½åŠ›ï¼Œå¯¹å­ç±»åˆ™éœ€è¦æä¾›ä¸€å®šçš„æ‰©å±•æ€§ï¼Œä½†æœ‰äº›æ—¶å€™æˆ‘ä»¬ä¸å¸Œæœ›å¤–ç•Œç”šè‡³å­ç±»çŸ¥é“ä¸€äº›ç»†èŠ‚ï¼Œè¿™æ—¶å°±ç”¨åˆ°äº†è®¿é—®æ§åˆ¶ï¼ˆAccess Controlï¼‰ã€‚åœ¨ C++ã€Javaã€Swift ç­‰å¤§å¤šæ•°é«˜çº§è¯­è¨€ä¸­éƒ½æœ‰è¿™æ ·çš„æ¦‚å¿µï¼Œé‚£ä¹ˆè¿™æ¬¡å°±æ¥è°ˆè°ˆ Obj-C ä¸­å®ä¾‹å˜é‡å’Œç±»çš„è®¿é—®æ§åˆ¶ã€‚</p>
<h2 id="è®¿é—®æ§åˆ¶ä¿®é¥°ç¬¦">è®¿é—®æ§åˆ¶ä¿®é¥°ç¬¦</h2>
<h3 id="public">@public</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-objectivec" data-lang="objectivec"><span class="k">@interface</span> <span class="nc">Foo</span> : <span class="nc">NSObject</span> <span class="p">{</span>
<span class="k">@public</span>
    <span class="n">NSString</span> <span class="o">*</span><span class="n">_ivar</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">@end</span>

<span class="k">@implementation</span> <span class="nc">Foo</span>
<span class="k">@end</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
    <span class="n">Foo</span> <span class="o">*</span><span class="n">f</span> <span class="o">=</span> <span class="p">[[</span><span class="n">Foo</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>

    <span class="n">f</span><span class="o">-&gt;</span><span class="n">_ivar</span> <span class="o">=</span> <span class="s">@&#34;kingcos.me&#34;</span><span class="p">;</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&#34;%@&#34;</span><span class="p">,</span> <span class="n">f</span><span class="o">-&gt;</span><span class="n">_ivar</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// OUTPUT:
</span><span class="c1">// kingcos.me
</span></code></pre></div><p>å£°æ˜ä¸º <code>@public</code> çš„å®ä¾‹å˜é‡æ˜¯è®¿é—®æ§åˆ¶ä¸­å¼€æ”¾èŒƒå›´æœ€å¹¿çš„ï¼Œå…¶å…è®¸å¤–ç•Œå¯ä»¥ç›´æ¥è®¿é—®ï¼ˆå½“ç„¶ï¼Œå‰ææ˜¯å¼•å…¥åŒ…å«è¯¥å£°æ˜çš„å¤´æ–‡ä»¶ï¼‰ã€‚</p>
<h3 id="protected">@protected</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-objectivec" data-lang="objectivec"><span class="k">@interface</span> <span class="nc">SubFoo</span> : <span class="nc">Foo</span> <span class="p">{</span>
    <span class="n">NSString</span> <span class="o">*</span><span class="n">_ivar2</span><span class="p">;</span>
<span class="k">@protected</span>
    <span class="n">NSString</span> <span class="o">*</span><span class="n">_ivar3</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">subFooFunc</span><span class="p">;</span>
<span class="k">@end</span>

<span class="k">@implementation</span> <span class="nc">SubFoo</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">subFooFunc</span> <span class="p">{</span>
    <span class="nb">self</span><span class="o">-&gt;</span><span class="n">_ivar2</span> <span class="o">=</span> <span class="s">@&#34;kingcos.me&#34;</span><span class="p">;</span>
    <span class="nb">self</span><span class="o">-&gt;</span><span class="n">_ivar3</span> <span class="o">=</span> <span class="s">@&#34;kingcos.me&#34;</span><span class="p">;</span>

    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&#34;%@&#34;</span><span class="p">,</span> <span class="nb">self</span><span class="o">-&gt;</span><span class="n">_ivar2</span><span class="p">);</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&#34;%@&#34;</span><span class="p">,</span> <span class="nb">self</span><span class="o">-&gt;</span><span class="n">_ivar3</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">@end</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
    <span class="n">SubFoo</span> <span class="o">*</span><span class="n">f</span> <span class="o">=</span> <span class="p">[[</span><span class="n">SubFoo</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>

    <span class="c1">// ERROR: Instance variable &#39;_ivar2&#39; is protected
</span><span class="c1"></span>    <span class="c1">// f-&gt;_ivar2 = @&#34;kingcos.me&#34;;
</span><span class="c1"></span>    <span class="p">[</span><span class="n">f</span> <span class="n">subFooFunc</span><span class="p">];</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// OUTPUT:
</span><span class="c1">// kingcos.me
</span><span class="c1">// kingcos.me
</span></code></pre></div><p>å£°æ˜ä¸º <code>@protected</code> çš„å®ä¾‹å˜é‡åªèƒ½åœ¨æœ¬ç±»ã€æœ¬ç±»çš„åˆ†ç±»ä»¥åŠå­ç±»ä¸­ä½¿ç”¨ã€‚æ³¨æ„ï¼Œå½“ä¸ä½¿ç”¨ä»»ä½•è®¿é—®æ§åˆ¶ä¿®é¥°ç¬¦æ—¶ï¼Œç±»ä¸­å®ä¾‹å˜é‡é»˜è®¤å³ä¸º <code>@protected</code>ï¼ˆæ³¨æ„ï¼šç±»æ‰©å±•ä¸­æ˜¯ä¸ªä¾‹å¤–ï¼Œè¯¦è§ã€Œç±»æ‰©å±•ã€ä¸€èŠ‚ï¼‰ã€‚</p>
<h3 id="private">@private</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-objectivec" data-lang="objectivec"><span class="k">@interface</span> <span class="nc">Foo</span> : <span class="nc">NSObject</span> <span class="p">{</span>
<span class="k">@private</span>
    <span class="n">NSString</span> <span class="o">*</span><span class="n">_ivar4</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">@property</span> <span class="p">(</span><span class="k">nonatomic</span><span class="p">,</span> <span class="k">copy</span><span class="p">)</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">prop</span><span class="p">;</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">fooFunc</span><span class="p">;</span>
<span class="k">@end</span>

<span class="k">@implementation</span> <span class="nc">Foo</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">fooFunc</span> <span class="p">{</span>
    <span class="nb">self</span><span class="o">-&gt;</span><span class="n">_ivar4</span> <span class="o">=</span> <span class="s">@&#34;kingcos.me&#34;</span><span class="p">;</span>
    <span class="nb">self</span><span class="o">-&gt;</span><span class="n">_prop</span> <span class="o">=</span> <span class="s">@&#34;kingcos.me&#34;</span><span class="p">;</span>

    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&#34;%@&#34;</span><span class="p">,</span> <span class="nb">self</span><span class="o">-&gt;</span><span class="n">_ivar4</span><span class="p">);</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&#34;%@&#34;</span><span class="p">,</span> <span class="nb">self</span><span class="o">-&gt;</span><span class="n">_prop</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">@end</span>

<span class="k">@interface</span> <span class="nc">Foo</span> <span class="nl">(Ext)</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">fooExtFunc</span><span class="p">;</span>
<span class="k">@end</span>

<span class="k">@implementation</span> <span class="nc">Foo</span> <span class="nl">(Ext)</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">fooExtFunc</span> <span class="p">{</span>
    <span class="nb">self</span><span class="o">-&gt;</span><span class="n">_ivar4</span> <span class="o">=</span> <span class="s">@&#34;kingcos.me&#34;</span><span class="p">;</span>
    <span class="nb">self</span><span class="o">-&gt;</span><span class="n">_prop</span> <span class="o">=</span> <span class="s">@&#34;kingcos.me&#34;</span><span class="p">;</span>

    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&#34;%@&#34;</span><span class="p">,</span> <span class="nb">self</span><span class="o">-&gt;</span><span class="n">_ivar4</span><span class="p">);</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&#34;%@&#34;</span><span class="p">,</span> <span class="nb">self</span><span class="o">-&gt;</span><span class="n">_prop</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">@end</span>

<span class="k">@interface</span> <span class="nc">SubFoo</span> : <span class="nc">Foo</span> <span class="p">{</span>
    <span class="n">NSString</span> <span class="o">*</span><span class="n">_ivar2</span><span class="p">;</span>
<span class="k">@protected</span>
    <span class="n">NSString</span> <span class="o">*</span><span class="n">_ivar3</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">subFooFunc</span><span class="p">;</span>
<span class="k">@end</span>

<span class="k">@implementation</span> <span class="nc">SubFoo</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">subFooFunc</span> <span class="p">{</span>
    <span class="nb">self</span><span class="o">-&gt;</span><span class="n">_ivar2</span> <span class="o">=</span> <span class="s">@&#34;kingcos.me&#34;</span><span class="p">;</span>
    <span class="nb">self</span><span class="o">-&gt;</span><span class="n">_ivar3</span> <span class="o">=</span> <span class="s">@&#34;kingcos.me&#34;</span><span class="p">;</span>

    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&#34;%@&#34;</span><span class="p">,</span> <span class="nb">self</span><span class="o">-&gt;</span><span class="n">_ivar2</span><span class="p">);</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&#34;%@&#34;</span><span class="p">,</span> <span class="nb">self</span><span class="o">-&gt;</span><span class="n">_ivar3</span><span class="p">);</span>

    <span class="c1">// ERROR: Instance variable &#39;_ivar4&#39; is private
</span><span class="c1"></span>    <span class="c1">// self-&gt;_ivar4 = @&#34;kingcos.me&#34;;
</span><span class="c1"></span>    <span class="c1">// ERROR: Instance variable &#39;_prop&#39; is private
</span><span class="c1"></span>    <span class="c1">// self-&gt;_prop = @&#34;kingcos.me&#34;;
</span><span class="c1"></span><span class="p">}</span>
<span class="k">@end</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
    <span class="n">Foo</span> <span class="o">*</span><span class="n">f</span> <span class="o">=</span> <span class="p">[[</span><span class="n">Foo</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
    <span class="p">[</span><span class="n">f</span> <span class="n">fooFunc</span><span class="p">];</span>
    <span class="p">[</span><span class="n">f</span> <span class="n">fooExtFunc</span><span class="p">];</span>

    <span class="n">SubFoo</span> <span class="o">*</span><span class="n">sf</span> <span class="o">=</span> <span class="p">[[</span><span class="n">SubFoo</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
    <span class="p">[</span><span class="n">sf</span> <span class="n">subFooFunc</span><span class="p">];</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// OUTPUT:
</span><span class="c1">// kingcos.me
</span><span class="c1">// kingcos.me
</span><span class="c1">// kingcos.me
</span><span class="c1">// kingcos.me
</span><span class="c1">// kingcos.me
</span><span class="c1">// kingcos.me
</span></code></pre></div><p>å£°æ˜ä¸º <code>@private</code> çš„å®ä¾‹å˜é‡æ˜¯è®¿é—®æ§åˆ¶ä¸­å¼€æ”¾èŒƒå›´æœ€å°çš„ï¼Œåªèƒ½è¢«æœ¬ç±»å’Œæœ¬ç±»çš„åˆ†ç±»è®¿é—®åˆ°ï¼Œå­ç±»ä¸­ä¹Ÿæ— æ³•è®¿é—®ã€‚åœ¨ç±»å£°æ˜ä¸­çš„å±æ€§ï¼ˆ<code>@property</code>ï¼‰ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ä¸ºæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª <code>_</code> å¼€å¤´çš„å®ä¾‹å˜é‡ï¼Œè¿™ä¸ªå®ä¾‹å˜é‡çš„å¯è§ç¨‹åº¦é»˜è®¤ä¹Ÿæ˜¯ <code>@private</code>ã€‚</p>
<h3 id="package">@package</h3>
<p><code>@package</code> åœ¨å¹³æ—¶å¹¶ä¸å¤šè§ï¼Œä½†ä» <code>@package</code> èƒ½å¤Ÿå»¶ä¼¸åˆ°ä¸€äº›å…¶ä»–é—®é¢˜ã€‚æ ¹æ®å®˜æ–¹æ–‡æ¡£æ‰€è¿°ï¼š</p>
<blockquote>
<p><code>@package</code> is a new instance variable protection class, like <code>@public</code> and <code>@protected</code>. <code>@package</code> instance variables behave as follows:</p>
<ul>
<li><code>@public</code> in 32-bit;</li>
<li><code>@public</code> in 64-bit, inside the framework that defined the class;</li>
<li><code>@private</code> in 64-bit, outside the framework that defined the class.</li>
</ul>
<p>In 64-bit, the instance variable symbol for an <code>@package</code> ivar is not exported, so any attempt to use the ivar from outside the framework that defined the class will fail with a link error. See &ldquo;<a href="https://developer.apple.com/library/archive/releasenotes/Cocoa/RN-ObjectiveC/index.html#//apple_ref/doc/uid/TP40004309-CH1-SW1">64-bit Class and Instance Variable Access Control</a>&rdquo; for more about instance variable symbols.</p>
<p>â€”â€” @package Instance Variables, Objective-C Release Notes</p>
<p>è¯‘ï¼š</p>
<p><code>@package</code> æ˜¯ä¸€ä¸ªæ–°çš„å®ä¾‹å˜é‡ä¿æŠ¤ç±»å‹ï¼Œå°±åƒ <code>@public</code> å’Œ <code>@protected</code>ã€‚<code>@package</code>ï¼ˆä¿®é¥°ï¼‰çš„å®ä¾‹å˜é‡è¡Œä¸ºå¦‚ä¸‹ï¼š</p>
<ul>
<li>åœ¨ 32 ä½ä¸‹ï¼Œï¼ˆç­‰åŒäºï¼‰<code>@public</code></li>
<li>åœ¨ 64 ä½ä¸‹ï¼Œä¸”åœ¨å®šä¹‰è¯¥ç±»çš„ Framework ä¸­ï¼ˆç­‰åŒäºï¼‰<code>@public</code></li>
<li>åœ¨ 64 ä½ä¸‹ï¼Œä½†ä¸åœ¨å®šä¹‰è¯¥ç±»çš„ Framework ä¸­ï¼ˆç­‰åŒäºï¼‰<code>@private</code></li>
</ul>
<p>â€”â€” @package å®ä¾‹å˜é‡ï¼ŒObjective-C å‘å¸ƒè¯´æ˜</p>
<p>Using the modern runtime, an <code>@package</code> instance variable has <code>@public</code> scope inside the executable image that implements the class, but acts like <code>@private</code> outside.</p>
<p>The <code>@package</code> scope for Objective-C instance variables is analogous to <code>private_extern</code> for C variables and functions. Any code outside the class implementationâ€™s image that tries to use the instance variable gets a link error.</p>
<p>This scope is most useful for instance variables in framework classes, where <code>@private</code> may be too restrictive but <code>@protected</code> or <code>@public</code> too permissive.</p>
<p>â€”â€” The Scope of Instance Variables, The Objective-C Programming Language</p>
<p>è¯‘ï¼š</p>
<p>å€ŸåŠ©ç°ä»£è¿è¡Œæ—¶ï¼Œ<code>@package</code> å®ä¾‹å˜é‡åœ¨å®ç°ç±»çš„åŒä¸€å¯æ‰§è¡Œé•œåƒä¹‹å†…ä¸º <code>@public</code>ï¼Œä¹‹å¤–ä¸º <code>@private</code>ã€‚</p>
<p>Obj-C å®ä¾‹å˜é‡çš„ <code>@package</code> åŸŸç±»ä¼¼ C å˜é‡å’Œå‡½æ•°çš„ <code>private_extern</code>ã€‚ä»»ä½•åœ¨ç±»å®ç°é•œåƒä¹‹å¤–çš„ä»£ç å°è¯•è®¿é—®è¯¥ç±»å‹å®ä¾‹å˜é‡ï¼Œå°†å‘ç”Ÿé“¾æ¥é”™è¯¯ã€‚</p>
<p>ç”±äº <code>@private</code> å¤ªè¿‡é™åˆ¶ï¼Œè€Œ <code>@protected</code> æˆ– <code>@public</code> åˆå¤ªå¼€æ”¾ï¼Œè¯¥åŸŸå¯¹äºæ¡†æ¶ç±»ä¸­çš„å®ä¾‹å˜é‡ååˆ†æœ‰ç”¨ã€‚</p>
<p>â€”â€” å®ä¾‹å˜é‡çš„åŸŸï¼ŒObj-C ç¼–ç¨‹è¯­è¨€</p>
</blockquote>
<p>å°è¯•åœ¨åŸæœ‰çš„é¡¹ç›®ä¸­å»ºç«‹ä¸€ä¸ª Cocoa Frameworkï¼ˆXcode 11 ä¸­ä¸º Frameworkï¼‰çš„ Target å’Œä¸€ä¸ª Static Libraryï¼Œå¹¶å¯¼å…¥ä»¥ä¸‹ä»£ç ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-objectivec" data-lang="objectivec"><span class="c1">// Baz.h - Framework
</span><span class="c1">// éœ€æ‰‹åŠ¨å°† `Baz.h` ç§»åŠ¨è‡³ Bar Taget çš„ Build Phases ä¸­ Headers çš„ Public åŸŸï¼Œ
</span><span class="c1"></span><span class="cp">#import &lt;Foundation/Foundation.h&gt;
</span><span class="cp"></span>
<span class="n">NS_ASSUME_NONNULL_BEGIN</span>

<span class="k">@interface</span> <span class="nc">Baz</span> : <span class="nc">NSObject</span> <span class="p">{</span>
<span class="p">@</span><span class="n">package</span>
    <span class="n">NSString</span> <span class="o">*</span><span class="n">ivar5</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">@end</span>

<span class="n">NS_ASSUME_NONNULL_END</span>

<span class="c1">// Bar.h
</span><span class="c1"></span><span class="cp">#import &lt;Foundation/Foundation.h&gt;
</span><span class="cp"></span>
<span class="c1">//! Project version number for Bar.
</span><span class="c1"></span><span class="n">FOUNDATION_EXPORT</span> <span class="kt">double</span> <span class="n">BarVersionNumber</span><span class="p">;</span>

<span class="c1">//! Project version string for Bar.
</span><span class="c1"></span><span class="n">FOUNDATION_EXPORT</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">BarVersionString</span><span class="p">[];</span>

<span class="c1">// In this header, you should import all the public headers of your framework using statements like #import &lt;Bar/PublicHeader.h&gt;
</span><span class="c1"></span><span class="cp">#import &#34;Baz.h&#34;
</span><span class="cp"></span>
<span class="cp">#import &lt;Foundation/Foundation.h&gt;
</span><span class="cp"></span>
<span class="k">@interface</span> <span class="nc">StaticBar</span> : <span class="nc">NSObject</span> <span class="p">{</span>
<span class="p">@</span><span class="n">package</span>
    <span class="n">NSString</span> <span class="o">*</span><span class="n">_ivar6</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">@end</span>

<span class="c1">// StaticBar.h - Static Library
</span><span class="c1">// éœ€æ‰‹åŠ¨åœ¨ä¸» Target çš„ Build Phases ä¸­ Link Binary With Libraries ä¸­æ·»åŠ  libStaticBar.a
</span><span class="c1"></span><span class="cp">#import &lt;Foundation/Foundation.h&gt;
</span><span class="cp"></span>
<span class="k">@interface</span> <span class="nc">StaticBar</span> : <span class="nc">NSObject</span> <span class="p">{</span>
<span class="p">@</span><span class="n">package</span>
    <span class="n">NSString</span> <span class="o">*</span><span class="n">_ivar6</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">@end</span>

<span class="c1">// main.m
</span><span class="c1"></span><span class="cp">#import &lt;Bar/Bar.h&gt;
</span><span class="cp">#import &#34;StaticBar.h&#34;
</span><span class="cp"></span>
<span class="kt">int</span> <span class="n">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
    <span class="n">Baz</span> <span class="o">*</span><span class="n">b</span> <span class="o">=</span> <span class="p">[[</span><span class="n">Baz</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>

    <span class="c1">// ERROR: Undefined symbol: _OBJC_IVAR_$_Baz.ivar5
</span><span class="c1"></span>    <span class="c1">// b-&gt;ivar5 = @&#34;kingcos.me&#34;;
</span><span class="c1"></span>
    <span class="n">StaticBar</span> <span class="o">*</span><span class="n">sb</span> <span class="o">=</span> <span class="p">[[</span><span class="n">StaticBar</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
    <span class="n">sb</span><span class="o">-&gt;</span><span class="n">_ivar6</span> <span class="o">=</span> <span class="s">@&#34;kingcos.me&#34;</span><span class="p">;</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&#34;%@&#34;</span><span class="p">,</span> <span class="n">sb</span><span class="o">-&gt;</span><span class="n">_ivar6</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>


<span class="c1">// OUTPUT:
</span><span class="c1">// kingcos.me
</span></code></pre></div><p>å°è¯•å‘ç°ï¼š</p>
<ol>
<li>å½“ Framework çš„ Mach-O Type ä¸ºåŠ¨æ€åº“ï¼ˆDynamic Libraryï¼‰æ—¶ï¼Œå°†å‡ºç°é”™è¯¯ï¼Œå³æ— æ³•è®¿é—®åˆ° <code>@package</code> ä¿®é¥°çš„ <code>_name</code> å®ä¾‹å˜é‡ï¼›</li>
<li>å½“ä½¿ç”¨ Static Library æˆ– Framework çš„ Mach-O Type ä¸ºé™æ€åº“ï¼ˆStatic Libraryï¼‰æˆ–æ—¶ï¼Œå¯ä»¥æ­£å¸¸ç¼–è¯‘å¹¶è¿è¡Œã€‚</li>
</ol>
<p>è¿™å…¶å®ä¹Ÿå°±éªŒè¯äº†å®˜æ–¹æ–‡æ¡£ä¸­å¯¹äº <code>@private</code> åœ¨é•œåƒï¼ˆImageï¼‰çš„æè¿°ã€‚å¯¹äºé™æ€åº“ï¼Œå…¶åœ¨ç¼–è¯‘æ—¶åˆ»å³è¢«è½½å…¥ï¼Œå› æ­¤å±äºåŒä¸€ä¸ªé•œåƒï¼Œå¯ä»¥æ­£å¸¸ç¼–è¯‘å¹¶è¿è¡Œï¼›è€ŒåŠ¨æ€åº“åªæœ‰åœ¨è¿è¡Œæ—¶æ‰èƒ½è¢«è½½å…¥ï¼Œå¹¶ä¸æ˜¯åŒä¸€ä¸ªé•œåƒï¼Œå› æ­¤è®¿é—®æ—¶å‡ºç°äº†é“¾æ¥é”™è¯¯ã€‚åœ¨ StackOverflow ä¸Šçš„ä¸€ä¸ªé—®é¢˜ä¸­ä¹Ÿæåˆ°äº† Imageï¼ˆé•œåƒï¼‰ï¼Œç›¸å…³é“¾æ¥å¯åœ¨æ–‡æœ«ã€ŒReferenceã€ä¸­æ‰¾åˆ°ã€‚</p>
<p>ã€Š<a href="../libraries_in_ios/">iOS ä¸­çš„åº“ä¸æ¡†æ¶</a>ã€‹ä¸€æ–‡ã€‚</p>
<h3 id="ç±»æ‰©å±•">ç±»æ‰©å±•</h3>
<p>åœ¨ Obj-C çš„ç±»æ‰©å±•ï¼ˆClass Extensionï¼‰ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€äº›ä¸æƒ³æš´éœ²åœ¨å¤–ç•Œï¼ˆ.hï¼‰çš„å®ä¾‹å˜é‡ã€å±æ€§ã€æˆ–æ–¹æ³•ï¼Œåšåˆ°ã€Œç‰©ç†ã€éš”ç¦»ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå®šä¹‰åœ¨ç±»æ‰©å±•ä¸­çš„å®ä¾‹å˜é‡ï¼Œé»˜è®¤ä¸º <code>@private</code>ï¼Œä»…ä¾›æœ¬ç±»ä½¿ç”¨ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-objectivec" data-lang="objectivec"><span class="c1">// Foo.h
</span><span class="c1"></span><span class="cp">#import &lt;Foundation/Foundation.h&gt;
</span><span class="cp"></span>
<span class="n">NS_ASSUME_NONNULL_BEGIN</span>

<span class="k">@interface</span> <span class="nc">Foo</span> : <span class="nc">NSObject</span>
<span class="k">@end</span>

<span class="n">NS_ASSUME_NONNULL_END</span>

<span class="c1">// Foo+Private.h
</span><span class="c1"></span><span class="cp">#import &#34;Foo.h&#34;
</span><span class="cp"></span>
<span class="n">NS_ASSUME_NONNULL_BEGIN</span>

<span class="k">@interface</span> <span class="nc">Foo</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">_ivar2</span><span class="p">;</span>

<span class="k">@public</span>
    <span class="kt">int</span> <span class="n">_ivar3</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">@end</span>

<span class="n">NS_ASSUME_NONNULL_END</span>

<span class="c1">// Foo.m
</span><span class="c1"></span><span class="cp">#import &#34;Foo.h&#34;
</span><span class="cp">#import &#34;Foo+Private.h&#34;
</span><span class="cp"></span>
<span class="k">@interface</span> <span class="nc">Foo</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">_ivar1</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">@end</span>

<span class="k">@implementation</span> <span class="nc">Foo</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">foo</span> <span class="p">{</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&#34;%d&#34;</span><span class="p">,</span> <span class="nb">self</span><span class="o">-&gt;</span><span class="n">_ivar1</span><span class="p">);</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&#34;%d&#34;</span><span class="p">,</span> <span class="nb">self</span><span class="o">-&gt;</span><span class="n">_ivar2</span><span class="p">);</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&#34;%d&#34;</span><span class="p">,</span> <span class="nb">self</span><span class="o">-&gt;</span><span class="n">_ivar3</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">@end</span>

<span class="c1">// SubFoo.h
</span><span class="c1"></span><span class="cp">#import &#34;Foo.h&#34;
</span><span class="cp">#import &#34;Foo+Private.h&#34;
</span><span class="cp"></span>
<span class="n">NS_ASSUME_NONNULL_BEGIN</span>

<span class="k">@interface</span> <span class="nc">SubFoo</span> : <span class="nc">Foo</span>

<span class="k">@end</span>

<span class="n">NS_ASSUME_NONNULL_END</span>

<span class="c1">// SubFoo.m
</span><span class="c1"></span><span class="cp">#import &#34;SubFoo.h&#34;
</span><span class="cp"></span>
<span class="k">@implementation</span> <span class="nc">SubFoo</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">subFoo</span> <span class="p">{</span>
    <span class="c1">// ERROR: &#39;SubFoo&#39; does not have a member named &#39;_ivar1&#39;
</span><span class="c1"></span>    <span class="c1">// NSLog(@&#34;%d&#34;, self-&gt;_ivar1);
</span><span class="c1"></span>    <span class="c1">// ERROR: Instance variable &#39;_ivar2&#39; is private
</span><span class="c1"></span>    <span class="c1">// NSLog(@&#34;%d&#34;, self-&gt;_ivar2);
</span><span class="c1"></span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&#34;%d&#34;</span><span class="p">,</span> <span class="nb">self</span><span class="o">-&gt;</span><span class="n">_ivar3</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">@end</span>
</code></pre></div><p>å¦‚ä¸Šï¼Œå¯¹å¤–æˆ‘ä»¬åªéœ€è¦æš´éœ² <code>Foo.h</code>ï¼Œè€Œå°†ç±»æ‰©å±•æ‰€åœ¨çš„ <code>Foo+Private.h</code> ä¸æš´éœ²ä¸º Public Header å³å¯ï¼›æˆ–è€…ä¹Ÿå¯ä»¥å°†ç±»æ‰©å±•ç›´æ¥å®šä¹‰åœ¨ .m ä¸­ã€‚è€Œç”±äºç±»æ‰©å±•å±äºç¼–è¯‘æ—¶åˆ»çš„è¯­æ³•ï¼Œå› æ­¤å…¶å®šä¹‰åŠ¡å¿…è¦åœ¨æœ¬ç±»çš„ <code>@implementation</code> ä¹‹å‰ï¼Œåˆ‡å¿Œåœ¨åˆ†ç±»å®ç°æ–‡ä»¶ä¸­å®šä¹‰çš„ç±»æ‰©å±•ä¸­å¢åŠ å®ä¾‹å˜é‡ï¼ˆæ­¤æ—¶å¢åŠ å±æ€§ä¹Ÿä¸ä¼šè‡ªåŠ¨ç”Ÿæˆå®ä¾‹å˜é‡ï¼‰ã€‚</p>
<h2 id="ç¬¦å·symbols">ç¬¦å·ï¼ˆSymbolsï¼‰</h2>
<p><img src="/img/2019/ivar_access_control_in_obj-c/2.png" alt="2"></p>
<p><code>nm</code> æ˜¯ macOS è‡ªå¸¦çš„å‘½ä»¤è¡Œç¨‹åºï¼Œå¯ä»¥ç”¨æ¥æŸ¥çœ‹ Mach-O æ–‡ä»¶çš„ LLVM ç¬¦å·è¡¨ï¼Œä½†é»˜è®¤æƒ…å†µå°†æ‰“å°å…¨éƒ¨çš„ç¬¦å·ï¼Œå¦‚æœå¸Œæœ›åªæ˜¾ç¤ºå¤–éƒ¨çš„å…¨å±€ç¬¦å·ï¼Œå¯ä»¥ä½¿ç”¨ <code>-g</code> å‚æ•°ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-objectivec" data-lang="objectivec"><span class="c1">// main.m
</span><span class="c1"></span><span class="cp">#import &lt;Foundation/Foundation.h&gt;
</span><span class="cp"></span>
<span class="k">@interface</span> <span class="nc">Computer</span> : <span class="nc">NSObject</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">_memorySize</span><span class="p">;</span>

    <span class="k">@public</span>
    <span class="n">NSString</span> <span class="o">*</span><span class="n">_name</span><span class="p">;</span>

    <span class="p">@</span><span class="n">package</span>
    <span class="n">NSString</span> <span class="o">*</span><span class="n">_macAdress</span><span class="p">;</span>

    <span class="k">@protected</span>
    <span class="kt">int</span> <span class="n">_diskSize</span><span class="p">;</span>

    <span class="k">@private</span>
    <span class="kt">int</span> <span class="n">_secret</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">@property</span><span class="p">(</span><span class="k">nonatomic</span><span class="p">,</span> <span class="k">copy</span><span class="p">)</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">arch</span><span class="p">;</span>
<span class="k">@end</span>

<span class="k">@implementation</span> <span class="nc">Computer</span>
<span class="k">@end</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// nm executable-mach-o-file
</span><span class="c1">// 0000000100000e00 t -[Computer .cxx_destruct]
</span><span class="c1">// 0000000100000d90 t -[Computer arch]
</span><span class="c1">// 0000000100000dc0 t -[Computer setArch:]
</span><span class="c1">// 0000000100001270 S _OBJC_CLASS_$_Computer
</span><span class="c1">//                  U _OBJC_CLASS_$_NSObject
</span><span class="c1">// 0000000100001218 s _OBJC_IVAR_$_Computer._arch
</span><span class="c1">// 0000000100001238 S _OBJC_IVAR_$_Computer._diskSize
</span><span class="c1">// 0000000100001220 s _OBJC_IVAR_$_Computer._macAdress
</span><span class="c1">// 0000000100001230 S _OBJC_IVAR_$_Computer._memorySize
</span><span class="c1">// 0000000100001240 s _OBJC_IVAR_$_Computer._secret
</span><span class="c1">// 0000000100001228 S _OBJC_IVAR_$_Computer._name
</span><span class="c1">// 0000000100001248 S _OBJC_METACLASS_$_Computer
</span><span class="c1">//                  U _OBJC_METACLASS_$_NSObject
</span><span class="c1">// 0000000100000000 T __mh_execute_header
</span><span class="c1">//                  U __objc_empty_cache
</span><span class="c1">// 0000000100000e70 T _main
</span><span class="c1">//                  U _objc_getProperty
</span><span class="c1">//                  U _objc_msgSend
</span><span class="c1">//                  U _objc_setProperty_nonatomic_copy
</span><span class="c1">//                  U _objc_storeStrong
</span><span class="c1">//                  U dyld_stub_binder
</span><span class="c1"></span>
<span class="c1">// nm -g executable-mach-o-file
</span><span class="c1">// 0000000100001270 S _OBJC_CLASS_$_Computer
</span><span class="c1">//                  U _OBJC_CLASS_$_NSObject
</span><span class="c1">// 0000000100001238 S _OBJC_IVAR_$_Computer._diskSize
</span><span class="c1">// 0000000100001230 S _OBJC_IVAR_$_Computer._memorySize
</span><span class="c1">// 0000000100001228 S _OBJC_IVAR_$_Computer._name
</span><span class="c1">// 0000000100001248 S _OBJC_METACLASS_$_Computer
</span><span class="c1">//                  U _OBJC_METACLASS_$_NSObject
</span><span class="c1">// 0000000100000000 T __mh_execute_header
</span><span class="c1">//                  U __objc_empty_cache
</span><span class="c1">// 0000000100000e70 T _main
</span><span class="c1">//                  U _objc_getProperty
</span><span class="c1">//                  U _objc_msgSend
</span><span class="c1">//                  U _objc_setProperty_nonatomic_copy
</span><span class="c1">//                  U _objc_storeStrong
</span><span class="c1">//                  U dyld_stub_binder
</span></code></pre></div><p>åœ¨ 64 ä½çš„ Obj-C ä¸­ï¼Œæ¯ä¸ªç±»ä»¥åŠå®ä¾‹å˜é‡çš„è®¿é—®æ§åˆ¶éƒ½æœ‰ä¸€ä¸ªä¸ä¹‹å…³è”çš„ç¬¦å·ï¼Œç±»æˆ–å®ä¾‹å˜é‡éƒ½ä¼šé€šè¿‡å¼•ç”¨æ­¤ç¬¦å·æ¥ä½¿ç”¨ã€‚ç±»ç¬¦å·çš„æ ¼å¼ä¸º <code>_OBJC_CLASS_$_ClassName</code> å’Œ <code>_OBJC_METACLASS_$_ClassName</code>ï¼Œå®ä¾‹å˜é‡ç¬¦å·çš„æ ¼å¼ä¸º <code>_OBJC_IVAR_$_ClassName.IvarName</code>ã€‚</p>
<p>åœ¨ C/C++ ä¸­ä¹Ÿæœ‰ç±»ä¼¼çš„ç¬¦å·æ¦‚å¿µã€‚</p>
<h2 id="å¯è§ç¨‹åº¦visibility">å¯è§ç¨‹åº¦ï¼ˆVisibilityï¼‰</h2>
<p>åœ¨ä¸æ˜ç¡®æŒ‡å®šçš„é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™äº›ç¬¦å·å‡æ˜¯æš´éœ²ç»™å¤–ç•Œçš„ã€‚ä½† gcc ç¼–è¯‘å™¨éƒ½å¯ä»¥é€šè¿‡ <code>-fvisibility</code> å‚æ•°è®¾å®šå¯è§ç¨‹åº¦ï¼Œä½†ä¼˜å…ˆçº§ä½äºç›´æ¥åœ¨æºä»£ç ä¸­å£°æ˜å¯è§ç¨‹åº¦ã€‚<code>-fvisibility=default</code> å³é»˜è®¤å¯è§ç¨‹åº¦ï¼Œ<code>-fvisibility=hidden</code>ï¼Œä½¿å¾—ç¼–è¯‘æºæ–‡ä»¶å†…æœªæ˜ç¡®æŒ‡å®šçš„ç¬¦å·éšè—ã€‚</p>
<p><img src="/img/2019/ivar_access_control_in_obj-c/1.png" alt="1"></p>
<blockquote>
<p>è™½ç„¶çœ‹ä¼¼ clang ä¹Ÿæ”¯æŒè¯¥å‚æ•°ï¼Œä½†åœ¨æµ‹è¯•ä¸­ï¼Œæœ¬æœºçš„ clang å´æ— æ³•è¾¾åˆ°å’Œ gcc åŒæ ·çš„æ•ˆæœã€‚</p>
</blockquote>
<p>å»ºç«‹ä¸€ä¸ª Test.cpp çš„ C++ æºæ–‡ä»¶ï¼Œä½†åœ¨æ–‡ä»¶å†…éƒ¨ä¸è¿›è¡Œä»»ä½•çš„å¯è§ç¨‹åº¦è®¾å®šï¼Œå»ºç«‹ main.cpp å¹¶åœ¨ä¸»å‡½æ•°ä¸­è°ƒç”¨ Test ä¸­çš„æ–¹æ³•ã€‚æˆ‘ä»¬å°†å…ˆæŠŠ Test.cpp ç¼–è¯‘å¹¶æ‰“åŒ…ä¸ºé™æ€åº“æ–‡ä»¶ï¼Œå†ç”¨ main.cpp ç¼–è¯‘å¥½çš„ç›®æ ‡æ–‡ä»¶å°†å…¶é“¾æ¥èµ·æ¥ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="c1">// Test.cpp
</span><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="kt">void</span> <span class="nf">test</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Test&#34;</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// main.cpp
</span><span class="c1"></span><span class="kt">void</span> <span class="nf">test</span><span class="p">();</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">test</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// gcc:
</span><span class="c1">// âœ  ~ g++ -shared -o libTest.so Test.cpp
</span><span class="c1">// âœ  ~ g++ -o main main.cpp -L ./ -lTest
</span><span class="c1">// âœ  ~ ./main
</span><span class="c1">// Testâ
</span><span class="c1"></span>
<span class="c1">// clang:
</span><span class="c1">// âœ  ~ clang++ -c Test.cpp
</span><span class="c1">// âœ  ~ ar -r libTest.a Test.o
</span><span class="c1">// ar: creating archive libTest.a
</span><span class="c1">// âœ  ~ clang++ -c main.cpp
</span><span class="c1">// âœ  ~ clang++ main.o -L. -lTest -o main
</span><span class="c1">// âœ  ~ ./main
</span><span class="c1">// Testâ
</span></code></pre></div><p>ä½¿ç”¨ <code>nm</code> æŸ¥çœ‹å…¶ç¬¦å·è¡¨ï¼Œæ³¨æ„ï¼šC++ ä¸­çš„ç¬¦å·åœ¨ä½¿ç”¨æ—¶æ˜¯è§£ç è¿‡çš„ï¼Œæ‰€ä»¥é»˜è®¤è¾“å‡ºä¹Ÿæ˜¯è§£ç åçš„ç¬¦å·ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>-C</code> å‚æ•°é™åˆ¶å…¶è§£ç ï¼Œ<code>-C</code> ä¸ <code>-g</code> ä¸€èµ·å¯ä»¥ç›´æ¥ä½¿ç”¨ <code>-gC</code>ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-objectivec" data-lang="objectivec"><span class="c1">// gcc
</span><span class="c1">// âœ  ~ nm libTest.so
</span><span class="c1">// 0000000000000f70 T __Z4testv
</span><span class="c1">//                  U _printf
</span><span class="c1">//                  U dyld_stub_binder
</span><span class="c1"></span>
<span class="c1">// âœ  ~ nm -gC libTest.so
</span><span class="c1">// 0000000000000f70 T test()
</span><span class="c1">//                  U _printf
</span><span class="c1">//                  U dyld_stub_binder
</span><span class="c1"></span>
<span class="c1">// âœ  ~ nm -gC main
</span><span class="c1">//                  U test()
</span><span class="c1">// 0000000100000000 T __mh_execute_header
</span><span class="c1">// 0000000100000f80 T _main
</span><span class="c1">//                  U dyld_stub_binder
</span></code></pre></div><p>ä¿æŒæºä»£ç æ–‡ä»¶ä¸æ›´æ”¹ï¼Œæ·»åŠ ç¼–è¯‘å‚æ•°ä¸º <code>-fvisibility=hidden</code>ï¼Œåˆ™å°†å‡ºç°é“¾æ¥é”™è¯¯ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="c1">// gcc:
</span><span class="c1">// âœ  ~ g++ -shared -o libTest.so -fvisibility=hidden Test.cpp
</span><span class="c1">// âœ  ~ g++ -o app main.cpp -L ./ -lTest
</span><span class="c1">// Undefined symbols for architecture x86_64:
</span><span class="c1">//   &#34;test()&#34;, referenced from:
</span><span class="c1">//       _main in main-0369ae.o
</span><span class="c1">// ld: symbol(s) not found for architecture x86_64
</span><span class="c1">// clang: error: linker command failed with exit code 1 (use -v to see invocation)
</span><span class="c1"></span>
<span class="c1">//âœ  ~ nm -gC libTest.so
</span><span class="c1">//                 U _printf
</span><span class="c1">//                 U dyld_stub_binder
</span></code></pre></div><p>åœ¨ C/C++æºæ–‡ä»¶ä¸­ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ <code>__attribute((visibility(&quot;value&quot;)))</code> è®¾å®šæŸä¸ªæ–¹æ³•æˆ–ç±»çš„å¯è§ç¨‹åº¦ã€‚å°è¯•å°† Test.cpp çš„ <code>test()</code> æ–¹æ³•è®¾ç½®ä¸º <code>hidden</code>ï¼Œä¹Ÿå°†å‡ºç°é“¾æ¥é”™è¯¯ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="c1">// Test.cpp
</span><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="n">__attribute</span><span class="p">((</span><span class="n">visibility</span><span class="p">(</span><span class="s">&#34;hidden&#34;</span><span class="p">)))</span>
<span class="kt">void</span> <span class="n">test</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Test&#34;</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// gcc:
</span><span class="c1">// âœ  ~ g++ -shared -o libTest.so Test.cpp
</span><span class="c1">// âœ  ~ g++ -o app main.cpp -L ./ -lTest
</span><span class="c1">// Undefined symbols for architecture x86_64:
</span><span class="c1">//   &#34;test()&#34;, referenced from:
</span><span class="c1">//       _main in main-45a3c6.o
</span><span class="c1">// ld: symbol(s) not found for architecture x86_64
</span><span class="c1">// clang: error: linker command failed with exit code 1 (use -v to see invocation)
</span><span class="c1"></span>
<span class="c1">// âœ  ~ nm libTest.so
</span><span class="c1">//                  U _printf
</span><span class="c1">//                  U dyld_stub_binder
</span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-objectivec" data-lang="objectivec"><span class="n">__attribute__</span><span class="p">((</span><span class="n">visibility</span><span class="p">(</span><span class="s">&#34;hidden&#34;</span><span class="p">)))</span>
<span class="k">@interface</span> <span class="nc">ClassName</span> : <span class="nc">SomeSuperclass</span>
</code></pre></div><p>å®˜æ–¹æ–‡æ¡£ä¸­æåˆ°ï¼Œåœ¨ Obj-C ä¸­å¯ä»¥é€šè¿‡ <code>__attribute__((visibility(&quot;hidden&quot;)))</code> æ¥è®¾å®šç±»çš„å¯è§ç¨‹åº¦ï¼Œä½†å…³äºè¿™ç‚¹æˆ‘å¹¶æ²¡æœ‰å®è·µæˆåŠŸï¼Œå°è¯•å°†ä»£ç ç¿»è¯‘ä¸º C++ï¼Œä½†ä¼¼ä¹å¹¶æœ‰å› ä¸ºè¯¥è¯­å¥è€Œå¢åŠ æœ‰ç”¨çš„ä¿¡æ¯ã€‚ä½†åœ¨ objc-api.h ä¸­æœ‰é’ˆå¯¹é»˜è®¤å¯è§ç¨‹åº¦ <code>__attribute__((visibility(&quot;default&quot;)))</code> çš„å®å®šä¹‰ï¼Œå®ƒè¢«å®šä¹‰ä¸ºä¸€ä¸ªæ›´ç®€å•ä½¿ç”¨çš„å® <code>OBJC_VISIBLE</code>ï¼ˆå½“ç„¶ï¼Œè¯¥å®åœ¨ Win 32 ç³»ç»Ÿä¸­ä»£è¡¨ <code>__declspec(dllexport)</code> æˆ– <code>__declspec(dllimport)</code>ï¼‰ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-objectivec" data-lang="objectivec"><span class="c1">// objc-api.h
</span><span class="c1"></span><span class="cp">#if !defined(OBJC_VISIBLE)
</span><span class="cp">#   if TARGET_OS_WIN32
</span><span class="cp">#       if defined(BUILDING_OBJC)
</span><span class="cp">#           define OBJC_VISIBLE __declspec(dllexport)
</span><span class="cp">#       else
</span><span class="cp">#           define OBJC_VISIBLE __declspec(dllimport)
</span><span class="cp">#       endif
</span><span class="cp">#   else
</span><span class="cp">#       define OBJC_VISIBLE  __attribute__((visibility(&#34;default&#34;)))
</span><span class="cp">#   endif
</span><span class="cp">#endif
</span></code></pre></div><h2 id="reference">Reference</h2>
<ul>
<li><a href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/ObjectiveC/Chapters/ocDefiningClasses.html#//apple_ref/doc/uid/TP30001163-CH12-SW1">The Objective-C Programming Language - Apple</a></li>
<li><a href="https://developer.apple.com/library/archive/releasenotes/Cocoa/RN-ObjectiveC/index.html#//apple_ref/doc/uid/TP40004309-CH1-DontLinkElementID_7">Objective-C Release Notes - Apple</a></li>
<li><a href="https://developer.apple.com/library/archive/releasenotes/Cocoa/RN-ObjectiveC/index.html#//apple_ref/doc/uid/TP40004309-CH1-SW1">64-bit Class and Instance Variable Access Control - Apple</a></li>
<li><a href="https://stackoverflow.com/questions/772600/what-does-the-package-directive-do-in-objective-c">What does the @package directive do in Objective-C? - StackOverflow</a></li>
<li><a href="https://blog.csdn.net/veryitman/article/details/46756683">GCC ç³»åˆ—: <code>__attribute__((visibility(&quot;&quot;)))</code> - veryitman</a></li>
<li><a href="https://www.ibm.com/support/knowledgecenter/zh/ssw_aix_72/com.ibm.aix.cmds4/nm.htm">nm å‘½ä»¤ - IBM</a></li>
<li><a href="http://clang.llvm.org/docs/AttributeReference.html">Attributes in Clang - LLVM.org</a></li>
<li><a href="../libraries_in_ios/">iOS ä¸­çš„åº“ä¸æ¡†æ¶ - kingcos</a></li>
<li><a href="https://blog.sunnyxx.com/2016/04/22/objc-class-extension-tips/">å·§ç”¨ Class Extension åˆ†ç¦»æ¥å£ä¾èµ– - sunnyxx</a></li>
</ul>
</div>
                    <div class="post_footer">
                        
                        <div class="meta">
                            <div class="info">
                                <span class="field tags">
                                    <i class="ri-stack-line"></i>
                                    
                                    <a href="https://kingcos.me/tags/practice/">Practice</a>
                                    
                                    <a href="https://kingcos.me/tags/ios/">iOS</a>
                                    
                                    <a href="https://kingcos.me/tags/obj-c/">Obj-C</a>
                                    
                                    <a href="https://kingcos.me/tags//">â˜…</a>
                                    
                                </span>
                            </div>
                        </div>
                        
                    </div>
                </div>
                <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<table style="border: 0;">
  <tr>
  <td style="border: 0; width: 30%;">
    <img width='100%' src='/img/about/1.jpg'>
  </td>
  <td style="border: 0; width: 50%;">
    <center>â† å†™å¾—å¦‚ä½•ï¼Ÿè€ƒè™‘<strong>èµèµ</strong>ä¸€ä¸‹ï¼ŸğŸŒš</center>
    
  </td>
  </tr>
</table>

<hr>

<script>
    (adsbygoogle = window.adsbygoogle || []).push({});
</script>
                
                
                







    
    
    
    <div>
        <div id="github-comment">
        </div>

        <script type="text/javascript">
        function getUtterances(isDark) {
            var utterances = document.createElement('script');
            utterances.type = 'text/javascript';
            utterances.async = true;
            utterances.setAttribute('issue-term', "pathname")
            utterances.setAttribute('repo', "kingcos\/kingcos.github.io")
            utterances.setAttribute('label', "comments")
            isDark ? utterances.setAttribute('theme', "github-dark") : utterances.setAttribute('theme', "github-light")
            utterances.crossorigin = 'anonymous';
            utterances.src = 'https://utteranc.es/client.js';

            return utterances
        }
        document.getElementById('github-comment').appendChild(getUtterances(false))
        </script>
    </div>
    




                
            </div>
        </div>
    </div>
    <a id="back_to_top" href="#" class="back_to_top"><i class="ri-arrow-up-s-line"></i></a>
    <footer class="footer">
    <div class="powered_by">
        <a href="https://kingcos.me">Powered by kingcos with love.</a>
    </div>

    <div class="footer_slogan">
        <span>â¤ï¸</span>
    </div>
</footer>
    <script src="https://kingcos.me/js/jquery-3.5.1.min.js"></script>
<link href="https://kingcos.me/css/fancybox.min.css" rel="stylesheet">
<script src="https://kingcos.me/js/fancybox.min.js"></script>
<script src="https://kingcos.me/js/zozo.js"></script>


<script type="text/javascript" async
    src="https://cdn.bootcss.com/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
        MathJax.Hub.Config({
            tex2jax: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\[\[', '\]\]']],
                processEscapes: true,
                processEnvironments: true,
                skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
                TeX: {
                    equationNumbers: { autoNumber: "AMS" },
                    extensions: ["AMSmath.js", "AMSsymbols.js"]
                }
            }
        });

        MathJax.Hub.Queue(function () {
            
            
            
            var all = MathJax.Hub.getAllJax(), i;
            for (i = 0; i < all.length; i += 1) {
                all[i].SourceElement().parentNode.className += ' has-jax';
            }
        });
    </script>

<style>
    code.has-jax {
        font: inherit;
        font-size: 100%;
        background: inherit;
        border: inherit;
        color: #515151;
    }
</style>



<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-138311951-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</body>

</html>