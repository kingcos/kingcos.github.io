<!DOCTYPE html>
<html lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="kingcos" />
	
	
	
	<title>深入 Vue（三） —— Vue 2 中的渲染（草稿） ｜ kingcos</title>
	
    
    
    <meta name="description" content="Dive in Vue" />
    

    
    
    <meta name="keywords" content="Hugo, theme, zozo" />
    

	
    
    <link rel="shortcut icon" href="https://kingcos.me/images/favicon.png" />

    <link rel="stylesheet" type="text/css" media="screen" href="https://kingcos.me/css/normalize.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.0/animate.min.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="https://kingcos.me/css/zozo.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://cdn.jsdelivr.net/npm/remixicon@2.5.0/fonts/remixicon.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="https://kingcos.me/css/highlight.css" />

    
    
</head>




<body>
    <div class="main animate__animated animate__fadeInDown">
        <div class="nav_container animated fadeInDown">
    <div class="site_nav" id="site_nav">
        <ul>
            
            <li>
                <a href="/">Home</a>
            </li>
            
            <li>
                <a href="/posts/">Archive</a>
            </li>
            
            <li>
                <a href="/tags/">Tags</a>
            </li>
            
            <li>
                <a href="/about/">About</a>
            </li>
            
        </ul>
    </div>
    <div class="menu_icon">
        <a id="menu_icon"><i class="ri-menu-line"></i></a>
    </div>
</div>


<link rel="stylesheet" href="https://kingcos.me/scss/main.min.75b49085bfb07b1bf150a1d59b4773d857e0452a747e37243805218b528a4045.css" integrity="sha256-dbSQhb&#43;wexvxUKHVm0dz2FfgRSp0fjckOAUhi1KKQEU=" media="screen">

<style>
.nav_container {
  height: 1rem;
}
 
table {
    width: 100%;
    table-layout: fixed;
}

 
.markdown code {
    white-space: normal;
    word-wrap: break-word;
    word-break: break-word;
    line-height: 1.5em;
    font-size: 0.85em;
    font-weight: bold;
    display: inline-block;
     
}

 
.menu_icon a {
    font-size: 16px;
}

 
body {
    font-family: 'Hiragino Sans GB', 'SFMono', 'Lato', '-apple-system';
    -webkit-font-smoothing: 'antialiased';
}

 
.markdown strong, .markdown b, .markdown em {
    font-weight: bold;
}

.post .post_content p {
     

    line-height: 1.75em;
}

 
.markdown img {
    max-width: 100%;
    margin: 0 auto;
    display: block;
    border-radius: 0.25rem;
}

 
.ri-stack-line {
    vertical-align: middle;
}

 
.ri-map-pin-time-line {
    vertical-align: middle;
}

 
.chroma .lntd:nth-child(2) {
    width: 100%;
}

 

 
.markdown .book-hint::before {
    content: none;
}

.markdown .book-hint {
    margin: 1rem 0;
    padding: 0.5rem 1rem 0.5rem 0.75rem;

    border-inline-start: 0.25rem solid #e9ecef;
    border-radius: 0.25rem;

    font-style: normal;
     
}

.book-hint strong {
    background-color: transparent;
}

.markdown .book-hint.info {
    border-left-color:#6bf;
    background-color:rgba(102,187,255,.1);
}

.markdown .book-hint.warning {
    border-left-color:#fd6;
    background-color:rgba(255,221,102,.1);
}

.markdown .book-hint.danger {
    border-left-color:#f66;
    background-color:rgba(255,102,102,.1);
}

</style>

        <div class="header animated fadeInDown">
    <div class="site_title_container">
        <div class="site_title">
            
                <a href="https://kingcos.me/">
                    
                    <img class="kingcos" style="margin-top: -20px; margin-left: -10px;" src="/title.svg" width="150px">
                </a>
            
        </div>
        <div class="description">
            <p class="sub_title">专注、坚持</p>
            <div class="my_socials">
                
                
                <a href="https://github.com/kingcos" title="github" target="_blank"><i class="ri-github-fill"></i></a>
                
                
                
                <a href="https://www.instagram.com/kingcos_v/" title="instagram" target="_blank"><i class="ri-instagram-fill"></i></a>
                
                
                
                <a href="https://twitter.com/kingcos_v" title="twitter" target="_blank"><i class="ri-twitter-fill"></i></a>
                
                
                
                <a href="https://weibo.com/u/1798410923" title="weibo" target="_blank"><i class="ri-weibo-fill"></i></a>
                
                
                
            </div>
        </div>
    </div>
</div>
        <div class="content">
            <div class="post_page">
                <div class="post animate__animated animate__fadeInDown">
                    <div class="post_title post_detail_title">
                        <h2><a href='/posts/2023/dive_in_vue_03/'>深入 Vue（三） —— Vue 2 中的渲染（草稿）</a></h2>
                        <span class="date">2021.02.25</span>
                        <span>by kingcos</span>
                        
                        
                        
                        
                    </div>
                    <div class="post_content markdown">
<div class="book-expand">
  <label>
    <div class="book-expand-head flex justify-between">
      <span>Release Notes</span>
      <span>↕</span>
    </div>
    <input type="checkbox" class="hidden" />
    <div class="book-expand-content markdown-inner">
      <table>
<thead>
<tr>
<th style="text-align:center">Date</th>
<th style="text-align:center">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">2023-02-25</td>
<td style="text-align:center">首次提交</td>
</tr>
</tbody>
</table>

    </div>
  </label>
</div>

<h2 id="开始">开始</h2>
<p>在<a href="../dive_in_vue_02">上一篇文章</a>中，我们先简单地介绍了 Vue 2 的运行时与编译器的区别，本篇继续尝试深入渲染部分。</p>
<h2 id="仅运行时">仅运行时</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">App</span> <span class="nx">from</span> <span class="s1">&#39;./App&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">Vue</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">productionTip</span> <span class="o">=</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/* eslint-disable no-new */</span>
</span></span><span class="line"><span class="cl"><span class="k">new</span> <span class="nx">Vue</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">el</span><span class="o">:</span> <span class="s1">&#39;#app&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">render</span><span class="o">:</span> <span class="nx">h</span> <span class="p">=&gt;</span> <span class="nx">h</span><span class="p">(</span><span class="nx">App</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></div><p>这里 <code>render</code> 更清晰的代码如下：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="k">new</span> <span class="nx">Vue</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">el</span><span class="o">:</span> <span class="s1">&#39;#app&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">render</span><span class="o">:</span> <span class="p">(</span><span class="nx">fn</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">fn</span><span class="p">(</span><span class="s1">&#39;App&#39;</span><span class="p">,</span> <span class="nx">App</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></div><h3 id="调用链路">调用链路</h3>
<p>上回书说到，当我们在仅运行时的 <code>render</code> 函数中断点时，调用栈如下：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Vue -&gt; Vue._init -&gt; Vue.$mount（挂载） -&gt; mountComponent -&gt; Watcher -&gt; Wacther.get -&gt; updateComponent -&gt; Vue._render -&gt; render（渲染）
</span></span></code></pre></div><p>我们简单从源码里梳理以上的调用关系如下：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="c1">// main.js
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">new</span> <span class="nx">Vue</span><span class="p">({</span> <span class="c1">// &lt;--- HERE
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">el</span><span class="o">:</span> <span class="s1">&#39;#app&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">components</span><span class="o">:</span> <span class="p">{</span> <span class="nx">App</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// template: &#39;&lt;App/&gt;&#39;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">render</span><span class="o">:</span> <span class="p">(</span><span class="nx">fn</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">fn</span><span class="p">(</span><span class="s1">&#39;App&#39;</span><span class="p">,</span> <span class="nx">App</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// vue.runtime.esm.js
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">function</span> <span class="nx">Vue</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">_init</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span> <span class="c1">// &lt;--- HERE
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">initMixin$1</span><span class="p">(</span><span class="nx">Vue</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Vue</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_init</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nx">vm</span><span class="p">.</span><span class="nx">$options</span><span class="p">.</span><span class="nx">el</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">vm</span><span class="p">.</span><span class="nx">$mount</span><span class="p">(</span><span class="nx">vm</span><span class="p">.</span><span class="nx">$options</span><span class="p">.</span><span class="nx">el</span><span class="p">);</span> <span class="c1">// &lt;--- HERE
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">Vue</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">$mount</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="nx">hydrating</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">el</span> <span class="o">=</span> <span class="nx">el</span> <span class="o">&amp;&amp;</span> <span class="nx">inBrowser</span> <span class="o">?</span> <span class="nx">query</span><span class="p">(</span><span class="nx">el</span><span class="p">)</span> <span class="o">:</span> <span class="kc">undefined</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">mountComponent</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">el</span><span class="p">,</span> <span class="nx">hydrating</span><span class="p">);</span> <span class="c1">// &lt;--- HERE
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">mountComponent</span><span class="p">(</span><span class="nx">vm</span><span class="p">,</span> <span class="nx">el</span><span class="p">,</span> <span class="nx">hydrating</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">updateComponent</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/* istanbul ignore if */</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">NODE_ENV</span> <span class="o">!==</span> <span class="s1">&#39;production&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">config</span><span class="p">.</span><span class="nx">performance</span> <span class="o">&amp;&amp;</span> <span class="nx">mark</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">updateComponent</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">vm</span><span class="p">.</span><span class="nx">_update</span><span class="p">(</span><span class="nx">vm</span><span class="p">.</span><span class="nx">_render</span><span class="p">(),</span> <span class="nx">hydrating</span><span class="p">);</span> <span class="c1">// &lt;--- HERE
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">new</span> <span class="nx">Watcher</span><span class="p">(</span><span class="nx">vm</span><span class="p">,</span> <span class="nx">updateComponent</span><span class="p">,</span> <span class="nx">noop</span><span class="p">,</span> <span class="nx">watcherOptions</span><span class="p">,</span> <span class="kc">true</span> <span class="cm">/* isRenderWatcher */</span><span class="p">);</span> <span class="c1">// &lt;--- HERE
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">return</span> <span class="nx">vm</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">Watcher</span> <span class="o">=</span> <span class="cm">/** @class */</span> <span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">function</span> <span class="nx">Watcher</span><span class="p">(</span><span class="nx">vm</span><span class="p">,</span> <span class="nx">expOrFn</span><span class="p">,</span> <span class="nx">cb</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">isRenderWatcher</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// parse expression for getter
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="p">(</span><span class="nx">isFunction</span><span class="p">(</span><span class="nx">expOrFn</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">this</span><span class="p">.</span><span class="nx">getter</span> <span class="o">=</span> <span class="nx">expOrFn</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">lazy</span> <span class="o">?</span> <span class="kc">undefined</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">();</span> <span class="c1">// &lt;--- HERE
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * Evaluate the getter, and re-collect dependencies.
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Watcher</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">get</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">value</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getter</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">vm</span><span class="p">,</span> <span class="nx">vm</span><span class="p">);</span> <span class="c1">// &lt;--- HERE
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">value</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">Watcher</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}());</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">renderMixin</span><span class="p">(</span><span class="nx">Vue</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Vue</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_render</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">vm</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">vnode</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">vnode</span> <span class="o">=</span> <span class="nx">render</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">vm</span><span class="p">.</span><span class="nx">_renderProxy</span><span class="p">,</span> <span class="nx">vm</span><span class="p">.</span><span class="nx">$createElement</span><span class="p">);</span> <span class="c1">// &lt;--- HERE
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">vnode</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="how-_render-works">How <code>_render</code> works?</h3>
<p>我们把 <code>_render</code> 源码的核心部分抽出如下：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="c1">// main.js
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">new</span> <span class="nx">Vue</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">el</span><span class="o">:</span> <span class="s1">&#39;#app&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">render</span><span class="o">:</span> <span class="p">(</span><span class="nx">fn</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">fn</span><span class="p">(</span><span class="s1">&#39;App&#39;</span><span class="p">,</span> <span class="nx">App</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// vue.runtime.esm.js
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">function</span> <span class="nx">renderMixin</span><span class="p">(</span><span class="nx">Vue</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Vue</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_render</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">vm</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// _a: { el: &#39;#app&#39;, ... }, render: render 函数, _parentVnode: undefined
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kd">var</span> <span class="nx">_a</span> <span class="o">=</span> <span class="nx">vm</span><span class="p">.</span><span class="nx">$options</span><span class="p">,</span> <span class="nx">render</span> <span class="o">=</span> <span class="nx">_a</span><span class="p">.</span><span class="nx">render</span><span class="p">,</span> <span class="nx">_parentVnode</span> <span class="o">=</span> <span class="nx">_a</span><span class="p">.</span><span class="nx">_parentVnode</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1">// render self
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kd">var</span> <span class="nx">vnode</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// =====&gt;&gt;&gt; HERE &lt;&lt;&lt;=====
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="nx">vnode</span> <span class="o">=</span> <span class="nx">render</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">vm</span><span class="p">.</span><span class="nx">_renderProxy</span><span class="p">,</span> <span class="nx">vm</span><span class="p">.</span><span class="nx">$createElement</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// set parent
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">vnode</span><span class="p">.</span><span class="nx">parent</span> <span class="o">=</span> <span class="nx">_parentVnode</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">vnode</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>我们将此处的 <code>render</code> 函数的调用及后续链路梳理得更清晰一些：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="c1">// this -&gt; vm._renderProxy
</span></span></span><span class="line"><span class="cl"><span class="c1">// vnode = render(vm.$createElement)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">vnode</span> <span class="o">=</span> <span class="nx">vm</span><span class="p">.</span><span class="nx">$createElement</span><span class="p">(</span><span class="s1">&#39;App&#39;</span><span class="p">,</span> <span class="nx">App</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">initRender</span><span class="p">(</span><span class="nx">vm</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">vm</span><span class="p">.</span><span class="nx">$createElement</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">c</span><span class="p">,</span> <span class="nx">d</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">createElement$1</span><span class="p">(</span><span class="nx">vm</span><span class="p">,</span> <span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">c</span><span class="p">,</span> <span class="nx">d</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">createElement$1</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="nx">tag</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">children</span><span class="p">,</span> <span class="nx">normalizationType</span><span class="p">,</span> <span class="nx">alwaysNormalize</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// context: vm, tag: &#39;App&#39;, data: App, children: undeifined, normalizationType: undeifined, alwaysNormalize: true
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">return</span> <span class="nx">_createElement</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="nx">tag</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">children</span><span class="p">,</span> <span class="nx">normalizationType</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">_createElement</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="nx">tag</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">children</span><span class="p">,</span> <span class="nx">normalizationType</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// context: vm, tag: &#39;App&#39;, data: App, children: undeifined, normalizationType: undeifined
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">var</span> <span class="nx">vnode</span><span class="p">,</span> <span class="nx">ns</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">tag</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">Ctor</span> <span class="o">=</span> <span class="k">void</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// undefined
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// !data.pre === true
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="p">((</span><span class="o">!</span><span class="nx">data</span> <span class="o">||</span> <span class="o">!</span><span class="nx">data</span><span class="p">.</span><span class="nx">pre</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
</span></span><span class="line"><span class="cl">            <span class="nx">isDef</span><span class="p">((</span><span class="nx">Ctor</span> <span class="o">=</span> <span class="nx">resolveAsset</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">$options</span><span class="p">,</span> <span class="s1">&#39;components&#39;</span><span class="p">,</span> <span class="nx">tag</span><span class="p">))))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// Ctor === context.$options[&#39;components&#39;][&#39;App&#39;]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="c1">// component
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="nx">vnode</span> <span class="o">=</span> <span class="nx">createComponent</span><span class="p">(</span><span class="nx">Ctor</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">children</span><span class="p">,</span> <span class="nx">tag</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">isDef</span><span class="p">(</span><span class="nx">vnode</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nx">isDef</span><span class="p">(</span><span class="nx">data</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="nx">registerDeepBindings</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">vnode</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">resolveAsset</span><span class="p">(</span><span class="nx">options</span><span class="p">,</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">warnMissing</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// options: $options, type: &#39;components&#39;, id: &#39;App&#39;, warnMissing: undefined
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">var</span> <span class="nx">assets</span> <span class="o">=</span> <span class="nx">options</span><span class="p">[</span><span class="nx">type</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// check local registration variations first
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="nx">hasOwn</span><span class="p">(</span><span class="nx">assets</span><span class="p">,</span> <span class="nx">id</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">assets</span><span class="p">[</span><span class="nx">id</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">createComponent</span><span class="p">(</span><span class="nx">Ctor</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">children</span><span class="p">,</span> <span class="nx">tag</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Ctor: context.$options[&#39;components&#39;][&#39;App&#39;], data, 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">var</span> <span class="nx">baseCtor</span> <span class="o">=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">$options</span><span class="p">.</span><span class="nx">_base</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// plain options object: turn it into a constructor
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="nx">isObject</span><span class="p">(</span><span class="nx">Ctor</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">Ctor</span> <span class="o">=</span> <span class="nx">baseCtor</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">Ctor</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// async component
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">var</span> <span class="nx">asyncFactory</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">data</span> <span class="o">=</span> <span class="nx">data</span> <span class="o">||</span> <span class="p">{};</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// resolve constructor options in case global mixins are applied after
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// component constructor creation
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">resolveConstructorOptions</span><span class="p">(</span><span class="nx">Ctor</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// extract props
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// @ts-expect-error
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">var</span> <span class="nx">propsData</span> <span class="o">=</span> <span class="nx">extractPropsFromVNodeData</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">Ctor</span><span class="p">,</span> <span class="nx">tag</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// extract listeners, since these needs to be treated as
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// child component listeners instead of DOM listeners
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">var</span> <span class="nx">listeners</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">on</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// replace with listeners with .native modifier
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// so it gets processed during parent component patch.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">data</span><span class="p">.</span><span class="nx">on</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">nativeOn</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// install component management hooks onto the placeholder node
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">installComponentHooks</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// return a placeholder vnode
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// @ts-expect-error
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">var</span> <span class="nx">name</span> <span class="o">=</span> <span class="nx">getComponentName</span><span class="p">(</span><span class="nx">Ctor</span><span class="p">.</span><span class="nx">options</span><span class="p">)</span> <span class="o">||</span> <span class="nx">tag</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">vnode</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">VNode</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// @ts-expect-error
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="s2">&#34;vue-component-&#34;</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">Ctor</span><span class="p">.</span><span class="nx">cid</span><span class="p">).</span><span class="nx">concat</span><span class="p">(</span><span class="nx">name</span> <span class="o">?</span> <span class="s2">&#34;-&#34;</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">),</span> <span class="nx">data</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">// @ts-expect-error
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">{</span> <span class="nx">Ctor</span><span class="o">:</span> <span class="nx">Ctor</span><span class="p">,</span> <span class="nx">propsData</span><span class="o">:</span> <span class="nx">propsData</span><span class="p">,</span> <span class="nx">listeners</span><span class="o">:</span> <span class="nx">listeners</span><span class="p">,</span> <span class="nx">tag</span><span class="o">:</span> <span class="nx">tag</span><span class="p">,</span> <span class="nx">children</span><span class="o">:</span> <span class="nx">children</span> <span class="p">},</span> <span class="nx">asyncFactory</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">vnode</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">VNode</span> <span class="o">=</span> <span class="cm">/** @class */</span> <span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">function</span> <span class="nx">VNode</span><span class="p">(</span><span class="nx">tag</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">children</span><span class="p">,</span> <span class="nx">text</span><span class="p">,</span> <span class="nx">elm</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">componentOptions</span><span class="p">,</span> <span class="nx">asyncFactory</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">tag</span> <span class="o">=</span> <span class="nx">tag</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">data</span> <span class="o">=</span> <span class="nx">data</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">children</span> <span class="o">=</span> <span class="nx">children</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">text</span> <span class="o">=</span> <span class="nx">text</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">elm</span> <span class="o">=</span> <span class="nx">elm</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">ns</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">context</span> <span class="o">=</span> <span class="nx">context</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">fnContext</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">fnOptions</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">fnScopeId</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">key</span> <span class="o">=</span> <span class="nx">data</span> <span class="o">&amp;&amp;</span> <span class="nx">data</span><span class="p">.</span><span class="nx">key</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">componentOptions</span> <span class="o">=</span> <span class="nx">componentOptions</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">componentInstance</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">parent</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">raw</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">isStatic</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">isRootInsert</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">isComment</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">isCloned</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">isOnce</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">asyncFactory</span> <span class="o">=</span> <span class="nx">asyncFactory</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">asyncMeta</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">isAsyncPlaceholder</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">VNode</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="s2">&#34;child&#34;</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// DEPRECATED: alias for componentInstance for backwards compat.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="cm">/* istanbul ignore next */</span>
</span></span><span class="line"><span class="cl">        <span class="nx">get</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">componentInstance</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="nx">enumerable</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">configurable</span><span class="o">:</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">VNode</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}());</span>
</span></span></code></pre></div><p>简而言之，<code>render</code> 函数最后构造了一个 <code>VNode</code> 对象。</p>
<h3 id="how-_update-works">How <code>_update</code> works?</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">lifecycleMixin</span><span class="p">(</span><span class="nx">Vue</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Vue</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_update</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">vnode</span><span class="p">,</span> <span class="nx">hydrating</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">vm</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">prevEl</span> <span class="o">=</span> <span class="nx">vm</span><span class="p">.</span><span class="nx">$el</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">prevVnode</span> <span class="o">=</span> <span class="nx">vm</span><span class="p">.</span><span class="nx">_vnode</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">restoreActiveInstance</span> <span class="o">=</span> <span class="nx">setActiveInstance</span><span class="p">(</span><span class="nx">vm</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">vm</span><span class="p">.</span><span class="nx">_vnode</span> <span class="o">=</span> <span class="nx">vnode</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// Vue.prototype.__patch__ is injected in entry points
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// based on the rendering backend used.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">prevVnode</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// initial render
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="c1">// ===&gt; HERE &lt;===
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="nx">vm</span><span class="p">.</span><span class="nx">$el</span> <span class="o">=</span> <span class="nx">vm</span><span class="p">.</span><span class="nx">__patch__</span><span class="p">(</span><span class="nx">vm</span><span class="p">.</span><span class="nx">$el</span><span class="p">,</span> <span class="nx">vnode</span><span class="p">,</span> <span class="nx">hydrating</span><span class="p">,</span> <span class="kc">false</span> <span class="cm">/* removeOnly */</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// updates
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="nx">vm</span><span class="p">.</span><span class="nx">$el</span> <span class="o">=</span> <span class="nx">vm</span><span class="p">.</span><span class="nx">__patch__</span><span class="p">(</span><span class="nx">prevVnode</span><span class="p">,</span> <span class="nx">vnode</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nx">restoreActiveInstance</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// update __vue__ reference
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="p">(</span><span class="nx">prevEl</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">prevEl</span><span class="p">.</span><span class="nx">__vue__</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nx">vm</span><span class="p">.</span><span class="nx">$el</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">vm</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">__vue__</span> <span class="o">=</span> <span class="nx">vm</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// if parent is an HOC, update its $el as well
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kd">var</span> <span class="nx">wrapper</span> <span class="o">=</span> <span class="nx">vm</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">while</span> <span class="p">(</span><span class="nx">wrapper</span> <span class="o">&amp;&amp;</span>
</span></span><span class="line"><span class="cl">            <span class="nx">wrapper</span><span class="p">.</span><span class="nx">$vnode</span> <span class="o">&amp;&amp;</span>
</span></span><span class="line"><span class="cl">            <span class="nx">wrapper</span><span class="p">.</span><span class="nx">$parent</span> <span class="o">&amp;&amp;</span>
</span></span><span class="line"><span class="cl">            <span class="nx">wrapper</span><span class="p">.</span><span class="nx">$vnode</span> <span class="o">===</span> <span class="nx">wrapper</span><span class="p">.</span><span class="nx">$parent</span><span class="p">.</span><span class="nx">_vnode</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">wrapper</span><span class="p">.</span><span class="nx">$parent</span><span class="p">.</span><span class="nx">$el</span> <span class="o">=</span> <span class="nx">wrapper</span><span class="p">.</span><span class="nx">$el</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="nx">wrapper</span> <span class="o">=</span> <span class="nx">wrapper</span><span class="p">.</span><span class="nx">$parent</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// updated hook is called by the scheduler to ensure that children are
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// updated in a parent&#39;s updated hook.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h2 id="tips">Tips</h2>
<h3 id="vue-2-中的-vm">Vue 2 中的 <code>vm</code></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">initMixin$1</span><span class="p">(</span><span class="nx">Vue</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Vue</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_init</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">vm</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// expose real self
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">vm</span><span class="p">.</span><span class="nx">_self</span> <span class="o">=</span> <span class="nx">vm</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>我们在 Vue 源码中经常看到 <code>vm</code>，其在 <code>_init</code> 中被赋值了 <code>self</code> —— 即 <code>Vue</code> 对象本身。<code>vm</code> 本身其实是 ViewModel 的缩写。</p>
<ul>
<li><a href="https://v2.vuejs.org/v2/guide/instance.html">The Vue Instance - vuejs.org</a></li>
</ul>
<h3 id="fncall--fnapply">fn.call() &amp; fn.apply()</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">fn</span><span class="p">(</span><span class="nx">arg1</span><span class="p">,</span> <span class="nx">arg2</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arg1</span><span class="p">,</span> <span class="nx">arg2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">fn</span><span class="p">();</span>     <span class="c1">// Window {} undefined undefined
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">fn</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>    <span class="c1">// Window {} 1 undefined
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">fn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span> <span class="c1">// Window {} 1 2
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nx">fn</span><span class="p">.</span><span class="nx">call</span><span class="p">();</span>         <span class="c1">// Window {} undefined undefined
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">fn</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>        <span class="c1">// Number {1} undefined undefined
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">fn</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>     <span class="c1">// Number {1} 2 undefined
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">fn</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>  <span class="c1">// Number {1} 2 3
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nx">fn</span><span class="p">.</span><span class="nx">apply</span><span class="p">();</span>           <span class="c1">// Window {} undefined undefined
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">fn</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>          <span class="c1">// Number {1} undefined undefined
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">fn</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">]);</span>     <span class="c1">// Number {1} 2 undefined
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">fn</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]);</span>  <span class="c1">// Number {1} 2 3
</span></span></span></code></pre></div><p><code>call()</code> 的功能也是函数调用，但差别在于第一个参数将被当作 <code>this</code> 指向；<code>apply()</code> 的功能则也是函数调用，但不同的是其最多有两个参数，且第二个参数可以理解为一个参数数组，摊开后传递给调用的函数。</p>
<p>那么此时我有个疑问，如何实现类似两者功能的函数呢？</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">fn</span><span class="p">(</span><span class="nx">arg1</span><span class="p">,</span> <span class="nx">arg2</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arg1</span><span class="p">,</span> <span class="nx">arg2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 使用原型让所有函数均可调用
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nb">Function</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">v_call</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="p">...</span><span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ctx 为 this 指向，默认为全局 window
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">ctx</span> <span class="o">=</span> <span class="nx">ctx</span> <span class="o">||</span> <span class="nb">window</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 将当前函数设为上下文原型的一个属性，避免非对象类型无法保存 func
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">ctx</span><span class="p">.</span><span class="nx">__proto__</span><span class="p">.</span><span class="nx">func</span> <span class="o">=</span> <span class="k">this</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 执行函数并保存返回值，注意这里要避免在原型上执行
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">func</span><span class="p">(...</span><span class="nx">args</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 删除上下文原型的 fn 属性
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">delete</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">__proto__</span><span class="p">.</span><span class="nx">func</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 返回函数执行结果
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">Function</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">v_apply</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// this 指向，默认为全局 window
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">ctx</span> <span class="o">=</span> <span class="nx">ctx</span> <span class="o">||</span> <span class="nb">window</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 将当前函数设为上下文原型的一个属性，避免非对象类型无法保存 func
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">ctx</span><span class="p">.</span><span class="nx">__proto__</span><span class="p">.</span><span class="nx">func</span> <span class="o">=</span> <span class="k">this</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 执行函数并保存返回值，注意这里要避免在原型上执行
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">func</span><span class="p">(...(</span><span class="nx">args</span> <span class="o">||</span> <span class="p">[]))</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 删除上下文原型的 fn 属性
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">delete</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">__proto__</span><span class="p">.</span><span class="nx">func</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 返回函数执行结果
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">fn</span><span class="p">.</span><span class="nx">v_call</span><span class="p">();</span>         <span class="c1">// Window {} undefined undefined
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">fn</span><span class="p">.</span><span class="nx">v_call</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>        <span class="c1">// Number {1} undefined undefined
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">fn</span><span class="p">.</span><span class="nx">v_call</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>     <span class="c1">// Number {1} 2 undefined
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">fn</span><span class="p">.</span><span class="nx">v_call</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>  <span class="c1">// Number {1} 2 3
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nx">fn</span><span class="p">.</span><span class="nx">v_apply</span><span class="p">();</span>           <span class="c1">// Window {} undefined undefined
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">fn</span><span class="p">.</span><span class="nx">v_apply</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>          <span class="c1">// Number {1} undefined undefined
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">fn</span><span class="p">.</span><span class="nx">v_apply</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">]);</span>     <span class="c1">// Number {1} 2 undefined
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">fn</span><span class="p">.</span><span class="nx">v_apply</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]);</span>  <span class="c1">// Number {1} 2 3
</span></span></span></code></pre></div><blockquote>
<p>Q: JavaScript 内置的 call()、apply() 函数的源码具体在哪里
A: `call() 和 apply() 方法是 JavaScript 中的内置函数，它们的实现源码在 JavaScript 引擎中，并不是开放的标准库函数，因此无法直接查看其源码。不过，根据规范，它们的实现方式可以由各个 JavaScript 引擎厂商自行实现，只需要遵循规范定义的函数签名和行为即可。不同 JavaScript 引擎的实现方式可能会有所不同。</p>
</blockquote>
<h3 id="void-0"><code>void 0</code></h3>
<p>在 JavaScript 中，通常使用 <code>void 0</code> 来代替 <code>undefined</code>。这是因为 <code>undefined</code> 不是 JavaScript 的保留字，可能被程序中的其他变量或函数名覆盖。使用 <code>void 0</code> 可以保证得到的始终是 <code>undefined</code>，而不会受到其他因素的影响。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">const</span> <span class="kc">undefined</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">a</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">a</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">// 1
</span></span></span></code></pre></div><h3 id="app-是如何被加载的"><code>App</code> 是如何被加载的？</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">__webpack_exports__</span><span class="p">,</span> <span class="s2">&#34;__esModule&#34;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">value</span><span class="o">:</span> <span class="kc">true</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="cm">/* harmony import */</span> <span class="kd">var</span> <span class="nx">__WEBPACK_IMPORTED_MODULE_0_vue__</span> <span class="o">=</span> <span class="nx">__webpack_require__</span><span class="p">(</span><span class="s2">&#34;./node_modules/vue/dist/vue.runtime.esm.js&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="cm">/* harmony import */</span> <span class="kd">var</span> <span class="nx">__WEBPACK_IMPORTED_MODULE_1__App__</span> <span class="o">=</span> <span class="nx">__webpack_require__</span><span class="p">(</span><span class="s2">&#34;./src/App.vue&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">__WEBPACK_IMPORTED_MODULE_0_vue__</span><span class="p">[</span><span class="s2">&#34;default&#34;</span><span class="p">].</span><span class="nx">config</span><span class="p">.</span><span class="nx">productionTip</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">new</span> <span class="nx">__WEBPACK_IMPORTED_MODULE_0_vue__</span><span class="p">[</span><span class="s2">&#34;default&#34;</span><span class="p">]({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">el</span><span class="o">:</span> <span class="s1">&#39;#app&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">components</span><span class="o">:</span> <span class="p">{</span> <span class="nx">App</span><span class="o">:</span> <span class="nx">__WEBPACK_IMPORTED_MODULE_1__App__</span><span class="p">[</span><span class="s2">&#34;a&#34;</span> <span class="cm">/* default */</span><span class="p">]</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">render</span><span class="p">(</span><span class="nx">fn</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">fn</span><span class="p">(</span><span class="s1">&#39;App&#39;</span><span class="p">,</span> <span class="nx">__WEBPACK_IMPORTED_MODULE_1__App__</span><span class="p">[</span><span class="s2">&#34;a&#34;</span> <span class="cm">/* default */</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></div><hr>
<h3 id="1">1</h3>
<p><code>Watcher</code> 的具体功能类似 <code>miniVue</code> 实现中的 <code>Watcher</code>，负责依赖收集与通知。这里我们暂时略过 <code>Watcher</code> 的源码分析，先对 <code>_render</code> 与 <code>_update</code> 一探究竟：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">lifecycleMixin</span><span class="p">(</span><span class="nx">Vue</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Vue</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_update</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">vnode</span><span class="p">,</span> <span class="nx">hydrating</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">vm</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">prevEl</span> <span class="o">=</span> <span class="nx">vm</span><span class="p">.</span><span class="nx">$el</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">prevVnode</span> <span class="o">=</span> <span class="nx">vm</span><span class="p">.</span><span class="nx">_vnode</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">restoreActiveInstance</span> <span class="o">=</span> <span class="nx">setActiveInstance</span><span class="p">(</span><span class="nx">vm</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">vm</span><span class="p">.</span><span class="nx">_vnode</span> <span class="o">=</span> <span class="nx">vnode</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// Vue.prototype.__patch__ is injected in entry points
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// based on the rendering backend used.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">prevVnode</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// initial render
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="c1">// ===&gt; HERE &lt;===
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="nx">vm</span><span class="p">.</span><span class="nx">$el</span> <span class="o">=</span> <span class="nx">vm</span><span class="p">.</span><span class="nx">__patch__</span><span class="p">(</span><span class="nx">vm</span><span class="p">.</span><span class="nx">$el</span><span class="p">,</span> <span class="nx">vnode</span><span class="p">,</span> <span class="nx">hydrating</span><span class="p">,</span> <span class="kc">false</span> <span class="cm">/* removeOnly */</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// updates
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="nx">vm</span><span class="p">.</span><span class="nx">$el</span> <span class="o">=</span> <span class="nx">vm</span><span class="p">.</span><span class="nx">__patch__</span><span class="p">(</span><span class="nx">prevVnode</span><span class="p">,</span> <span class="nx">vnode</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nx">restoreActiveInstance</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// update __vue__ reference
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="p">(</span><span class="nx">prevEl</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">prevEl</span><span class="p">.</span><span class="nx">__vue__</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nx">vm</span><span class="p">.</span><span class="nx">$el</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">vm</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">__vue__</span> <span class="o">=</span> <span class="nx">vm</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// if parent is an HOC, update its $el as well
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kd">var</span> <span class="nx">wrapper</span> <span class="o">=</span> <span class="nx">vm</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">while</span> <span class="p">(</span><span class="nx">wrapper</span> <span class="o">&amp;&amp;</span>
</span></span><span class="line"><span class="cl">            <span class="nx">wrapper</span><span class="p">.</span><span class="nx">$vnode</span> <span class="o">&amp;&amp;</span>
</span></span><span class="line"><span class="cl">            <span class="nx">wrapper</span><span class="p">.</span><span class="nx">$parent</span> <span class="o">&amp;&amp;</span>
</span></span><span class="line"><span class="cl">            <span class="nx">wrapper</span><span class="p">.</span><span class="nx">$vnode</span> <span class="o">===</span> <span class="nx">wrapper</span><span class="p">.</span><span class="nx">$parent</span><span class="p">.</span><span class="nx">_vnode</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">wrapper</span><span class="p">.</span><span class="nx">$parent</span><span class="p">.</span><span class="nx">$el</span> <span class="o">=</span> <span class="nx">wrapper</span><span class="p">.</span><span class="nx">$el</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="nx">wrapper</span> <span class="o">=</span> <span class="nx">wrapper</span><span class="p">.</span><span class="nx">$parent</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// updated hook is called by the scheduler to ensure that children are
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// updated in a parent&#39;s updated hook.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">renderMixin</span><span class="p">(</span><span class="nx">Vue</span><span class="p">)</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="nx">Vue</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_render</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">vm</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// _a: { el: &#39;#app&#39;, ... }, render: render 函数, _parentVnode: undefined
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kd">var</span> <span class="nx">_a</span> <span class="o">=</span> <span class="nx">vm</span><span class="p">.</span><span class="nx">$options</span><span class="p">,</span> <span class="nx">render</span> <span class="o">=</span> <span class="nx">_a</span><span class="p">.</span><span class="nx">render</span><span class="p">,</span> <span class="nx">_parentVnode</span> <span class="o">=</span> <span class="nx">_a</span><span class="p">.</span><span class="nx">_parentVnode</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// set parent vnode. this allows render functions to have access
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// to the data on the placeholder node.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">vm</span><span class="p">.</span><span class="nx">$vnode</span> <span class="o">=</span> <span class="nx">_parentVnode</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// render self
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kd">var</span> <span class="nx">vnode</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// There&#39;s no need to maintain a stack because all render fns are called
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="c1">// separately from one another. Nested component&#39;s render fns are called
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="c1">// when parent component is patched.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="nx">setCurrentInstance</span><span class="p">(</span><span class="nx">vm</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="nx">currentRenderingInstance</span> <span class="o">=</span> <span class="nx">vm</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="nx">vnode</span> <span class="o">=</span> <span class="nx">render</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">vm</span><span class="p">.</span><span class="nx">_renderProxy</span><span class="p">,</span> <span class="nx">vm</span><span class="p">.</span><span class="nx">$createElement</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">        <span class="k">finally</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">currentRenderingInstance</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="nx">setCurrentInstance</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// set parent
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">vnode</span><span class="p">.</span><span class="nx">parent</span> <span class="o">=</span> <span class="nx">_parentVnode</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">vnode</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><details>
<summary>点击此处即可查看完整源码</summary>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">renderMixin</span><span class="p">(</span><span class="nx">Vue</span><span class="p">)</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="nx">Vue</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_render</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">vm</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// _a: { el: &#39;#app&#39;, ... }, render: render 函数, _parentVnode: undefined
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kd">var</span> <span class="nx">_a</span> <span class="o">=</span> <span class="nx">vm</span><span class="p">.</span><span class="nx">$options</span><span class="p">,</span> <span class="nx">render</span> <span class="o">=</span> <span class="nx">_a</span><span class="p">.</span><span class="nx">render</span><span class="p">,</span> <span class="nx">_parentVnode</span> <span class="o">=</span> <span class="nx">_a</span><span class="p">.</span><span class="nx">_parentVnode</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nx">_parentVnode</span> <span class="o">&amp;&amp;</span> <span class="nx">vm</span><span class="p">.</span><span class="nx">_isMounted</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// 跳过
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="nx">vm</span><span class="p">.</span><span class="nx">$scopedSlots</span> <span class="o">=</span> <span class="nx">normalizeScopedSlots</span><span class="p">(</span><span class="nx">vm</span><span class="p">.</span><span class="nx">$parent</span><span class="p">,</span> <span class="nx">_parentVnode</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">scopedSlots</span><span class="p">,</span> <span class="nx">vm</span><span class="p">.</span><span class="nx">$slots</span><span class="p">,</span> <span class="nx">vm</span><span class="p">.</span><span class="nx">$scopedSlots</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="nx">vm</span><span class="p">.</span><span class="nx">_slotsProxy</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nx">syncSetupSlots</span><span class="p">(</span><span class="nx">vm</span><span class="p">.</span><span class="nx">_slotsProxy</span><span class="p">,</span> <span class="nx">vm</span><span class="p">.</span><span class="nx">$scopedSlots</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// set parent vnode. this allows render functions to have access
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// to the data on the placeholder node.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">vm</span><span class="p">.</span><span class="nx">$vnode</span> <span class="o">=</span> <span class="nx">_parentVnode</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// render self
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kd">var</span> <span class="nx">vnode</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// There&#39;s no need to maintain a stack because all render fns are called
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="c1">// separately from one another. Nested component&#39;s render fns are called
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="c1">// when parent component is patched.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="nx">setCurrentInstance</span><span class="p">(</span><span class="nx">vm</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="nx">currentRenderingInstance</span> <span class="o">=</span> <span class="nx">vm</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="nx">vnode</span> <span class="o">=</span> <span class="nx">render</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">vm</span><span class="p">.</span><span class="nx">_renderProxy</span><span class="p">,</span> <span class="nx">vm</span><span class="p">.</span><span class="nx">$createElement</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// 跳过
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="nx">handleError</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">vm</span><span class="p">,</span> <span class="s2">&#34;render&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// return error render result,
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="c1">// or previous vnode to prevent render error causing blank component
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="cm">/* istanbul ignore else */</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">NODE_ENV</span> <span class="o">!==</span> <span class="s1">&#39;production&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">vm</span><span class="p">.</span><span class="nx">$options</span><span class="p">.</span><span class="nx">renderError</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="nx">vnode</span> <span class="o">=</span> <span class="nx">vm</span><span class="p">.</span><span class="nx">$options</span><span class="p">.</span><span class="nx">renderError</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">vm</span><span class="p">.</span><span class="nx">_renderProxy</span><span class="p">,</span> <span class="nx">vm</span><span class="p">.</span><span class="nx">$createElement</span><span class="p">,</span> <span class="nx">e</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="nx">handleError</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">vm</span><span class="p">,</span> <span class="s2">&#34;renderError&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                    <span class="nx">vnode</span> <span class="o">=</span> <span class="nx">vm</span><span class="p">.</span><span class="nx">_vnode</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nx">vnode</span> <span class="o">=</span> <span class="nx">vm</span><span class="p">.</span><span class="nx">_vnode</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">finally</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">currentRenderingInstance</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="nx">setCurrentInstance</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// if the returned array contains only a single node, allow it
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// 跳过
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="p">(</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">vnode</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">vnode</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">vnode</span> <span class="o">=</span> <span class="nx">vnode</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// return empty vnode in case the render function errored out
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// 跳过
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">vnode</span> <span class="k">instanceof</span> <span class="nx">VNode</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">NODE_ENV</span> <span class="o">!==</span> <span class="s1">&#39;production&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">isArray</span><span class="p">(</span><span class="nx">vnode</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nx">warn</span><span class="p">(</span><span class="s1">&#39;Multiple root nodes returned from render function. Render function &#39;</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">                    <span class="s1">&#39;should return a single root node.&#39;</span><span class="p">,</span> <span class="nx">vm</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="nx">vnode</span> <span class="o">=</span> <span class="nx">createEmptyVNode</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// set parent
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">vnode</span><span class="p">.</span><span class="nx">parent</span> <span class="o">=</span> <span class="nx">_parentVnode</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">vnode</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div></details>
<h2 id="挂载时机">挂载时机</h2>
</div>
                    <div class="post_footer">
                        
                        <div class="meta">
                            <div class="info">
                                <span class="field tags">
                                    <i class="ri-stack-line"></i>
                                    
                                    <a href="https://kingcos.me/tags/fe/">FE</a>
                                    
                                    <a href="https://kingcos.me/tags/focus/">Focus</a>
                                    
                                </span>
                            </div>
                        </div>
                        
                    </div>
                </div>
                <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<table style="border: 0;">
  <tr>
  <td style="border: 0; width: 30%;">
    <img width='100%' src='/img/about/1.jpg'>
  </td>
  <td style="border: 0; width: 50%;">
    
    <ins class="adsbygoogle"
     style="display:block;width:100%;"
     data-ad-client="ca-pub-9925978992661955"
     data-ad-slot="3213735320"
     data-ad-format="rectangle"
     data-full-width-responsive="false"></ins>
  </td>
  </tr>
</table>

<hr>

<script>
    (adsbygoogle = window.adsbygoogle || []).push({});
</script>
                
                
                







    
    
    
    <div>
        <div id="github-comment">
        </div>

        <script type="text/javascript">
        function getUtterances(isDark) {
            var utterances = document.createElement('script');
            utterances.type = 'text/javascript';
            utterances.async = true;
            utterances.setAttribute('issue-term', "pathname")
            utterances.setAttribute('repo', "kingcos\/kingcos.github.io")
            utterances.setAttribute('label', "comments")
            isDark ? utterances.setAttribute('theme', "github-dark") : utterances.setAttribute('theme', "github-light")
            utterances.crossorigin = 'anonymous';
            utterances.src = 'https://utteranc.es/client.js';

            return utterances
        }
        document.getElementById('github-comment').appendChild(getUtterances(false))
        </script>
    </div>
    




                
            </div>
        </div>
    </div>
    <a id="back_to_top" href="#" class="back_to_top"><i class="ri-arrow-up-s-line"></i></a>
    <footer class="footer">
    <div class="powered_by">
        <a href="https://kingcos.me">Powered by kingcos with love.</a>
    </div>

    <div class="footer_slogan">
        <span>❤️</span>
    </div>
</footer>
    <script src="https://kingcos.me/js/jquery-3.5.1.min.js"></script>
<link href="https://kingcos.me/css/fancybox.min.css" rel="stylesheet">
<script src="https://kingcos.me/js/fancybox.min.js"></script>
<script src="https://kingcos.me/js/zozo.js"></script>


<script type="text/javascript" async
    src="https://cdn.bootcss.com/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
        MathJax.Hub.Config({
            tex2jax: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\[\[', '\]\]']],
                processEscapes: true,
                processEnvironments: true,
                skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
                TeX: {
                    equationNumbers: { autoNumber: "AMS" },
                    extensions: ["AMSmath.js", "AMSsymbols.js"]
                }
            }
        });

        MathJax.Hub.Queue(function () {
            
            
            
            var all = MathJax.Hub.getAllJax(), i;
            for (i = 0; i < all.length; i += 1) {
                all[i].SourceElement().parentNode.className += ' has-jax';
            }
        });
    </script>

<style>
    code.has-jax {
        font: inherit;
        font-size: 100%;
        background: inherit;
        border: inherit;
        color: #515151;
    }
</style>



<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-138311951-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</body>

</html>