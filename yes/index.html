<!DOCTYPE html>
<html>
    <head>
        <title>椰树风 🥥</title>
        <meta http-equiv="content-type" content="txt/html; charset=utf-8" />
        <meta content="width=device-width,user-scalable=no" name="viewport" />
    </head>

    <style>

        body {
            font-family: 'Hiragino Sans GB', 'SFMono', 'Lato', '-apple-system';
            background-color: black;
        }
        .container {            
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .content {
            /* border: 2px solid #73AD21;
            border-radius: 25px; */
            /* margin: 20px; */
            padding: 10px;
            /* height: 200px; */
            color: aliceblue;

            /* display: flex; */
            /* flex-direction: column; */
            font-weight: 600;
            word-break: break-all;
            
            font-size: 64px;
            max-width: 90%;
            /* background-color: #ffe733; */
            text-align: justify;
        }

        .block1 {
            border: 3px solid #73AD21;
            border-radius: 10px;
            padding: 5px;
            margin-right: 5px;
            /* line-height: 50px; */
            
            /* border-collapse: collapse; */
           
        }
        
        .block2 {
            border: 3px solid yellow;
            border-radius: 10px;
            padding: 5px;
            background-color: red;
            margin-right: 5px;
        }
        
        .block3 {
            border: 3px solid yellow;
            border-radius: 10px;
            padding: 5px;
            background-color: rgb(91, 91, 236);
            margin-right: 5px;
           
        }
        .block4 {
            /* border: 2px solid #73AD21; */
            border-radius: 10px;
            padding: 5px;
            margin-right: 5px;
           
        }
        .block5 {
            border: 3px solid red;
            border-radius: 10px;
            padding: 5px;
            margin-right: 5px;
           
        }
        .block6 {
            border: 3px solid yellow;
            border-radius: 10px;
            padding: 5px;
            background-color: yellow;
            color: black;
            margin-right: 5px;
        }

        .block7 {
            border: 3px solid #ffe733;
            border-radius: 10px;
            padding: 5px;
            background-color: rgb(255, 29, 29);
            margin-right: 5px;
        }
        
        .block {
            padding: 5px;
            margin-right: 5px;

        }
    </style>

    <body>
        <div class="container">
            <div class="content" id="container">
                <!-- <span class="block1">00000 00000 00000 00000 00000 00000 00000 00000 00000 00000 00000 00000</span> -->
                <!-- <span class="block1">这是一个测试🌹</span>
                <span class="block2">#椰树牌</span>
                <span class="block3">听说瑞幸和椰树联名了耶</span>
                <span class="block4">Hello World</span>
                <span class="block7">🌟 那我可以请你喝咖啡嘛</span>
                <span class="block5">绝绝子 X 椰树风</span>
                <span class="block6">我真的栓 Q 🙏</span>
                <span class="block3">YYDS</span> -->
            </div>
        </div>
        <canvas id="canvas"></canvas>
    </body>
    <script>
    function generateSentences() {
        return [
        "这是一个测试 🌹",
        "#椰树牌",
        "听说瑞幸和椰树联名了耶",
        "Hello World",
        "🌟 那我可以请你喝咖啡嘛",
        "绝绝子 X 椰树风",
        "我真的栓 Q 🙏",
        "YYDS"
    ]
}

getFontSize = function(textCount, targetWidth, font) {
  // https://stackoverflow.com/questions/51032611/find-font-size-to-fit-text-into-a-specific-width-using-pure-js

  // 生成文本
  var text = ''
  for (var i = 0; i < textCount; i++) {
    text += '绝'
  }

  const canvas = document.getElementById('canvas');
  const ctx = canvas.getContext('2d');
  var size = 1;
  ctx.font = size + 'px ' + font;
  while (ctx.measureText(text).width < targetWidth) { 		
    size++;
    ctx.font = size + 'px ' + font;
  }

  console.log('size: ', size)

  return size;
}

getFontWidthHeightRatio = function(font) {
  const text = '绝'
  const canvas = document.getElementById('canvas');
  const ctx = canvas.getContext('2d');
  ctx.font = 32 + 'px ' + font;

  let metrics = ctx.measureText(text)
  let width = metrics.width
  // https://stackoverflow.com/questions/1134586/how-can-you-find-the-height-of-text-on-an-html-canvas
  let height = metrics.fontBoundingBoxAscent + metrics.fontBoundingBoxDescent

  return width / height
}

function getTextCountInOneLine(width, height, fontHeightWidthRatio, allTextCount) {
  let whRatio = width / height
  return Math.sqrt(whRatio / fontWidthHeightRatio * allTextCount)
}

function calculateWordsLength(str) {
    var len = 0;
    for (var i = 0; i < str.length; i++) {
        if (str.charCodeAt(i) > 127 || str.charCodeAt(i) == 94) {
            len += 2;
        } else {
            len++;
        }
    }
    console.log(len);
}

function calculateFontSize(width, height, fontHeightWidthRatio) {
  let font = 'SFMono'
  let text = generateSentences().reduce((acc, cur) => acc + cur + ' ', '')
  let wordsLength = Math.floor(generateSentences().reduce((acc, cur) => acc + cur.length * 10 + 5, 0) / 10)

//   wordsLength = Math.floor(calculateWordsLength(text) / 2)
  // 铺满屏幕
  let wordsInWidth = Math.floor(Math.sqrt(wordsLength * width / height / getFontWidthHeightRatio(font)))

  // 613 533.7 7 46
  console.log(height, width, wordsInWidth, wordsLength)

  return getFontSize(wordsInWidth, width, font)
}

function setupFontSize(size) {
	document.getElementById('container').style.fontSize = size + 'px'
    // let lineHeight = (size > 50 ? size * 1.5 : size * 1.8) + 'px'
    // let lineHeight = (size * 0.8 < 30 ? size + 30 : size * 1.8) + 'px'
    // let lineHeight = size * 1.8 + 'px'

    let lineHeight = size * 1.5
    if (size < 50) {
        // 太小
        lineHeight = size * 2
    } else if (size > 100) {
        // 太大
        lineHeight = size * 1.5
    }

	document.getElementById('container').style.lineHeight = lineHeight + 'px'
    Array.from(document.getElementsByTagName('span')).map(item => {
        item.style.borderRadius = size/3 + 'px'
        item.style.borderWidth = size/10 + 'px'
    })
    // line-height:
    console.log(size)
}

function setup() {
    // 设置 spans

    generateSentences().forEach(item => {
        let index = Math.floor(Math.random() * generateSentences().length)
        let span = document.createElement('span')
        span.className = 'block' + index
        span.innerText = item
        span.style.marginRight = '15px'

        // 设置 style

        document.getElementById('container').appendChild(span)
    })

    let width = window.innerWidth * 0.9
    let height = window.innerHeight

    let fontSize = calculateFontSize(width, height)
    setupFontSize(fontSize)
}

setup()

// setupFontSize(calculateFontSize(window.innerWidth * 0.9, window.innerHeight))

window.onresize = function(res){
    setup()
	// setupFontSize(calculateFontSize(window.innerWidth * 0.9, window.innerHeight))
}
    </script>
</html>