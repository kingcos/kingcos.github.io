<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Swift," />





  <link rel="alternate" href="/atom.xml" title="V2M" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.2" />






<meta name="description" content="Value Type &amp;amp; Reference Type">
<meta property="og:type" content="article">
<meta property="og:title" content="Swift 中的值类型与引用类型">
<meta property="og:url" content="https://maimieng.com/2016/36/index.html">
<meta property="og:site_name" content="V2M">
<meta property="og:description" content="Value Type &amp;amp; Reference Type">
<meta property="og:image" content="https://o7y30w6c6.qnssl.com/blog/swift_vrtype_01.png">
<meta property="og:image" content="https://o7y30w6c6.qnssl.com/blog/swift_vrtype_02.png">
<meta property="og:image" content="https://o7y30w6c6.qnssl.com/blog/swift_vrtype_03.png">
<meta property="og:image" content="https://o7y30w6c6.qnssl.com/blog/swift_vrtype_04.png">
<meta property="og:image" content="https://o7y30w6c6.qnssl.com/blog/swift_vrtype_05.png">
<meta property="og:image" content="https://o7y30w6c6.qnssl.com/blog/swift_vrtype_06.png">
<meta property="og:image" content="https://o7y30w6c6.qnssl.com/blog/swift_vrtype_07.png">
<meta property="og:updated_time" content="2016-11-28T16:47:04.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Swift 中的值类型与引用类型">
<meta name="twitter:description" content="Value Type &amp;amp; Reference Type">
<meta name="twitter:image" content="https://o7y30w6c6.qnssl.com/blog/swift_vrtype_01.png">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '12611462',
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="https://maimieng.com/2016/36/"/>


  <title> Swift 中的值类型与引用类型 | V2M </title>
</head>

<body itemscope itemtype="//schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="//schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">V2M</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">Way to MM.</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-ipro">
          <a href="/ipro" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            Pro.
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Swift 中的值类型与引用类型
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-11-22T00:00:00+08:00" content="2016-11-22">
              2016-11-22
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/36/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/36/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
              &nbsp; | &nbsp;
              <span class="page-pv"><i class="fa fa-file-o"></i>
              <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>
              </span>
          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p><blockquote class="blockquote-center"><br>Value Type &amp; Reference Type<br></blockquote><br><a id="more"></a></p>
<ul>
<li>Info:<ul>
<li>macOS 10.12.2 Beta</li>
<li>Xcode 8.2 Beta</li>
<li>Swift 3.0</li>
</ul>
</li>
</ul>
<p><strong>2016-11-28 Update: 调整了行文顺序，并增加了一部分图文。</strong></p>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>最近在学设计模式中，发现 Swift 中的 struct，class 以及 enum 在一般的使用中能够做到互相替换，因此探究其背后的逻辑就十分有必要。而这一问题又引出了 Swift 中的值类型和引用类型的区别。在网上搜寻一番，虽然也找到很多很棒的资料，不过有的有些过时，或是比较分散，因此总结一篇，以便自己加深印象，也方便与大家交流。</p>
<p>由于 Swift 中的 struct 为值类型，class 为引用类型，因此文中以这两种类型为代表来具体阐述。</p>
<h2 id="stack-amp-heap"><a href="#stack-amp-heap" class="headerlink" title="stack &amp; heap"></a>stack &amp; heap</h2><p>内存（RAM）中有两个区域，栈区（stack）和堆区（heap）。<strong>在 Swift 中，值类型，存放在栈区；引用类型，存放在堆区。</strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">RectClass</span> </span>&#123;</div><div class="line">    <span class="keyword">var</span> height = <span class="number">0.0</span></div><div class="line">    <span class="keyword">var</span> width = <span class="number">0.0</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">RectStruct</span> </span>&#123;</div><div class="line">    <span class="keyword">var</span> height = <span class="number">0.0</span></div><div class="line">    <span class="keyword">var</span> width = <span class="number">0.0</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> rectCls = <span class="type">RectClass</span>()</div><div class="line"><span class="keyword">var</span> rectStrct = <span class="type">RectStruct</span>()</div></pre></td></tr></table></figure>
<p><img src="https://o7y30w6c6.qnssl.com/blog/swift_vrtype_01.png" alt="stack &amp; heap in RAM"></p>
<h2 id="值类型-amp-引用类型"><a href="#值类型-amp-引用类型" class="headerlink" title="值类型 &amp; 引用类型"></a>值类型 &amp; 引用类型</h2><h3 id="值类型（Value-Type）"><a href="#值类型（Value-Type）" class="headerlink" title="值类型（Value Type）"></a>值类型（Value Type）</h3><p><strong>值类型，即每个实例保持一份数据拷贝。</strong></p>
<p>在 Swift 中，典型的有 struct，enum，以及 tuple 都是值类型。而平时使用的 <code>Int</code>，    <code>Double</code>，<code>Float</code>，<code>String</code>，<code>Array</code>，<code>Dictionary</code>，<code>Set</code> 其实都是用结构体实现的，也是值类型。</p>
<p>Swift 中，值类型的赋值为深拷贝（Deep Copy），值语义（Value Semantics）即新对象和源对象是独立的，当改变新对象的属性，源对象不会受到影响，反之同理。</p>
<p><img src="https://o7y30w6c6.qnssl.com/blog/swift_vrtype_02.png" alt="值类型"></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">CoordinateStruct</span> </span>&#123;</div><div class="line">    <span class="keyword">var</span> x: <span class="type">Double</span></div><div class="line">    <span class="keyword">var</span> y: <span class="type">Double</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> coordA = <span class="type">CoordinateStruct</span>(x: <span class="number">0</span>, y: <span class="number">0</span>)</div><div class="line"><span class="keyword">var</span> coordB = coordA</div><div class="line"></div><div class="line">coordA.x = <span class="number">100.0</span></div><div class="line"><span class="built_in">print</span>(<span class="string">"coordA.x -&gt; \(coordA.x)"</span>)</div><div class="line"><span class="built_in">print</span>(<span class="string">"coordB.x -&gt; \(coordB.x)"</span>)</div><div class="line"></div><div class="line"><span class="comment">// coordA.x -&gt; 100.0</span></div><div class="line"><span class="comment">// coordB.x -&gt; 0.0</span></div></pre></td></tr></table></figure>
<p>如果声明一个值类型的<strong>常量</strong>，那么就意味着该常量是不可变的（无论内部数据为 <code>var</code>/<code>let</code>）。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> coordC = <span class="type">CoordinateStruct</span>(x: <span class="number">0</span>, y: <span class="number">0</span>)</div><div class="line"><span class="comment">// WRONG: coordC.x = 100.0</span></div></pre></td></tr></table></figure>
<blockquote>
<p>在 Swift 3.0 中，可以使用 <code>withUnsafePointer(to:_:)</code> 函数来打印<strong>值类型</strong>变量的内存地址，这样就能看出两个变量的内存地址并不相同。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">withUnsafePointer</span>(to: &amp;coordA) &#123; <span class="built_in">print</span>(<span class="string">"\($0)"</span>) &#125;</div><div class="line"><span class="built_in">withUnsafePointer</span>(to: &amp;coordB) &#123; <span class="built_in">print</span>(<span class="string">"\($0)"</span>) &#125;</div><div class="line"></div><div class="line"><span class="comment">// 0x000000011df6ec10</span></div><div class="line"><span class="comment">// 0x000000011df6ec20</span></div></pre></td></tr></table></figure>
<p>在 Swift 中，双等号（<code>==</code> &amp; <code>!=</code>）可以用来比较变量存储的内容是否一致，如果要让我们的 <code>struct</code> 类型支持该符号，则必须遵守 <code>Equatable</code> 协议。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">extension</span> <span class="title">CoordinateStruct</span>: <span class="title">Equatable</span> </span>&#123;</div><div class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> ==<span class="params">(<span class="keyword">left</span>: CoordinateStruct, <span class="keyword">right</span>: CoordinateStruct)</span></span> -&gt; <span class="type">Bool</span> &#123;</div><div class="line">        <span class="keyword">return</span> (<span class="keyword">left</span>.x == <span class="keyword">right</span>.x &amp;&amp; <span class="keyword">left</span>.y == <span class="keyword">right</span>.y)</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">if</span> coordA != coordB &#123;</div><div class="line">    <span class="built_in">print</span>(<span class="string">"coordA != coordB"</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// coordA != coordB</span></div></pre></td></tr></table></figure>
<h3 id="引用类型（Reference-Type）"><a href="#引用类型（Reference-Type）" class="headerlink" title="引用类型（Reference Type）"></a>引用类型（Reference Type）</h3><p><strong>引用类型，即所有实例共享一份数据拷贝。</strong></p>
<p>在 Swift 中，class 和闭包是引用类型。引用类型的赋值是浅拷贝（Shallow Copy），引用语义（Reference Semantics）即新对象和源对象的变量名不同，但其引用（指向的内存空间）是一样的，因此当使用新对象操作其内部数据时，源对象的内部数据也会受到影响。</p>
<p><img src="https://o7y30w6c6.qnssl.com/blog/swift_vrtype_03.png" alt="引用类型"></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span> </span>&#123;</div><div class="line">    <span class="keyword">var</span> height = <span class="number">0.0</span></div><div class="line">    <span class="keyword">var</span> weight = <span class="number">0.0</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> dogA = <span class="type">Dog</span>()</div><div class="line"><span class="keyword">var</span> dogB = dogA</div><div class="line"></div><div class="line">dogA.height = <span class="number">50.0</span></div><div class="line"><span class="built_in">print</span>(<span class="string">"dogA.height -&gt; \(dogA.height)"</span>)</div><div class="line"><span class="built_in">print</span>(<span class="string">"dogB.height -&gt; \(dogB.height)"</span>)</div><div class="line"></div><div class="line"><span class="comment">// dogA.height -&gt; 50.0</span></div><div class="line"><span class="comment">// dogB.height -&gt; 50.0</span></div></pre></td></tr></table></figure>
<p>如果声明一个引用类型的<strong>常量</strong>，那么就意味着该常量的引用不能改变（即不能被同类型变量赋值），但指向的内存中所存储的<strong>变量</strong>是可以改变的。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> dogC = <span class="type">Dog</span>()</div><div class="line">dogC.height = <span class="number">50</span></div><div class="line"></div><div class="line"><span class="comment">// WRONG: dogC = dogA</span></div></pre></td></tr></table></figure>
<blockquote>
<p>在 Swift 3.0 中，可以使用以下方法来打印<strong>引用类型</strong>变量指向的内存地址。从中即可发现，两个变量指向的是同一块内存空间。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">print</span>(<span class="type">Unmanaged</span>.passUnretained(dogA).toOpaque())</div><div class="line"><span class="built_in">print</span>(<span class="type">Unmanaged</span>.passUnretained(dogB).toOpaque())</div><div class="line"></div><div class="line"><span class="comment">// 0x0000600000031380</span></div><div class="line"><span class="comment">// 0x0000600000031380</span></div></pre></td></tr></table></figure>
<p>在 Swift 中，三等号（<code>===</code> &amp; <code>!==</code>）可以用来比较引用类型的引用（即指向的内存地址）是否一致。也可以在遵守 <code>Equatable</code> 协议后，使用双等号（<code>==</code> &amp; <code>!=</code>）用来比较变量的内容是否一致。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (dogA === dogB) &#123;</div><div class="line">    <span class="built_in">print</span>(<span class="string">"dogA === dogB"</span>)</div><div class="line">&#125;</div><div class="line"><span class="comment">// dogA === dogB</span></div><div class="line"></div><div class="line"><span class="keyword">if</span> dogC !== dogA &#123;</div><div class="line">    <span class="built_in">print</span>(<span class="string">"dogC !== dogA"</span>)</div><div class="line">&#125;</div><div class="line"><span class="comment">// dogC !== dogA</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Animal</span>: <span class="title">Equatable</span> </span>&#123;</div><div class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> ==<span class="params">(<span class="keyword">left</span>: Animal, <span class="keyword">right</span>: Animal)</span></span> -&gt; <span class="type">Bool</span> &#123;</div><div class="line">        <span class="keyword">return</span> (<span class="keyword">left</span>.height == <span class="keyword">right</span>.height &amp;&amp; <span class="keyword">left</span>.weight == <span class="keyword">right</span>.weight)</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">if</span> dogC == dogA &#123;</div><div class="line">    <span class="built_in">print</span>(<span class="string">"dogC == dogA"</span>)</div><div class="line">&#125;</div><div class="line"><span class="comment">// dogC == dogA</span></div></pre></td></tr></table></figure>
<h3 id="参数-与-inout"><a href="#参数-与-inout" class="headerlink" title="参数 与 inout"></a>参数 与 inout</h3><h4 id="预备"><a href="#预备" class="headerlink" title="预备"></a>预备</h4><p>定义一个 <code>ResolutionStruct</code> 结构体，以及一个 <code>ResolutionClass</code> 类。这里为了方便打印对象属性，<code>ResolutionClass</code> 类遵从了 <code>CustomStringConvertible</code> 协议。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ResolutionStruct</span> </span>&#123;</div><div class="line">    <span class="keyword">var</span> height = <span class="number">0.0</span></div><div class="line">    <span class="keyword">var</span> width = <span class="number">0.0</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ResolutionClass</span>: <span class="title">CustomStringConvertible</span> </span>&#123;</div><div class="line">    <span class="keyword">var</span> height = <span class="number">0.0</span></div><div class="line">    <span class="keyword">var</span> width = <span class="number">0.0</span></div><div class="line">    </div><div class="line">    <span class="keyword">var</span> description: <span class="type">String</span> &#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">"ResolutionClass(height: \(height), width: \(width))"</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="函数传参"><a href="#函数传参" class="headerlink" title="函数传参"></a>函数传参</h4><p>在 Swift 中，函数的参数默认为<strong>常量</strong>，即在函数体内只能访问参数，而不能修改参数值。具体来说：</p>
<ol>
<li>值类型作为参数传入时，函数体内部不能修改其值</li>
<li>引用类型作为参数传入时，函数体内部不能修改其指向的内存地址，但是可以修改其内部的变量值</li>
</ol>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">(sct: ResolutionStruct)</span></span> &#123;</div><div class="line"><span class="comment">//    WRONG: sct.height = 1080</span></div><div class="line">    </div><div class="line">    <span class="keyword">var</span> sct = sct</div><div class="line">    sct.height = <span class="number">1080</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">(clss: ResolutionClass)</span></span> &#123;</div><div class="line"><span class="comment">//    WRONG: clss = ResolutionClass()</span></div><div class="line">    clss.height = <span class="number">1080</span></div><div class="line">    </div><div class="line">    <span class="keyword">var</span> clss = clss</div><div class="line">    clss = <span class="type">ResolutionClass</span>()</div><div class="line">    clss.height = <span class="number">1440</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>但是如果要改变参数值或引用，那么就可以在函数体内部直接<strong>声明同名变量</strong>，并把原有变量赋值于新变量，那么这个新的变量就可以更改其值或引用。那么在函数参数的作用域和生命周期是什么呢？我们来测试一下，定义两个函数，目的为交换内部的 <code>height</code> 和 <code>width</code>。</p>
<p><strong>值类型</strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">swap</span><span class="params">(resSct: ResolutionStruct)</span></span> -&gt; <span class="type">ResolutionStruct</span> &#123;</div><div class="line">    <span class="keyword">var</span> resSct = resSct</div><div class="line">    <span class="built_in">withUnsafePointer</span>(to: &amp;resSct) &#123; <span class="built_in">print</span>(<span class="string">"During calling: \($0)"</span>) &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">let</span> temp = resSct.height</div><div class="line">    resSct.height = resSct.width</div><div class="line">    resSct.width = temp</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> resSct</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> iPhone4ResoStruct = <span class="type">ResolutionStruct</span>(height: <span class="number">960</span>, width: <span class="number">640</span>)</div><div class="line"><span class="built_in">print</span>(iPhone4ResoStruct)</div><div class="line"><span class="built_in">withUnsafePointer</span>(to: &amp;iPhone4ResoStruct) &#123; <span class="built_in">print</span>(<span class="string">"Before calling: \($0)"</span>) &#125;</div><div class="line"><span class="built_in">print</span>(<span class="built_in">swap</span>(resSct: iPhone4ResoStruct))</div><div class="line"><span class="built_in">print</span>(iPhone4ResoStruct)</div><div class="line"><span class="built_in">withUnsafePointer</span>(to: &amp;iPhone4ResoStruct) &#123; <span class="built_in">print</span>(<span class="string">"After calling: \($0)"</span>) &#125;</div><div class="line"></div><div class="line"><span class="comment">// ResolutionStruct(height: 960.0, width: 640.0)</span></div><div class="line"><span class="comment">// Before calling: 0x00000001138d6f50</span></div><div class="line"><span class="comment">// During calling: 0x00007fff5a512148</span></div><div class="line"><span class="comment">// ResolutionStruct(height: 640.0, width: 960.0)</span></div><div class="line"><span class="comment">// ResolutionStruct(height: 960.0, width: 640.0)</span></div><div class="line"><span class="comment">// After calling: 0x00000001138d6f50</span></div></pre></td></tr></table></figure>
<p>小结：在调用函数前后，外界变量值并<strong>没有</strong>因为函数内对参数的修改而发生变化，而且函数体内参数的内存地址与外界<strong>不同</strong>。因此：<strong>当值类型的变量作为参数被传入函数时，相当于创建了新的常量并初始化为传入的变量值，该参数的作用域及生命周期仅存在于函数体内。</strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">swap</span><span class="params">(resCls: ResolutionClass)</span></span> &#123;</div><div class="line">    <span class="built_in">print</span>(<span class="string">"During calling: \(Unmanaged.passUnretained(resCls).toOpaque())"</span>)</div><div class="line">    <span class="keyword">let</span> temp = resCls.height</div><div class="line">    </div><div class="line">    resCls.height = resCls.width</div><div class="line">    resCls.width = temp</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">let</span> iPhone5ResoClss = <span class="type">ResolutionClass</span>()</div><div class="line">iPhone5ResoClss.height = <span class="number">1136</span></div><div class="line">iPhone5ResoClss.width = <span class="number">640</span></div><div class="line"><span class="built_in">print</span>(iPhone5ResoClss)</div><div class="line"><span class="built_in">print</span>(<span class="string">"Before calling: \(Unmanaged.passUnretained(iPhone5ResoClss).toOpaque())"</span>)</div><div class="line"><span class="built_in">swap</span>(resCls: iPhone5ResoClss)</div><div class="line"><span class="built_in">print</span>(iPhone5ResoClss)</div><div class="line"><span class="built_in">print</span>(<span class="string">"After calling: \(Unmanaged.passUnretained(iPhone5ResoClss).toOpaque())"</span>)</div><div class="line"></div><div class="line"><span class="comment">// ResolutionClass(height: 1136.0, width: 640.0)</span></div><div class="line"><span class="comment">// Before calling: 0x00006000000220e0</span></div><div class="line"><span class="comment">// During calling: 0x00006000000220e0</span></div><div class="line"><span class="comment">// ResolutionClass(height: 640.0, width: 1136.0)</span></div><div class="line"><span class="comment">// After calling: 0x00006000000220e0</span></div></pre></td></tr></table></figure>
<p>小结：在调用函数前后，外界变量值随函数内对参数的修改而发生变化，而且函数体内参数的内存地址与外界<strong>一致</strong>。因此：<strong>当引用类型的变量作为参数被传入函数时，相当于创建了新的常量并初始化为传入的变量引用，当函数体内操作参数指向的数据，函数体外也受到了影响。</strong></p>
<h4 id="inout"><a href="#inout" class="headerlink" title="inout"></a>inout</h4><p><code>inout</code>  是 Swift 中的关键字，可以放置于参数类型前，冒号之后。使用 <code>inout</code> 之后，函数体内部可以直接更改参数值，而且改变会保留。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">swap</span><span class="params">(resSct: <span class="keyword">inout</span> ResolutionStruct)</span></span> &#123;</div><div class="line">    <span class="built_in">withUnsafePointer</span>(to: &amp;resSct) &#123; <span class="built_in">print</span>(<span class="string">"During calling: \($0)"</span>) &#125;</div><div class="line">    <span class="keyword">let</span> temp = resSct.height</div><div class="line">    resSct.height = resSct.width</div><div class="line">    resSct.width = temp</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> iPhone6ResoStruct = <span class="type">ResolutionStruct</span>(height: <span class="number">1334</span>, width: <span class="number">750</span>)</div><div class="line"><span class="built_in">print</span>(iPhone6ResoStruct)</div><div class="line"><span class="built_in">withUnsafePointer</span>(to: &amp;iPhone6ResoStruct) &#123; <span class="built_in">print</span>(<span class="string">"Before calling: \($0)"</span>) &#125;</div><div class="line"><span class="built_in">swap</span>(resSct: &amp;iPhone6ResoStruct)</div><div class="line"><span class="built_in">print</span>(iPhone6ResoStruct)</div><div class="line"><span class="built_in">withUnsafePointer</span>(to: &amp;iPhone6ResoStruct) &#123; <span class="built_in">print</span>(<span class="string">"After calling: \($0)"</span>) &#125;</div><div class="line"></div><div class="line"><span class="comment">// ResolutionStruct(height: 1334.0, width: 750.0)</span></div><div class="line"><span class="comment">// Before calling: 0x000000011ce62f50</span></div><div class="line"><span class="comment">// During calling: 0x000000011ce62f50</span></div><div class="line"><span class="comment">// ResolutionStruct(height: 750.0, width: 1334.0)</span></div><div class="line"><span class="comment">// After calling: 0x000000011ce62f50</span></div></pre></td></tr></table></figure>
<p>小结：<strong>值类型变量作为参数传入函数，外界和函数参数的内存地址一致，函数内对参数的更改得到了保留。</strong></p>
<p>引用类型也可以使用 <code>inout</code> 参数，但意义不大。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">swap</span><span class="params">(clss: <span class="keyword">inout</span> ResolutionClass)</span></span> &#123;</div><div class="line">    <span class="built_in">print</span>(<span class="string">"During calling: \(Unmanaged.passUnretained(clss).toOpaque())"</span>)</div><div class="line">    <span class="keyword">let</span> temp = clss.height</div><div class="line">    clss.height = clss.width</div><div class="line">    clss.width = temp</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> iPhone7PlusResClss = <span class="type">ResolutionClass</span>()</div><div class="line">iPhone7PlusResClss.height = <span class="number">1080</span></div><div class="line">iPhone7PlusResClss.width = <span class="number">1920</span></div><div class="line"><span class="built_in">print</span>(iPhone7PlusResClss)</div><div class="line"><span class="built_in">print</span>(<span class="string">"Before calling: \(Unmanaged.passUnretained(iPhone7PlusResClss).toOpaque())"</span>)</div><div class="line"><span class="built_in">swap</span>(clss: &amp;iPhone7PlusResClss)</div><div class="line"><span class="built_in">print</span>(iPhone7PlusResClss)</div><div class="line"><span class="built_in">print</span>(<span class="string">"After calling: \(Unmanaged.passUnretained(iPhone7PlusResClss).toOpaque())"</span>)</div><div class="line"></div><div class="line"><span class="comment">// ResolutionClass(height: 1080.0, width: 1920.0)</span></div><div class="line"><span class="comment">// Before calling: 0x000060000003e580</span></div><div class="line"><span class="comment">// During calling: 0x000060000003e580</span></div><div class="line"><span class="comment">// ResolutionClass(height: 1920.0, width: 1080.0)</span></div><div class="line"><span class="comment">// After calling: 0x000060000003e580</span></div></pre></td></tr></table></figure>
<p>需要注意的是：</p>
<ol>
<li>使用 <code>inout</code> 关键字的函数，在调用时需要在该参数前加上 <code>&amp;</code> 符号</li>
<li><code>inout</code> 参数在传入时必须为变量，不能为常量或字面量（literal）</li>
<li><code>inout</code> 参数不能有默认值，不能为可变参数</li>
<li><code>inout</code> 参数不等同于函数返回值，是一种使参数的作用域超出函数体的方式</li>
<li>多个 <code>inout</code> 参数不能同时传入同一个变量，因为拷入拷出的顺序不定，那么最终值也不能确定</li>
</ol>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Point</span> </span>&#123;</div><div class="line">    <span class="keyword">var</span> x = <span class="number">0.0</span></div><div class="line">    <span class="keyword">var</span> y = <span class="number">0.0</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Rectangle</span> </span>&#123;</div><div class="line">    <span class="keyword">var</span> width = <span class="number">0.0</span></div><div class="line">    <span class="keyword">var</span> height = <span class="number">0.0</span></div><div class="line">    <span class="keyword">var</span> origin = <span class="type">Point</span>()</div><div class="line">    </div><div class="line">    <span class="keyword">var</span> center: <span class="type">Point</span> &#123;</div><div class="line">        <span class="keyword">get</span> &#123;</div><div class="line">            <span class="built_in">print</span>(<span class="string">"center GETTER call"</span>)</div><div class="line">            <span class="keyword">return</span> <span class="type">Point</span>(x: origin.x + width / <span class="number">2</span>,</div><div class="line">                         y: origin.y + height / <span class="number">2</span>)</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="keyword">set</span> &#123;</div><div class="line">            <span class="built_in">print</span>(<span class="string">"center SETTER call"</span>)</div><div class="line">            origin.x = newValue.x - width / <span class="number">2</span></div><div class="line">            origin.y = newValue.y - height / <span class="number">2</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">reset</span><span class="params">(center: <span class="keyword">inout</span> Point)</span></span> &#123;</div><div class="line">        center.x = <span class="number">0.0</span></div><div class="line">        center.y = <span class="number">0.0</span></div><div class="line">    &#125;</div><div class="line">    </div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> rect = <span class="type">Rectangle</span>(width: <span class="number">100</span>, height: <span class="number">100</span>, origin: <span class="type">Point</span>(x: -<span class="number">100</span>, y: -<span class="number">100</span>))</div><div class="line"><span class="built_in">print</span>(rect.center)</div><div class="line">rect.reset(center: &amp;rect.center)</div><div class="line"><span class="built_in">print</span>(rect.center)</div><div class="line"></div><div class="line"><span class="comment">// center GETTER call</span></div><div class="line"><span class="comment">// Point(x: -50.0, y: -50.0)</span></div><div class="line"></div><div class="line"><span class="comment">// center GETTER call</span></div><div class="line"><span class="comment">// center SETTER call</span></div><div class="line"></div><div class="line"><span class="comment">// center GETTER call</span></div><div class="line"><span class="comment">// Point(x: 0.0, y: 0.0)</span></div></pre></td></tr></table></figure>
<p><code>inout</code> 参数的传递过程：</p>
<ol>
<li>当函数被调用时，参数值被拷贝</li>
<li>在函数体内，被拷贝的参数修改</li>
<li>函数返回时，被拷贝的参数值被赋值给原有的变量</li>
</ol>
<p>官方称这个行为为：<code>copy-in copy-out</code> 或 <code>call by value result</code>。我们可以使用 KVO 或计算属性来跟踪这一过程，这里以计算属性为例。排除在调用函数之前与之后的 <code>center GETTER call</code>，从中可以发现：参数值先被获取到（setter 被调用），接着被设值（setter 被调用）。</p>
<p>根据 <code>inout</code> 参数的传递过程，可以得知：<code>inout</code> 参数的本质与引用类型的传参并不是同一回事。<code>inout</code> 参数打破了其生命周期，是一个可变浅拷贝。在 Swift 3.0 中，也彻底摒除了在逃逸闭包（Escape Closure）中被捕获。苹果官方也有如下的说明：</p>
<blockquote>
<p>As an optimization, when the argument is a value stored at a physical address in memory, the same memory location is used both inside and outside the function body. The optimized behavior is known as <em>call by reference</em>; it satisfies all of the requirements of the copy-in copy-out model while removing the overhead of copying. Write your code using the model given by copy-in copy-out, without depending on the call-by-reference optimization, so that it behaves correctly with or without the optimization.</p>
<p>作为一种优化，当参数是一个存储于内存中实际地址的值时，函数体内外共用相同的一块内存地址。该优化行为被称作<em>通过引用调用</em>；其满足 copy-in copy-out 模型的所有必需条件，同时消除了拷贝时的开销。不依赖于通过引用调用的优化，使用 copy-in copy-out 提供的模型来写代码，以便在进不进行优化时（都能）正确运行。</p>
</blockquote>
<h3 id="嵌套类型"><a href="#嵌套类型" class="headerlink" title="嵌套类型"></a>嵌套类型</h3><p>在实际使用中，其实值类型和引用类型并不是孤立的，有时值类型里会存在引用类型的变量，反之亦然。这里简要介绍这四种嵌套类型。</p>
<h4 id="值类型嵌套值类型"><a href="#值类型嵌套值类型" class="headerlink" title="值类型嵌套值类型"></a>值类型嵌套值类型</h4><p>值类型嵌套值类型时，赋值时创建了新的变量，两者是独立的，嵌套的值类型变量也会创建新的变量，这两者也是独立的。</p>
<p><img src="https://o7y30w6c6.qnssl.com/blog/swift_vrtype_04.png" alt="值类型嵌套值类型"></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Circle</span> </span>&#123;</div><div class="line">    <span class="keyword">var</span> radius: <span class="type">Double</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> circleA = <span class="type">Circle</span>(radius: <span class="number">5.0</span>)</div><div class="line"><span class="keyword">var</span> circleB = circleA</div><div class="line">circleA.radius = <span class="number">10</span></div><div class="line"><span class="built_in">print</span>(circleA)</div><div class="line"><span class="built_in">print</span>(circleB)</div><div class="line"><span class="built_in">withUnsafePointer</span>(to: &amp;circleA) &#123; <span class="built_in">print</span>(<span class="string">"circleA: \($0)"</span>) &#125;</div><div class="line"><span class="built_in">withUnsafePointer</span>(to: &amp;circleB) &#123; <span class="built_in">print</span>(<span class="string">"circleB: \($0)"</span>) &#125;</div><div class="line"><span class="built_in">withUnsafePointer</span>(to: &amp;circleA.radius) &#123; <span class="built_in">print</span>(<span class="string">"circleA.radius: \($0)"</span>) &#125;</div><div class="line"><span class="built_in">withUnsafePointer</span>(to: &amp;circleB.radius) &#123; <span class="built_in">print</span>(<span class="string">"circleB.radius: \($0)"</span>) &#125;</div><div class="line"></div><div class="line"><span class="comment">// Circle(radius: 10.0)</span></div><div class="line"><span class="comment">// Circle(radius: 5.0)</span></div><div class="line"><span class="comment">// circleA: 0x000000011dc6dc90</span></div><div class="line"><span class="comment">// circleB: 0x000000011dc6dc98</span></div><div class="line"><span class="comment">// circleA.radius: 0x000000011dc6dc90</span></div><div class="line"><span class="comment">// circleB.radius: 0x000000011dc6dc98</span></div></pre></td></tr></table></figure>
<h4 id="值类型嵌套引用类型"><a href="#值类型嵌套引用类型" class="headerlink" title="值类型嵌套引用类型"></a>值类型嵌套引用类型</h4><p>值类型嵌套引用类型时，赋值时创建了新的变量，两者是独立的，但嵌套的引用类型指向的是同一块内存空间，当改变值类型内部嵌套的引用类型变量值时（除了重新初始化），其他对象的该属性也会随之改变。</p>
<p><img src="https://o7y30w6c6.qnssl.com/blog/swift_vrtype_05.png" alt="值类型嵌套引用类型"></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">PointClass</span>: <span class="title">CustomStringConvertible</span> </span>&#123;</div><div class="line">    <span class="keyword">var</span> x: <span class="type">Double</span></div><div class="line">    <span class="keyword">var</span> y: <span class="type">Double</span></div><div class="line">    </div><div class="line">    <span class="keyword">var</span> description: <span class="type">String</span> &#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">"(\(x), \(y))"</span></div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">init</span>(x: <span class="type">Double</span>, y: <span class="type">Double</span>) &#123;</div><div class="line">        <span class="keyword">self</span>.x = x</div><div class="line">        <span class="keyword">self</span>.y = y</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Circle</span> </span>&#123;</div><div class="line">    <span class="keyword">var</span> center: <span class="type">PointClass</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> circleA = <span class="type">Circle</span>(center: <span class="type">PointClass</span>(x: <span class="number">0.0</span>, y: <span class="number">0.0</span>))</div><div class="line"><span class="keyword">var</span> circleB = circleA</div><div class="line">circleA.center.x = <span class="number">10.0</span></div><div class="line"><span class="built_in">print</span>(circleA)</div><div class="line"><span class="built_in">print</span>(circleB)</div><div class="line"><span class="built_in">withUnsafePointer</span>(to: &amp;circleA) &#123; <span class="built_in">print</span>(<span class="string">"circleA: \($0)"</span>) &#125;</div><div class="line"><span class="built_in">withUnsafePointer</span>(to: &amp;circleB) &#123; <span class="built_in">print</span>(<span class="string">"circleB: \($0)"</span>) &#125;</div><div class="line"><span class="built_in">print</span>(<span class="string">"circleA.center: \(Unmanaged.passUnretained(circleA.center).toOpaque())"</span>)</div><div class="line"><span class="built_in">print</span>(<span class="string">"circleB.center: \(Unmanaged.passUnretained(circleB.center).toOpaque())"</span>)</div><div class="line"></div><div class="line"><span class="comment">// Circle(center: (10.0, 0.0))</span></div><div class="line"><span class="comment">// Circle(center: (10.0, 0.0))</span></div><div class="line"><span class="comment">// circleA: 0x0000000118251fa0</span></div><div class="line"><span class="comment">// circleB: 0x0000000118251fa8</span></div><div class="line"><span class="comment">// circleA.center: 0x000060000003e100</span></div><div class="line"><span class="comment">// circleB.center: 0x000060000003e100</span></div></pre></td></tr></table></figure>
<h4 id="引用类型嵌套值类型"><a href="#引用类型嵌套值类型" class="headerlink" title="引用类型嵌套值类型"></a>引用类型嵌套值类型</h4><p>引用类型嵌套值类型时，赋值时创建了新的变量，但是新变量和源变量指向同一块内存，因此改变源变量的内部值，会影响到其他变量的值。</p>
<p><img src="https://o7y30w6c6.qnssl.com/blog/swift_vrtype_06.png" alt="引用类型嵌套值类型"></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Circle</span>: <span class="title">CustomStringConvertible</span> </span>&#123;</div><div class="line">    <span class="keyword">var</span> radius: <span class="type">Double</span></div><div class="line">    <span class="keyword">var</span> description: <span class="type">String</span> &#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">"Radius:\(radius)"</span></div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">init</span>(radius: <span class="type">Double</span>) &#123;</div><div class="line">        <span class="keyword">self</span>.radius = radius</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> circleA = <span class="type">Circle</span>(radius: <span class="number">0.0</span>)</div><div class="line"><span class="keyword">var</span> circleB = circleA</div><div class="line"></div><div class="line">circleA.radius = <span class="number">5.0</span></div><div class="line"></div><div class="line"><span class="built_in">print</span>(circleA)</div><div class="line"><span class="built_in">print</span>(circleB)</div><div class="line"><span class="built_in">print</span>(<span class="string">"circleA: \(Unmanaged.passUnretained(circleA).toOpaque())"</span>)</div><div class="line"><span class="built_in">print</span>(<span class="string">"circleB: \(Unmanaged.passUnretained(circleB).toOpaque())"</span>)</div><div class="line"><span class="built_in">withUnsafePointer</span>(to: &amp;circleA.radius) &#123; <span class="built_in">print</span>(<span class="string">"circleA.radius: \($0)"</span>) &#125;</div><div class="line"><span class="built_in">withUnsafePointer</span>(to: &amp;circleB.radius) &#123; <span class="built_in">print</span>(<span class="string">"circleB.radius: \($0)"</span>) &#125;</div><div class="line"></div><div class="line"><span class="comment">// Radius:5.0</span></div><div class="line"><span class="comment">// Radius:5.0</span></div><div class="line"><span class="comment">// circleA: 0x000060000003bc80</span></div><div class="line"><span class="comment">// circleB: 0x000060000003bc80</span></div><div class="line"><span class="comment">// circleA.radius: 0x000060000003bc90</span></div><div class="line"><span class="comment">// circleB.radius: 0x000060000003bc90</span></div></pre></td></tr></table></figure>
<h4 id="引用类型嵌套引用类型"><a href="#引用类型嵌套引用类型" class="headerlink" title="引用类型嵌套引用类型"></a>引用类型嵌套引用类型</h4><p>引用类型嵌套引用类型时，赋值时创建了新的变量，但是新变量和源变量指向同一块内存，内部引用类型变量也指向同一块内存地址，改变引用类型嵌套的引用类型的值，也会影响到其他变量的值。</p>
<p><img src="https://o7y30w6c6.qnssl.com/blog/swift_vrtype_07.png" alt="引用类型嵌套引用类型"></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">PointClass</span>: <span class="title">CustomStringConvertible</span> </span>&#123;</div><div class="line">    <span class="keyword">var</span> x: <span class="type">Double</span></div><div class="line">    <span class="keyword">var</span> y: <span class="type">Double</span></div><div class="line">    </div><div class="line">    <span class="keyword">init</span>(x: <span class="type">Double</span>, y: <span class="type">Double</span>) &#123;</div><div class="line">        <span class="keyword">self</span>.x = x</div><div class="line">        <span class="keyword">self</span>.y = y</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">var</span> description: <span class="type">String</span> &#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">"(\(x), \(y))"</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Circle</span>: <span class="title">CustomStringConvertible</span> </span>&#123;</div><div class="line">    <span class="keyword">var</span> center: <span class="type">PointClass</span></div><div class="line">    <span class="keyword">var</span> description: <span class="type">String</span> &#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">"Center:\(center)"</span></div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">init</span>(center: <span class="type">PointClass</span>) &#123;</div><div class="line">        <span class="keyword">self</span>.center = center</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> circleA = <span class="type">Circle</span>(center: <span class="type">PointClass</span>(x: <span class="number">0.0</span>, y: <span class="number">0.0</span>))</div><div class="line"><span class="keyword">let</span> circleB = circleA</div><div class="line"></div><div class="line">circleA.center.x = <span class="number">5.0</span></div><div class="line"><span class="built_in">print</span>(circleA)</div><div class="line"><span class="built_in">print</span>(circleB)</div><div class="line"></div><div class="line"><span class="built_in">print</span>(<span class="string">"circleA: \(Unmanaged.passUnretained(circleA).toOpaque())"</span>)</div><div class="line"><span class="built_in">print</span>(<span class="string">"circleB: \(Unmanaged.passUnretained(circleB).toOpaque())"</span>)</div><div class="line"><span class="built_in">print</span>(<span class="string">"circleA.center: \(Unmanaged.passUnretained(circleA.center).toOpaque())"</span>)</div><div class="line"><span class="built_in">print</span>(<span class="string">"circleB.center: \(Unmanaged.passUnretained(circleB.center).toOpaque())"</span>)</div><div class="line"></div><div class="line"><span class="comment">// Center:(5.0, 0.0)</span></div><div class="line"><span class="comment">// Center:(5.0, 0.0)</span></div><div class="line"><span class="comment">// circleA: 0x0000608000025fa0</span></div><div class="line"><span class="comment">// circleB: 0x0000608000025fa0</span></div><div class="line"><span class="comment">// circleA.center: 0x0000608000025820</span></div><div class="line"><span class="comment">// circleB.center: 0x0000608000025820</span></div></pre></td></tr></table></figure>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>这篇文章是我在着手写 <a href="https://maimieng.com/2016/37/">Swift 中的 struct &amp; class &amp; enum</a> 一文时抽离出来的一篇。主要还是围绕了值类型中的 struct 和引用类型中的 class，在本文 stack &amp; heap 一节中，只是简单描述，因为一直对此部分内容感到迷惑，也查阅很多资料，希望最近可以总结出来一篇小文，与大家分享。</p>
<table>
<thead>
<tr>
<th>When</th>
<th>值类型 Value Type</th>
<th>引用类型 Reference Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td><code>==</code> 有意义时</td>
<td><code>===</code> 有意义时</td>
</tr>
<tr>
<td>2</td>
<td>独立</td>
<td>共享，可变</td>
</tr>
<tr>
<td>3</td>
<td>在多线程使用的数据</td>
<td>-</td>
</tr>
</tbody>
</table>
<p>在本文的叙述中，可能有许多说法与您平时所用的术语略有差池，例如变量指向的内存空间，其实也等价于变量指向的内存地址。在行文过程中，查阅了很多国外的资料，也尽力将语言规范，以免产生歧义，如果有任何错误或建议，您都可以在评论中直接提出，我会研究学习，虚心接受，并作出相应整改。</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a href="https://developer.apple.com/videos/play/wwdc2015/414/" target="_blank" rel="external">WWDC 2015 Building Better Apps with Value Types in Swift</a><br><a href="https://developer.apple.com/swift/blog/?id=10" target="_blank" rel="external">Value and Reference Types</a><br><a href="https://developer.apple.com/library/content/documentation/Swift/Conceptual/Swift_Programming_Language/Functions.html#//apple_ref/doc/uid/TP40014097-CH10-ID173" target="_blank" rel="external">In-Out Parameters</a><br><a href="https://developer.apple.com/library/content/documentation/Swift/Conceptual/Swift_Programming_Language/Declarations.html#//apple_ref/doc/uid/TP40014097-CH34-ID545" target="_blank" rel="external">In-Out Parameters</a><br><a href="https://www.raywenderlich.com/112027/reference-value-types-in-swift-part-1" target="_blank" rel="external">Reference vs Value Types in Swift: Part 1/2</a></p>
<h2 id="延伸阅读"><a href="#延伸阅读" class="headerlink" title="延伸阅读"></a>延伸阅读</h2><p><a href="https://www.raywenderlich.com/112027/reference-value-types-in-swift-part-2" target="_blank" rel="external">Reference vs Value Types in Swift: Part 2/2</a><br><a href="http://www.jianshu.com/p/70684b2e0c15" target="_blank" rel="external">Swift 3 必看：foundation 中数据引用类型改为值类型</a><br><a href="https://github.com/apple/swift-evolution/blob/master/proposals/0069-swift-mutability-for-foundation.md" target="_blank" rel="external">Mutability and Foundation Value Types</a></p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        
  <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
    <div>才疏学浅，如有错误或不当之处，请您一定指出！ 如果能帮到您，那就再好不过了～</div>
    <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
      <span>赏</span>
    </button>
    <div id="QR" style="display: none;">
      
        <div id="wechat" style="display: inline-block">
          <img id="wechat_qr" src="/wechat.jpg" alt="kingcos WeChat Pay"/>
          <p>微信打赏</p>
        </div>
      
      
        <div id="alipay" style="display: inline-block">
          <img id="alipay_qr" src="/alipay.jpg" alt="kingcos Alipay"/>
          <p>支付宝打赏</p>
        </div>
      
    </div>
  </div>


      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Swift/" rel="tag">#Swift</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/35/" rel="next" title="腾讯云 Ubuntu 安装并远程访问 MySQL">
                <i class="fa fa-chevron-left"></i> 腾讯云 Ubuntu 安装并远程访问 MySQL
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/37/" rel="prev" title="Swift 中的字符串截取">
                Swift 中的字符串截取 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2016/36/"
           data-title="Swift 中的值类型与引用类型" data-url="https://maimieng.com/2016/36/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="//schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="https://o7y30w6c6.qnssl.com/blog/avatar.jpg"
               alt="kingcos" />
          <p class="site-author-name" itemprop="name">kingcos</p>
          <p class="site-description motion-element" itemprop="description">Way to MM.</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">71</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">42</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/kingcos" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.v2ex.com/member/kingcos" target="_blank" title="V2EX">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  V2EX
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.jianshu.com/users/b88081164fe8/latest_articles" target="_blank" title="JianShu">
                  
                    <i class="fa fa-fw fa-book"></i>
                  
                  JianShu
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/375975847" target="_blank" title="Weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  Weibo
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://instagram.com/MMDADAO" target="_blank" title="Instagram">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  Instagram
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://twitter.com/mmdadao" target="_blank" title="Twitter">
                  
                    <i class="fa fa-fw fa-twitter"></i>
                  
                  Twitter
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              Links
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://blog.xcatliu.com" title="Xcat Liu's Blog" target="_blank">Xcat Liu's Blog</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://chuangzaoshi.com/" title="创造狮导航" target="_blank">创造狮导航</a>
                </li>
              
            </ul>
          </div>
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#前言"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#stack-amp-heap"><span class="nav-number">2.</span> <span class="nav-text">stack & heap</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#值类型-amp-引用类型"><span class="nav-number">3.</span> <span class="nav-text">值类型 & 引用类型</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#值类型（Value-Type）"><span class="nav-number">3.1.</span> <span class="nav-text">值类型（Value Type）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#引用类型（Reference-Type）"><span class="nav-number">3.2.</span> <span class="nav-text">引用类型（Reference Type）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#参数-与-inout"><span class="nav-number">3.3.</span> <span class="nav-text">参数 与 inout</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#预备"><span class="nav-number">3.3.1.</span> <span class="nav-text">预备</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#函数传参"><span class="nav-number">3.3.2.</span> <span class="nav-text">函数传参</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#inout"><span class="nav-number">3.3.3.</span> <span class="nav-text">inout</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#嵌套类型"><span class="nav-number">3.4.</span> <span class="nav-text">嵌套类型</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#值类型嵌套值类型"><span class="nav-number">3.4.1.</span> <span class="nav-text">值类型嵌套值类型</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#值类型嵌套引用类型"><span class="nav-number">3.4.2.</span> <span class="nav-text">值类型嵌套引用类型</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#引用类型嵌套值类型"><span class="nav-number">3.4.3.</span> <span class="nav-text">引用类型嵌套值类型</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#引用类型嵌套引用类型"><span class="nav-number">3.4.4.</span> <span class="nav-text">引用类型嵌套引用类型</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#总结"><span class="nav-number">4.</span> <span class="nav-text">总结</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参考资料"><span class="nav-number">5.</span> <span class="nav-text">参考资料</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#延伸阅读"><span class="nav-number">6.</span> <span class="nav-text">延伸阅读</span></a></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2015 - 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">kingcos</span>
</div>

<div class="powered-by">
  豫ICP备<a class="theme-link" href="http://www.miibeian.gov.cn/">15002689</a>号
</div>

<div class="theme-info">
  T. -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>

        

<div class="busuanzi-count">

  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv"><i class="fa fa-user"></i><span class="busuanzi-value" id="busuanzi_value_site_uv"></span></span>
  

  
    <span class="site-pv"><i class="fa fa-eye"></i><span class="busuanzi-value" id="busuanzi_value_site_pv"></span></span>
  
  
</div>



        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.2"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.0.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.2"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.2"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"kingcos"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  






  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
       search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();

    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
    'use strict';
    $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
            // get the contents from search data
            isfetched = true;
            $('.popup').detach().appendTo('.header-inner');
            var datas = $( "entry", xmlResponse ).map(function() {
                return {
                    title: $( "title", this ).text(),
                    content: $("content",this).text(),
                    url: $( "url" , this).text()
                };
            }).get();
            var $input = document.getElementById(search_id);
            var $resultContent = document.getElementById(content_id);
            $input.addEventListener('input', function(){
                var matchcounts = 0;
                var str='<ul class=\"search-result-list\">';
                var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                $resultContent.innerHTML = "";
                if (this.value.trim().length > 1) {
                // perform local searching
                datas.forEach(function(data) {
                    var isMatch = false;
                    var content_index = [];
                    var data_title = data.title.trim().toLowerCase();
                    var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                    var data_url = decodeURIComponent(data.url);
                    var index_title = -1;
                    var index_content = -1;
                    var first_occur = -1;
                    // only match artiles with not empty titles and contents
                    if(data_title != '') {
                        keywords.forEach(function(keyword, i) {
                            index_title = data_title.indexOf(keyword);
                            index_content = data_content.indexOf(keyword);
                            if( index_title >= 0 || index_content >= 0 ){
                                isMatch = true;
								if (i == 0) {
                                    first_occur = index_content;
                                }
                            } 
							
                        });
                    }
                    // show search results
                    if (isMatch) {
                        matchcounts += 1;
                        str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                        var content = data.content.trim().replace(/<[^>]+>/g,"");
                        if (first_occur >= 0) {
                            // cut out 100 characters
                            var start = first_occur - 20;
                            var end = first_occur + 80;
                            if(start < 0){
                                start = 0;
                            }
                            if(start == 0){
                                end = 50;
                            }
                            if(end > content.length){
                                end = content.length;
                            }
                            var match_content = content.substring(start, end);
                            // highlight all keywords
                            keywords.forEach(function(keyword){
                                var regS = new RegExp(keyword, "gi");
                                match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                            });

                            str += "<p class=\"search-result\">" + match_content +"...</p>"
                        }
                        str += "</li>";
                    }
                })};
                str += "</ul>";
                if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
                if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
                $resultContent.innerHTML = str;
            });
            proceedsearch();
        }
    });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };

    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>


  
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
  </script>

  <script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
      for (i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
      }
    });
  </script>
  <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


  

  

  


</body>
</html>
